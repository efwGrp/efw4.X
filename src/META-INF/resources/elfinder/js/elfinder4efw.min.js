/*!
 * elFinder - file manager for web
 * Version 2.1.20 (2017-01-11)
 * http://elfinder.org
 * 
 * Copyright 2009-2017, Studio 42
 * Licensed under a 3-clauses BSD license
 */
/*
 * Efw does not support commands:
 * search,resize,places,quicklook,netmount,netunmount,help,extract,chmod,archive
 * Efw Changed download upload send and so on.
 * Efw Adds setReadOnly setHome setHeight setWidth funtions to elfinder object.
 */
!function(e,t){if("function"==typeof define&&define.amd)define(["jquery","jquery-ui"],t);else if("undefined"!=typeof exports){var n,i;try{n=require("jquery"),i=require("jquery-ui")}catch(e){}module.exports=t(n,i)}else t(e.jQuery,e.jQuery.ui,!0)}(this,function(Te,e,t){var n,a,r,o,s,ze=function(u,e){function z(e){var t,n,a,i,r,o,s,l={},d={};2.1<=L.api?(L.commandMap=e.options.uiCmdMap&&Object.keys(e.options.uiCmdMap).length?e.options.uiCmdMap:{},fe!==JSON.stringify(L.commandMap)&&(fe=JSON.stringify(L.commandMap),Object.keys(L.commandMap).length&&((n=L.getUI("contextmenu")).data("cmdMaps")||n.data("cmdMaps",{}),(t=e.cwd?e.cwd.volumeid:null)&&!n.data("cmdMaps")[t]&&(n.data("cmdMaps")[t]=L.commandMap)))):L.options.sync=0,e.init?ee={}:(s=Q,a="elfinder-subtree-loaded "+L.res("class","navexpand"),L.res("class","navcollapse"),i=Object.keys(ee),r=function(e,t){if(!ee[t])return!0;var n="directory"===ee[t].mime,i=ee[t].phash;(!n||l[i]||!d[i]&&Te("#"+L.navHash2Id(ee[t].hash)).is(":hidden")&&100<Te("#"+L.navHash2Id(i)).next(".elfinder-navbar-subtree").children().length)&&(n||i!==Q)&&-1===Te.inArray(t,re)?(n&&!l[i]&&(l[i]=!0,Te("#"+L.navHash2Id(i)).removeClass(a).next(".elfinder-navbar-subtree").empty()),delete ee[t]):n&&(d[i]=!0)},o=function(){i.length&&(Te.each(i.splice(0,100),r),i.length&&setTimeout(o,20))},L.trigger("filesgc").one("filesgc",function(){i=[]}),L.one("opendone",function(){s!==Q&&(u.data("lazycnt")?L.one("lazydone",o):o())})),L.sorters=[],Q=e.cwd.hash,me(e.files),ee[Q]||me([e.cwd]),L.lastDir(Q),L.autoSync()}var s,t,n,i,a,r,o,l,d,c,h,p,f,m,g,v,b,y,w,x,C,k,T,O,S,I,D,A,E,M,U,F,P,H,j,_,R,N,q,L=this,W=(u=Te(u),Te("<div/>").append(u.contents())),K=u.attr("style"),B=u.attr("id")||"",X="elfinder-"+(B||Math.random().toString().substr(2,7)),Y="mousedown."+X,V="keydown."+X,$="keypress."+X,J=!0,G=!0,Q="",Z={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:!0,uploadOverwrite:!0,uploadMaxSize:0,jpgQuality:100,tmbCrop:!1,tmb:!1},ee={},te=[],ne={},ie={},ae=[],re=[],oe=[],se=[],le=new L.command(L),de="auto",ce=400,ue="./sounds/",he=Te(document.createElement("audio")).hide().appendTo("body")[0],pe=0,fe="",me=function(e){var t,n,i={name:!0,perm:!0,date:!0,size:!0,kind:!0},a=0===L.sorters.length,r=e.length;for(n=0;n<r;n++)(t=e[n]).name&&t.hash&&t.mime&&(a&&t.phash===Q&&(Te.each(L.sortRules,function(e){(i[e]||void 0!==t[e]||"mode"===e&&void 0!==t.perm)&&L.sorters.push(e)}),a=!1),t.isroot&&t.phash&&(L.leafRoots[t.phash]?-1===Te.inArray(t.hash,L.leafRoots[t.phash])&&L.leafRoots[t.phash].push(t.hash):L.leafRoots[t.phash]=[t.hash],ee[t.phash]&&(ee[t.phash].dirs||(ee[t.phash].dirs=1),t.ts&&(ee[t.phash].ts||0)<t.ts&&(ee[t.phash].ts=t.ts))),ee[t.hash]=t)},ge=new Date,ve=window.parent!==window,be=function(){var n,e;if(ve)try{(e=Te("iframe",window.parent.document)).length&&Te.each(e,function(e,t){if(t.contentWindow===window)return n=Te(t),!1})}catch(e){}return n}();function ye(e){if(e.target===window&&e.data&&e.data.elm){var t=e.data.elm;b&&clearTimeout(b),b=setTimeout(function(){t.trigger("resize",{maximize:"on"})},100)}}if(this.api=null,this.newAPI=!1,this.oldAPI=!1,this.netDrivers=[],this.options=Te.extend(!0,{},this._options,e||{}),this.options.cssAutoLoad&&(i=this,(d=Te('head > script[src$="js/elfinder.min.js"],script[src$="js/elfinder.full.js"]:first')).length?(r=Te("<style>.elfinder{visibility:hidden;overflow:hidden}</style>"),Te("head").append(r),a=d.attr("src").replace(/js\/[^\/]+$/,""),i.loadCss([a+"css/elfinder.min.css",a+"css/theme.css"]),Te.isArray(i.options.cssAutoLoad)&&i.loadCss(i.options.cssAutoLoad),l=1e3,o=setInterval(function(){0<--l&&"hidden"!==u.css("visibility")&&(clearInterval(o),r.remove(),i.trigger("cssloaded"))},10)):i.options.cssAutoLoad=!1),this.optionProperties=["icon","csscls","tmbUrl","uiCmdMap","netkey"],e.ui&&(this.options.ui=e.ui),e.commands&&(this.options.commands=e.commands),e.uiOptions&&e.uiOptions.toolbar&&(this.options.uiOptions.toolbar=e.uiOptions.toolbar),e.uiOptions&&e.uiOptions.cwd&&e.uiOptions.cwd.listView&&e.uiOptions.cwd.listView.columns&&(this.options.uiOptions.cwd.listView.columns=e.uiOptions.cwd.listView.columns),e.uiOptions&&e.uiOptions.cwd&&e.uiOptions.cwd.listView&&e.uiOptions.cwd.listView.columnsCustomName&&(this.options.uiOptions.cwd.listView.columnsCustomName=e.uiOptions.cwd.listView.columnsCustomName),ve||this.options.enableAlways||2!==Te("body").children().length||(this.options.enableAlways=!0),this.isCORS=!1,(h=document.createElement("a")).href=e.url,e.urlUpload&&e.urlUpload!==e.url&&((c=document.createElement("a")).href=e.urlUpload),(window.location.host!==h.host||c&&window.location.host!==c.host)&&(L.isCORS=!0,Te.isPlainObject(L.options.customHeaders)||(L.options.customHeaders={}),Te.isPlainObject(L.options.xhrFields)||(L.options.xhrFields={}),L.options.requestType="post",L.options.customHeaders["X-Requested-With"]="XMLHttpRequest",L.options.xhrFields.withCredentials=!0),Te.extend(this.options.contextmenu,e.contextmenu),this.requestType=/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get",this.customData=Te.isPlainObject(this.options.customData)?this.options.customData:{},this.customHeaders=Te.isPlainObject(this.options.customHeaders)?this.options.customHeaders:{},this.xhrFields=Te.isPlainObject(this.options.xhrFields)?this.options.xhrFields:{},this.abortCmdsOnOpen=this.options.abortCmdsOnOpen||["tmb"],this.id=B,this.navPrefix="nav"+(ze.prototype.uniqueid?ze.prototype.uniqueid:"")+"-",this.cwdPrefix=ze.prototype.uniqueid?"cwd"+ze.prototype.uniqueid+"-":"",++ze.prototype.uniqueid,this.uploadURL=e.urlUpload||e.url,this.namespace=X,this.lang=this.i18[this.options.lang]&&this.i18[this.options.lang].messages?this.options.lang:"en",n="en"==this.lang?this.i18.en:Te.extend(!0,{},this.i18.en,this.i18[this.lang]),this.direction=n.direction,this.messages=n.messages,this.dateFormat=this.options.dateFormat||n.dateFormat,this.fancyFormat=this.options.fancyDateFormat||n.fancyDateFormat,this.today=new Date(ge.getFullYear(),ge.getMonth(),ge.getDate()).getTime()/1e3,this.yesterday=this.today-86400,t=this.options.UTCDate?"UTC":"",this.getHours="get"+t+"Hours",this.getMinutes="get"+t+"Minutes",this.getSeconds="get"+t+"Seconds",this.getDate="get"+t+"Date",this.getDay="get"+t+"Day",this.getMonth="get"+t+"Month",this.getFullYear="get"+t+"FullYear",this.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+("rtl"==this.direction?"rtl":"ltr")+(this.UA.Touch?" elfinder-touch"+(this.options.resizable?" touch-punch":""):"")+(this.UA.Mobile?" elfinder-mobile":"")+" "+this.options.cssClass,this.zIndex,this.searchStatus={state:0,query:"",target:"",mime:"",mixed:!1,ininc:!1},this.storage=function(){try{return"localStorage"in window&&null!==window.localStorage?(L.UA.Safari&&(window.localStorage.setItem("elfstoragecheck",1),window.localStorage.removeItem("elfstoragecheck")),L.localStorage):L.cookie}catch(e){return L.cookie}}(),this.viewType=this.storage("view")||this.options.defaultView||"icons",this.sortType=this.storage("sortType")||this.options.sortType||"name",this.sortOrder=this.storage("sortOrder")||this.options.sortOrder||"asc",this.sortStickFolders=this.storage("sortStickFolders"),null===this.sortStickFolders?this.sortStickFolders=!!this.options.sortStickFolders:this.sortStickFolders=!!this.sortStickFolders,this.sortAlsoTreeview=this.storage("sortAlsoTreeview"),null===this.sortAlsoTreeview?this.sortAlsoTreeview=!!this.options.sortAlsoTreeview:this.sortAlsoTreeview=!!this.sortAlsoTreeview,this.sortRules=Te.extend(!0,{},this._sortRules,this.options.sortRules),Te.each(this.sortRules,function(e,t){"function"!=typeof t&&delete L.sortRules[e]}),this.compare=Te.proxy(this.compare,this),this.notifyDelay=0<this.options.notifyDelay?parseInt(this.options.notifyDelay):500,this.draggingUiHelper=null,v=V+"draggable keyup."+X+"draggable",L.draggable={appendTo:u,addClasses:!1,distance:4,revert:!0,refreshPositions:!1,cursor:"crosshair",cursorAt:{left:50,top:47},scroll:!1,start:function(e,t){var n,i,a=t.helper,r=Te.map(a.data("files")||[],function(e){return e||null}),o=!1;for(g=u.attr("style"),u.width(u.width()).height(u.height()),p="ltr"===L.direction,f=L.getUI("workzone").data("rectangle"),m=f.top+f.height,L.draggingUiHelper=a,n=r.length;n--;)if(i=r[n],ee[i].locked){o=!0,a.data("locked",!0);break}o||L.trigger("lockfiles",{files:r}),a.data("autoScrTm",setInterval(function(){a.data("autoScr")&&L.autoScroll[a.data("autoScr")](a.data("autoScrVal"))},50))},drag:function(e,t){var n,i=t.helper;(n=f.top>e.pageY)||m<e.pageY?(f.cwdEdge>e.pageX?i.data("autoScr",(p?"navbar":"cwd")+(n?"Up":"Down")):i.data("autoScr",(p?"cwd":"navbar")+(n?"Up":"Down")),i.data("autoScrVal",Math.pow(n?f.top-e.pageY:e.pageY-m,1.3))):i.data("autoScr")&&i.data("refreshPositions",1).data("autoScr",null),i.data("refreshPositions")&&Te(this).elfUiWidgetInstance("draggable")&&(0<i.data("refreshPositions")?(Te(this).draggable("option",{refreshPositions:!0,elfRefresh:!0}),i.data("refreshPositions",-1)):(Te(this).draggable("option",{refreshPositions:!1,elfRefresh:!1}),i.data("refreshPositions",null)))},stop:function(e,t){var n,i=t.helper;Te(document).off(v),Te(this).elfUiWidgetInstance("draggable")&&Te(this).draggable("option",{refreshPositions:!1}),L.draggingUiHelper=null,L.trigger("focus").trigger("dragstop"),i.data("droped")||(n=Te.map(i.data("files")||[],function(e){return e||null}),L.trigger("unlockfiles",{files:n}),L.trigger("selectfiles",{files:n})),L.enable(),u.attr("style",g),i.data("autoScrTm")&&clearInterval(i.data("autoScrTm"))},helper:function(e,t){function n(e){var t,n=e.mime,i=L.tmb(e);return t='<div class="elfinder-cwd-icon '+L.mime2class(n)+' ui-corner-all"/>',i&&(t=Te(t).addClass(i.className).css("background-image","url('"+i.url+"')").get(0).outerHTML),t}var i,a,r,o=this.id?Te(this):Te(this).parents("[id]:first"),s=Te('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-status"/></div>');return L.draggingUiHelper&&L.draggingUiHelper.stop(!0,!0),L.trigger("dragstart",{target:o[0],originalEvent:e}),i=o.hasClass(L.res("class","cwdfile"))?L.selected():[L.navId2Hash(o.attr("id"))],s.append(n(ee[i[0]])).data("files",i).data("locked",!1).data("droped",!1).data("namespace",X).data("dropover",0),1<(a=i.length)&&s.append(n(ee[i[a-1]])+'<span class="elfinder-drag-num">'+a+"</span>"),Te(document).on(v,function(e){var t=e.shiftKey||e.ctrlKey||e.metaKey;r!==t&&(r=t,s.is(":visible")&&s.data("dropover")&&!s.data("droped")&&(s.toggleClass("elfinder-drag-helper-plus",!!s.data("locked")||r),L.trigger(r?"unlockfiles":"lockfiles",{files:i,helper:s})))}),s}},this.droppable={greedy:!0,tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file,.elfinder-cwd-filename",hoverClass:this.res("class","adroppable"),classes:{"ui-droppable-hover":this.res("class","adroppable")},autoDisable:!0,drop:function(e,t){var n,i,a,r=Te(this),o=Te.map(t.helper.data("files")||[],function(e){return e||null}),s=[],l=[],d=[],c=t.helper.hasClass("elfinder-drag-helper-plus");if(void 0===e.button||t.helper.data("namespace")!==X||!L.insideWorkzone(e.pageX,e.pageY))return!1;for(i=r.hasClass(L.res("class","cwdfile"))?L.cwdId2Hash(r.attr("id")):r.hasClass(L.res("class","navdir"))?L.navId2Hash(r.attr("id")):Q,n=o.length;n--;)(a=o[n])!=i&&ee[a].phash!=i?s.push(a):(c&&a!==i&&ee[i].write?l:d).push(a);if(d.length)return!1;t.helper.data("droped",!0),l.length&&(t.helper.hide(),L.exec("duplicate",l)),s.length&&(t.helper.hide(),L.clipboard(s,!c),L.exec("paste",i,void 0,i).always(function(){L.clipboard([]),L.trigger("unlockfiles",{files:o})}),L.trigger("drop",{files:o}))}},this.enabled=function(){return J&&this.visible()},this.visible=function(){return u[0].elfinder&&u.is(":visible")},this.isRoot=function(e){return!(!e.isroot&&e.phash)},this.root=function(n,e){var i,t;if(n=n||Q,!e&&(Te.each(L.roots,function(e,t){if(0===n.indexOf(e))return i=t,!1}),i))return i;for(i=ee[n];i&&i.phash&&(e||!i.isroot);)i=ee[i.phash];if(i)return i.hash;for(;t in ee&&ee.hasOwnProperty(t);)if(!(i=ee[t]).phash&&"directory"==!i.mime&&i.read)return i.hash;return""},this.cwd=function(){return ee[Q]||{}},this.option=function(n,i){var a;return i=i||Q,L.optionsByHashes[i]&&void 0!==L.optionsByHashes[i][n]?L.optionsByHashes[i][n]:Q!==i?(a="",Te.each(L.volOptions,function(e,t){if(0===i.indexOf(e))return a=t[n]||"",!1}),a):Z[n]||""},this.getDisabledCmds=function(e){var i=[];return Te.isArray(e)||(e=[e]),Te.each(e,function(e,t){var n=L.option("disabled",t);n&&Te.each(n,function(e,t){-1===Te.inArray(t,i)&&i.push(t)})}),i},this.file=function(e){return e?ee[e]:void 0},this.files=function(){return Te.extend(!0,{},ee)},this.parents=function(e){for(var t,n=[];t=this.file(e);)n.unshift(t.hash),e=t.phash;return n},this.path2array=function(e,t){for(var n,i=[];e;){if(!(n=ee[e])||!n.hash){i=[];break}i.unshift(t&&n.i18?n.i18:n.name),e=n.isroot?null:n.phash}return i},this.path=function(e,t,n){var i=ee[e]&&ee[e].path?ee[e].path:this.path2array(e,t).join(Z.separator);if(n&&ee[e]){n=Te.extend({notify:{type:"parents",cnt:1,hideCnt:!0}},n);function a(){L.request({data:{cmd:"parents",target:ee[e].phash},notify:s,preventFail:!0}).done(d).fail(function(){o.reject()})}var r,o=Te.Deferred(),s=n.notify,l=!1,d=function(){L.one("parentsdone",function(){""===(i=L.path(e,t))&&l?(l=!1,a()):(s&&(clearTimeout(r),s.cnt=-parseInt(s.cnt||0),L.notify(s)),o.resolve(i))})};return i?o.resolve(i):(L.ui.tree?(s&&(r=setTimeout(function(){L.notify(s)},L.notifyDelay)),d(l=!0)):a(),o)}return i},this.url=function(e){var t,n=ee[e];if(!n||!n.read)return"";if("1"==n.url&&this.request({data:{cmd:"url",target:e},preventFail:!0,options:{async:!1}}).done(function(e){n.url=e.url||""}).fail(function(){n.url=""}),n.url)return n.url;if(t=0===n.hash.indexOf(L.cwd().volumeid)?Z.url:this.option("url",n.hash))return t+Te.map(this.path2array(e),function(e){return encodeURIComponent(e)}).slice(1).join("/");var i=Te.extend({},this.customData,{cmd:"file",target:n.hash});return this.oldAPI&&(i.cmd="open",i.current=n.phash),this.options.url+(-1===this.options.url.indexOf("?")?"?":"&")+Te.param(i,!0)},this.openUrl=function(e,t){var n=ee[e],i="";if(!n||!n.read)return"";if(!t)if(n.url){if(1!=n.url)return n.url}else if(Z.url&&0===n.hash.indexOf(L.cwd().volumeid))return Z.url+Te.map(this.path2array(e),function(e){return encodeURIComponent(e)}).slice(1).join("/");return i=(i=this.options.url)+(-1===i.indexOf("?")?"?":"&")+(this.oldAPI?"cmd=open&current="+n.phash:"cmd=file")+"&target="+n.hash,t&&(i+="&download=1"),Te.each(this.options.customData,function(e,t){i+="&"+encodeURIComponent(e)+"="+encodeURIComponent(t)}),i},this.tmb=function(e){var t,n="elfinder-cwd-bgurl",i="";return!(!Te.isPlainObject(e)||((L.searchStatus.state&&0!==e.hash.indexOf(L.cwd().volumeid)?(t=L.option("tmbUrl",e.hash),L.option("tmbCrop",e.hash)):(t=Z.tmbUrl,Z.tmbCrop))&&(n+=" elfinder-cwd-bgurl-crop"),"self"===t&&0===e.mime.indexOf("image/")?(i=L.openUrl(e.hash),n+=" elfinder-cwd-bgself"):(L.oldAPI||t)&&e&&e.tmb&&1!=e.tmb&&(i=t+e.tmb),!i))&&{url:i,className:n}},this.selected=function(){return te.slice(0)},this.selectedFiles=function(){return Te.map(te,function(e){return ee[e]?Te.extend({},ee[e]):null})},this.fileByName=function(e,t){var n;for(n in ee)if(ee.hasOwnProperty(n)&&ee[n].phash==t&&ee[n].name==e)return ee[n]},this.validResponse=function(e,t){return t.error||this.rules[this.rules[e]?e:"defaults"](t)},this.returnBytes=function(e){var t;return isNaN(e)?(t=(e=(e=e||"").replace(/b$/i,"")).charAt(e.length-1).toLowerCase(),e=e.replace(/[tgmk]$/i,""),"t"==t?e=1024*e*1024*1024*1024:"g"==t?e=1024*e*1024*1024:"m"==t?e=1024*e*1024:"k"==t&&(e*=1024),e=isNaN(e)?0:parseInt(e)):(e=parseInt(e))<1&&(e=0),e},this.request=function(e){function t(e){e.warning&&l.error(e.warning),p&&z(e),l.lazy(function(){e.removed&&e.removed.length&&l.remove(e),e.added&&e.added.length&&l.add(e),e.changed&&e.changed.length&&l.change(e)}).then(function(){return l.lazy(function(){l.trigger(h,e)})}).then(function(){return l.lazy(function(){l.trigger(h+"done")})}).then(function(){e.sync&&l.sync()})}function n(e,t){var n,i;switch(t){case"abort":n=e.quiet?"":["errConnect","errAbort"];break;case"timeout":n=["errConnect","errTimeout"];break;case"parsererror":n=["errResponse","errDataNotJSON"],e.responseText&&(l.debug("backend-debug",{debug:{phpErrors:[e.responseText]}}),Q||e.responseText&&n.push(e.responseText));break;default:if(e.responseText)try{(i=JSON.parse(e.responseText))&&i.error&&(n=i.error)}catch(e){}if(!n)if(403==e.status)n=["errConnect","errAccess","HTTP error "+e.status];else if(404==e.status)n=["errConnect","errNotFound","HTTP error "+e.status];else{if(414==e.status&&"get"===C.type)return C.type="post",void(c.xhr=e=l.transport.send(C).fail(n).done(k));n=e.quiet?"":["errConnect","HTTP error "+e.status]}}l.trigger(h+"done"),c.reject(n,e,t)}function i(e){if(l.trigger(h+"done"),"autosync"==e.type){if("stop"!=e.data.action)return}else if(!("unload"==e.type||"destroy"==e.type||"openxhrabort"==e.type||e.data.added&&e.data.added.length))return;"pending"==o.state()&&(o.quiet=!0,o.abort(),"unload"!=e.type&&"destroy"!=e.type&&l.autoSync())}function a(){if(c.fail(function(e,t,n){l.trigger(h+"fail",n),e&&(f?l.error(e):l.debug("error",l.i18n(e))),y&&l.sync()}),!h)return y=!1,c.reject("errCmdReq");if(l.maxTargets&&u.targets&&u.targets.length>l.maxTargets)return y=!1,c.reject(["errMaxTargets",l.maxTargets]);if(m&&c.done(t),g.type&&g.cnt&&(v&&(g.cancel=c),r=setTimeout(function(){l.notify(g),c.always(function(){g.cnt=-(parseInt(g.cnt)||0),l.notify(g)})},l.notifyDelay),c.always(function(){clearTimeout(r)})),p){for(;s=oe.pop();)"pending"==s.state()&&(s.quiet=!0,s.abort());if(Q!==u.target)for(;s=se.pop();)"pending"==s.state()&&(s.quiet=!0,s.abort())}return-1!==Te.inArray(h,(l.cmdsToAdd+" autosync").split(" "))&&("autosync"!==h&&(l.autoSync("stop"),c.always(function(){l.autoSync()})),l.trigger("openxhrabort")),delete C.preventFail,c.xhr=o=l.transport.send(C).fail(n).done(k),p||u.compare&&"info"===h?(oe.unshift(o),u.compare&&l.bind(l.cmdsToAdd+" autosync openxhrabort",i),c.always(function(){var e=Te.inArray(o,oe);u.compare&&l.unbind(l.cmdsToAdd+" autosync openxhrabort",i),-1!==e&&oe.splice(e,1)})):-1!==Te.inArray(h,l.abortCmdsOnOpen)&&(se.unshift(o),c.always(function(){var e=Te.inArray(o,se);-1!==e&&se.splice(e,1)})),l.bind("unload destroy",i),c.always(function(){l.unbind("unload destroy",i)}),c}var r,o,s,l=this,d=this.options,c=Te.Deferred(),u=Te.extend({},d.customData,{mimes:d.onlyMimes},e.data||e),h=u.cmd,p="open"===h,f=!(e.preventDefault||e.preventFail),m=!(e.preventDefault||e.preventDone),g=Te.extend({},e.notify),v=!!e.cancel,b=!!e.raw,y=e.syncOnFail,w=!!e.lazy,x=e.prepare,C=Te.extend({url:d.url,async:!0,type:(this.requestType,"POST"),dataType:"json",cache:!1,data:JSON.stringify({eventId:"elfinder_cmds",lang:efw.lang,params:u}),headers:this.customHeaders,xhrFields:this.xhrFields},e.options||{}),k=function(a){if(l.currentReqCmd=h,b)return a&&a.debug&&l.debug("backend-debug",a),c.resolve(a);if(!a)return c.reject(["errResponse","errDataEmpty"],o,a);if(a.actions)EfwClient.prototype._showActions(a.actions);else{if(!Te.isPlainObject(a))return c.reject(["errResponse","errDataNotJSON"],o,a);if(a.error)return c.reject(a.error,o,a);if(!l.validResponse(h,a))return c.reject("errResponse",o,a);function e(){function e(i){l.leafRoots[u.target]&&a[i]&&Te.each(l.leafRoots[u.target],function(e,t){var n;(n=l.file(t))&&a[i].push(n)})}p?e("files"):"tree"===h&&e("tree"),a=l.normalize(a),l.api||(l.api=a.api||1,"2.0"==l.api&&void 0!==a.options.uploadMaxSize&&(l.api="2.1"),l.newAPI=2<=l.api,l.oldAPI=!l.newAPI),a.options&&(Z=Te.extend({},Z,a.options)),a.netDrivers&&(l.netDrivers=a.netDrivers),a.maxTargets&&(l.maxTargets=a.maxTargets),p&&u.init&&(l.uplMaxSize=l.returnBytes(a.uplMaxSize),l.uplMaxFile=a.uplMaxFile?parseInt(a.uplMaxFile):20),"function"==typeof x&&x(a),c.resolve(a),a.debug&&l.debug("backend-debug",a)}w?l.lazy(e):e()}},T={opts:e,result:!0};return l.trigger("request."+h,T,!0),T.result?"object"==typeof T.result&&T.result.promise?(T.result.done(a).fail(function(){l.trigger(h+"done"),c.reject()}),c):a():(l.trigger(h+"done"),c.reject())},this.diff=function(e,n,i){var a={},r=[],o=[],s=[];return Te.each(e,function(e,t){a[t.hash]=t}),Te.each(ee,function(e,t){a[e]||n&&t.phash!==n||o.push(e)}),Te.each(a,function(e,t){var n=ee[e];n?Te.each(t,function(e){if((!i||-1===Te.inArray(e,i))&&t[e]!==n[e])return s.push(t),!1}):r.push(t)}),Te.each(o,function(e,t){var n=ee[t],i=n.phash;i&&"directory"==n.mime&&-1===Te.inArray(i,o)&&a[i]&&!function(e){for(var t=s.length;t--;)if(s[t].hash==e)return!0}(i)&&s.push(a[i])}),{added:r,removed:o,changed:s}},this.sync=function(r,n){this.autoSync("stop");var i,a,o,s=this,l=(i="",o=a=0,r&&n&&Te.each(ee,function(e,t){t.phash&&t.phash===r&&(++a,o=Math.max(o,t.ts)),i=a+":"+o}),i),d=Te.Deferred().done(function(){s.trigger("sync")}),c=[this.request({data:{cmd:"open",reload:1,target:Q,tree:!r&&this.ui.tree?1:0,compare:l},preventDefault:!0})];return r||(Q!==this.root()&&c.push(this.request({data:{cmd:"parents",target:Q},preventDefault:!0})),Te.each(function(){for(var e,t=[],n=s.file(s.root(Q)),i=n?n.volumeid:null,a=s.cwd().phash;a;)a=(e=s.file(a))?(0!==a.indexOf(i)&&(s.isRoot(e)||t.push({target:a,cmd:"tree"}),t.push({target:a,cmd:"parents"}),i=(n=s.file(s.root(a)))?n.volumeid:null),e.phash):null;return t}(),function(e,t){c.push(s.request({data:{cmd:t.cmd,target:t.target},preventDefault:!0}))})),Te.when.apply(Te,c).fail(function(e,t){n&&-1===Te.inArray("errOpen",e)?d.reject(e&&0!=t.status?e:void 0):(d.reject(e),e&&s.request({data:{cmd:"open",target:s.lastDir("")||s.root(),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}}))}).done(function(e){var t,n,i;if(!e.actions){if(e.cwd.compare&&l===e.cwd.compare)return d.reject();if(t={tree:[]},1<(n=arguments.length))for(i=1;i<n;i++)arguments[i].tree&&arguments[i].tree.length&&t.tree.push.apply(t.tree,arguments[i].tree);s.api<2.1&&(t.tree=(t.tree||[]).push(e.cwd)),e=s.normalize(e),t=s.normalize(t);var a=s.diff(e.files.concat(t&&t.tree?t.tree:[]),r);return a.added.push(e.cwd),a.removed.length&&s.remove(a),a.added.length&&s.add(a),a.changed.length&&s.change(a),d.resolve(a)}}).always(function(){s.autoSync()}),d},this.upload=function(e){return this.transport.upload(e,this)},this.bind=function(e,t){var n;if("function"==typeof t)for(e=(""+e).toLowerCase().split(/\s+/),n=0;n<e.length;n++)void 0===ne[e[n]]&&(ne[e[n]]=[]),ne[e[n]].push(t);return this},this.unbind=function(e,t){var n,i,a;for(e=(""+e).toLowerCase().split(/\s+/),n=0;n<e.length;n++)i=ne[e[n]]||[],-1<(a=Te.inArray(t,i))&&i.splice(a,1);return t=null,this},this.trigger=function(e,t,n){var i,a,r,o="open"===(e=e.toLowerCase()),s=ne[e]||[];if(this.debug("event-"+e,t),o&&!n&&(r=JSON.stringify(t)),a=s.length)for(e=Te.Event(e),n&&(e.data=t),i=0;i<a;i++)if(s[i]){s[i].length&&(n||(e.data=o?JSON.parse(r):Te.extend(!0,{},t)));try{if(!1===s[i](e,this)||e.isDefaultPrevented()){this.debug("event-stoped",e.type);break}}catch(e){window.console&&window.console.log&&window.console.log(e)}}return this},this.getListeners=function(e){return e?ne[e.toLowerCase()]:ne},this.shortcut=function(e){var t,n,i,a,r;if(this.options.allowShortcuts&&e.pattern&&Te.isFunction(e.callback))for(t=e.pattern.toUpperCase().split(/\s+/),a=0;a<t.length;a++)(i=1==(i=(r=(n=t[a]).split("+")).pop()).length?0<i?i:i.charCodeAt(0):0<i?i:Te.ui.keyCode[i])&&!ie[n]&&(ie[n]={keyCode:i,altKey:-1!=Te.inArray("ALT",r),ctrlKey:-1!=Te.inArray("CTRL",r),shiftKey:-1!=Te.inArray("SHIFT",r),type:e.type||"keydown",callback:e.callback,description:e.description,pattern:n});return this},this.shortcuts=function(){var n=[];return Te.each(ie,function(e,t){n.push([t.pattern,L.i18n(t.description)])}),n},this.clipboard=function(e,n){function t(){return Te.map(ae,function(e){return e.hash})}return void 0!==e&&(ae.length&&this.trigger("unlockfiles",{files:t()}),re=[],ae=Te.map(e||[],function(e){var t=ee[e];return t?(re.push(e),{hash:e,phash:t.phash,name:t.name,mime:t.mime,read:t.read,locked:t.locked,cut:!!n}):null}),this.trigger("changeclipboard",{clipboard:ae.slice(0,ae.length)}),n&&this.trigger("lockfiles",{files:t()})),ae.slice(0,ae.length)},this.isCommandEnabled=function(e,t){var n,i=L.cwd().volumeid||"";return n=!t||i&&0===t.indexOf(i)?Z.disabled:(n=L.option("disabled",t))||[],!!this._commands[e]&&-1===Te.inArray(e,n)},this.exec=function(e,t,n,i){return"open"===e&&((this.searchStatus.state||this.searchStatus.ininc)&&this.trigger("searchend",{noupdate:!0}),this.autoSync("stop")),this._commands[e]&&this.isCommandEnabled(e,i)?this._commands[e].exec(t,n):Te.Deferred().reject("No such command")},this.dialog=function(e,t){function n(){!i.data("draged")&&i.is(":visible")&&i.elfinderdialog("posInit")}var i=Te("<div/>").append(e).appendTo(u).elfinderdialog(t,this),a=i.closest(".ui-dialog");return a.length&&(L.bind("resize",n),a.on("remove",function(){L.unbind("resize",n)})),i},this.toast=function(e){return Te('<div class="ui-front"/>').appendTo(this.ui.toast).elfindertoast(e||{},this)},this.getUI=function(e){return this.ui[e]||u},this.getCommand=function(e){return void 0===e?this._commands:this._commands[e]},this.resize=function(e,t){u.css("width",e).height(t).trigger("resize"),this.trigger("resize",{width:u.width(),height:u.height()})},this.restoreSize=function(){this.resize(de,ce)},this.show=function(){u.show(),this.enable().trigger("show")},this.hide=function(){this.options.enableAlways&&(G=J,J=!1),this.disable().trigger("hide"),u.hide()},this.lazy=function(e,t,i){function n(e){var t,n=u.data("lazycnt");e?(t=!u.data("lazyrepaint")&&i.repaint,n?u.data("lazycnt",++n):u.data("lazycnt",1).addClass("elfinder-processing"),t&&u.data("lazyrepaint",!0).css("display")):n&&1<n?u.data("lazycnt",--n):(t=u.data("lazyrepaint"),u.data("lazycnt",0).removeData("lazyrepaint").removeClass("elfinder-processing"),t&&u.css("display"),L.trigger("lazydone"))}var a=Te.Deferred();return t=t||0,i=i||{},n(!0),setTimeout(function(){a.resolve(e.call(a)),n(!1)},t),a},this.destroy=function(){u&&u[0].elfinder&&(this.options.syncStart=!1,this.autoSync("forcestop"),this.trigger("destroy").disable(),ae=[],te=[],ne={},ie={},Te(window).off("."+X),Te(document).off("."+X),L.trigger=function(){},u.off(),u.removeData(),u.empty(),u[0].elfinder=null,Te(he).remove(),u.append(W.contents()).removeClass(this.cssClass).attr("style",K))},this.autoSync=function(e){var o;if(1e3<=L.options.sync){if(s&&(clearTimeout(s),s=null,L.trigger("autosync",{action:"stop"})),"stop"===e?++pe:pe=Math.max(0,--pe),pe||"forcestop"===e||!L.options.syncStart)return;(o=function(e){var r;Z.syncMinMs&&(e||s)&&(e&&L.trigger("autosync",{action:"start"}),r=Math.max(L.options.sync,Z.syncMinMs),s&&clearTimeout(s),s=setTimeout(function(){var n,i=!0,a=Q;Z.syncChkAsTs&&(n=ee[a].ts)?L.request({data:{cmd:"info",targets:[a],compare:n,reload:1},preventDefault:!0}).done(function(e){var t;i=!0,e.compare&&(t=e.compare)==n&&(i=!1),i?L.sync(a).always(function(){t&&(ee[a].ts=t),o()}):o()}).fail(function(e,t){e&&0!=t.status?(L.error(e),-1!==Te.inArray("errOpen",e)&&L.request({data:{cmd:"open",target:L.lastDir("")||L.root(),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}})):s=setTimeout(function(){o()},r)}):L.sync(Q,!0).always(function(){o()})},r))})(!0)}},this.insideWorkzone=function(e,t,n){var i=this.getUI("workzone").data("rectangle");return n=n||1,!(e<i.left+n||e>i.left+i.width+n||t<i.top+n||t>i.top+i.height+n)},this.toFront=function(e){var t=u.children(":last");e=Te(e),t.get(0)!==e.get(0)&&t.after(e)},this.getMaximizeCss=function(){return{width:"100%",height:"100%",margin:0,padding:0,top:0,left:0,display:"block",position:"fixed",zIndex:Math.max(L.zIndex?L.zIndex+1:0,1e3)}},function(){ve&&L.UA.Fullscreen&&(L.UA.Fullscreen=!1,be&&void 0!==be.attr("allowfullscreen")&&(L.UA.Fullscreen=!0));function i(){var a=0,r=0;Te.each(u.children(".ui-dialog,.ui-draggable"),function(e,t){var n=Te(t),i=n.position();i.top<0&&(n.css("top",a),a+=20),i.left<0&&(n.css("left",r),r+=20)})}var a,t,r,o="elfinder-fullscreen",s="elfinder-fullscreen-native",l=L.UA.Fullscreen?{fullElm:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||null},exitFull:function(){return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():void 0},toFull:function(e){return e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():!!e.msRequestFullscreen&&e.msRequestFullscreen()}}:{fullElm:function(){var e;return u.hasClass(o)?u.get(0):(e=u.find("."+o)).length?e.get(0):null},exitFull:function(){var e;Te(window).off("resize."+X,c),void 0!==t&&Te("body").css("overflow",t),t=void 0,a&&(e=a.elm,d(e),Te(e).trigger("resize",{fullscreen:"off"})),Te(window).trigger("resize")},toFull:function(e){return t=Te("body").css("overflow")||"",Te("body").css("overflow","hidden"),Te(e).css(L.getMaximizeCss()).addClass(o).trigger("resize",{fullscreen:"on"}),i(),Te(window).on("resize."+X,c).trigger("resize"),!0}},d=function(e){a&&a.elm==e&&(Te(e).removeClass(o+" "+s).attr("style",a.style),a=null)},c=function(e){var t;e.target===window&&(r&&clearTimeout(r),r=setTimeout(function(){(t=l.fullElm())&&Te(t).trigger("resize",{fullscreen:"on"})},100))};Te(document).on("fullscreenchange."+X+" webkitfullscreenchange."+X+" mozfullscreenchange."+X+" MSFullscreenChange."+X,function(e){if(L.UA.Fullscreen){var t=l.fullElm(),n=Te(window);r&&clearTimeout(r),null===t?(n.off("resize."+X,c),a&&(t=a.elm,d(t),Te(t).trigger("resize",{fullscreen:"off"}))):(Te(t).addClass(o+" "+s).attr("style","width:100%; height:100%; margin:0; padding:0;").trigger("resize",{fullscreen:"on"}),n.on("resize."+X,c),i()),n.trigger("resize")}}),L.toggleFullscreen=function(e,t){var n,i=Te(e).get(0);if(n=l.fullElm()){if(n==i){if(!0===t)return n}else if(!1===t)return n;return l.exitFull(),null}return!1===t?null:!(a={elm:i,style:Te(i).attr("style")})!==l.toFull(i)?i:a=null}}(),y="elfinder-maximized",L.toggleMaximize=function(e,t){var n,i,a=Te(e);if(a.hasClass(y)){if(!0===t)return;i=a,Te(window).off("resize."+X,ye),Te("body").css("overflow",i.data("bodyOvf")),i.removeClass(y).attr("style",i.data("orgStyle")).removeData("bodyOvf").removeData("orgStyle"),i.trigger("resize",{maximize:"off"})}else{if(!1===t)return;(n=a).data("bodyOvf",Te("body").css("overflow")||"").data("orgStyle",n.attr("style")).addClass(y).css(L.getMaximizeCss()),Te("body").css("overflow","hidden"),Te(window).on("resize."+X,{elm:n},ye).trigger("resize")}},!(Te.fn.selectable&&Te.fn.draggable&&Te.fn.droppable))return alert(this.i18n("errJqui"));if(!u.length)return alert(this.i18n("errNode"));if(!this.options.url)return alert(this.i18n("errURL"));function we(e){return"TEXTAREA"!==e.target.nodeName&&"INPUT"!==e.target.nodeName&&0===Te(e.target).closest("div.ui-dialog-content").length}function xe(){T&&clearTimeout(T),T=null}function Ce(e){e.preventDefault()}function ke(){Te(document).off("touchmove",Ce)}Te.extend(Te.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,CONTEXTMENU:93}),this.dragUpload=!1,this.xhrUpload=("undefined"!=typeof XMLHttpRequestUpload||"undefined"!=typeof XMLHttpRequestEventTarget)&&"undefined"!=typeof File&&"undefined"!=typeof FormData,this.transport={},this.transport.send=function(e){return Te.ajax(e)},this.transport.upload=Te.proxy(this.uploads.xhr,this),this.dragUpload=!0,this.decodeRawString=Te.isFunction(this.options.rawStringDecoder)?this.options.rawStringDecoder:function(e){return function(e){var t,n,i,a,r=String.fromCharCode;for(t=0,n=e.length,a="";i=e[t],t<n;t++)a+=i<=127?r(i):i<=223&&194<=i?r((31&i)<<6|63&e[++t]):i<=239&&224<=i?r((15&i)<<12|(63&e[++t])<<6|63&e[++t]):i<=247&&240<=i?r(55296|((7&i)<<8|(63&e[++t])<<2|e[++t]>>>4&3)-64,56320|(15&e[t++])<<6|63&e[t]):r(65533);return a}(function(e){var t,n,i,a=[];for("string"==typeof e&&(e=function(e){var t,n,i;for(t=0,n=e.length,i=[];t<n;t++)i.push(e.charCodeAt(t));return i}(e)),t=0,n=e.length;i=e[t],t<n;t++)55296<=i&&i<=56319?a.push(64+(1023&i)<<10|1023&e[++t]):a.push(i);return a}(e))},this.error=function(){var e=arguments[0],t=arguments[1]||null;return 1==arguments.length&&"function"==typeof e?L.bind("error",e):!0===e?this:L.trigger("error",{error:e,opts:t})},Te.each(["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","selectfiles","unselectfiles","dragstart","dragstop","search","searchend","viewchange"],function(e,t){L[t]=function(){var e=arguments[0];return 1==arguments.length&&"function"==typeof e?L.bind(t,e):L.trigger(t,Te.isPlainObject(e)?e:{})}}),this.enable(function(){!J&&L.visible()&&L.ui.overlay.is(":hidden")&&!u.children(".elfinder-dialog").find("."+L.res("class","editing")).length&&(J=!0,document.activeElement&&document.activeElement.blur(),u.removeClass("elfinder-disabled"))}).disable(function(){G=J,J=!1,u.addClass("elfinder-disabled")}).open(function(){te=[]}).select(function(e){var t=0,n=[];te=Te.map(e.data.selected||e.data.value||[],function(e){return n.length||L.maxTargets&&++t>L.maxTargets?(n.push(e),null):ee[e]?e:null}),n.length&&(L.trigger("unselectfiles",{files:n,inselect:!0}),L.toast({mode:"warning",msg:L.i18n(["errMaxTargets",L.maxTargets])}))}).error(function(e){var t={cssClass:"elfinder-dialog-error",title:L.i18n(L.i18n("error")),resizable:!1,destroyOnClose:!0,buttons:{}};t.buttons[L.i18n(L.i18n("btnClose"))]=function(){Te(this).elfinderdialog("close")},e.data.opts&&Te.isPlainObject(e.data.opts)&&Te.extend(t,e.data.opts),L.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"/>'+L.i18n(e.data.error),t)}).bind("tree parents",function(e){me(e.data.tree||[])}).bind("tmb",function(e){Te.each(e.data.images||[],function(e,t){ee[e]&&(ee[e].tmb=t)})}).add(function(e){me(e.data.added||[])}).change(function(e){Te.each(e.data.changed||[],function(e,n){var i=n.hash;ee[i]&&Te.each(["locked","hidden","width","height"],function(e,t){ee[i][t]&&!n[t]&&delete ee[i][t]}),ee[i]=ee[i]?Te.extend(ee[i],n):n})}).remove(function(e){var t=e.data.removed||[],n=t.length,i={},a=function(n){var e=ee[n];e&&("directory"===e.mime&&(i[n]&&delete L.roots[i[n]],Te.each(ee,function(e,t){t.phash==n&&a(e)})),delete ee[n])};for(Te.each(L.roots,function(e,t){i[t]=e});n--;)a(t[n])}).bind("searchstart",function(e){Te.extend(L.searchStatus,e.data),L.searchStatus.state=1}).bind("search",function(e){L.searchStatus.state=2,me(e.data.files||[])}).bind("searchend",function(){L.searchStatus.state=0,L.searchStatus.mixed=!1}),!0===this.options.sound&&this.bind("rm",function(e){var t=he.canPlayType&&he.canPlayType('audio/wav; codecs="1"');t&&""!=t&&"no"!=t&&Te(he).html('<source src="'+ue+'rm.wav" type="audio/wav">')[0].play()}),Te.each(this.options.handlers,function(e,t){L.bind(e,t)}),this.history=new this.history(this),this.commands.getfile&&("function"==typeof this.options.getFileCallback?(this.bind("dblclick",function(e){e.preventDefault(),L.exec("getfile").fail(function(){L.exec("open")})}),this.shortcut({pattern:"enter",description:this.i18n("cmdgetfile"),callback:function(){L.exec("getfile").fail(function(){L.exec("mac"==L.OS?"rename":"open")})}}).shortcut({pattern:"ctrl+enter",description:this.i18n("mac"==this.OS?"cmdrename":"cmdopen"),callback:function(){L.exec("mac"==L.OS?"rename":"open")}})):this.options.getFileCallback=null),this.roots={},this.leafRoots={},this._commands={},Te.isArray(this.options.commands)||(this.options.commands=[]),-1!==Te.inArray("*",this.options.commands)&&(this.options.commands=Object.keys(this.commands)),Te.each(this.commands,function(e,t){var n,i,a=Te.extend({},t.prototype);if(Te.isFunction(t)&&!L._commands[e]&&(t.prototype.forceLoad||-1!==Te.inArray(e,L.options.commands))){if(n=t.prototype.extendsCmd||""){if(!Te.isFunction(L.commands[n]))return!0;t.prototype=Te.extend({},le,new L.commands[n],t.prototype)}else t.prototype=Te.extend({},le,t.prototype);L._commands[e]=new t,t.prototype=a,i=L.options.commandsOptions[e]||{},n&&L.options.commandsOptions[n]&&(i=Te.extend(!0,{},L.options.commandsOptions[n],i)),L._commands[e].setup(e,i),L._commands[e].linkedCmds.length&&Te.each(L._commands[e].linkedCmds,function(e,t){var n=L.commands[t];Te.isFunction(n)&&!L._commands[t]&&(n.prototype=le,L._commands[t]=new n,L._commands[t].setup(t,L.options.commandsOptions[t]||{}))})}}),this.commandMap={},this.volOptions={},this.optionsByHashes={},u.addClass(this.cssClass).on(Y,function(){J||L.enable()}),this.ui={workzone:Te("<div/>").appendTo(u).elfinderworkzone(this),navbar:Te("<div/>").appendTo(u).elfindernavbar(this,this.options.uiOptions.navbar||{}),contextmenu:Te("<div/>").appendTo(u).elfindercontextmenu(this),overlay:Te("<div/>").appendTo(u).elfinderoverlay({show:function(){L.disable()},hide:function(){G&&L.enable()}}),cwd:Te("<div/>").appendTo(u).elfindercwd(this,this.options.uiOptions.cwd||{}),notify:this.dialog("",{cssClass:"elfinder-dialog-notify",position:this.options.notifyDialog.position,absolute:!0,resizable:!1,autoOpen:!1,closeOnEscape:!1,title:"&nbsp;",width:parseInt(this.options.notifyDialog.width)}),statusbar:Te('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"/>').hide().appendTo(u),toast:Te('<div class="elfinder-toast"/>').appendTo(u),bottomtray:Te('<div class="elfinder-bottomtray">').appendTo(u)},this.uiAutoHide=[],this.one("open",function(){L.uiAutoHide.length&&setTimeout(function(){L.trigger("uiautohide")},500)}),this.bind("uiautohide",function(){L.uiAutoHide.length&&L.uiAutoHide.shift()()}),Te.each(this.options.ui||[],function(e,t){var n="elfinder"+t,i=L.options.uiOptions[t]||{};!L.ui[t]&&Te.fn[n]&&(L.ui[t]=Te("<"+(i.tag||"div")+"/>").appendTo(u),L.ui[t][n](L,i))}),(u[0].elfinder=this).options.resizable&&Te.fn.resizable&&u.resizable({resize:function(e,t){L.resize(t.size.width,t.size.height)},handles:"se",minWidth:300,minHeight:200}),this.options.width&&(de=this.options.width),this.options.height&&(ce=parseInt(this.options.height)),this.options.soundPath&&(ue=this.options.soundPath.replace(/\/+$/,"")+"/"),L.resize(de,ce),Te(document).on("click."+X,function(e){!J||L.options.enableAlways||Te(e.target).closest(u).length||L.disable()}).on(V+" "+$,function(n){var e,i=n.keyCode,a=!(!n.ctrlKey&&!n.metaKey);J&&(Te.each(ie,function(e,t){t.type==n.type&&t.keyCode==i&&t.shiftKey==n.shiftKey&&t.ctrlKey==a&&t.altKey==n.altKey&&(n.preventDefault(),n.stopPropagation(),t.callback(n,L),L.debug("shortcut-exec",e+" : "+t.description))}),i!=Te.ui.keyCode.TAB||Te(n.target).is(":input")||n.preventDefault(),"keydown"===n.type&&i==Te.ui.keyCode.ESCAPE&&(u.find(".ui-widget:visible").length||L.clipboard().length&&L.clipboard([]),Te.ui.ddmanager&&(e=Te.ui.ddmanager.current)&&e.helper&&e.cancel(),u.find(".ui-widget.elfinder-button-menu").hide()))}),L.options.useBrowserHistory&&Te(window).on("popstate."+X,function(e){var t=e.originalEvent.state&&e.originalEvent.state.thash;t&&!Te.isEmptyObject(L.files())&&L.request({data:{cmd:"open",target:t,onhistory:1},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0})}),Te(window).on("resize."+X,function(e){e.target===this&&(w&&clearTimeout(w),w=setTimeout(function(){L.trigger("resize",{width:u.width(),height:u.height()})},100))}).on("beforeunload."+X,function(e){var t,n;if(u.is(":visible")&&(L.ui.notify.children().length&&-1!==Te.inArray("hasNotifyDialog",L.options.windowCloseConfirm)?t=L.i18n("ntfsmth"):u.find("."+L.res("class","editing")).length&&-1!==Te.inArray("editingFile",L.options.windowCloseConfirm)?t=L.i18n("editingFile"):(n=Object.keys(L.selected()).length)&&-1!==Te.inArray("hasSelectedItem",L.options.windowCloseConfirm)?t=L.i18n("hasSelected",""+n):(n=Object.keys(L.clipboard()).length)&&-1!==Te.inArray("hasClipboardData",L.options.windowCloseConfirm)&&(t=L.i18n("hasClipboard",""+n)),t))return e.returnValue=t;L.trigger("unload")}),Te(window).on("message."+X,function(e){var t,n,i=e.originalEvent||null;if(i&&0===L.uploadURL.indexOf(i.origin))try{(n=(t=JSON.parse(i.data)).data||null)&&(n.error?(t.bind&&L.trigger(t.bind+"fail",n),L.error(n.error)):(n.warning&&L.error(n.warning),n.removed&&n.removed.length&&L.remove(n),n.added&&n.added.length&&L.add(n),n.changed&&n.changed.length&&L.change(n),t.bind&&(L.trigger(t.bind,n),L.trigger(t.bind+"done")),n.sync&&L.sync()))}catch(e){L.sync()}}),L.options.enableAlways?(Te(window).on("focus."+X,function(e){e.target===this&&L.enable()}),ve&&Te(window.top).on("focus."+X,function(){!L.enable()||be&&!be.is(":visible")||setTimeout(function(){Te(window).focus()},10)})):ve&&Te(window).on("blur."+X,function(e){J&&e.target===this&&L.disable()}),x=L.getUI("navbar"),C=L.getUI("cwd").parent(),L.autoScroll={navbarUp:function(e){x.scrollTop(Math.max(0,x.scrollTop()-e))},navbarDown:function(e){x.scrollTop(x.scrollTop()+e)},cwdUp:function(e){C.scrollTop(Math.max(0,C.scrollTop()-e))},cwdDown:function(e){C.scrollTop(C.scrollTop()+e)}},L.dragUpload&&(O="native-drag-enter",S="native-drag-disable",I="class",D=L.res(I,"navdir"),L.res(I,"droppable"),L.res(I,"adroppable"),L.res(I,"navarrow"),A=L.res(I,"adroppable"),E=L.getUI("workzone"),M="ltr"===L.direction,u.on("dragenter",function(e){xe(),we(e)&&(e.preventDefault(),e.stopPropagation(),k=E.data("rectangle"))}).on("dragleave",function(e){xe(),we(e)&&(e.preventDefault(),e.stopPropagation())}).on("dragover",function(n){var i;we(n)?(n.preventDefault(),n.stopPropagation(),n.originalEvent.dataTransfer.dropEffect="none",T=T||setTimeout(function(){var e,t=k.top+k.height;((i=n.pageY<k.top)||n.pageY>t)&&(e=k.cwdEdge>n.pageX?(M?"navbar":"cwd")+(i?"Up":"Down"):(M?"cwd":"navbar")+(i?"Up":"Down"),L.autoScroll[e](Math.pow(i?k.top-n.pageY:n.pageY-t,1.3))),T=null},20)):xe()}).on("drop",function(e){xe(),we(e)&&(e.stopPropagation(),e.preventDefault())}),u.on("dragenter",".native-droppable",function(e){if(e.originalEvent.dataTransfer){var n,t=Te(e.currentTarget),i=null;if(!(e.currentTarget.id||null)){i=L.cwd(),t.data(S,!1);try{Te.each(e.originalEvent.dataTransfer.types,function(e,t){"elfinderfrom:"===t.substr(0,13)&&(n=t.substr(13).toLowerCase())})}catch(e){}}i&&(!i.write||n&&n===(window.location.href+i.hash).toLowerCase())?t.data(S,!0):(e.preventDefault(),e.stopPropagation(),t.data(O,!0),t.addClass(A))}}).on("dragleave",".native-droppable",function(e){if(e.originalEvent.dataTransfer){var t=Te(e.currentTarget);e.preventDefault(),e.stopPropagation(),t.data(O)?t.data(O,!1):t.removeClass(A)}}).on("dragover",".native-droppable",function(e){if(e.originalEvent.dataTransfer){var t=Te(e.currentTarget);e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect=t.data(S)?"none":"copy",t.data(O,!1)}}).on("drop",".native-droppable",function(e){if(e.originalEvent&&e.originalEvent.dataTransfer){var t=Te(e.currentTarget);e.preventDefault(),e.stopPropagation(),t.removeClass(A),B=e.currentTarget.id?t.hasClass(D)?L.navId2Hash(e.currentTarget.id):L.cwdId2Hash(e.currentTarget.id):L.cwd().hash,e.originalEvent._target=B,L.exec("upload",{dropEvt:e.originalEvent,target:B},void 0,B)}})),L.UA.Touch&&(N=L.getUI("navbar"),q=L.getUI("toolbar"),u.on("touchstart touchmove touchend",function(e){if("touchend"===e.type)return F=U=!1,void ke();var t,n,i,a,r,o,s=e.originalEvent.touches||[{}],l=s[0].pageX||null,d=s[0].pageY||null,c="ltr"===L.direction;null===l||null===d||"touchstart"===e.type&&1<s.length||("touchstart"===e.type?(P=u.offset(),H=u.width(),N&&(U=!1,N.is(":hidden")?(R=R||Math.max(50,H/10),(c?l-P.left:H+P.left-l)<R&&(U=l)):(j=N.width(),n=Math.max.apply(Math,Te.map(N.children(".elfinder-tree"),function(e){return Te(e).width()})),i=c?l<P.left+j&&n-N.scrollLeft()-5<=j:l>P.left+H-j&&n+N.scrollLeft()-5<=j,U=!!i&&(R=Math.max(50,H/10),l))),q&&(_=q.height(),d-P.top<(q.is(":hidden")?50:_+30)?(F=d,Te(document).on("touchmove."+X,Ce),setTimeout(function(){ke()},500)):F=!1)):(N&&!1!==U&&(t=(c?l<U:U<l)?"navhide":"navshow",a=Math.abs(U-l),("navhide"==t&&.6*j<a||("navhide"==t?j/3:45)<a&&("navshow"==t||(c?l<P.left+20:l>P.left+H-20)))&&(L.getUI("navbar").trigger(t,{handleW:R}),U=!1)),q&&!1!==F&&(r=q.offset().top,Math.abs(F-d)>Math.min(45,_/3)&&("slideDown"==(o=d<F?"slideUp":"slideDown")||d<r+20)&&(q.is("slideDown"==o?":hidden":":visible")&&(q.stop(!0,!0).trigger("toggle",{duration:100,handleH:50}),ke()),F=!1))))})),ve&&u.on("click",function(e){Te(window).focus()}),this.options.enableByMouseOver&&u.on("mouseenter",function(e){ve&&Te(window).focus(),L.enabled()||L.enable()}),this.options.cssAutoLoad||this.trigger("cssloaded"),this.trigger("init").request({data:{cmd:"open",target:L.startDir(),init:1,tree:this.ui.tree?1:0},preventDone:!0,notify:{type:"open",cnt:1,hideCnt:!0},freeze:!0}).fail(function(){L.trigger("fail").disable().lastDir(""),ne={},ie={},Te(document).add(u).off("."+X),L.trigger=function(){}}).done(function(e){var t=u.css("z-index");t&&"auto"!==t&&"inherit"!==t?L.zIndex=t:u.parents().each(function(e,t){var n=Te(t).css("z-index");if("auto"!==n&&"inherit"!==n&&(n=parseInt(n)))return L.zIndex=n,!1}),L.load().debug("api",L.api),u.trigger("resize"),z(e),L.trigger("open",e),ve&&L.options.enableAlways&&Te(window).focus()})};return void 0!==(t=t||!1)&&!t||(window.elFinder=ze),ze.prototype={uniqueid:0,res:function(e,t){return this.resources[e]&&this.resources[e][t]},OS:-1!==navigator.userAgent.indexOf("Mac")?"mac":-1!==navigator.userAgent.indexOf("Win")?"win":"other",UA:(n=!document.uniqueID&&!window.opera&&!window.sidebar&&window.localStorage&&"WebkitAppearance"in document.documentElement.style,{ltIE6:void 0===window.addEventListener&&void 0===document.documentElement.style.maxHeight,ltIE7:void 0===window.addEventListener&&void 0===document.querySelectorAll,ltIE8:void 0===window.addEventListener&&void 0===document.getElementsByClassName,IE:document.uniqueID,Firefox:window.sidebar,Opera:window.opera,Webkit:n,Chrome:n&&window.chrome,Safari:n&&!window.chrome,Mobile:void 0!==window.orientation,Touch:void 0!==window.ontouchstart,iOS:navigator.platform.match(/^iP(?:[ao]d|hone)/),Fullscreen:void 0!==(document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen)}),currentReqCmd:"",i18:{en:{translator:"",language:"English",direction:"ltr",dateFormat:"d.m.Y H:i",fancyDateFormat:"$1 H:i",messages:{}},months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["msJan","msFeb","msMar","msApr","msMay","msJun","msJul","msAug","msSep","msOct","msNov","msDec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},kinds:{unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/msword":"MsWord","application/vnd.ms-word":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"MsWord","application/vnd.ms-word.document.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"MsWord","application/vnd.ms-word.template.macroEnabled.12":"MsWord","application/vnd.ms-excel":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"MsExcel","application/vnd.ms-excel.sheet.macroEnabled.12":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"MsExcel","application/vnd.ms-excel.template.macroEnabled.12":"MsExcel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"MsExcel","application/vnd.ms-excel.addin.macroEnabled.12":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.presentation":"MsPP","application/vnd.ms-powerpoint.presentation.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"MsPP","application/vnd.ms-powerpoint.slideshow.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.template":"MsPP","application/vnd.ms-powerpoint.template.macroEnabled.12":"MsPP","application/vnd.ms-powerpoint.addin.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slide":"MsPP","application/vnd.ms-powerpoint.slide.macroEnabled.12":"MsPP","application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/vnd.oasis.opendocument.text-template":"OO","application/vnd.oasis.opendocument.text-web":"OO","application/vnd.oasis.opendocument.text-master":"OO","application/vnd.oasis.opendocument.graphics":"OO","application/vnd.oasis.opendocument.graphics-template":"OO","application/vnd.oasis.opendocument.presentation":"OO","application/vnd.oasis.opendocument.presentation-template":"OO","application/vnd.oasis.opendocument.spreadsheet":"OO","application/vnd.oasis.opendocument.spreadsheet-template":"OO","application/vnd.oasis.opendocument.chart":"OO","application/vnd.oasis.opendocument.formula":"OO","application/vnd.oasis.opendocument.database":"OO","application/vnd.oasis.opendocument.image":"OO","application/vnd.openofficeorg.extension":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF","application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML","application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/x-xz":"XZ","application/zip":"ZIP","application/x-zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML","text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader","text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","text/x-markdown":"Markdown","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF","image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG","audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash","video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"},rules:{defaults:function(e){return!(!e||e.added&&!Te.isArray(e.added)||e.removed&&!Te.isArray(e.removed)||e.changed&&!Te.isArray(e.changed))},open:function(e){return e&&e.cwd&&e.files&&Te.isPlainObject(e.cwd)&&Te.isArray(e.files)},tree:function(e){return e&&e.tree&&Te.isArray(e.tree)},parents:function(e){return e&&e.tree&&Te.isArray(e.tree)},tmb:function(e){return e&&e.images&&(Te.isPlainObject(e.images)||Te.isArray(e.images))},upload:function(e){return e&&(Te.isPlainObject(e.added)||Te.isArray(e.added))},search:function(e){return e&&e.files&&Te.isArray(e.files)}},commands:{},cmdsToAdd:"archive duplicate extract mkdir mkfile paste rm upload",parseUploadData:function(e){var t;if(!Te.trim(e))return{error:["errResponse","errDataEmpty"]};try{t=JSON.parse(e)}catch(e){return{error:["errResponse","errDataNotJSON"]}}return this.validResponse("upload",t)?((t=this.normalize(t)).removed=Te.merge(t.removed||[],Te.map(t.added||[],function(e){return e.hash})),t):{error:["errResponse"]}},iframeCnt:0,uploads:{xhrUploading:!1,checkExists:function(a,i,r){function o(){for(var e=a.length;-1<--e;)a[e]._remove=!0}var s,e,l,d,c,u,h,p=Te.Deferred();return 2.1<=r.api&&"object"==typeof a[0]?(l=[],d={},c=[],u=[],h=function(n){var i=n==u.length-1,e={title:r.i18n("cmdupload"),text:["errExists",u[n].name,"confirmRepl"],all:!i,accept:{label:"btnYes",callback:function(e){i||e?p.resolve(l,d):h(++n)}},reject:{label:"btnNo",callback:function(e){var t;if(e)for(t=u.length;n<t--;)a[u[t].i]._remove=!0;else a[u[n].i]._remove=!0;i||e?p.resolve(l,d):h(++n)}},cancel:{label:"btnCancel",callback:function(){o(),p.resolve(l,d)}},buttons:[]};0<r.iframeCnt&&delete e.reject,r.confirm(e)},r.file(i).read?(s=Te.map(a,function(e,t){return e.name?{i:t,name:e.name}:null}),e=Te.map(s,function(e){return e.name}),r.request({data:{cmd:"ls",target:i,intersect:e},notify:{type:"preupload",cnt:1,hideCnt:!0},preventFail:!0}).done(function(e){var t,n;e&&(e.error?o():r.options.overwriteUploadConfirm&&!r.UA.iOS&&r.option("uploadOverwrite",i)&&e.list&&(Te.isArray(e.list)?c=e.list||[]:(t=[],c=Te.map(e.list,function(e){return"string"==typeof e?e:(t=t.concat(e),null)}),t.length&&(c=c.concat(t)),d=e.list),u=Te.map(s,function(e){return-1!==Te.inArray(e.name,c)?e:null}),c.length&&i==r.cwd().hash&&(n=Te.map(r.files(),function(e){return e.phash==i?e.name:null}),Te.map(c,function(e){return-1===Te.inArray(e,n)||null}).length&&r.sync()))),0<u.length?h(0):p.resolve([])}).fail(function(e){o(),p.resolve([]),e&&r.error(e)})):p.resolve([]),p):p.resolve([])},checkFile:function(e,l,d){if(e.checked||"files"==e.type)return e.files;if("data"==e.type){var n,i=Te.Deferred(),c=[],u=[],h=0,p=[],f=function(e){var t,n,i,a=[],r=l.options.folderUploadExclude[l.OS]||null;i=e.length;for(var o=0;o<i;o++)if(n=e[o])if(n.isFile)h++,n.file(function(e){r&&e.name.match(r)||(u.push(n.fullPath||""),c.push(e)),h--});else if(n.isDirectory&&2.1<=l.api){h++,p.push(n.fullPath),t=n.createReader();a=[];var s=function(){t.readEntries(function(e){if(e.length)a=a.concat((n=e,Array.prototype.slice.call(n||[],0))),s();else{for(var t=0;t<a.length;t++)f([a[t]]);h--}var n},function(){h--})};s()}};return 0<(n=Te.map(e.files.items,function(e){return e.getAsEntry?e.getAsEntry():e.webkitGetAsEntry()})).length?(l.uploads.checkExists(n,d,l).done(function(r,o){var t,s=[];l.options.overwriteUploadConfirm&&!l.UA.iOS&&l.option("uploadOverwrite",d)&&(n=Te.map(n,function(n){var e,t,i,a;return n.isDirectory&&-1!==(e=Te.inArray(n.name,r))&&(r.splice(e,1),t=l.uniqueName(n.name+l.options.backupSuffix,null,""),Te.each(o,function(e,t){if(n.name==t)return i=e,!1}),i=i||l.fileByName(n.name,d).hash,l.lockfiles({files:[i]}),a=l.request({data:{cmd:"rename",target:i,name:t},notify:{type:"rename",cnt:1}}).fail(function(e){n._remove=!0,l.sync()}).always(function(){l.unlockfiles({files:[i]})}),s.push(a)),n._remove?null:n})),Te.when.apply(Te,s).done(function(){0<n.length?(t=setTimeout(function(){l.notify({type:"readdir",cnt:1,hideCnt:!0})},l.options.notifyDelay),f(n),setTimeout(function e(){0<h?setTimeout(e,10):(t&&clearTimeout(t),l.notify({type:"readdir",cnt:-1}),i.resolve([c,u,r,o,p]))},10)):i.reject()})}),i.promise()):i.reject()}var a=[],r=[],t=e.files[0];if("html"==e.type){var o,s=Te("<html/>").append(Te.parseHTML(t.replace(/ src=/gi," _elfsrc=")));Te("img[_elfsrc]",s).each(function(){var e,t,n=Te(this),i=n.closest("a");i&&i.attr("href")&&i.attr("href").match(/\.(?:jpe?g|gif|bmp|png)/i)&&(t=i.attr("href")),(e=n.attr("_elfsrc"))&&(t?(-1==Te.inArray(t,a)&&a.push(t),-1==Te.inArray(e,r)&&r.push(e)):-1==Te.inArray(e,a)&&a.push(e))}),(o=Te("a[href]",s)).each(function(){var e,t,n;Te(this).text()&&(t=Te(this).attr("href"),(n=document.createElement("a")).href=t,!(e=n).href||1!==o.length&&e.pathname.match(/(?:\.html?|\/[^\/.]*)$/i)||-1==Te.inArray(e.href,a)&&-1==Te.inArray(e.href,r)&&a.push(e.href))})}else{var m,g,v;for(m=/(http[^<>"{}|\\^\[\]`\s]+)/gi;g=m.exec(t);)v=g[1].replace(/&amp;/g,"&"),-1==Te.inArray(v,a)&&a.push(v)}return a},xhr:function(S,I){function D(e){i.children(".elfinder-notify-upload").children(".elfinder-notify-cancel")[e?"show":"hide"]()}function A(e){return e=e||d,setTimeout(function(){n=!0,E.notify({type:"upload",cnt:L,progress:o-l,size:e,cancel:function(){r.trigger("uploadabort"),N.resolve()}}),l=o,S.multiupload?W&&D(!0):D(W&&o<e)},E.options.notifyDelay)}var E=I||this,r=E.getUI(),M=new XMLHttpRequest,U=null,F=S.checked,P=S.isDataType||"data"==S.type,H=S.target||E.cwd().hash,j=S.dropEvt||null,_=-1!=E.option("uploadMaxConn",H),R=Math.min(5,Math.max(1,E.option("uploadMaxConn",H))),t=0,N=Te.Deferred().fail(function(e){if(E.uploads.xhrUploading){setTimeout(function(){E.sync()},5e3);var t=s.length?P?s[0][0]:s[0]:{};t._cid&&(q=new FormData,s=[{_chunkfail:!0}],q.append("chunk",t._chunk),q.append("cid",t._cid),P=!1,h(s))}E.uploads.xhrUploading=!1,s=null,e&&E.error(e)}).done(function(e){M=null,E.uploads.xhrUploading=!1,s=null,e&&(E.currentReqCmd="upload",e.warning&&E.error(e.warning),e.removed&&E.remove(e),e.added&&E.add(e),e.changed&&E.change(e),E.trigger("upload",e),E.trigger("uploaddone"),e.sync&&E.sync(),e.debug&&I.debug("backend-debug",e))}).always(function(){r.off("uploadabort",e),Te(window).off("unload",e),U&&clearTimeout(U),F&&!S.multiupload&&B()&&E.notify({type:"upload",cnt:-L,progress:0,size:0}),a&&i.children(".elfinder-notify-chunkmerge").length&&E.notify({type:"chunkmerge",cnt:-1})}),q=new FormData,s=S.input?S.input.files:E.uploads.checkFile(S,E,H),L=S.checked&&P?s[0].length:s.length,o=0,l=0,d=0,n=!1,i=E.ui.notify,W=!0,K=!1,B=function(){return n=n||i.children(".elfinder-notify-upload").length},e=function(){K=!0,M&&(M.quiet=!0,M.abort()),B()&&E.notify({type:"upload",cnt:-1*i.children(".elfinder-notify-upload").data("cnt"),progress:0,size:0})},X=S.renames||null,Y=S.hashes||null,a=!1;if(r.one("uploadabort",e),Te(window).one("unload."+I.namespace,e),a||(l=o),!P&&!L)return N.reject(["errUploadNoFiles"]);M.addEventListener("error",function(){0==M.status?K?N.reject():!P&&S.files&&Te.map(S.files,function(e){return e.type||e.size!==(E.UA.Safari?1802:0)?null:e}).length?(errors.push("errFolderUpload"),N.reject(["errAbort","errFolderUpload"])):S.input&&Te.map(S.input.files,function(e){return e.type||e.size!==(E.UA.Safari?1802:0)?null:e}).length?N.reject(["errUploadNoFiles"]):t++<=30?(B()&&l&&E.notify({type:"upload",cnt:0,progress:0,size:l}),M.quiet=!0,M.abort(),l=o=0,setTimeout(function(){K||(M.open("POST",E.uploadURL,!0),M.send(q))},1e4)):(r.trigger("uploadabort"),N.reject(["errAbort","errTimeout"])):(r.trigger("uploadabort"),N.reject("errConnect"))},!1),M.addEventListener("load",function(e){var t=M.status,n=0,i="";if(400<=t?i=500<t?"errResponse":"errConnect":M.responseText||(i=["errResponse","errDataEmpty"]),i){r.trigger("uploadabort");var a=P?s[0][0]:s[0];return N.reject(a._cid?null:i)}o=d,B()&&(n=o-l)&&E.notify({type:"upload",cnt:0,progress:n,size:0}),I.request({data:{cmd:"open",target:S.target,saveupload:1,reload:1,tree:1,compare:""}}),N.resolve({})},!1),M.upload.addEventListener("loadstart",function(e){!a&&e.lengthComputable&&(o=e.loaded,t&&(o=0),d=e.total,o=o||parseInt(.05*d),B()&&(E.notify({type:"upload",cnt:0,progress:o-l,size:S.multiupload?0:d}),l=o))},!1),M.upload.addEventListener("progress",function(e){var t;e.lengthComputable&&!a&&M.readyState<2&&(o=e.loaded,!S.checked&&0<o&&!U&&(U=A(M._totalSize-o)),d||(d=e.total,o=o||parseInt(.05*d)),t=o-l,B()&&.05<=t/e.total&&(E.notify({type:"upload",cnt:0,progress:t,size:0}),l=o),!S.multiupload&&d<=o&&D(W=!1))},!1);var c,u,h=function(e,t){var n,i,a,r,o,s,l,d,c,u,h,p,f,m=0,g=1,v=[],b=0,y=L,w=0,x=[],C=(new Date).getTime().toString().substr(-9),k=Math.min((I.uplMaxSize?I.uplMaxSize:2097152)-8190,I.options.uploadMaxChunkSize),T=!_&&"",z=function(t,e){var n,i,a=[],r=0;if(!K){for(;t.length&&a.length<e;)a.push(t.shift());if(r=a.length){i=r;for(var o=0;o<r&&!K;o++)n=P?a[o][0][0]._cid||null:a[o][0]._cid||null,f[n]?p--:I.exec("upload",{type:S.type,isDataType:P,files:a[o],checked:!0,target:H,dropEvt:j,renames:X,hashes:Y,multiupload:!0},void 0,H).fail(function(e){e&&"No such command"===e&&(K=!0,I.error(["errUpload","errPerm"])),n&&(f[n]=!0)}).always(function(e){e&&e.added&&(u=Te.merge(u,e.added)),p<=++h&&(I.trigger("multiupload",{added:u}),U&&clearTimeout(U),B()&&E.notify({type:"upload",cnt:-L,progress:0,size:0})),t.length?z(t,1):--i<=1&&D(W=!1)})}}(a.length<1||K)&&(K?(U&&clearTimeout(U),n&&(f[n]=!0),N.reject()):(N.resolve(),E.uploads.xhrUploading=!1))},O=function(){E.uploads.xhrUploading?setTimeout(function(){O()},100):(E.uploads.xhrUploading=!0,z(v,R))};if(!F&&(P||"files"==S.type)){for((n=I.option("uploadMaxSize",H))||(n=0),r=0;r<e.length;r++){try{i=(d=e[r]).size,!1===T&&(T="",2.1<=E.api&&("slice"in d?T="slice":"mozSlice"in d?T="mozSlice":"webkitSlice"in d&&(T="webkitSlice")))}catch(e){L--,y--;continue}if(n&&n<i||!T&&I.uplMaxSize&&i>I.uplMaxSize)E.error(E.i18n("errUploadFile",d.name)+" "+E.i18n("errUploadFileSize")),L--,y--;else if(!d.type||E.uploadMimeCheck(d.type,H))if(T&&k<i){for(o=0,s=k,l=-1,y=Math.floor(i/k),a=d.lastModified?Math.round(d.lastModified/1e3):0,w+=i,x[C]=0;o<=i;)(c=d[T](o,s))._chunk=d.name+"."+ ++l+"_"+y+".part",c._cid=C,c._range=o+","+c.size+","+i,c._mtime=a,x[C]++,m&&b++,void 0===v[b]&&(v[b]=[],P&&(v[b][0]=[],v[b][1]=[])),m=k,g=1,P?(v[b][0].push(c),v[b][1].push(t[r])):v[b].push(c),s=(o=s)+k;null==c?(E.error(E.i18n("errUploadFile",d.name)+" "+E.i18n("errUploadFileSize")),L--,y--):(y+=l,m=0,g=1,b++)}else(I.uplMaxSize&&m+i>=I.uplMaxSize||g>I.uplMaxFile)&&(m=0,g=1,b++),void 0===v[b]&&(v[b]=[],P&&(v[b][0]=[],v[b][1]=[])),P?(v[b][0].push(d),v[b][1].push(t[r])):v[b].push(d),m+=i,w+=i,g++;else E.error(E.i18n("errUploadFile",d.name)+" "+E.i18n("errUploadMime")+" ("+E.escape(d.type)+")"),L--,y--}if(0==v.length)return!(S.checked=!0);if(1<v.length)return U=A(w),u=[],h=0,p=v.length,f=[],O(),!0;P?(e=v[0][0],t=v[0][1]):e=v[0]}return F||(I.UA.Safari&&S.files?M._totalSize=w:U=A(w)),F=!0,e.length||N.reject(["errUploadNoFiles"]),M.open("POST",E.uploadURL,!0),I.customHeaders&&Te.each(I.customHeaders,function(e){M.setRequestHeader(e,this)}),I.xhrFields&&Te.each(I.xhrFields,function(e){e in M&&(M[e]=this)}),q.append("cmd","upload"),q.append(E.newAPI?"target":"current",H),X&&X.length&&(Te.each(X,function(e,t){q.append("renames[]",t)}),q.append("suffix",I.options.backupSuffix)),Y&&Te.each(Y,function(e,t){q.append("hashes["+e+"]",t)}),Te.each(E.options.customData,function(e,t){q.append(e,t)}),Te.each(E.options.onlyMimes,function(e,t){q.append("mimes["+e+"]",t)}),Te.each(e,function(e,t){t._chunkmerged?(q.append("chunk",t._chunkmerged),q.append("upload[]",t._name),q.append("mtime[]",t._mtime)):(t._chunkfail?(q.append("upload[]","chunkfail"),q.append("mimes","chunkfail")):q.append("upload[]",t),t._chunk?(q.append("chunk",t._chunk),q.append("cid",t._cid),q.append("range",t._range),q.append("mtime[]",t._mtime)):q.append("mtime[]",t.lastModified?Math.round(t.lastModified/1e3):0)),I.UA.iOS&&q.append("overwrite",0)}),P&&Te.each(t,function(e,t){q.append("upload_path[]",t)}),j&&q.append("dropWith",parseInt((j.altKey?"1":"0")+(j.ctrlKey?"1":"0")+(j.metaKey?"1":"0")+(j.shiftKey?"1":"0"),2)),M.send(q),!0};if(P)F?h(s[0],s[1]):s.done(function(n){if(X=[],L=n[0].length){if(n[4]&&n[4].length)return void I.request({data:{cmd:"mkdir",target:H,dirs:n[4]},notify:{type:"mkdir",cnt:n[4].length}}).fail(function(e){"errCmdParams"===(e=e||["errUnknown"])[0]?R=1:(R=0,N.reject(e))}).done(function(t){t.hashes&&(n[1]=Te.map(n[1],function(e){return""===(e=e.replace(/\/[^\/]*$/,""))?H:t.hashes[e]}))}).always(function(e){R&&(X=n[2],Y=n[3],h(n[0],n[1]))});n[1]=Te.map(n[1],function(){return H}),X=n[2],Y=n[3],h(n[0],n[1])}else N.reject(["errUploadNoFiles"])}).fail(function(){N.reject()});else if(0<s.length)if(null==X){var p=[],f=[],m=I.options.folderUploadExclude[I.OS]||null;Te.each(s,function(e,t){var n=t.webkitRelativePath||t.relativePath||"";if(!n)return!1;m&&t.name.match(m)?(t._remove=!0,n=void 0):(n=n.replace(/\/[^\/]*$/,""))&&-1===Te.inArray(n,p)&&p.push(n),f.push(n)}),I.getUI().find("div.elfinder-upload-dialog-wrapper").elfinderdialog("close"),X=[],Y={},p.length?(c=Te.map(p,function(e){return-1===e.indexOf("/")?{name:e}:null}),u=[],I.uploads.checkExists(c,H,I).done(function(n,i){var a,r,o=[];I.options.overwriteUploadConfirm&&!I.UA.iOS&&I.option("uploadOverwrite",H)&&(u=Te.map(c,function(e){return e._remove?e.name:null}),c=Te.map(c,function(e){return e._remove?null:e})),u.length&&Te.each(f.concat(),function(e,t){0===Te.inArray(t,u)&&(s[e]._remove=!0,delete f[e])}),s=Te.map(s,function(e){return e._remove?null:e}),f=Te.map(f,function(e){return void 0===e?null:e}),c.length?(Te.Deferred(),n.length?Te.each(n,function(e,t){a=I.uniqueName(t+I.options.backupSuffix,null,""),Te.each(i,function(e,t){if(n[0]==t)return r=e,!1}),r=r||I.fileByName(n[0],H).hash,I.lockfiles({files:[r]}),o.push(I.request({data:{cmd:"rename",target:r,name:a},notify:{type:"rename",cnt:1}}).fail(function(e){N.reject(e),I.sync()}).always(function(){I.unlockfiles({files:[r]})}))}):o.push(null),Te.when.apply(Te,o).done(function(){I.request({data:{cmd:"mkdir",target:H,dirs:p},notify:{type:"mkdir",cnt:p.length}}).fail(function(e){"errCmdParams"===(e=e||["errUnknown"])[0]?R=1:(R=0,N.reject(e))}).done(function(t){t.hashes&&(f=Te.map(f.concat(),function(e){return""===e?H:t.hashes["/"+e]}))}).always(function(e){R&&(P=!0,h(s,f)||N.reject())})})):N.reject()})):I.uploads.checkExists(s,H,I).done(function(e,t){I.options.overwriteUploadConfirm&&!I.UA.iOS&&I.option("uploadOverwrite",H)&&(X=e,Y=t,s=Te.map(s,function(e){return e._remove?null:e})),0<(L=s.length)&&h(s)||N.reject()})}else h(s)||N.reject();else N.reject();return N}},one:function(n,i){var a=this,r=function(e,t){return setTimeout(function(){a.unbind(n,r)},3),i.apply(a.getListeners(e.type),arguments)};return this.bind(n,r)},localStorage:function(t,n){var e,i,a,r=window.localStorage,o="elfinder-"+t+this.id;if(t=window.location.pathname+"-elfinder-"+t+this.id,null===n)return r.removeItem(t);if(void 0===n&&!(e=r.getItem(t))&&(i=r.getItem(o))&&(n=i,r.removeItem(o)),void 0!==n){"string"!=(a=typeof n)&&"number"!=a&&(n=JSON.stringify(n));try{r.setItem(t,n)}catch(e){try{r.clear(),r.setItem(t,n)}catch(e){self.debug("error",e.toString())}}e=r.getItem(t)}if(e&&("{"===e.substr(0,1)||"["===e.substr(0,1)))try{return JSON.parse(e)}catch(e){}return e},cookie:function(e,t){var n,i,a,r,o,s;if(e="elfinder-"+e+this.id,void 0!==t)return i=Te.extend({},this.options.cookie),null===t?(t="",i.expires=-1):"string"!=(s=typeof t)&&"number"!=s&&(t=JSON.stringify(t)),"number"==typeof i.expires&&((n=new Date).setTime(n.getTime()+864e5*i.expires),i.expires=n),document.cookie=e+"="+encodeURIComponent(t)+"; expires="+i.expires.toUTCString()+(i.path?"; path="+i.path:"")+(i.domain?"; domain="+i.domain:"")+(i.secure?"; secure":""),t;if(document.cookie&&""!=document.cookie)for(a=document.cookie.split(";"),e+="=",r=0;r<a.length;r++)if(a[r]=Te.trim(a[r]),a[r].substring(0,e.length)==e){if("{"===(o=decodeURIComponent(a[r].substring(e.length))).substr(0,1)||"["===o.substr(0,1))try{return JSON.parse(o)}catch(e){}return o}return""},startDir:function(){var e=window.location.hash;return e&&e.match(/^#elf_/)?e.replace(/^#elf_/,""):this.options.startPathHash?this.options.startPathHash:this.lastDir()},lastDir:function(e){return this.options.rememberLastDir?this.storage("lastdir",e):""},_node:Te("<span/>"),escape:function(e){return this._node.text(e).html().replace(/"/g,"&quot;").replace(/'/g,"&#039;")},normalize:function(e){function t(n){var e,i;return n&&n.hash&&n.name&&n.mime?("application/x-empty"==n.mime&&(n.mime="text/plain"),n.options&&(l.optionsByHashes[n.hash]=n.options),n.phash&&"directory"!==n.mime||(n.volumeid&&(e=n.volumeid,l.isRoot(n)&&(l.volOptions[e]||(l.volOptions[e]={}),i=l.volOptions[e],n.options&&(i=Te.extend(i,n.options)),n.disabled&&(i.disabled=n.disabled),n.tmbUrl&&(i.tmbUrl=n.tmbUrl),Te.each(l.optionProperties,function(e,t){i[t]&&(n[t]=i[t])}),l.roots[e]=n.hash),s!==e&&(s=e,o=l.option("i18nFolderName",e))),!n.i18&&l.isRoot(n)&&(a="volume_"+n.name,r=l.i18n(!1,a),a!==r&&(n.i18=r)),o&&!n.i18&&(a="folder_"+n.name,r=l.i18n(!1,a),a!==r&&(n.i18=r)),l.leafRoots[n.hash]&&(n.dirs||(n.dirs=1),Te.each(l.leafRoots[n.hash],function(){var e=l.file(this);e&&e.ts&&(n.ts||0)<e.ts&&(n.ts=e.ts)}))),n):null}var a,r,o,s,l=this;return e.cwd&&(e.cwd.volumeid&&e.options&&Object.keys(e.options).length&&(l.volOptions[e.cwd.volumeid]=e.options),e.cwd=t(e.cwd)),e.files&&(e.files=Te.map(e.files,t)),e.tree&&(e.tree=Te.map(e.tree,t)),e.added&&(e.added=Te.map(e.added,t)),e.changed&&(e.changed=Te.map(e.changed,t)),e.api&&(e.init=!0),e.cwd&&e.cwd.options&&e.options&&Te.extend(e.options,e.cwd.options),e},setSort:function(e,t,n,i){this.storage("sortType",this.sortType=this.sortRules[e]?e:"name"),this.storage("sortOrder",this.sortOrder=/asc|desc/.test(t)?t:"asc"),this.storage("sortStickFolders",(this.sortStickFolders=!!n)?1:""),this.storage("sortAlsoTreeview",(this.sortAlsoTreeview=!!i)?1:""),this.trigger("sortchange")},_sortRules:{name:function(e,t){return ze.prototype.naturalCompare(e.i18||e.name,t.i18||t.name)},size:function(e,t){var n=parseInt(e.size)||0,i=parseInt(t.size)||0;return n===i?0:i<n?1:-1},kind:function(e,t){return ze.prototype.naturalCompare(e.mime,t.mime)},date:function(e,t){var n=e.ts||e.date,i=t.ts||t.date;return n===i?0:i<n?1:-1},perm:function(e,t){function n(e){return(e.write?2:0)+(e.read?1:0)}var i=n(e),a=n(t);return i===a?0:a<i?1:-1},mode:function(e,t){var n=e.mode||e.perm||"",i=t.mode||t.perm||"";return ze.prototype.naturalCompare(n,i)},owner:function(e,t){var n=e.owner||"",i=t.owner||"";return ze.prototype.naturalCompare(n,i)},group:function(e,t){var n=e.group||"",i=t.group||"";return ze.prototype.naturalCompare(n,i)}},sorters:[],naturalCompare:function(e,t){var w=ze.prototype.naturalCompare;return void 0===w.loc&&(w.loc=navigator.userLanguage||navigator.browserLanguage||navigator.language||"en-US"),void 0===w.sort&&(0<"11".localeCompare("2",w.loc,{numeric:!0})?window.Intl&&window.Intl.Collator?w.sort=new Intl.Collator(w.loc,{numeric:!0}).compare:w.sort=function(e,t){return e.localeCompare(t,w.loc,{numeric:!0})}:(w.sort=function(e,t){function n(e){return w.sort.insensitive&&(""+e).toLowerCase()||""+e}var i,a,r=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,o=/(^[ ]*|[ ]*$)/g,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,l=/^0x[0-9a-f]+$/i,d=/^0/,c=/^[\x01\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e]/,u=n(e).replace(o,"").replace(/^_/,"")||"",h=n(t).replace(o,"").replace(/^_/,"")||"",p=u.replace(r,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),f=h.replace(r,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=parseInt(u.match(l))||1!=p.length&&u.match(s)&&Date.parse(u),g=parseInt(h.match(l))||m&&h.match(s)&&Date.parse(h)||null,v=0;if(g){if(m<g)return-1;if(g<m)return 1}for(var b=0,y=Math.max(p.length,f.length);b<y;b++){if(i=!(p[b]||"").match(d)&&parseFloat(p[b])||p[b]||0,a=!(f[b]||"").match(d)&&parseFloat(f[b])||f[b]||0,isNaN(i)!==isNaN(a)){if(isNaN(i)&&("string"!=typeof i||!i.match(c)))return 1;if("string"!=typeof a||!a.match(c))return-1}if(0===parseInt(i,10)&&(i=0),0===parseInt(a,10)&&(a=0),typeof i!=typeof a&&(i+="",a+=""),w.sort.insensitive&&"string"==typeof i&&"string"==typeof a&&0!==(v=i.localeCompare(a,w.loc)))return v;if(i<a)return-1;if(a<i)return 1}return 0},w.sort.insensitive=!0)),w.sort(e,t)},compare:function(e,t){var n,i=this.sortType,a="asc"==this.sortOrder,r=this.sortStickFolders,o=this.sortRules,s=o[i],l="directory"==e.mime,d="directory"==t.mime;if(r){if(l&&!d)return-1;if(!l&&d)return 1}return n=a?s(e,t):s(t,e),"name"!==i&&0===n?n=a?o.name(e,t):o.name(t,e):n},sortFiles:function(e){return e.sort(this.compare)},notify:function(e){function t(){l._esc&&Te(document).off("keydown",l._esc),l.remove(),s.children().length||s.elfinderdialog("close")}var n,i,a,r=e.type,o=this.i18n(void 0!==e.msg?e.msg:this.messages["ntf"+r]?"ntf"+r:"ntfsmth"),s=this.ui.notify,l=s.children(".elfinder-notify-"+r),d=l.children("div.elfinder-notify-cancel").children("button"),c=e.cnt,u=void 0!==e.size?parseInt(e.size):null,h=void 0!==e.progress&&0<=e.progress?e.progress:null,p=e.cancel;return r&&(l.length?void 0!==e.msg&&l.children("span.elfinder-notify-msg").html(o):(l=Te('<div class="elfinder-notify elfinder-notify-{type}"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"/><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"/><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"/></div><div class="elfinder-notify-cancel"/></div>'.replace(/\{type\}/g,r).replace(/\{msg\}/g,o)).appendTo(s).data("cnt",0),null!=h&&l.data({progress:0,total:0}),p&&(d=Te('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+this.i18n("btnCancel")+"</span></button>").hover(function(e){Te(this).toggleClass("ui-state-hover","mouseenter"==e.type)}),l.children("div.elfinder-notify-cancel").append(d))),0<(n=c+parseInt(l.data("cnt")))?(p&&d.length&&(Te.isFunction(p)||"object"==typeof p&&p.promise)&&(l._esc=function(e){"keydown"==e.type&&e.keyCode!=Te.ui.keyCode.ESCAPE||(e.preventDefault(),e.stopPropagation(),t(),p.promise?(p.xhr&&(p.xhr.quiet=!0,p.xhr.abort()),p.reject()):p(e))},d.on("click",function(e){l._esc(e)}),Te(document).on("keydown."+this.namespace,l._esc)),e.hideCnt||l.children(".elfinder-notify-cnt").text("("+n+")"),s.is(":hidden")&&s.elfinderdialog("open",this),l.data("cnt",n),null!=h&&0<=(i=l.data("total"))&&0<=(a=l.data("progress"))&&(i+=null!=u?u:c,a+=h,null==u&&c<0&&(a+=100*c),l.data({progress:a,total:i}),null!=u&&(a*=100,i=Math.max(1,i)),h=parseInt(a/i),l.find(".elfinder-notify-progress").animate({width:(h<100?h:100)+"%"},20))):t()),this},confirm:function(e){var n,i=this,a=!1,r={cssClass:"elfinder-dialog-confirm",modal:!0,resizable:!1,title:this.i18n(e.title||"confirmReq"),buttons:{},close:function(){a||e.cancel.callback(),Te(this).elfinderdialog("destroy")}},t=this.i18n("apllyAll");return r.buttons[this.i18n(e.accept.label)]=function(){e.accept.callback(!(!n||!n.prop("checked"))),a=!0,Te(this).elfinderdialog("close")},e.reject&&(r.buttons[this.i18n(e.reject.label)]=function(){e.reject.callback(!(!n||!n.prop("checked"))),a=!0,Te(this).elfinderdialog("close")}),e.buttons&&0<e.buttons.length&&Te.each(e.buttons,function(e,t){r.buttons[i.i18n(t.label)]=function(){t.callback(!(!n||!n.prop("checked"))),a=!0,Te(this).elfinderdialog("close")}}),r.buttons[this.i18n(e.cancel.label)]=function(){Te(this).elfinderdialog("close")},e.all&&(r.create=function(){var e=Te('<div class="elfinder-dialog-confirm-applyall"/>');n=Te('<input type="checkbox" />'),Te(this).next().find(".ui-dialog-buttonset").prepend(e.append(Te("<label>"+t+"</label>").prepend(n)))}),e.optionsCallback&&Te.isFunction(e.optionsCallback)&&e.optionsCallback(r),this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"/>'+this.i18n(e.text),r)},uniqueName:function(e,t,n){var i,a,r=0,o="";if(e=this.i18n(e),t=t||this.cwd().hash,n=void 0===n?" ":n,(i=e.match(/^(.+)(\.[^.]+)$/))&&(o=i[2],e=i[1]),a=e+o,!this.fileByName(a,t))return a;for(;r<1e4;)if(a=e+n+ ++r+o,!this.fileByName(a,t))return a;return e+Math.random()+o},i18n:function(){function e(e){var t;return 0===e.indexOf("#")&&(t=r.file(e.substr(1)))?t.name:e}var n,t,i,a,r=this,o=this.messages,s=[],l=[],d=0;for(arguments.length&&!1===arguments[0]&&(a=function(e){return e},d=1),n=d;n<arguments.length;n++)if(i=arguments[n],Te.isArray(i))for(t=0;t<i.length;t++)i[t]instanceof jQuery?s.push(i[t]):void 0!==i[t]&&s.push(e(""+i[t]));else i instanceof jQuery?s.push(i[t]):void 0!==i&&s.push(e(""+i));for(n=0;n<s.length;n++)-1===Te.inArray(n,l)&&(i="string"==typeof(i=s[n])?(i=o[i]||(a?a(i):r.escape(i))).replace(/\$(\d+)/g,function(e,t){return 0<(t=n+parseInt(t))&&s[t]&&l.push(t),a?a(s[t]):r.escape(s[t])}):i.get(0).outerHTML,s[n]=i);return Te.map(s,function(e,t){return-1===Te.inArray(t,l)?e:null}).join("<br>")},mime2class:function(e){var t="elfinder-cwd-icon-";return t+(e=e.split("/"))[0]+("image"!=e[0]&&e[1]?" "+t+e[1].replace(/(\.|\+)/g,"-"):"")},mime2kind:function(e){var t,n="object"==typeof e,i=n?e.mime:e;return n&&e.alias&&"symlink-broken"!=i?t="Alias":this.kinds[i]&&(t=!n||"directory"!==i||e.phash&&!e.isroot?this.kinds[i]:"Root"),t=t||(0===i.indexOf("text")?"Text":0===i.indexOf("image")?"Image":0===i.indexOf("audio")?"Audio":0===i.indexOf("video")?"Video":0===i.indexOf("application")?"App":i),this.messages["kind"+t]?this.i18n("kind"+t):i},formatDate:function(e,t){var n,i,a,r,o,s,l,d,c,u,h=this,p=(t=t||e.ts,h.i18);return h.options.clientFormatDate&&0<t?(n=new Date(1e3*t),l=n[h.getHours](),d=12<l?l-12:l,c=n[h.getMinutes](),u=n[h.getSeconds](),a=n[h.getDate](),r=n[h.getDay](),o=n[h.getMonth]()+1,s=n[h.getFullYear](),i=(t>=this.yesterday?this.fancyFormat:this.dateFormat).replace(/[a-z]/gi,function(e){switch(e){case"d":return 9<a?a:"0"+a;case"j":return a;case"D":return h.i18n(p.daysShort[r]);case"l":return h.i18n(p.days[r]);case"m":return 9<o?o:"0"+o;case"n":return o;case"M":return h.i18n(p.monthsShort[o-1]);case"F":return h.i18n(p.months[o-1]);case"Y":return s;case"y":return(""+s).substr(2);case"H":return 9<l?l:"0"+l;case"G":return l;case"g":return d;case"h":return 9<d?d:"0"+d;case"a":return 12<=l?"pm":"am";case"A":return 12<=l?"PM":"AM";case"i":return 9<c?c:"0"+c;case"s":return 9<u?u:"0"+u}return e}),t>=this.yesterday?i.replace("$1",this.i18n(t>=this.today?"Today":"Yesterday")):i):e.date?e.date.replace(/([a-z]+)\s/i,function(e,t){return h.i18n(t)+" "}):h.i18n("dateUnknown")},perms2class:function(e){var t="";return e.read||e.write?e.read?e.write||(t="elfinder-ro"):t="elfinder-wo":t="elfinder-na",e.type&&(t+=" elfinder-"+this.escape(e.type)),t},formatPermissions:function(e){var t=[];return e.read&&t.push(this.i18n("read")),e.write&&t.push(this.i18n("write")),t.length?t.join(" "+this.i18n("and")+" "):this.i18n("noaccess")},formatSize:function(e){var t=1,n="b";return"unknown"==e?this.i18n("unknown"):(1073741824<e?(t=1073741824,n="GB"):1048576<e?(t=1048576,n="MB"):1024<e&&(t=1024,n="KB"),(0<(e/=t)?1048576<=t?e.toFixed(2):Math.round(e):0)+" "+n)},formatFileMode:function(e,t){var n,i,a,r,o,s,l,d;if(t=t||this.options.fileModeStyle.toLowerCase(),(e=Te.trim(e)).match(/[rwxs-]{9}$/i)){if(l=e=e.substr(-9),"string"==t)return l;for(d="",n=a=0;n<7;n+=3)r=0,(i=e.substr(n,3)).match(/[r]/i)&&(r+=4),i.match(/[w]/i)&&(r+=2),i.match(/[xs]/i)&&(i.match(/[xs]/)&&(r+=1),i.match(/[s]/i)&&(0==n?a+=4:3==n&&(a+=2))),d+=r.toString(8);a&&(d=a.toString(8)+d)}else{if(d=(e=parseInt(e,8))?e.toString(8):"",!e||"octal"==t)return d;for(a=0,3<(i=e.toString(8)).length&&(i=i.substr(-4),a=parseInt(i.substr(0,1),8),i=i.substr(1)),s=2==(2&a),o=4==(4&a),l="",n=0;n<3;n++)4==(4&parseInt(i.substr(n,1),8))?l+="r":l+="-",2==(2&parseInt(i.substr(n,1),8))?l+="w":l+="-",1==(1&parseInt(i.substr(n,1),8))?l+=0==n&&o||1==n&&s?"s":"x":l+="-"}return"both"==t?l+" ("+d+")":"string"==t?l:d},uploadMimeCheck:function(i,e){e=e||this.cwd().hash;function t(e){var n=!1;return"string"==typeof e&&"all"===e.toLowerCase()?n=!0:Te.isArray(e)&&e.length&&Te.each(e,function(e,t){if("all"===(t=t.toLowerCase())||0===i.indexOf(t))return!(n=!0)}),n}var n,a,r=!0,o=this.option("uploadMime",e);return i&&Te.isPlainObject(o)&&(i=i.toLowerCase(),n=t(o.allow),a=t(o.deny),"allow"===o.firstOrder?(r=!1,a||!0!==n||(r=!0)):(r=!0)!==a||n||(r=!1)),r},sequence:function(n){var e=n.length,i=function(e,t){return n[++t]?i(e.then(n[t]),t):e};return 1<e?i(n[0](),0):n[0]()},reloadContents:function(n){var t,i=Te.Deferred();try{t=Te('<iframe width="1" height="1" scrolling="no" frameborder="no" style="position:absolute; top:-1px; left:-1px" crossorigin="use-credentials">').attr("src",n).one("load",function(){var t=Te(this);try{this.contentDocument.location.reload(!0),t.one("load",function(){t.remove(),i.resolve()})}catch(e){t.attr("src","").attr("src",n).one("load",function(){t.remove(),i.resolve()})}}).appendTo("body")}catch(e){t&&t.remove(),i.reject()}return i},makeNetmountOptionOauth:function(s,e,l,d){return{vars:{},name:e,inputs:{offline:Te('<input type="checkbox"/>').on("change",function(){Te(this).parents("table.elfinder-netmount-tb").find("select:first").trigger("change","reset")}),host:Te('<span><span class="elfinder-info-spinner"/></span><input type="hidden"/>'),path:Te('<input type="text" value="root"/>'),user:Te('<input type="hidden"/>'),pass:Te('<input type="hidden"/>')},select:function(n,e,t){var i=this.inputs,a=i.offline,r=Te(i.host[0]);t=t||null;this.vars.mbtn=i.host.closest(".ui-dialog").children(".ui-dialog-buttonpane:first").find("button.elfinder-btncnt-0"),r.data("inrequest")||!r.find("span.elfinder-info-spinner").length&&"reset"!==t&&("winfocus"!==t||r.siblings("span.elfinder-button-icon-reload").length)?(a.closest("tr")[d||i.user.val()?"hide":"show"](),r.data("funcexpup")&&r.data("funcexpup")()):(1===a.parent().children().length&&(i.path.parent().prev().html(n.i18n("folderId")),a.attr("title",n.i18n("offlineAccess")),a.uniqueId().after(Te("<label/>").attr("for",a.attr("id")).html(" "+n.i18n("offlineAccess")))),r.data("inrequest",!0).empty().addClass("elfinder-info-spinner").parent().find("span.elfinder-button-icon").remove(),n.request({data:{cmd:"netmount",protocol:s,host:l,user:"init",options:{id:n.id,offline:a.prop("checked")?1:0,pass:i.host[1].value}},preventDefault:!0}).done(function(e){r.removeClass("elfinder-info-spinner").html(e.body.replace(/\{msg:([^}]+)\}/g,function(e,t){return n.i18n(t,l)}))}),d&&a.closest("tr").hide()),this.vars.mbtn[Te(i.host[1]).val()?"show":"hide"]()},done:function(n,e){var t=this.inputs,i=this.protocol,a=Te(t.host[0]),r=Te(t.host[1]),o="&nbsp;";if(d&&t.offline.closest("tr").hide(),"makebtn"==e.mode)a.removeClass("elfinder-info-spinner").removeData("expires").removeData("funcexpup"),t.host.find("input").hover(function(){Te(this).toggleClass("ui-state-hover")}),r.val(""),t.path.val("root").next().remove(),t.user.val(""),t.pass.val(""),d||t.offline.closest("tr").show(),this.vars.mbtn.hide();else{if(e.expires&&(o="()",a.data("expires",e.expires)),a.html(l+o).removeClass("elfinder-info-spinner"),e.expires&&(a.data("funcexpup",function(){var e=Math.floor((a.data("expires")-new Date/1e3)/60);e<3?a.parent().children(".elfinder-button-icon-reload").click():(a.text(a.text().replace(/\(.*\)/,"("+n.i18n(["minsLeft",e])+")")),setTimeout(function(){a.is(":visible")&&a.data("funcexpup")()},6e4))}),a.data("funcexpup")()),e.reset)return void i.trigger("change","reset");a.parent().append(Te('<span class="elfinder-button-icon elfinder-button-icon-reload" title="'+n.i18n("reAuth")+'">').on("click",function(){r.val("reauth"),i.trigger("change","reset")})),r.val(s),this.vars.mbtn.show(),e.folders&&t.path.next().remove().end().after(Te("<div/>").append(Te('<select class="ui-corner-all" style="max-width:200px;">').append(Te(Te.map(e.folders,function(e,t){return'<option value="'+(t+"").trim()+'">'+n.escape(e)+"</option>"}).join(""))).on("change",function(){t.path.val(Te(this).val())}))),t.user.val("done"),t.pass.val("done"),t.offline.closest("tr").hide()}a.removeData("inrequest")},fail:function(e,t){Te(this.inputs.host[0]).removeData("inrequest"),this.protocol.trigger("change","reset")}}},findCwdNodes:function(e,n){var i=this,a=this.getUI("cwd"),r=this.cwd().hash,o=Te();return n=n||{},Te.each(e,function(e,t){if(t.phash===r&&(o=o.add(a.find("#"+i.cwdHash2Id(t.hash))),n.firstOnly))return!1}),o},convAbsUrl:function(e){if(e.match(/^http/i))return e;if("//"===e.substr(0,2))return window.location.protocol+e;var t,n=window.location.protocol+"//"+window.location.host,i=/[^\/]+\/\.\.\//;for(t=(t="/"===e.substr(0,1)?n+e:n+window.location.pathname.replace(/\/[^\/]+$/,"/")+e).replace("/./","/");i.test(t);)t=t.replace(i,"");return t},navHash2Id:function(e){return this.navPrefix+e},navId2Hash:function(e){return"string"==typeof e&&e.substr(this.navPrefix.length)},cwdHash2Id:function(e){return this.cwdPrefix+e},cwdId2Hash:function(e){return"string"==typeof e&&e.substr(this.cwdPrefix.length)},isInWindow:function(e,t){return!(!t&&e.is(":hidden"))&&(!!(n=e.get(0))&&(i=n.getBoundingClientRect(),!!document.elementFromPoint(i.left,i.top)));var n,i},loadScript:function(t,n,i,a){var e={dataType:"script",cache:!0},r=null;return Te.isFunction(n)&&(r=function(){if(a)if(void 0===a.obj[a.name])var e=a.timeout?a.timeout/10:1e3,t=setInterval(function(){0<--e&&void 0!==a.obj[a.name]&&(clearInterval(t),n())},10);else n();else n()}),i&&"tag"===i.loadType?(Te.each(t,function(e,t){Te("head").append(Te('<script defer="defer">').attr("src",t))}),r()):(i=Te.isPlainObject(i)?Te.extend(e,i):e,function e(){Te.ajax(Te.extend(i,{url:t.shift(),success:t.length?e:r}))}()),this},loadCss:function(e){var n=this;return"string"==typeof e&&(e=[e]),Te.each(e,function(e,t){t=n.convAbsUrl(t).replace(/^https?:/i,""),Te("head > link[href='+url+']").length||Te("head").append('<link rel="stylesheet" type="text/css" href="'+t+'" />')}),this},log:function(e){return window.console&&window.console.log&&window.console.log(e),this},debug:function(e,t){var n=this.options.debug;return("all"==n||!0===n||Te.isArray(n)&&-1!=Te.inArray(e,n))&&window.console&&window.console.log&&window.console.log("elfinder debug: ["+e+"] ["+this.id+"]",t),"backend-debug"===e&&this.trigger("backenddebug",t),this},time:function(e){window.console&&window.console.time&&window.console.time(e)},timeEnd:function(e){window.console&&window.console.timeEnd&&window.console.timeEnd(e)},setReadOnly:function(e){this.options.customData.readonly=e,this.options.customData.id=this.id,this.exec("reload")},setHome:function(e){this.options.customData.home=e,this.options.customData.id=this.id;var t=this.id;Te("#"+t).after('<div id="_after_'+t+'"></div>'),Te("#"+t).remove(),Te("#_after_"+t).after('<div id="'+t+'"></div>'),window[t]=Te("#"+t).elfinder(this.options).elfinder("instance")},setHeight:function(e){this.options.height=e,this.resize(this.options.width,this.options.height)},setWidth:function(e){this.options.width=e,this.resize(this.options.width,this.options.height)}},Object.keys||(Object.keys=(a=Object.prototype.hasOwnProperty,r=!{toString:null}.propertyIsEnumerable("toString"),s=(o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var t=[];for(var n in e)a.call(e,n)&&t.push(n);if(r)for(var i=0;i<s;i++)a.call(e,o[i])&&t.push(o[i]);return t})),ze.prototype.version="2.1.20",function(){if(Te.ui&&Te.ui.ddmanager){var s=Te.ui.ddmanager.prepareOffsets;Te.ui.ddmanager.prepareOffsets=function(e,t){function n(e){if(e.is(":hidden"))return!0;var t=e[0].getBoundingClientRect();return!document.elementFromPoint(t.left,t.top)}if("mousedown"===t.type||e.options.elfRefresh){var i,a,r=Te.ui.ddmanager.droppables[e.options.scope]||[],o=r.length;for(i=0;i<o;i++)(a=r[i]).options.autoDisable&&(!a.options.disabled||1<a.options.autoDisable)&&(a.options.disabled=n(a.element),a.options.autoDisable=a.options.disabled?2:1)}return s(e,t)}}}(),function(a){if(a.support.touch="ontouchend"in document,a.support.touch){var i,r,o,e=a.ui.mouse.prototype,t=e._mouseInit,n=e._mouseDestroy;e._touchStart=function(e){!i&&this._mouseCapture(e.originalEvent.changedTouches[0])&&(r=e.originalEvent.changedTouches[0].screenX.toFixed(0),o=e.originalEvent.changedTouches[0].screenY.toFixed(0),i=!0,this._touchMoved=!1,s(e,"mouseover"),s(e,"mousemove"),s(e,"mousedown"))},e._touchMove=function(e){if(i){var t=e.originalEvent.changedTouches[0].screenX.toFixed(0),n=e.originalEvent.changedTouches[0].screenY.toFixed(0);Math.abs(r-t)<=2&&Math.abs(o-n)<=2||(this._touchMoved=!0,s(e,"mousemove"))}},e._touchEnd=function(e){i&&(s(e,"mouseup"),s(e,"mouseout"),this._touchMoved||s(e,"click"),i=!1,this._touchMoved=!1)},e._mouseInit=function(){var e=this;e.element.hasClass("touch-punch")&&e.element.bind({touchstart:a.proxy(e,"_touchStart"),touchmove:a.proxy(e,"_touchMove"),touchend:a.proxy(e,"_touchEnd")}),t.call(e)},e._mouseDestroy=function(){var e=this;e.element.hasClass("touch-punch")&&e.element.unbind({touchstart:a.proxy(e,"_touchStart"),touchmove:a.proxy(e,"_touchMove"),touchend:a.proxy(e,"_touchEnd")}),n.call(e)}}function s(e,t){if(!(1<e.originalEvent.touches.length)){a(e.currentTarget).hasClass("touch-punch-keep-default")||e.preventDefault();var n=e.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}}}(jQuery),Te.fn.elfinder=function(t){return"instance"==t?this.getElFinder():this.each(function(){var e="string"==typeof t?t:"";switch(this.elfinder||new ze(this,"object"==typeof t?t:{}),e){case"close":case"hide":this.elfinder.hide();break;case"open":case"show":this.elfinder.show();break;case"destroy":this.elfinder.destroy()}})},Te.fn.getElFinder=function(){var e;return this.each(function(){if(this.elfinder)return e=this.elfinder,!1}),e},Te.fn.elfUiWidgetInstance=function(t){try{return this[t]("instance")}catch(e){var n=this.data("ui-"+t);return n&&"object"==typeof n&&n.widgetFullName==="ui-"+t?n:null}},ze.prototype._options={url:"",requestType:"get",transport:{},urlUpload:"",dragUploadAllow:"auto",overwriteUploadConfirm:!0,uploadMaxChunkSize:10485760,folderUploadExclude:{win:/^(?:desktop\.ini|thumbs\.db)$/i,mac:/^\.ds_store$/i},iframeTimeout:0,customData:{},handlers:{},customHeaders:{},xhrFields:{},lang:"en",cssAutoLoad:!0,cssClass:"",commands:["*"],commandsOptions:{getfile:{onlyURL:!1,multiple:!1,folders:!1,oncomplete:"",getPath:!0,getImgSize:!1},open:{method:"post"},upload:{ui:"button"},download:{maxRequests:10},quicklook:{autoplay:!0,width:450,height:300,googleDocsMimes:[]},edit:{mimes:[],editors:[],encodings:["Big5","Big5-HKSCS","Cp437","Cp737","Cp775","Cp850","Cp852","Cp855","Cp857","Cp858","Cp862","Cp866","Cp874","EUC-CN","EUC-JP","EUC-KR","ISO-2022-CN","ISO-2022-JP","ISO-2022-KR","ISO-8859-1","ISO-8859-2","ISO-8859-3","ISO-8859-4","ISO-8859-5","ISO-8859-6","ISO-8859-7","ISO-8859-8","ISO-8859-9","ISO-8859-13","ISO-8859-15","KOI8-R","KOI8-U","Shift-JIS","Windows-1250","Windows-1251","Windows-1252","Windows-1253","Windows-1254","Windows-1257"]},search:{incsearch:{enable:!0,minlen:1,wait:500}},info:{nullUrlDirLinkSelf:!0,custom:{}},mkdir:{intoNewFolderToolbtn:!1},resize:{grid8px:"enable"},help:{view:["about","shortcuts","help","debug"]}},getFileCallback:null,defaultView:"icons",startPathHash:"",sound:!0,ui:["toolbar","tree","path","stat"],uiOptions:{toolbar:[["back","forward"],["mkdir","mkfile","upload"],["info","chmod"],["quicklook"],["copy","cut","paste"],["rm"],["duplicate","rename","resize"],["view","sort"],["help"],["fullscreen"],{displayTextLabel:!1,labelExcludeUA:["Mobile"],autoHideUA:["Mobile"]}],tree:{openRootOnLoad:!0,openCwdOnOpen:!0,syncTree:!0},navbar:{minWidth:150,maxWidth:500,autoHideUA:[]},cwd:{oldSchool:!1,showSelectCheckboxUA:["Touch"],listView:{columns:["perm","date","size","kind"],columnsCustomName:{},fixedHeader:!0}}},onlyMimes:[],sortRules:{},sortType:"name",sortOrder:"asc",sortStickFolders:!0,sortAlsoTreeview:!1,clientFormatDate:!0,UTCDate:!1,dateFormat:"",fancyDateFormat:"",fileModeStyle:"both",width:"auto",height:400,resizable:!0,notifyDelay:500,notifyDialog:{position:{top:"12px",right:"12px"},width:280},allowShortcuts:!0,rememberLastDir:!1,reloadClearHistory:!1,useBrowserHistory:!1,showFiles:50,showThreshold:50,validName:!1,backupSuffix:"~",sync:0,syncStart:!0,loadTmbs:5,cookie:{expires:30,domain:"",path:"/",secure:!1},contextmenu:{navbar:["open","download","|","upload","mkdir","|","copy","cut","paste","duplicate","|","rm","|","rename","|","archive","|","places","info","chmod","netunmount"],cwd:["reload","back","|","upload","mkdir","mkfile","paste","|","view","sort","colwidth","|","info","|","fullscreen"],files:["getfile","|","open","download","opendir","quicklook","|","upload","mkdir","|","copy","cut","paste","duplicate","|","rm","|","rename","resize","|","archive","extract","|","places","info","chmod","netunmount"]},enableAlways:!1,enableByMouseOver:!0,windowCloseConfirm:["hasNotifyDialog","editingFile"],rawStringDecoder:"object"==typeof Encoding&&Te.isFunction(Encoding.convert)?function(e){return Encoding.convert(e,{to:"UNICODE",type:"string"})}:null,debug:["error","warning","event-destroy"]},ze.prototype._options.commandsOptions.netmount={ftp:{name:"FTP",inputs:{host:Te('<input type="text"/>'),port:Te('<input type="text" placeholder="21"/>'),path:Te('<input type="text" value="/"/>'),user:Te('<input type="text"/>'),pass:Te('<input type="password"/>'),encoding:Te('<input type="text" placeholder="Optional"/>'),locale:Te('<input type="text" placeholder="Optional"/>')}},dropbox:{name:"Dropbox.com",inputs:{host:Te('<span><span class="elfinder-info-spinner"/></span></span><input type="hidden"/>'),path:Te('<input type="text" value="/"/>'),user:Te('<input type="hidden"/>'),pass:Te('<input type="hidden"/>')},select:function(n){var t=this;t.inputs.host.find("span").length&&n.request({data:{cmd:"netmount",protocol:"dropbox",host:"dropbox.com",user:"init",pass:"init",options:{url:n.uploadURL,id:n.id}},preventDefault:!0}).done(function(e){t.inputs.host.find("span").removeClass("elfinder-info-spinner"),t.inputs.host.find("span").html(e.body.replace(/\{msg:([^}]+)\}/g,function(e,t){return n.i18n(t,"Dropbox.com")}))}).fail(function(){})},done:function(e,t){var n=this;"makebtn"==t.mode?(n.inputs.host.find("span").removeClass("elfinder-info-spinner"),n.inputs.host.find("input").hover(function(){Te(this).toggleClass("ui-state-hover")}),n.inputs.host[1].value=""):(n.inputs.host.find("span").removeClass("elfinder-info-spinner"),n.inputs.host.find("span").html("Dropbox.com"),n.inputs.host[1].value="dropbox",n.inputs.user.val("done"),n.inputs.pass.val("done"))}},googledrive:ze.prototype.makeNetmountOptionOauth("googledrive","Google Drive","Google"),onedrive:ze.prototype.makeNetmountOptionOauth("onedrive","One Drive","OneDrive"),box:ze.prototype.makeNetmountOptionOauth("box","Box","Box",!0)},ze.prototype.history=function(n){function t(){o=[n.cwd().hash],r=!(i=0)}function e(e){return e&&a.canForward()||!e&&a.canBack()?(r=!1,n.exec("open",o[e?++i:--i]).fail(t)):Te.Deferred().reject()}var i,a=this,r=!0,o=[],s=n.options.useBrowserHistory&&window.history&&window.history.pushState?window.history:null;this.canBack=function(){return 0<i},this.canForward=function(){return i<o.length-1},this.back=e,this.forward=function(){return e(!0)},n.open(function(){var e=o.length,t=n.cwd().hash;r&&(0<=i&&i+1<e&&o.splice(i+1),o[o.length-1]!=t&&o.push(t),i=o.length-1),r=!0,s&&(s.state?s.state.thash!=t&&s.pushState({thash:t},null,location.pathname+location.search+"#elf_"+t):s.replaceState({thash:t},null,location.pathname+location.search+"#elf_"+t))}).reload(n.options.reloadClearHistory&&t)},ze.prototype.command=function(t){this.fm=t,this.name="",this.className="",this.title="",this.linkedCmds=[],this.state=-1,this.alwaysEnabled=!1,this._disabled=!1,this.disableOnSearch=!1,this.updateOnSelect=!0,this._handlers={enable:function(){this.update(void 0,this.value)},disable:function(){this.update(-1,this.value)},"open reload load sync":function(){this._disabled=!(this.alwaysEnabled||this.fm.isCommandEnabled(this.name)),this.update(void 0,this.value),this.change()}},this.handlers={},this.shortcuts=[],this.options={ui:"button"},this.setup=function(t,e){var n,i,a,r,o=this,s=this.fm;for(this.name=t,this.title=s.messages["cmd"+t]?s.i18n("cmd"+t):this.extendsCmd&&s.messages["cmd"+this.extendsCmd]?s.i18n("cmd"+this.extendsCmd):t,this.options=Te.extend({},this.options,e),this.listeners=[],e.shortcuts&&("function"==typeof e.shortcuts?a=e.shortcuts(this.fm,this.shortcuts):Te.isArray(e.shortcuts)&&(a=e.shortcuts),this.shortcuts=a||[]),this.updateOnSelect&&(this._handlers.select=function(){this.update(void 0,this.value)}),Te.each(Te.extend({},o._handlers,o.handlers),function(e,t){s.bind(e,Te.proxy(t,o))}),n=0;n<this.shortcuts.length;n++)i=this.shortcuts[n],r=i.callback||o.exec,i.callback=function(){s.isCommandEnabled(o.name)&&r.call(o)},i.description||(i.description=this.title),s.shortcut(i);this.disableOnSearch&&s.bind("search searchend",function(e){o._disabled="search"===e.type||!(this.alwaysEnabled||s.isCommandEnabled(t)),o.update(void 0,o.value)}),this.init()},this.init=function(){},this.exec=function(e,t){return Te.Deferred().reject()},this.disabled=function(){return this.state<0},this.enabled=function(){return-1<this.state},this.active=function(){return 0<this.state},this.getstate=function(){return-1},this.update=function(e,t){var n=this.state,i=this.value;this._disabled?this.state=-1:this.state=void 0!==e?e:this.getstate(),this.value=t,n==this.state&&i==this.value||this.change()},this.change=function(e){var t,n;if("function"==typeof e)this.listeners.push(e);else for(n=0;n<this.listeners.length;n++){t=this.listeners[n];try{t(this.state,this.value)}catch(e){this.fm.debug("error",e)}}return this},this.hashes=function(e){return e?Te.map(Te.isArray(e)?e:[e],function(e){return t.file(e)?e:null}):t.selected()},this.files=function(e){var t=this.fm;return e?Te.map(Te.isArray(e)?e:[e],function(e){return t.file(e)||null}):t.selectedFiles()}},ze.prototype.resources={class:{hover:"ui-state-hover",active:"ui-state-active",disabled:"ui-state-disabled",draggable:"ui-draggable",droppable:"ui-droppable",adroppable:"elfinder-droppable-active",cwdfile:"elfinder-cwd-file",cwd:"elfinder-cwd",tree:"elfinder-tree",treeroot:"elfinder-navbar-root",navdir:"elfinder-navbar-dir",navdirwrap:"elfinder-navbar-dir-wrapper",navarrow:"elfinder-navbar-arrow",navsubtree:"elfinder-navbar-subtree",navcollapse:"elfinder-navbar-collapsed",navexpand:"elfinder-navbar-expanded",treedir:"elfinder-tree-dir",placedir:"elfinder-place-dir",searchbtn:"elfinder-button-search",editing:"elfinder-to-editing"},tpl:{perms:'<span class="elfinder-perms"/>',lock:'<span class="elfinder-lock"/>',symlink:'<span class="elfinder-symlink"/>',navicon:'<span class="elfinder-nav-icon"/>',navspinner:'<span class="elfinder-navbar-spinner"/>',navdir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon" {style}/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree" style="display:none"/></div>',placedir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}" title="{title}"><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon" {style}/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree" style="display:none"/></div>'},mimes:{text:["application/x-empty","application/javascript","application/xhtml+xml","audio/x-mp3-playlist","application/x-web-config","application/docbook+xml","application/x-php","application/x-perl","application/x-awk","application/x-config","application/x-csh","application/xml"]},mixin:{make:function(){function a(){I.is(":hidden")||I.addClass("ui-front").elfinderoverlay("hide").off("click",A),S.removeClass("ui-front").css("position",""),v?t.css("max-height",""):n&&n.css("width","").parent("td").css("overflow","")}var e,t,n,i,r,o,s,l,d,c=this.fm,u=this.name,h=c.getUI("workzone"),p=this.origin&&"navbar"===this.origin?"tree":"cwd",f=c.getUI(p),m="tree"==p,g=m?"navHash2Id":"cwdHash2Id",v=!m&&"list"!=c.storage("view"),b=c.selected(),y=this.move||!1,w=h.hasClass("elfinder-cwd-wrapper-empty"),x=Te.Deferred().fail(function(e){r&&i.attr("class",r),w&&h.addClass("elfinder-cwd-wrapper-empty"),b&&(y&&c.trigger("unlockfiles",{files:b}),c.clipboard([]),c.trigger("selectfiles",{files:b})),e&&c.error(e)}).always(function(){a(),D(),c.enable(),c.trigger("resMixinMake")}),C="tmp_"+parseInt(1e5*Math.random()),k=m?c.file(b[0]).hash:c.cwd().hash,T=new Date,z={hash:C,phash:k,name:c.uniqueName(this.prefix,k),mime:this.mime,read:!0,write:!0,date:"Today "+T.getHours()+":"+T.getMinutes(),move:y},O=this.data||{},S=f.trigger("create."+c.namespace,z).find("#"+c[g](C)).on("unselect."+c.namespace,function(){setTimeout(function(){E&&E.blur()},50)}),I=c.getUI("overlay"),D=function(){c.unbind("resize",U),E.remove(),m&&S.closest(".elfinder-navbar-wrapper").remove(),S.remove()},A=function(e){F||(D(),e.stopPropagation(),x.reject())},E=Te(v?"<textarea/>":'<input type="text"/>').on("keyup text",function(){v?(this.style.height="1px",this.style.height=this.scrollHeight+"px"):e&&(this.style.width=e+"px",this.scrollWidth>e&&(this.style.width=this.scrollWidth+10+"px"))}).keydown(function(e){e.stopImmediatePropagation(),e.keyCode==Te.ui.keyCode.ESCAPE?x.reject():e.keyCode==Te.ui.keyCode.ENTER&&E.blur()}).mousedown(function(e){e.stopPropagation()}).blur(function(){var e,t=Te.trim(E.val()),n=E.parent(),i=!0;if(!F&&n.length){if(c.options.validName&&c.options.validName.test)try{i=c.options.validName.test(t)}catch(e){i=!1}if(!t||".."===t||!i)return F=!0,c.error("errInvName",{modal:!0,close:M}),!1;if(c.fileByName(t,k))return F=!0,c.error(["errExists",t],{modal:!0,close:M}),!1;e=b&&y?c.exec("cut",b):null,Te.when(e).done(function(){a(),E.hide().before(Te("<span>").text(t)),c.lockfiles({files:[C]}),c.request({data:Te.extend({cmd:u,name:t,target:k},O||{}),notify:{type:u,cnt:1},preventFail:!0,syncOnFail:!0}).fail(function(e){c.unlockfiles({files:[C]}),F=!0,E.show().prev().remove(),c.error(e,{modal:!0,close:M})}).done(function(i){if(x.resolve(i),i&&i.added&&i.added[0]){var a=i.added[0],e=a.hash,r=f.find("#"+c[g](e));b&&y&&c.one(u+"done",function(){c.exec("paste",e)}),c.one(u+"done",function(){var e,t,n={directory:{cmd:"open",msg:"cmdopendir"},default:{cmd:"open",msg:"cmdopen"}};r=f.find("#"+c[g](a.hash)),1===i.added.length&&(e=n[a.mime]||n.default,t=Te("<div/>").append(Te('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">'+c.i18n(e.msg)+"</span></button>").on("mouseenter mouseleave",function(e){Te(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click",function(){c.exec(e.cmd,a.hash)}))),r.length?(r.trigger("scrolltoview"),!y&&t&&c.toast({msg:c.i18n(["complete",c.i18n("cmd"+u)]),extNode:t})):(c.trigger("selectfiles",{files:Te.map(i.added,function(e){return e.hash})}),y||c.toast({msg:c.i18n(["complete",c.i18n("cmd"+u)]),extNode:t}))})}})}).fail(function(){x.reject()})}}),M=function(){var e=E.val().replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/gi,"");F=!1,c.UA.Mobile&&I.on("click",A).removeClass("ui-front").elfinderoverlay("show"),E.select().focus(),E[0].setSelectionRange&&E[0].setSelectionRange(0,e.length)},U=function(){S.trigger("scrolltoview")},F=!1;return!m&&this.disabled()||!S.length?x.reject():(m?(i=Te("#"+c[g](k)),o=c.res("class","navcollapse"),s=c.res("class","navexpand"),l=c.res("class","navarrow"),d=c.res("class","navsubtree"),S.closest("."+d).show(),i.hasClass(o)||(r=i.attr("class"),i.addClass(o+" "+s+" elfinder-subtree-loaded")),i.is("."+o+":not(."+s+")")&&i.children("."+l).click().data("dfrd").done(function(){E.val()===z.name&&E.val(c.uniqueName(this.prefix,k)).select().focus()}.bind(this)),(t=S.contents().filter(function(){return 3==this.nodeType&&Te(this).parent().attr("id")===c.navHash2Id(z.hash)})).replaceWith(E.val(z.name))):(w&&h.removeClass("elfinder-cwd-wrapper-empty"),t=S.find(".elfinder-cwd-filename"),n=t.parent(),S.css("position","relative").addClass("ui-front"),v?t.css("max-height","none"):(e=n.width(),n.width(e-15).parent("td").css("overflow","visible")),t.empty("").append(E.val(z.name))),c.bind("resize",U),E.trigger("keyup"),M(),x)}},blink:function(e,t){var n,i={slowonce:function(){e.hide().delay(250).fadeIn(750).delay(500).fadeOut(3500)},lookme:function(){e.show().fadeOut(500).fadeIn(750)}};n=i[t=t||"slowonce"]||i.lookme,e.stop(!0,!0),n()}},Te.fn.dialogelfinder=function(i){var a="elfinderPosition",r="elfinderDestroyOnClose";if(this.not(".elfinder").each(function(){Te(document);var e=Te('<div class="ui-widget-header dialogelfinder-drag ui-corner-top">'+(i.title||"Files")+"</div>"),t=(Te('<a href="#" class="dialogelfinder-drag-close ui-corner-all"><span class="ui-icon ui-icon-closethick"> </span></a>').appendTo(e).click(function(e){e.preventDefault(),t.dialogelfinder("close")}),Te(this).addClass("dialogelfinder").css("position","absolute").hide().appendTo("body").draggable({handle:".dialogelfinder-drag",containment:"window",stop:function(){t.trigger("resize"),n.trigger("resize")}}).elfinder(i).prepend(e)),n=t.elfinder("instance");t.width(parseInt(t.width())||840).data(r,!!i.destroyOnClose).find(".elfinder-toolbar").removeClass("ui-corner-top"),i.position&&t.data(a,i.position),!1!==i.autoOpen&&Te(this).dialogelfinder("open")}),"open"==i){var e=(t=Te(this)).data(a)||{top:parseInt(Te(document).scrollTop()+(Te(window).height()<t.height()?2:(Te(window).height()-t.height())/2)),left:parseInt(Te(document).scrollLeft()+(Te(window).width()<t.width()?2:(Te(window).width()-t.width())/2))};t.is(":hidden")&&(t.addClass("ui-front").css(e).show().trigger("resize"),setTimeout(function(){t.trigger("resize").mousedown()},200))}else if("close"==i){var t;(t=Te(this).removeClass("ui-front")).is(":visible")&&(t.data(r)?t.elfinder("destroy").remove():t.elfinder("close"))}else if("instance"==i)return Te(this).getElFinder();return this},Te.fn.elfinderbutton=function(c){return this.each(function(){function e(){n.hide()}var n,t="class",i=c.fm,a=i.res(t,"disabled"),r=i.res(t,"active"),o=i.res(t,"hover"),s="elfinder-button-menu-item",l=Te('<span class="elfinder-button-text">'+c.title+"</span>"),d=Te(this).addClass("ui-state-default elfinder-button").attr("title",c.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+(c.className?c.className:c.name)+'"/>',l).hover(function(e){d.hasClass(a)||d["mouseleave"==e.type?"removeClass":"addClass"](o)}).click(function(e){d.hasClass(a)||(n&&1<c.variants.length?(n.is(":hidden")&&c.fm.getUI().click(),e.stopPropagation(),n.slideToggle(100)):c.exec())});l.hide(),Te.isArray(c.variants)&&(d.addClass("elfinder-menubutton"),n=Te('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(d).on("mouseenter mouseleave","."+s,function(){Te(this).toggleClass(o)}).on("click","."+s,function(e){e.preventDefault(),e.stopPropagation(),d.removeClass(o),n.hide(),c.exec(c.fm.selected(),Te(this).data("value"))}),c.fm.bind("disable select",e).getUI().click(e),c.change(function(){n.html(""),Te.each(c.variants,function(e,t){n.append(Te('<div class="'+s+'">'+t[1]+"</div>").data("value",t[0]).addClass(t[0]==c.value?"elfinder-button-menu-item-selected":""))})})),c.change(function(){c.disabled()?d.removeClass(r+" "+o).addClass(a):(d.removeClass(a),d[c.active()?"addClass":"removeClass"](r))}).change()})},Te.fn.elfindercontextmenu=function(A){return this.each(function(){function p(e,t,n,i){var a="",r="",o="";return i&&(i.className&&(a=" "+i.className),i.iconClass&&(o=i.iconClass,t=""),i.iconImg&&(r=" style=\"background:url('"+A.escape(i.iconImg)+"') 0 0 no-repeat;background-size:contain;\"")),Te(s.replace("{icon}",t?"elfinder-button-icon-"+t:o||"").replace("{label}",e).replace("{style}",r).replace("{className}",a)).click(function(e){e.stopPropagation(),e.preventDefault(),n()})}function f(e){var t=e.keyCode,n=Te.ui.keyCode.ESCAPE,i=Te.ui.keyCode.ENTER,a=Te.ui.keyCode.LEFT,r=Te.ui.keyCode.RIGHT,o=Te.ui.keyCode.UP,s=Te.ui.keyCode.DOWN,l="ltr"===A.direction?r:a,d=l===r?a:r;-1!==Te.inArray(t,[n,i,a,r,o,s])&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t==n||t===d?b&&y&&w?(w.trigger("mouseleave"),b.addClass("ui-state-hover"),w=y=null):t==n&&I():t==o||t==s?y?(w&&w.trigger("mouseleave"),t==s&&(!w||y.length<=++y._cur)?y._cur=0:t==o&&(!w||--y._cur<0)&&(y._cur=y.length-1),w=y.eq(y._cur).trigger("mouseenter")):(y=null,b&&b.trigger("mouseleave"),t==s&&(!b||v.length<=++v._cur)?v._cur=0:t==o&&(!b||--v._cur<0)&&(v._cur=v.length-1),b=v.eq(v._cur).addClass("ui-state-hover")):!b||t!=i&&t!==l||(b.hasClass("elfinder-contextmenu-group")?w?t==i&&w.click():(b.trigger("mouseenter"),(y=b.find("div."+k))._cur=0,w=y.first().addClass("ui-state-hover")):t==i&&b.click()))}var g,m,v,b,y,w,x,C="elfinder-contextmenu-item",k="elfinder-contextsubmenu-item",t={distance:8,start:function(){T.data("touching")&&T.find(".ui-state-hover").removeClass("ui-state-hover")},stop:function(){T.data("draged",!0)}},T=Te(this).addClass("touch-punch ui-helper-reset ui-front ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-"+A.direction).hide().on("touchstart",function(e){T.data("touching",!0)}).on("touchend",function(e){T.removeData("touching")}).on("mouseenter mouseleave","."+C,function(e){Te(this).toggleClass("ui-state-hover",!("mouseenter"!==e.type&&(T.data("draged")||!T.data("submenuKeep")))),T.data("draged")&&T.data("submenuKeep")&&T.find(".elfinder-contextmenu-sub:visible").parent().addClass("ui-state-hover")}).on("mouseenter mouseleave",".elfinder-contextmenu-extra-icon",function(e){Te(this).parent().toggleClass("ui-state-hover","mouseleave"===e.type)}).on("mouseenter mouseleave","."+C+",."+k,function(e){function t(n,i){Te.each(i?y:v,function(e,t){if(n[0]===t)return(i?y:v)._cur=e,i?w=n:b=n,!1})}var n;if(e.originalEvent){var i=Te(this);"mouseenter"===e.type?i.hasClass(k)?(w&&w.removeClass("ui-state-hover"),y=b.find("div."+k),t(i,!0)):(b&&b.removeClass("ui-state-hover"),t(i)):i.hasClass(k)?y=w=null:(b&&b.removeClass("ui-state-hover"),n=b,setTimeout(function(){n===b&&(b=null)},250))}}).on("contextmenu",function(){return!1}).on("mouseup",function(){setTimeout(function(){T.removeData("draged")},100)}).draggable(t),z="ltr"==A.direction?"left":"right",O=Te.extend({},A.options.contextmenu),s='<div class="'+C+'{className}"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"{style}/><span>{label}</span></div>',S=function(e,t,n){var i,a,r=T.outerWidth(),o=T.outerHeight(),s=g.attr("style"),l=g.offset(),d=g.width(),c=g.height(),u=A.UA.Mobile?40:2,h=A.UA.Mobile?20:2;e-=l?l.left:0,t-=l?l.top:0,n=Te.extend(n||{},{top:Math.max(0,t+h+o<c?t+h:t-(t+o-c)),left:Math.max(0,e<r+u||e+u+r<d?e+u:e-u-r),opacity:"1"});x=!0,A.autoSync("stop"),A.toFront(T),g.width(d),T.stop().removeAttr("style").css(n).show(),g.attr("style",s),n[z]=parseInt(T.width()),T.find(".elfinder-contextmenu-sub").css(n),A.UA.iOS&&Te("div.elfinder div.overflow-scrolling-touch").css("-webkit-overflow-scrolling","auto"),w=y=b=null,Te(document).on("keydown."+A.namespace,f),(i=Te._data(document).events)&&i.keydown&&i.keydown.unshift(i.keydown.pop()),A.UA.Mobile&&(a="touchstart.contextmenuAutoToggle",T.data("hideTm")&&clearTimeout(T.data("hideTm")),T.is(":visible")&&T.on("touchstart",function(e){1<e.originalEvent.touches.length||(T.stop().show(),T.data("hideTm")&&clearTimeout(T.data("hideTm")))}).data("hideTm",setTimeout(function(){m.find(".elfinder-cwd-file").off(a),m.find(".elfinder-cwd-file.ui-selected").one(a,function(e){if(!(1<e.originalEvent.touches.length)){var t=Te(e.target);if(T.first().length&&!t.is("input:checkbox")&&!t.hasClass("elfinder-cwd-select"))return S(e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),!1;m.find(".elfinder-cwd-file").off(a)}}).one("unselect."+A.namespace,function(){m.find(".elfinder-cwd-file").off(a)}),T.fadeOut({duration:300,fail:function(){T.css("opacity","1").show()}})},4500)))},I=function(){if(Te(document).off("keydown."+A.namespace,f),D=null,T.is(":visible")||T.children().length){T.removeAttr("style").hide().empty().removeData("submenuKeep");try{T.draggable("instance")||T.draggable(t)}catch(e){T.hasClass("ui-draggable")||T.draggable(t)}T.data("prevNode")&&(T.data("prevNode").after(T),T.removeData("prevNode")),A.trigger("closecontextmenu"),A.UA.iOS&&Te("div.elfinder div.overflow-scrolling-touch").css("-webkit-overflow-scrolling","touch")}x&&A.searchStatus.state<1&&!A.searchStatus.ininc&&A.autoSync(),x=!1},D=null;A.one("load",function(){g=A.getUI(),m=A.getUI("cwd"),A.bind("contextmenu",function(e){var t,n,a,r,i,o,s,l,d,c,u=e.data,h={};u.type&&"files"===u.type||m.trigger("unselectall"),I(),u.type&&u.targets?(a=u.type,r=u.targets,s=o=!1,l={},d=[],c="cwd"===a,D=a,T.data("cmdMaps")&&Te.each(T.data("cmdMaps"),function(e,t){if(0==r[0].indexOf(e,0))return l=t,!1}),c||(d=A.getDisabledCmds(r)),"navbar"===a&&A.select({selected:r,origin:"navbar"}),1<(i=A.selected().length)&&T.append('<div class="ui-corner-top ui-widget-header elfinder-contextmenu-header"><span>'+A.i18n("selectedItems",""+i)+"</span></div>"),v=Te(),Te.each(O[a]||[],function(e,t){var n,f,m,i;if("|"!==t){if(l[t]&&(t=l[t]),!(n=A.getCommand(t))||c||A.searchStatus.state&&n.disableOnSearch||(n.__disabled=n._disabled,n._disabled=!(n.alwaysEnabled||A._commands[t]&&-1===Te.inArray(t,d)),Te.each(n.linkedCmds,function(e,t){var n;(n=A.getCommand(t))&&(n.__disabled=n._disabled,n._disabled=!(n.alwaysEnabled||A._commands[t]&&-1===Te.inArray(t,d)))})),n&&-1!=n.getstate(r)){if(n.variants){if(!n.variants.length)return;f=p(n.title,n.className?n.className:n.name,function(){}),m=Te('<div class="ui-front ui-corner-all elfinder-contextmenu-sub"/>').hide().appendTo(f.append('<span class="elfinder-contextmenu-arrow"/>')),i=function(e){if(e){var t=g.attr("style");g.width(g.width()),m.css({left:"auto",right:"auto"});var n,i,a,r=f.offset(),o=r.left,s=r.top,l=f.outerWidth(),d=m.outerWidth(!0),c=m.outerHeight(!0),u=g.offset(),h=u.left+g.width(),p=u.top+g.height();a=o+l+d-h,n=d<o&&0<a?A.UA.Mobile?10-d:l-a:l,"right"==z&&o<d&&(n=A.UA.Mobile?30-l:l-(d-o)),i=0<(a=s+5+c-p)&&s<p?5-a:0<a?30-c:5,T.find(".elfinder-contextmenu-sub:visible").hide().parent().removeClass("ui-state-hover"),m.css({top:i}).css(z,n).show(),g.attr("style",t)}else m.hide()},f.addClass("elfinder-contextmenu-group").on("touchstart",".elfinder-contextmenu-sub",function(e){f.data("touching",!0)}).on("mouseleave",".elfinder-contextmenu-sub",function(e){T.data("draged")||T.removeData("submenuKeep")}).on("click","."+k,function(e){var t;e.stopPropagation(),T.data("draged")||(T.hide(),t=Te(this).data("exec"),Te.isPlainObject(t)&&(t._currentType=a),I(),n.exec(r,t))}).on("touchend",function(e){T.data("submenuKeep",!0)}).on("mouseenter mouseleave",function(e){"mouseleave"===e.type?T.data("submenuKeep")||f.data("timer",setTimeout(function(){f.removeData("timer"),i(!1)},250)):(f.data("timer")&&(clearTimeout(f.data("timer")),f.removeData("timer")),f.data("touching")||i(!0)),f.removeData("touching")}),Te.each(n.variants,function(e,t){m.append("|"===t?'<div class="elfinder-contextmenu-separator"/>':Te('<div class="'+C+" "+k+'"><span>'+t[1]+"</span></div>").data("exec",t[0]))})}else f=p(n.title,n.className?n.className:n.name,function(){T.data("draged")||(I(),n.exec(r,{_currentType:a}))}),n.extra&&n.extra.node?(Te('<span class="elfinder-button-icon elfinder-button-icon-'+(n.extra.icon||"")+' elfinder-contextmenu-extra-icon"/>').append(n.extra.node).appendTo(f),Te(n.extra.node).trigger("ready")):f.remove(".elfinder-contextmenu-extra-icon");n.extendsCmd&&f.children("span.elfinder-button-icon").addClass("elfinder-button-icon-"+n.extendsCmd),s&&T.append('<div class="elfinder-contextmenu-separator"/>'),T.append(f),s=!(o=!0)}n&&void 0!==n.__disabled&&(n._disabled=n.__disabled,delete n.__disabled,Te.each(n.linkedCmds,function(e,t){var n;(n=A.getCommand(t))&&(n._disabled=n.__disabled,delete n.__disabled)}))}else o&&(s=!0)}),v=T.children("div."+C)):u.raw&&(n=u.raw,D="raw",Te.each(n,function(e,t){var n;"|"===t?T.append('<div class="elfinder-contextmenu-separator"/>'):t.label&&"function"==typeof t.callback&&(n=p(t.label,t.icon,function(){T.data("draged")||(t.remain||I(),t.callback())},t.options||null),T.append(n))}),v=T.children("div."+C)),T.children().length&&((t=u.prevNode||null)&&(T.data("prevNode",T.prev()),t.after(T)),u.fitHeight&&(h={maxHeight:Math.min(A.getUI().height(),Te(window).height()),overflowY:"auto"},T.draggable("destroy").removeClass("ui-draggable")),S(u.x,u.y,h))}).one("destroy",function(){T.remove()}).bind("disable",I).bind("select",function(){"files"===D&&I()}).getUI().click(I)}).shortcut({pattern:"mac"===A.OS?"ctrl+m":"contextmenu shift+f10",description:"contextmenu",callback:function(e){e.stopPropagation(),e.preventDefault(),Te(document).one("contextmenu."+A.namespace,function(e){e.preventDefault(),e.stopPropagation()});var t,n,i,a,r=A.selected();r.length?(t="files",n=r,a=Te("#"+A.cwdHash2Id(r[0]))):(t="cwd",n=[A.cwd().hash],i=A.getUI("workzone").offset()),a&&a.length||(a=A.getUI("workzone")),(i=a.offset()).top+=a.height()/2,i.left+=a.width()/2,A.trigger("contextmenu",{type:t,targets:n,x:i.left,y:i.top})}})})},Te.fn.elfindercwd=function(xe,Ce){return this.not(".elfinder-cwd").each(function(){function r(){return'<tr id="{id}" class="'+n+' {permsclass} {dirclass}" title="{tooltip}"{css}><td class="elfinder-col-name"><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"{style}/>{marker}<span class="elfinder-cwd-filename">{name}</span></div>'+F+"</td>"+function(){for(var e="",t=0;t<U.length;t++)e+='<td class="elfinder-col-'+U[t]+'">{'+U[t]+"}</td>";return e}()+"</tr>"}function m(n){return j[v?"row":"icon"].replace(/\{([a-z0-9_]+)\}/g,function(e,t){return q[t]?q[t](n,xe):n[t]?n[t]:""})}function i(e){Te("#"+xe.cwdHash2Id(e)).trigger(h)}function t(){xe.cwd().hash,F&&ve.find("input").prop("checked",!0),xe.lazy(function(){var e;fe.find("[id]:not(."+w+"):not(.elfinder-cwd-parent)").trigger(h),K=xe.maxTargets&&(M||E).length>xe.maxTargets?(e=Te.map(M||E,function(e){return xe.file(e)||null}),e=xe.sortFiles(e),Te.map(e,function(e){return e.hash})):(M||E).concat(),X(),F&&ve.data("pending",!1)},0,{repaint:!0})}function s(){F&&ve.find("input").prop("checked",!1),K.length?(W=!1,K=[],fe.find("[id]."+w).trigger(u),F&&fe.find("input:checkbox").prop("checked",!1)):xe.select({selected:[]}),X(),F&&ve.data("pending",!1),fe.removeClass("elfinder-cwd-allselected")}function o(e){for(var t=V.length;t--;)if(V[t].hash==e)return t;return-1}function a(t){function n(e){e&&(ye=Te(m(Te.extend(!0,{},e,{name:"..",mime:"directory"}))).addClass("elfinder-cwd-parent").bind("mousedown click mouseup touchstart touchmove touchend dblclick mouseenter",function(e){e.preventDefault(),e.stopPropagation()}).dblclick(function(){xe.exec("open",xe.cwdId2Hash(this.id))}),(v?fe.find("tbody"):fe).prepend(ye))}t=xe.cwd().phash;var e=xe.file(t)||null;e?n(e):xe.getUI("tree").hasClass("elfinder-tree")?xe.one("parents",function(){n(xe.file(t)||null)}):xe.request({data:{cmd:"parents",target:xe.cwd().hash},preventFail:!0}).done(function(e){n(xe.file(t)||null)})}function l(e,t){function n(e){for(var t,n=fe.find("[id]:first");n.length;){if(t=xe.file(xe.cwdId2Hash(n.attr("id"))),!n.hasClass("elfinder-cwd-parent")&&t&&xe.compare(e,t)<0)return n;n=n.next("[id]")}}function i(e){var t,n=V.length;for(t=0;t<n;t++)if(xe.compare(e,V[t])<0)return t;return n||-1}var a,r,o,s,l,d=v?fe.find("tbody"):fe,c=e.length,u={},h={},p=!!Te.htmlPrefilter,f=Te(p?document.createDocumentFragment():"<div/>");if(Q<c)pe(),K=e.concat(),X();else{for(c&&we.removeClass("elfinder-cwd-wrapper-empty");c--;)r=(a=e[c]).hash,Te("#"+xe.cwdHash2Id(r)).length||((o=n(a))&&!o.length&&(o=null),!o&&0<=(l=i(a))?V.splice(l,0,a):(f.empty().append(m(a)),"directory"!==a.mime||g||ae(f),s=p?f:f.children(),o?o.before(s):d.append(s)),Te("#"+xe.cwdHash2Id(r)).length&&"directory"!==a.mime&&a.tmb&&(1==a.tmb?h[r]=a.tmb:u[r]=a.tmb));ne(),le(d),(Object.keys(u).length||Object.keys(h).length)&&(Object.keys($.attachTmbs).length<1&&(me.off(J,re).on(J,re),xe.unbind("resize",re).bind("resize",re)),Te.extend($.attachTmbs,u,h),Object.keys(u).length&&re(u,"change"===t&&"resize"===xe.currentReqCmd),Object.keys(h).length&&re(h))}}function d(e){var t,n,i,a=e.length;if(xe.cwd().hash||"open"===xe.currentReqCmd){for(;a--;)if(t=e[a],(n=Te("#"+xe.cwdHash2Id(t))).length)try{n.remove(),--$.renderd}catch(e){xe.debug("error",e)}else-1!=(i=o(t))&&V.splice(i,1);ne()}else Te.each(A.reverse(),function(e,n){if(xe.files()[n])return xe.one(xe.currentReqCmd+"done",function(e,t){t.cwd().hash||t.exec("open",n)}),!1})}function c(t){function n(){var e=0;me.siblings("div.elfinder-panel:visible").each(function(){e+=Te(this).outerHeight(!0)}),me.height(we.height()-e-me._padding)}t&&n(),be&&clearTimeout(be),be=setTimeout(function(){var e;t||n(),fe.css("height","auto"),e=me[0].clientHeight-parseInt(me.css("padding-top"))-parseInt(me.css("padding-bottom"))-parseInt(fe.css("margin-top")),fe.outerHeight(!0)<e&&fe.height(e)},20),v&&!P&&te()}var e,g=xe.UA.Mobile,v="list"==xe.viewType,h="select."+xe.namespace,u="unselect."+xe.namespace,p="disable."+xe.namespace,f="enable."+xe.namespace,b="class",n=xe.res(b,"cwdfile"),y="."+n,w="ui-selected",x=xe.res(b,"disabled"),C=xe.res(b,"draggable"),k=xe.res(b,"droppable"),T=xe.res(b,"hover"),z=xe.res(b,"adroppable"),O=n+"-tmp",S=0<xe.options.loadTmbs?xe.options.loadTmbs:5,I="",D={},A=[],E=[],M=void 0,U=[],F=Te.map(Ce.showSelectCheckboxUA,function(e){return!(!xe.UA[e]&&!e.match(/^all$/i))||null}).length?'<div class="elfinder-cwd-select"><input type="checkbox"></div>':"",P=!1,H=null,j={icon:'<div id="{id}" class="'+n+' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on"{style}/>{marker}</div><div class="elfinder-cwd-filename" title="{nametitle}">{name}</div>'+F+"</div>",row:""},_=xe.res("tpl","perms"),R=xe.res("tpl","lock"),N=xe.res("tpl","symlink"),q={id:function(e){return xe.cwdHash2Id(e.hash)},name:function(e){var t=xe.escape(e.i18||e.name);return v||(t=t.replace(/([_.])/g,"&#8203;$1")),t},nametitle:function(e){return xe.escape(e.i18||e.name)},permsclass:function(e){return xe.perms2class(e)},perm:function(e){return xe.formatPermissions(e)},dirclass:function(e){var t="directory"==e.mime?"directory":"";return e.isroot&&(t+=" isroot"),e.csscls&&(t+=" "+xe.escape(e.csscls)),Ce.getClass&&(t+=" "+Ce.getClass(e)),t},style:function(e){return e.icon?"style=\"background:url('"+xe.escape(e.icon)+"') 0 0 no-repeat;background-size:contain;\"":""},mime:function(e){return xe.mime2class(e.mime)},size:function(e){return"directory"!==e.mime||e.size?xe.formatSize(e.size):"-"},date:function(e){return xe.formatDate(e)},kind:function(e){return xe.mime2kind(e)},mode:function(e){return e.perm?xe.formatFileMode(e.perm):""},modestr:function(e){return e.perm?xe.formatFileMode(e.perm,"string"):""},modeoct:function(e){return e.perm?xe.formatFileMode(e.perm,"octal"):""},modeboth:function(e){return e.perm?xe.formatFileMode(e.perm,"both"):""},marker:function(e){return(e.alias||"symlink-broken"==e.mime?N:"")+(e.read&&e.write?"":_)+(e.locked?R:"")},tooltip:function(e){var t=xe.formatDate(e)+(0<e.size?" ("+xe.formatSize(e.size)+")":""),n="";return n=I&&e.path?xe.escape(e.path.replace(/\/[^\/]*$/,"")):e.tooltip?xe.escape(e.tooltip).replace(/\r/g,"&#13;"):"",v&&(n+=(n?"&#13;":"")+xe.escape(e.i18||e.name)),n?n+"&#13;"+t:t}},L=Te(),W=!1,K=[],B=void 0,X=function(){if(F){var e=K.length===E.length;ve.find("input").prop("checked",e),fe[e?"addClass":"removeClass"]("elfinder-cwd-allselected")}xe.trigger("select",{selected:K})},Y=function(e,t){var n=e.position().top,i=e.outerHeight(!0),a=me.scrollTop(),r=me.get(0).clientHeight,o=ee?ee.outerHeight(!0):0;a+r<n+o+i?me.scrollTop(parseInt(n+o+i-r)):n<a&&me.scrollTop(n),v&&me.scrollLeft(0),t&&xe.resources.blink(e,"lookme")},V=[],$={},J="elfscrstop",G={filter:y,stop:X,delay:250,appendTo:"body",autoRefresh:!1,selected:function(e,t){Te(t.selected).trigger(h)},unselected:function(e,t){Te(t.unselected).trigger(u)}},Q=xe.options.showFiles,Z=function(){function e(e){e=e||null;var t,n,i,a=[],r=!1,o={},s="self"===xe.option("tmbUrl");t=V.splice(0,Q+(e||0)/($.hpi||1)),$.renderd+=t.length,V.length||(ge.hide(),me.off(J,Z)),n=[],a=Te.map(t,function(e){return e.hash&&e.name?("directory"==e.mime&&(r=!0),(e.tmb||s&&0===e.mime.indexOf("image/"))&&(o[e.hash]=e.tmb),D[e.hash]&&n.push(e.hash),m(e)):null}),c.empty().append(a.join("")),r&&!g&&ae(c),i=[],K.length&&c.find("[id]:not(."+w+"):not(.elfinder-cwd-parent)").each(function(){-1!==Te.inArray(xe.cwdId2Hash(this.id),K)&&i.push(Te(this))}),l.append(d?c:c.children()),i.length&&(Te.each(i,function(e,t){t.trigger(h)}),X()),n.length&&xe.trigger("lockfiles",{files:n}),$.hpi||le(l,t.length),v&&(fe.find("thead").show(),te({fitWidth:!H})),Object.keys(o).length&&(Object.keys($.attachTmbs).length<1&&(me.off(J,re).on(J,re),xe.unbind("resize",re).bind("resize",re)),Te.extend($.attachTmbs,o),re(o)),me.trigger(J)}var t,n,l=v?fe.children("table").children("tbody"):fe,i=!1,d=!!Te.htmlPrefilter,c=Te(d?document.createDocumentFragment():"<div/>");$.renderd?i||0<(t=me.height()+me.scrollTop()+xe.options.showThreshold+$.row-$.renderd*$.hpi)&&(i=!0,xe.lazy(function(){e(t),i=!1})):(i=!0,me.scrollTop(0),n=xe.cwd().phash,e(),Ce.oldSchool&&n&&!I&&a(n),v&&(H&&ne(),te({fitWidth:!0})),$.itemH=(v?l.find("tr:first"):l.find("[id]:first")).outerHeight(!0),xe.trigger("cwdrender"),i=!1)},ee=null,te=function(e){if(Ce.listView.fixedHeader){function t(){var e,t;t="ltr"===xe.direction?(e=-1*me.scrollLeft(),"left"):(e=me.scrollLeft(),"right"),i.css(t)!==e&&i.css(t,e)}var n,i,a,r,o,s,l,d,c,u,h,p,f;e=e||{};if((d=(o=fe.find("tbody")).children("tr:first")).length){if(a=o.parent(),ee?l=(r=Te("#"+xe.namespace+"-cwd-thead")).children("tr:first"):(f=!0,o.addClass("elfinder-cwd-fixheader"),s=(l=(r=fe.find("thead").attr("id",xe.namespace+"-cwd-thead")).children("tr:first")).outerHeight(!0),fe.css("margin-top",s-parseInt(a.css("padding-top"))),i=Te("<div/>").addClass(fe.attr("class")).append(Te("<table/>").append(r)),ee=Te("<div/>").addClass(me.attr("class")+" elfinder-cwd-fixheader").removeClass("ui-droppable native-droppable").css(me.position()).css("height",s).append(i),"rtl"===xe.direction&&ee.css("right",xe.getUI().width()-me.width()+"px"),t(),me.after(ee).on("scroll.fixheader resize.fixheader",function(e){t(),"resize"===e.type&&(e.stopPropagation(),te())})),f||e.fitWidth||2<Math.abs(d.outerWidth()-l.outerWidth())){n=U.length+1;for(var m=0;m<n&&(c=l.children("td:eq("+m+")"),u=d.children("td:eq("+m+")"),h=c.width(),p=u.width(),void 0===c.data("delta")&&c.data("delta",c.outerWidth()-h-(u.outerWidth()-p)),p-=c.data("delta"),f||e.fitWidth||h!==p);m++)c.css("width",p+"px")}ee.data("widthTimer")&&clearTimeout(ee.data("widthTimer")),ee.data("widthTimer",setTimeout(function(){ee&&("rtl"===xe.direction&&ee.css("right",xe.getUI().width()-me.width()+"px"),ee.css(me.position()).css("width",fe.outerWidth()+"px"))},10))}}},ne=function(){if(v&&H){var e="elfinder-cwd-colwidth",i=fe.find("tr[id]:first");i.hasClass(e)||(fe.find("tr."+e).removeClass(e).find("td").css("width",""),i.addClass(e),fe.find("table:first").css("table-layout","fixed"),Te.each(Te.merge(["name"],U),function(e,t){var n=H[t]||i.find("td.elfinder-col-"+t).width();i.find("td.elfinder-col-"+t).width(n)}))}},ie=Te.extend({},xe.droppable,{over:function(e,t){var n,i,a,r=Te(this),o=t.helper,s=e.shiftKey||e.ctrlKey||e.metaKey;if(e.stopPropagation(),o.data("dropover",o.data("dropover")+1),r.data("dropover",!0),o.data("namespace")!==xe.namespace||!xe.insideWorkzone(e.pageX,e.pageY))return r.removeClass(z),void o.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus");r.hasClass(xe.res(b,"cwdfile"))?(n=xe.cwdId2Hash(r.attr("id")),r.data("dropover",n)):(n=xe.cwd().hash,xe.cwd().write&&r.data("dropover",n)),a=xe.file(o.data("files")[0]).phash===n,r.data("dropover")===n?Te.each(o.data("files"),function(e,t){if(t===n||a&&!s&&!o.hasClass("elfinder-drag-helper-plus"))return r.removeClass(z),!1}):r.removeClass(z),o.data("locked")||a?i="elfinder-drag-helper-plus":(i="elfinder-drag-helper-move",s&&(i+=" elfinder-drag-helper-plus")),r.hasClass(z)&&o.addClass(i),setTimeout(function(){r.hasClass(z)&&o.addClass(i)},20)},out:function(e,t){var n=t.helper;e.stopPropagation(),n.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus").data("dropover",Math.max(n.data("dropover")-1,0)),Te(this).removeData("dropover").removeClass(z)},deactivate:function(){Te(this).removeData("dropover").removeClass(z)},drop:function(e,t){s(),xe.droppable.drop.call(this,e,t)}}),ae=function(e){var t=(e=e||(v?fe.find("tbody"):fe)).children(".directory:not(."+k+",.elfinder-na,.elfinder-ro)");xe.isCommandEnabled("paste")&&t.droppable(ie),xe.isCommandEnabled("upload")&&t.addClass("native-droppable"),e.children(".isroot").each(function(e,t){var n=Te(t),i=xe.cwdId2Hash(t.id);xe.isCommandEnabled("paste",i)?n.hasClass(k+",elfinder-na,elfinder-ro")||n.droppable(ie):n.hasClass(k)&&n.droppable("destroy"),xe.isCommandEnabled("upload",i)?n.hasClass("native-droppable,elfinder-na,elfinder-ro")||n.addClass("native-droppable"):n.hasClass("native-droppable")&&n.removeClass("native-droppable")})},re=function(e,l){xe.option("tmbUrl");function t(e,t){var n,i,a,r,o=Te("#"+xe.cwdHash2Id(e)),s=[];o.length&&xe.isInWindow(o,!0)&&("1"!=t?((n=xe.file(e)).tmb!==t&&(n.tmb=t),i=xe.tmb(n),l?xe.reloadContents(i.url).done(function(){o.find(".elfinder-cwd-icon").addClass(i.className).css("background-image","url('"+i.url+"')")}):(a=o,r=i,Te("<img/>").on("load",function(){a.find(".elfinder-cwd-icon").addClass(r.className).css("background-image","url('"+r.url+"')")}).attr("src",r.url))):l?s.push(e):$.getTmbs.push(e),d.push(e)),Te.each(d,function(e,t){delete $.attachTmbs[t]}),l?oe(s):$.getTmbs.length&&oe(),Object.keys($.attachTmbs).length<1&&$.getTmbs.length<1&&(me.off(J,re),xe.unbind("resize",re))}var d=[];Te.isPlainObject(e)&&Object.keys(e).length?(Te.extend($.attachTmbs,e),Te.each(e,t)):($.attachThumbTm&&clearTimeout($.attachThumbTm),$.attachThumbTm=setTimeout(function(){Te.each($.attachTmbs,t)},0))},oe=function(t){var e=[],n=!1;$.gettingTmb&&!t||(t||($.gettingTmb=!0),xe.oldAPI?xe.request({data:{cmd:"tmb",current:xe.cwd().hash},preventFail:!0}).done(function(e){$.gettingTmb=!1,e.images&&Object.keys(e.images).length&&re(e.images),e.tmb&&oe()}).fail(function(){$.gettingTmb=!1}):(e=t?(n=!0,t.splice(0,S)):$.getTmbs.splice(0,S)).length&&(n||xe.isInWindow(Te("#"+xe.cwdHash2Id(e[0])),!0)||xe.isInWindow(Te("#"+xe.cwdHash2Id(e[e.length-1])),!0)?xe.request({data:{cmd:"tmb",targets:e},preventFail:!0}).done(function(e){$.gettingTmb=!1,e.images&&Object.keys(e.images).length&&re(e.images,n),n?t.length&&oe(t):$.getTmbs.length&&oe()}).fail(function(){$.gettingTmb=!1}):(Te.each(e,function(e,t){$.attachTmbs[t]="1"}),$.gettingTmb=!1,re())))},se={name:xe.i18n("name"),perm:xe.i18n("perms"),date:xe.i18n("modify"),size:xe.i18n("size"),kind:xe.i18n("kind"),modestr:xe.i18n("mode"),modeoct:xe.i18n("mode"),modeboth:xe.i18n("mode")},le=function(e,t){var n,i=1;e=e||(v?fe.find("tbody"):fe),0<V.length&&(e.css({height:"auto"}),n=e.height(),t&&(v||(i=Math.floor(e.width()/e.find("[id]:first").width()),t=Math.ceil(t/i)*i),$.hpi=n/t,$.row=$.hpi*i),ge.css({top:$.hpi*V.length+n+"px"}).show())},de=function(e){e.preventDefault(),xe.trigger("contextmenu",{type:"cwd",targets:[xe.cwd().hash],x:e.pageX,y:e.pageY})},ce=function(e){1<e.originalEvent.touches.length||(fe.data("longtap",null),me.data("touching",{x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}),e.target!==this&&e.target!==fe.get(0)||fe.data("tmlongtap",setTimeout(function(){fe.data("longtap",!0),xe.trigger("contextmenu",{type:"cwd",targets:[xe.cwd().hash],x:me.data("touching").x,y:me.data("touching").y})},500)))},ue=function(e){"touchmove"===e.type&&(!me.data("touching")||4<Math.abs(me.data("touching").x-e.originalEvent.touches[0].pageX)+Math.abs(me.data("touching").y-e.originalEvent.touches[0].pageY))&&me.data("touching",null),clearTimeout(fe.data("tmlongtap"))},he=function(e){fe.data("longtap")&&(e.preventDefault(),e.stopPropagation())},pe=function(){var e;we.append(ve).removeClass("elfinder-cwd-wrapper-empty elfinder-search-result elfinder-incsearch-result"),(1<xe.searchStatus.state||xe.searchStatus.ininc)&&we.addClass("elfinder-search-result"+(xe.searchStatus.ininc?" elfinder-incsearch-result":"")),L=Te();try{fe.empty()}catch(e){fe.html("")}ee&&(me.off("scroll.fixheader resize.fixheader"),ee.remove(),ee=null),fe.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-"+(v?"list":"icons")).attr("style","").css("height","auto"),ge.hide(),me[v?"addClass":"removeClass"]("elfinder-cwd-wrapper-list")._padding=parseInt(me.css("padding-top"))+parseInt(me.css("padding-bottom")),xe.UA.iOS&&me.removeClass("overflow-scrolling-touch").addClass("overflow-scrolling-touch"),v&&(fe.html("<table><thead/><tbody/></table>"),e=Te('<tr class="ui-state-default"><td class="elfinder-cwd-view-th-name">'+se.name+"</td>"+function(){for(var e="",t="",n=Te.extend({},se,Ce.listView.columnsCustomName),i=0;i<U.length;i++)e=void 0!==n[U[i]]?n[U[i]]:xe.i18n(U[i]),t+='<td class="elfinder-cwd-view-th-'+U[i]+' sortable-item">'+e+"</td>";return t}()+"</tr>"),fe.find("thead").hide().append(e.on("contextmenu."+xe.namespace,de).on("touchstart."+xe.namespace,"td",ce).on("touchmove."+xe.namespace+" touchend."+xe.namespace+" mouseup."+xe.namespace,"td",ue).on("click."+xe.namespace,"td",he)).find("td:first").append(ve),Te.fn.sortable&&e.addClass("touch-punch touch-punch-keep-default").sortable({axis:"x",distance:8,items:"> .sortable-item",start:function(e,t){Te(t.item[0]).data("dragging",!0),t.placeholder.width(t.helper.removeClass("ui-state-hover").width()).removeClass("ui-state-active").addClass("ui-state-hover").css("visibility","visible")},update:function(e,t){var n,i,a=Te(t.item[0]).attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","");U=Te.map(Te(this).children(),function(e){var t=Te(e).attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","");return i||(a===t?i=!0:n=t),"name"===t?null:t}),j.row=r(),xe.storage("cwdCols",U),n=".elfinder-col-"+n+":first",a=".elfinder-col-"+a+":first",xe.lazy(function(){fe.find("tbody tr").each(function(){var e=Te(this);e.children(n).after(e.children(a))})})},stop:function(e,t){setTimeout(function(){Te(t.item[0]).removeData("dragging")},100)}}),Te.fn.resizable&&e.find("td").addClass("touch-punch").resizable({handles:"ltr"===xe.direction?"e":"w",start:function(e,t){var n=fe.find("td.elfinder-col-"+t.element.attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","")+":first");t.element.data("resizeTarget",n).data("targetWidth",n.width()),P=!0,"fixed"!==fe.find("table").css("table-layout")&&(fe.find("tbody tr:first td").each(function(){Te(this).width(Te(this).width())}),fe.find("table").css("table-layout","fixed"))},resize:function(e,t){t.element.data("resizeTarget").width(t.element.data("targetWidth")-(t.originalSize.width-t.size.width))},stop:function(){te({fitWidth:!(P=!1)}),H={},fe.find("tbody tr:first td").each(function(){var e=Te(this).attr("class").split(" ")[0].replace("elfinder-col-","");H[e]=Te(this).width()}),xe.storage("cwdColWidth",H)}}).find(".ui-resizable-handle").addClass("ui-icon ui-icon-grip-dotted-vertical")),xe.lazy(function(){V=Te.map(M||E,function(e){return xe.file(e)||null}),V=xe.sortFiles(V),$={renderd:0,attachTmbs:{},getTmbs:[],lazyOpts:{tm:0}},we[V.length<1?"addClass":"removeClass"]("elfinder-cwd-wrapper-empty"),me.off(J,Z).on(J,Z).trigger(J),xe.cwd().write?(me[xe.isCommandEnabled("upload")?"addClass":"removeClass"]("native-droppable"),me.droppable("enable")):me.removeClass("native-droppable").droppable("disable").removeClass("ui-state-disabled")})},fe=Te(this).addClass("ui-helper-clearfix elfinder-cwd").attr("unselectable","on").on("click."+xe.namespace,y,function(e){var t,n,i,a,r=this.id?Te(this):Te(this).parents("[id]:first"),o=Te(e.target);if(F&&(o.is("input:checkbox")||o.hasClass("elfinder-cwd-select")))return e.stopPropagation(),e.preventDefault(),me.data("touching")||(r.trigger(r.hasClass(w)?u:h),X()),setTimeout(function(){o.prop("checked",r.hasClass(w))},10),!1;if(fe.data("longtap"))e.stopPropagation();else{if(e.shiftKey&&(t=r.prevAll(B||"."+w+":first"),n=r.nextAll(B||"."+w+":first"),i=t.length,a=n.length),e.shiftKey&&(i||a))(i?r.prevUntil("#"+t.attr("id")):r.nextUntil("#"+n.attr("id"))).add(r).trigger(h);else if(e.ctrlKey||e.metaKey)r.trigger(r.hasClass(w)?u:h);else{if(me.data("touching")&&r.hasClass(w))return me.data("touching",null),void xe.dblclick({file:xe.cwdId2Hash(this.id)});s(),r.trigger(h)}X()}}).on("dblclick."+xe.namespace,y,function(e){xe.dblclick({file:xe.cwdId2Hash(this.id)})}).on("touchstart."+xe.namespace,y,function(e){if(!(1<e.originalEvent.touches.length)){var t=this.id?Te(this):Te(this).parents("[id]:first"),n=Te(e.target);me.data("touching",{x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}),F&&(n.is("input:checkbox")||n.hasClass("elfinder-cwd-select"))?setTimeout(function(){me.data("touching")&&(t.trigger(t.hasClass(w)?u:h),X())},150):"INPUT"!=e.target.nodeName&&"TEXTAREA"!=e.target.nodeName&&(t.prevAll("."+w+":first").length,t.nextAll("."+w+":first").length,fe.data("longtap",null),t.addClass(T).data("tmlongtap",setTimeout(function(){fe.data("longtap",!0),("TD"!=e.target.nodeName||0<xe.selected().length)&&(t.trigger(h),X(),xe.trigger("contextmenu",{type:"files",targets:xe.selected(),x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}))},500)))}}).on("touchmove."+xe.namespace+" touchend."+xe.namespace,y,function(e){if("INPUT"!=e.target.nodeName&&"TEXTAREA"!=e.target.nodeName&&!Te(e.target).hasClass("elfinder-cwd-select")){var t=this.id?Te(this):Te(this).parents("[id]:first");clearTimeout(t.data("tmlongtap")),"touchmove"===e.type?(me.data("touching",null),t.removeClass(T)):me.data("touching")&&!fe.data("longtap")&&t.hasClass(w)&&(e.preventDefault(),me.data("touching",null),xe.dblclick({file:xe.cwdId2Hash(this.id)}))}}).on("mouseenter."+xe.namespace,y,function(e){var t=Te(this),u=null,n=v?t:t.children("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename");g||t.hasClass(O)||n.hasClass(C)||n.hasClass(x)||n.on("mousedown",function(e){e.shiftKey&&!xe.UA.IE&&fe.data("selectable")&&(fe.selectable("destroy").data("selectable",!1),setTimeout(function(){fe.selectable(G).data("selectable",!0)},10)),n.draggable("option","disabled",e.shiftKey).removeClass("ui-state-disabled"),e.shiftKey?n.attr("draggable","true"):n.removeAttr("draggable").draggable("option","cursorAt",{left:50-parseInt(Te(e.currentTarget).css("margin-left")),top:47})}).on("dragstart",function(e){var t=e.dataTransfer||e.originalEvent.dataTransfer||null;if(u=null,t&&!xe.UA.IE){function n(e){var t,n=e.mime,i=xe.tmb(e);return t='<div class="elfinder-cwd-icon '+xe.mime2class(n)+' ui-corner-all"/>',i&&(t=Te(t).addClass(i.className).css("background-image","url('"+i.url+"')").get(0).outerHTML),t}var i,a=this.id?Te(this):Te(this).parents("[id]:first"),r=Te("<span>"),o="",s=null,l=null,d=[],c=[];if(a.trigger(h),X(),Te.each(K,function(e,t){var n=xe.file(t),i=n.url;if(n&&"directory"!==n.mime){if(i){if("1"==i)return c.push(t),!0}else i=xe.url(n.hash);i&&(i=xe.convAbsUrl(i),d.push(t),Te("<a>").attr("href",i).text(i).appendTo(r),o+=i+"\n",s=s||n.mime+":"+n.name+":"+i,l=l||i+"\n"+n.name)}}),c.length)return Te.each(c,function(e,t){var n=xe.file(t);n.url="",xe.request({data:{cmd:"url",target:t},notify:{type:"url",cnt:1},preventDefault:!0}).always(function(e){n.url=e.url?e.url:"1"})}),!1;if(!o)return!1;t.setDragImage&&(u=Te('<div class="elfinder-drag-helper html5-native"></div>').append(n(xe.file(d[0]))).appendTo(Te(document.body)),1<(i=d.length)&&u.append(n(xe.file(d[i-1]))+'<span class="elfinder-drag-num">'+i+"</span>"),t.setDragImage(u.get(0),50,47)),t.effectAllowed="copyLink",t.setData("DownloadURL",s),t.setData("text/x-moz-url",l),t.setData("text/uri-list",o),t.setData("text/plain",o),t.setData("text/html",r.html()),t.setData("elfinderfrom",window.location.href+xe.cwd().hash),t.setData("elfinderfrom:"+t.getData("elfinderfrom"),"")}}).on("dragend",function(e){s(),u&&u.remove()}).draggable(xe.draggable)}).on(h,y,function(e){var t=Te(this),n=xe.cwdId2Hash(t.attr("id"));W||t.hasClass(x)||(B="#"+this.id,t.addClass(w).children().addClass(T).find("input:checkbox").prop("checked",!0),-1===Te.inArray(n,K)&&K.push(n),L=fe.find("[id]."+w+":last").next())}).on(u,y,function(e){var t,n=Te(this),i=xe.cwdId2Hash(n.attr("id"));W||(n.removeClass(w).children().removeClass(T).find("input:checkbox").prop("checked",!1),fe.hasClass("elfinder-cwd-allselected")&&(F&&ve.children("input").prop("checked",!1),fe.removeClass("elfinder-cwd-allselected")),-1!==(t=Te.inArray(i,K))&&(B=void 0,K.splice(t,1)))}).on(p,y,function(){var e=Te(this).removeClass(T+" "+w).addClass(x),t=e.children(),n=v?e:t.find("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename");t.removeClass(T+" "+w),e.hasClass(k)&&e.droppable("disable"),n.hasClass(C)&&n.draggable("disable")}).on(f,y,function(){var e=Te(this).removeClass(x),t=v?e:e.children("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename");e.hasClass(k)&&e.droppable("enable"),t.hasClass(C)&&t.draggable("enable")}).on("scrolltoview",y,function(){Y(Te(this),!0)}).on("mouseenter."+xe.namespace+" mouseleave."+xe.namespace,y,function(e){xe.trigger("hover",{hash:xe.cwdId2Hash(Te(this).attr("id")),type:e.type}),Te(this).toggleClass(T,"mouseenter"==e.type)}).on("contextmenu."+xe.namespace,function(e){var t=Te(e.target).closest("."+n);t.length&&("TD"!=e.target.nodeName||-1<Te.inArray(xe.cwdId2Hash(t.get(0).id),xe.selected()))&&(e.stopPropagation(),e.preventDefault(),t.hasClass(x)||me.data("touching")||(t.hasClass(w)||(s(),t.trigger(h),X()),xe.trigger("contextmenu",{type:"files",targets:xe.selected(),x:e.pageX,y:e.pageY})))}).on("click."+xe.namespace,function(e){e.target!==this||fe.data("longtap")||e.shiftKey||e.ctrlKey||e.metaKey||s()}).on("create."+xe.namespace,function(e,t){var n=v?fe.find("tbody"):fe,i=n.find(".elfinder-cwd-parent"),a=t.move||!1,r=(t=Te(m(t)).addClass(O),xe.selected());r.length?a&&xe.trigger("lockfiles",{files:r}):s(),i.length?i.after(t):n.prepend(t),ne(),me.scrollTop(0).scrollLeft(0)}).on("unselectall",s).on("selectfile",function(e,t){Te("#"+xe.cwdHash2Id(t)).trigger(h),X()}).on("colwidth",function(){v&&(fe.find("table").css("table-layout","").find("td").css("width",""),te({fitWidth:!0}),xe.storage("cwdColWidth",H=null))}),me=Te('<div class="elfinder-cwd-wrapper"/>').droppable(Te.extend({},ie,{autoDisable:!1})).on("contextmenu."+xe.namespace,de).on("touchstart."+xe.namespace,ce).on("touchmove."+xe.namespace+" touchend."+xe.namespace,ue).on("click."+xe.namespace,he).on("scroll."+xe.namespace,function(){$.seltm&&clearTimeout($.seltm),$.scrtm&&clearTimeout($.scrtm),$.scrtm&&Math.abs(($.scrolltop||0)-($.scrolltop=Te(this).scrollTop()))<2?($.scrtm=0,me.trigger(J)):$.scrtm=setTimeout(function(){$.scrtm=0,me.trigger(J)},100)}),ge=Te("<div>&nbsp;</div>").css({position:"absolute",width:"1px",height:"1px"}).hide(),ve=F?Te('<div class="elfinder-cwd-selectall"><input type="checkbox"/></div>').attr("title",xe.i18n("selectall")).on("touchstart mousedown click",function(e){if(e.stopPropagation(),e.preventDefault(),Te(this).data("pending")||"click"===e.type)return!1;ve.data("pending",!0),fe.hasClass("elfinder-cwd-allselected")?(ve.find("input").prop("checked",!1),setTimeout(function(){s()},10)):t()}):Te(),be=null,ye=Te(this).parent().resize(c),we=ye.children(".elfinder-workzone").append(me.append(this).append(ge));q=Te.extend(q,Ce.replacement||{});try{H=xe.storage("cwdColWidth")?xe.storage("cwdColWidth"):null}catch(e){H=null}(U=xe.storage("cwdCols"))?(U=Te.map(U,function(e){return-1!==Ce.listView.columns.indexOf(e)?e:null}),Ce.listView.columns.length>U.length&&Te.each(Ce.listView.columns,function(e,t){-1===U.indexOf(t)&&U.push(t)})):U=Ce.listView.columns,j.row=r(),g&&Te("body").on("touchstart touchmove touchend",function(e){}),F&&fe.addClass("elfinder-has-checkbox"),Te(window).on("scroll."+xe.namespace,function(){e&&clearTimeout(e),e=setTimeout(function(){me.trigger(J)},50)}),Te(document).on("keydown."+xe.namespace,function(e){e.keyCode==Te.ui.keyCode.ESCAPE&&(xe.getUI().find(".ui-widget:visible").length||s())}),xe.one("init",function(){var e,i,a,r,t=document.createElement("style");document.head.appendChild(t),(e=t.sheet).insertRule('.elfinder-cwd-wrapper-empty .elfinder-cwd:after{ content:"'+xe.i18n("emptyFolder")+'" }',0),e.insertRule('.elfinder-cwd-wrapper-empty .ui-droppable .elfinder-cwd:after{ content:"'+xe.i18n("emptyFolder"+(g?"LTap":"Drop"))+'" }',1),e.insertRule('.elfinder-cwd-wrapper-empty .ui-droppable-disabled .elfinder-cwd:after{ content:"'+xe.i18n("emptyFolder")+'" }',2),e.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result .elfinder-cwd:after{ content:"'+xe.i18n("emptySearch")+'" }',3),e.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-incsearch-result .elfinder-cwd:after{ content:"'+xe.i18n("emptyIncSearch")+'" }',3),g||(fe.selectable(G).data("selectable",!0),i=function(){fe.data("selectable")&&($.seltm&&clearTimeout($.seltm),$.seltm=0,fe.selectable("enable").selectable("refresh"))},me.on(J,function(){fe.off("mousedown",i).one("mousedown",i),$.seltm=setTimeout(function(){fe.off("mousedown",i),i()},2e3)}),r=Te('<div style="position:absolute"/>'),(a=xe.getUI()).on("resize",function(e,t){var n;t&&t.fullscreen&&(n=a.offset(),"on"===t.fullscreen?(r.css({top:-1*n.top,left:-1*n.left}).appendTo(a),G.appendTo=r):(r.detach(),G.appendTo="body"),fe.selectable("option",{appendTo:G.appendTo})),i()}))}).bind("open add remove searchend",function(){var t=xe.cwd().hash;E=Te.map(xe.files(),function(e){return e.phash==t?e.hash:null})}).bind("open",function(){A=xe.parents(xe.cwd().hash),M=void 0,s(),pe(),c()}).bind("search",function(e){E=Te.map(e.data.files,function(e){return e.hash}),M=void 0,xe.searchStatus.ininc=!1,pe(),xe.autoSync("stop"),c()}).bind("searchend",function(e){(I||M)&&(I="",M&&xe.trigger("incsearchend",e.data),e.data&&e.data.noupdate||pe()),xe.autoSync(),c()}).bind("searchstart",function(e){s(),I=e.data.query}).bind("incsearchstart",function(e){K=[],xe.lazy(function(){if(I=e.data.query||""){var n=new RegExp(I.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g,"\\$1"),"i");M=Te.map(E,function(e){var t=xe.file(e);return t&&(t.name.match(n)||t.i18&&t.i18.match(n))?t.hash:null}),xe.trigger("incsearch",{hashes:M,query:I}).searchStatus.ininc=!0,pe(),xe.autoSync("stop")}else xe.trigger("incsearchend");c()})}).bind("incsearchend",function(e){I="",xe.searchStatus.ininc=!1,M=void 0,e.data&&e.data.noupdate||pe(),xe.autoSync()}).bind("sortchange",function(){var e=me.scrollLeft();pe(),xe.one("cwdrender",function(){me.scrollLeft(e),K.length&&X(),c()})}).bind("viewchange",function(){var e="list"==xe.storage("view"),t=fe.hasClass("elfinder-cwd-allselected");e!=v&&(v=e,xe.viewType=v?"list":"icons",pe(),t&&(fe.addClass("elfinder-cwd-allselected"),ve.find("input").prop("checked",!0)),K.length&&X()),c()}).bind("wzresize",function(){var e,t=v?fe.find("tbody"):fe;c(!0),$.hpi&&le(t,t.find("[id]").length),e=fe.offset(),we.data("rectangle",Te.extend({width:we.width(),height:we.height(),cwdEdge:"ltr"===xe.direction?e.left:e.left+fe.width()},we.offset())),$.itemH=(v?t.find("tr:first"):t.find("[id]:first")).outerHeight(!0)}).bind("changeclipboard",function(e){D={},e.data&&e.data.clipboard&&e.data.clipboard.length&&Te.each(e.data.clipboard,function(e,t){t.cut&&(D[t.hash]=!0)})}).bind("resMixinMake",function(){ne()}).bind("tmbreload",function(e){var n={},t=e.data&&e.data.files?e.data.files:null;Te.each(t,function(e,t){t.tmb&&"1"!=t.tmb&&(n[t.hash]=t.tmb)}),Object.keys(n).length&&re(n,!0)}).add(function(e){var t=xe.cwd().hash,n=I?new RegExp(I.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g,"\\$1"),"i"):null,i=n?Te.map(e.data.added||[],function(e){return xe.searchStatus.ininc&&e.phash!=t||!(e.name.match(n)||e.i18&&e.i18.match(n))?null:e}):Te.map(e.data.added||[],function(e){return e.phash==t?e:null});l(i),v&&c(),me.trigger(J)}).change(function(e){var t=xe.cwd().hash,n=xe.selected();I?Te.each(e.data.changed||[],function(e,t){d([t.hash]),-1!==t.name.indexOf(I)&&(l([t],"change"),-1!==Te.inArray(t.hash,n)&&i(t.hash))}):Te.each(Te.map(e.data.changed||[],function(e){return e.phash==t?e:null}),function(e,t){d([t.hash]),l([t],"change"),-1!==Te.inArray(t.hash,n)&&i(t.hash)}),X()}).remove(function(e){var t=v?fe.find("tbody"):fe;d(e.data.removed||[]),X(),V.length<1&&t.children().length<1?(we.addClass("elfinder-cwd-wrapper-empty"),F&&ve.find("input").prop("checked",!1),ge.hide(),me.off(J,Z),c()):(le(t),me.trigger(J))}).dragstart(function(e){var t=Te(e.data.target),n=e.data.originalEvent;t.hasClass(y.substr(1))&&(t.hasClass(w)||(n.ctrlKey||n.metaKey||n.shiftKey||s(),t.trigger(h),X())),fe.selectable("disable").removeClass(x),W=!0}).dragstop(function(){fe.selectable("enable"),W=!1}).bind("lockfiles unlockfiles selectfiles unselectfiles",function(e){var t,n,a,r,i={lockfiles:p,unlockfiles:f,selectfiles:h,unselectfiles:u}[e.type],o=e.data.files||[],s=o.length,l=e.data.helper||Te();if(0<s&&(t=xe.parents(o[0])),i!==h&&i!==u||(r=(a=i===h)?K.concat():K,Te.each(o,function(e,t){var n=Te.inArray(t,r),i=fe.hasClass("elfinder-cwd-allselected");-1===n?a&&K.push(t):(i&&(F&&ve.children("input").prop("checked",!1),fe.removeClass("elfinder-cwd-allselected"),i=!1),a||K.splice(n,1))})),!l.data("locked")){for(;s--;)Te("#"+xe.cwdHash2Id(o[s])).trigger(i);e.data.inselect||X()}me.data("dropover")&&-1!==t.indexOf(me.data("dropover"))&&(n="lockfiles"!==e.type,l.toggleClass("elfinder-drag-helper-plus",n),me.toggleClass(z,n))}).bind("mkdir mkfile duplicate upload rename archive extract paste multiupload",function(e){if("upload"!=e.type||!e.data._multiupload){var n=xe.cwd().hash;s(),Te.each((e.data.added||[]).concat(e.data.changed||[]),function(e,t){t&&t.phash==n&&i(t.hash)}),X()}}).shortcut({pattern:"ctrl+a",description:"selectall",callback:t}).shortcut({pattern:"left right up down shift+left shift+right shift+up shift+down",description:"selectfiles",type:"keydown",callback:function(e){!function(e,t){var n,i,a,r,o,s=Te.ui.keyCode,l=e==s.LEFT||e==s.UP,d=fe.find("[id]."+w);function c(e,t){return e[t+"All"]("[id]:not(."+x+"):not(.elfinder-cwd-parent):first")}if(d.length)if((a=c(n=d.filter(l?":first":":last"),l?"prev":"next")).length)if(v||e==s.LEFT||e==s.RIGHT)i=a;else if(r=n.position().top,o=n.position().left,i=n,l){for(;(i=i.prev("[id]")).length&&!(i.position().top<r&&i.position().left<=o););i.hasClass(x)&&(i=c(i,"next"))}else{for(;(i=i.next("[id]")).length&&!(i.position().top>r&&i.position().left>=o););i.hasClass(x)&&(i=c(i,"prev")),i.length||(a=fe.find("[id]:not(."+x+"):last")).position().top>r&&(i=a)}else i=n;else i=L.length?l?L.prev():L:fe.find("[id]:not(."+x+"):not(.elfinder-cwd-parent):"+(l?"last":"first"));i&&i.length&&!i.hasClass("elfinder-cwd-parent")&&(n&&t?i=n.add(n[l?"prevUntil":"nextUntil"]("#"+i.attr("id"))).add(i):d.trigger(u),i.trigger(h),Y(i.filter(l?":first":":last")),X())}(e.keyCode,e.shiftKey)}}).shortcut({pattern:"home",description:"selectffile",callback:function(e){s(),Y(fe.find("[id]:first").trigger(h)),X()}}).shortcut({pattern:"end",description:"selectlfile",callback:function(e){s(),Y(fe.find("[id]:last").trigger(h)),X()}}).shortcut({pattern:"page_up",description:"pageTurning",callback:function(e){$.itemH&&me.scrollTop(Math.round(me.scrollTop()-Math.floor((me.height()+(v?-1*$.itemH:16))/$.itemH)*$.itemH))}}).shortcut({pattern:"page_down",description:"pageTurning",callback:function(e){$.itemH&&me.scrollTop(Math.round(me.scrollTop()+Math.floor((me.height()+(v?-1*$.itemH:16))/$.itemH)*$.itemH))}})}),this},Te.fn.elfinderdialog=function(b,y){var e,w,x=-1!=window.navigator.platform.indexOf("Win");return y&&y.ui?w=y.getUI():(w=this.closest(".elfinder"),y=y||w.elfinder("instance")),"string"==typeof b?(e=this.closest(".ui-dialog")).length&&("open"==b?"none"==e.css("display")&&e.fadeIn(120,function(){e.trigger("open")}):"close"==b||"destroy"==b?(e.stop(!0),(e.is(":visible")||w.is(":hidden"))&&e.hide().trigger("close"),"destroy"==b&&e.remove()):"toTop"==b?e.trigger("totop"):"posInit"==b?e.trigger("posinit"):"tabstopsInit"==b&&e.trigger("tabstopsInit")):((b=Te.extend({},Te.fn.elfinderdialog.defaults,b)).allowMinimize&&"auto"===b.allowMinimize&&(b.allowMinimize=!!this.find("textarea,input").length),b.headerBtnPos&&"auto"===b.headerBtnPos&&(b.headerBtnPos=x?"right":"left"),b.headerBtnOrder&&"auto"===b.headerBtnOrder&&(b.headerBtnOrder=x?"close:maximize:minimize":"close:minimize:maximize"),b.modal&&b.allowMinimize&&(b.allowMinimize=!1),this.filter(":not(.ui-dialog-content)").each(function(){function e(){(m=v.find("."+s)).length&&(m.attr("tabindex","-1"),m.filter("."+l).length||u.children("."+s+":"+(x?"first":"last")).addClass(l))}function o(n){var i=m.filter(":visible"),a=n?null:i.filter("."+l+":first");return a&&a.length||(a=i.first()),n&&Te.each(i,function(e,t){if(t===n&&i[e+1])return a=i.eq(e+1),!1}),a}var a=Te(this).addClass("ui-dialog-content ui-widget-content"),t="elfinder-dialog-active",n="elfinder-dialog",i="elfinder-dialog-notify",r="ui-state-hover",s="elfinder-tabstop",l="elfinder-focus",d=parseInt(1e6*Math.random()),c=Te('<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="elfinder-dialog-title">'+b.title+"</span></div>"),u=Te('<div class="ui-dialog-buttonset"/>'),h=Te('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"/>').append(u),p=0,f=0,m=Te(),g={close:function(){c.prepend(Te('<span class="ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button"><span class="ui-icon ui-icon-closethick"/></span>').on("mousedown",function(e){e.preventDefault(),e.stopPropagation(),a.elfinderdialog("close")}))},maximize:function(){b.allowMaximize&&(v.on("resize",function(e,t){var n,i;if(t&&t.maximize){if(i=c.find(".elfinder-titlebar-full"),n="on"===t.maximize,i.children("span.ui-icon").toggleClass("ui-icon-plusthick",!n).toggleClass("ui-icon-arrowreturnthick-1-s",n),n){try{v.hasClass("ui-draggable")&&v.draggable("disable"),v.hasClass("ui-resizable")&&v.resizable("disable")}catch(e){}void 0===i.data("style")&&(a.height(a.height()),i.data("style",a.attr("style")||"")),a.css("width","100%").css("height",v.height()-v.children(".ui-dialog-titlebar").outerHeight(!0)-h.outerHeight(!0))}else{a.attr("style",i.data("style")),i.removeData("style");try{v.hasClass("ui-draggable")&&v.draggable("enable"),v.hasClass("ui-resizable")&&v.resizable("enable")}catch(e){}}v.trigger("resize")}}),c.prepend(Te('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-full"><span class="ui-icon ui-icon-plusthick"/></span>').on("mousedown",function(e){e.preventDefault(),e.stopPropagation(),y.toggleMaximize(v)})))},minimize:function(){b.allowMinimize&&c.on("dblclick",function(e){Te(this).children(".elfinder-titlebar-minimize").trigger("mousedown")}).prepend(Te('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-minimize"><span class="ui-icon ui-icon-minusthick"/></span>').on("mousedown",function(e){var t,n=Te(this);if(e.preventDefault(),e.stopPropagation(),void 0!==n.data("style"))w.append(v),v.attr("style",n.data("style")).removeClass("elfinder-dialog-minimized").off("mousedown.minimize"),n.removeData("style").show(),c.children(".elfinder-titlebar-full").show(),v.children(".ui-widget-content").slideDown("fast",function(){var e;if(this===v.children(".ui-widget-content:first").get(0)){if(v.find("."+y.res("class","editing"))&&y.disable(),e={minimize:"off"},v.hasClass("elfinder-maximized"))e.maximize="on";else try{v.hasClass("ui-draggable")&&v.draggable("enable"),v.hasClass("ui-resizable")&&v.resizable("enable")}catch(e){}v.trigger("resize",e)}});else{try{v.hasClass("ui-draggable")&&v.draggable("disable"),v.hasClass("ui-resizable")&&v.resizable("disable")}catch(e){}n.data("style",v.attr("style")||"").hide(),c.children(".elfinder-titlebar-full").hide(),t=v.width(),v.children(".ui-widget-content").slideUp("fast",function(){this===v.children(".ui-widget-content:first").get(0)&&(v.trigger("resize",{minimize:"on"}),v.attr("style","").css({maxWidth:t}).addClass("elfinder-dialog-minimized").one("mousedown.minimize",function(e){n.trigger("mousedown")}).appendTo(y.getUI("bottomtray")))})}}))}},v=Te('<div class="ui-front ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog touch-punch '+n+" "+b.cssClass+'"/>').hide().append(a).appendTo(w).draggable({handle:".ui-dialog-titlebar",containment:"document",stop:function(e,t){v.css({height:b.height}),a.data("draged",!0)}}).css({width:b.width,height:b.height}).on("mousedown",function(e){v.hasClass("ui-front")||setTimeout(function(){v.is(":visible:not(.elfinder-dialog-minimized)")&&v.trigger("totop")},10)}).on("open",function(){var e=Te(this),r=e.outerWidth()>w.width()-10?w.width()-10:null;r&&e.css({width:r,left:"5px"}),v.hasClass(i)||w.children("."+n+":visible:not(."+i+")").each(function(){var e=Te(this),t=parseInt(e.css("top")),n=parseInt(e.css("left")),i=parseInt(v.css("top")),a=parseInt(v.css("left"));e[0]==v[0]||t!=i&&n!=a||v.css({top:t+(r?15:10)+"px",left:(r?5:n+10)+"px"})}),v.data("modal")&&y.getUI("overlay").elfinderoverlay("show"),v.trigger("totop"),"function"==typeof b.open&&Te.proxy(b.open,a[0])(),y.UA.Mobile&&o().focus(),b.closeOnEscape&&Te(document).on("keyup."+d,function(e){e.keyCode==Te.ui.keyCode.ESCAPE&&v.hasClass(t)&&a.elfinderdialog("close")})}).on("close",function(){var e;b.closeOnEscape&&Te(document).off("keyup."+d),b.allowMaximize&&y.toggleMaximize(v,!1),v.data("modal")&&y.getUI("overlay").elfinderoverlay("hide"),"function"==typeof b.close?Te.proxy(b.close,a[0])():b.destroyOnClose&&v.hide().remove(),(e=w.children("."+n+":visible")).length?e.filter(":last").trigger("totop"):setTimeout(function(){y.enable()},20)}).on("totop",function(){v.hasClass("elfinder-dialog-minimized")&&c.children(".elfinder-titlebar-minimize").trigger("mousedown"),y.toFront(v),w.children("."+n).removeClass(t+" ui-front"),v.addClass(t+" ui-front"),y.UA.Mobile||o().focus()}).on("posinit",function(){var e=b.position;e||v.data("resizing")||(e={top:Math.max(0,parseInt((w.height()-v.outerHeight())/2-42))+"px",left:Math.max(0,parseInt((w.width()-v.outerWidth())/2))+"px"}),b.absolute&&(e.position="absolute"),e&&v.css(e)}).on("resize",function(e,t){"function"==typeof b.resize&&Te.proxy(b.resize,a[0])(e,t)}).on("tabstopsInit",e).on("focus","."+s,function(){Te(this).addClass(r).parent("label").addClass(r),this.id&&Te(this).parent().find("label[for="+this.id+"]").addClass(r)}).on("blur","."+s,function(){Te(this).removeClass(r).parent("label").removeClass(r),this.id&&Te(this).parent().find("label[for="+this.id+"]").removeClass(r)}).on("mouseenter mouseleave","."+s,function(e){var t=Te(this);b.btnHoverFocus?"mouseenter"==e.type&&t.focus():t.toggleClass(r,"mouseenter"==e.type)}).on("keydown","."+s,function(e){var n,i,a,t=Te(this);if(t.is(":focus"))if(e.stopPropagation(),e.keyCode==Te.ui.keyCode.ENTER)e.preventDefault(),t.click();else if(e.keyCode==Te.ui.keyCode.TAB&&e.shiftKey||e.keyCode==Te.ui.keyCode.LEFT||e.keyCode==Te.ui.keyCode.UP){if(t.is("input:text")&&!e.ctrlKey&&!e.metaKey&&e.keyCode==Te.ui.keyCode.LEFT)return;if(t.is("select")&&e.keyCode!=Te.ui.keyCode.TAB)return;if(t.is("textarea")&&!e.ctrlKey&&!e.metaKey)return;e.preventDefault(),(n=this,i=m.filter(":visible"),a=i.last(),Te.each(i,function(e,t){if(t===n&&i[e-1])return a=i.eq(e-1),!1}),a).focus()}else if(e.keyCode==Te.ui.keyCode.TAB||e.keyCode==Te.ui.keyCode.RIGHT||e.keyCode==Te.ui.keyCode.DOWN){if(t.is("input:text")&&!e.ctrlKey&&!e.metaKey&&e.keyCode==Te.ui.keyCode.RIGHT)return;if(t.is("select")&&e.keyCode!=Te.ui.keyCode.TAB)return;if(t.is("textarea")&&!e.ctrlKey&&!e.metaKey)return;e.preventDefault(),o(this).focus()}}).data({modal:b.modal});v.prepend(c),Te.each(b.headerBtnOrder.split(":").reverse(),function(e,t){g[t]&&g[t]()}),x&&c.children(".elfinder-titlebar-button").addClass("elfinder-titlebar-button-right"),Te.each(b.buttons,function(e,t){var n=Te('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-btncnt-'+f+++" "+s+'"><span class="ui-button-text">'+e+"</span></button>").on("click",Te.proxy(t,a[0]));x?u.append(n):u.prepend(n)}),u.children().length&&(v.append(h),v.show(),h.find("button").each(function(e,t){p+=Te(t).outerWidth(!0)}),v.hide(),p+=20,v.width()<p&&v.width(p)),v.trigger("posinit").data("margin-y",a.outerHeight(!0)-a.height()),b.resizable&&Te.fn.resizable&&v.resizable({minWidth:b.minWidth,minHeight:b.minHeight,start:function(){!0!==v.data("resizing")&&v.data("resizing")&&clearTimeout(v.data("resizing")),v.data("resizing",!0)},stop:function(){v.data("resizing",setTimeout(function(){v.data("resizing",!1)},200))},resize:function(e,t){var n=0;v.children(".ui-widget-header,.ui-dialog-buttonpane").each(function(){n+=Te(this).outerHeight(!0)}),a.height(t.size.height-n-v.data("margin-y")),v.trigger("resize")}}),"function"==typeof b.create&&Te.proxy(b.create,this)(),e(),b.autoOpen&&a.elfinderdialog("open")})),this},Te.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:!1,resizable:!0,autoOpen:!0,closeOnEscape:!0,destroyOnClose:!1,buttons:{},btnHoverFocus:!0,position:null,absolute:!1,width:320,height:"auto",minWidth:200,minHeight:110,allowMinimize:"auto",allowMaximize:!1,headerBtnPos:"auto",headerBtnOrder:"auto"},Te.fn.elfinderfullscreenbutton=function(i){return this.each(function(){var t=Te(this).elfinderbutton(i),n=t.children(".elfinder-button-icon");i.change(function(){var e=i.value;n.toggleClass("elfinder-button-icon-unfullscreen",e),t.attr("title",e?i.fm.i18n("reinstate"):i.fm.i18n("cmdfullscreen")),i.className=e?"unfullscreen":"",i.title=i.fm.i18n(e?"reinstate":"cmdfullscreen")})})},Te.fn.elfindermkdirbutton=function(t){return this.each(function(){var e=Te(this).elfinderbutton(t);t.change(function(){e.attr("title",t.value)})})},Te.fn.elfindernavbar=function(d,c){return this.not(".elfinder-navbar").each(function(){function r(){var e=d.getUI("cwd"),t=d.getUI("workzone"),n=t.data("rectangle"),i=e.offset();t.data("rectangle",Te.extend(n,{cwdEdge:"ltr"===d.direction?i.left:i.left+e.width()}))}var n,o,s,t,l=Te(this).hide().addClass("ui-state-default elfinder-navbar"),e=l.parent().children(".elfinder-workzone").append(l),i=l.outerHeight()-l.height(),a="ltr"==d.direction;d.one("cssloaded",function(){i!==(i=l.outerHeight()-l.height())&&d.trigger("wzresize")}).bind("wzresize",function(){l.height(e.height()-i)}),d.UA.Touch&&(void 0===(s=d.storage("autoHide")||{}).navbar&&(s.navbar=c.autoHideUA&&0<c.autoHideUA.length&&Te.map(c.autoHideUA,function(e){return!!d.UA[e]||null}).length,d.storage("autoHide",s)),s.navbar&&d.one("init",function(){d.uiAutoHide.push(function(){l.stop(!0,!0).trigger("navhide",{duration:"slow",init:!0})})}),d.bind("load",function(){"none"!==(o=Te('<div class="elfinder-navbar-swipe-handle"/>').hide().appendTo(e)).css("pointer-events")&&(o.remove(),o=null)}),l.on("navshow navhide",function(e,t){var n="navshow"===e.type?"show":"hide",i=t&&t.duration?t.duration:"fast",a=t&&t.handleW?t.handleW:Math.max(50,d.getUI().width()/10);l.stop(!0,!0)[n](i,function(){"show"==n?o&&o.stop(!0,!0).hide():o&&(o.width(a||""),d.resources.blink(o,"slowonce")),d.trigger("navbar"+n).getUI("cwd").trigger("resize"),t.init&&d.trigger("uiautohide"),r()}),s.navbar="show"!=n,d.storage("autoHide",Te.extend(d.storage("autoHide"),{navbar:s.navbar}))})),Te.fn.resizable&&!d.UA.Mobile&&(n=l.resizable({handles:a?"e":"w",minWidth:c.minWidth||150,maxWidth:c.maxWidth||500,stop:function(e,t){d.storage("navbarWidth",t.size.width),r()}}).on("resize scroll",function(t){a||"resize"!==t.type||l.css("left",0),clearTimeout(Te(this).data("posinit")),Te(this).data("posinit",setTimeout(function(){var e=d.UA.Opera&&l.scrollLeft()?20:2;n.css({top:parseInt(l.scrollTop())+"px",left:a?"auto":parseInt(l.scrollLeft()+e),right:a?-1*parseInt(l.scrollLeft()-e):"auto"}),"resize"===t.type&&d.getUI("cwd").trigger("resize")},50))}).find(".ui-resizable-handle").addClass("ui-front"),d.one("open",function(){setTimeout(function(){l.trigger("resize")},150)})),(t=d.storage("navbarWidth"))?l.width(t):d.UA.Mobile&&d.one("cssloaded",function(){l.data("defWidth",l.width()),Te(window).on("resize."+d.namespace,function(e){t=l.parent().width()/2,l.data("defWidth")>t?l.width(t):l.width(l.data("defWidth")),l.data("width",l.width())})})}),this},Te.fn.elfinderoverlay=function(e){var t=this.parent().elfinder("instance");if(this.filter(":not(.elfinder-overlay)").each(function(){e=Te.extend({},e),Te(this).addClass("ui-front ui-widget-overlay elfinder-overlay").hide().mousedown(function(e){e.preventDefault(),e.stopPropagation()}).data({cnt:0,show:"function"==typeof e.show?e.show:function(){},hide:"function"==typeof e.hide?e.hide:function(){}})}),"show"==e){var n=(a=this.eq(0)).data("cnt")+1,i=a.data("show");t.toFront(a),a.data("cnt",n),a.is(":hidden")&&(a.show(),i())}if("hide"==e){n=(a=this.eq(0)).data("cnt")-1;var a,r=a.data("hide");a.data("cnt",n),n<=0&&(a.hide(),r())}return this},Te.fn.elfinderpanel=function(a){return this.each(function(){var n=Te(this).addClass("elfinder-panel ui-state-default ui-corner-all"),i="margin-"+("ltr"==a.direction?"left":"right");a.one("load",function(e){var t=a.getUI("navbar");n.css(i,parseInt(t.outerWidth(!0))),t.on("resize",function(){n.is(":visible")&&n.css(i,parseInt(t.outerWidth(!0)))})})})},Te.fn.elfinderpath=function(p){return this.each(function(){function n(r){var o=[];return Te.each(p.parents(r),function(e,t){var n=r===t?"elfinder-path-dir elfinder-path-cwd":"elfinder-path-dir",i=p.file(t),a=p.escape(i.i18||i.name);o.push('<span id="'+c+t+'" class="'+n+'" title="'+a+'">'+a+"</span>")}),o.join('<span class="elfinder-path-other">'+p.option("separator")+"</span>")}function i(){var e;h.children("span.elfinder-path-dir").attr("style",""),e="ltr"===p.direction?Te("#"+c+p.cwd().hash).prevAll("span.elfinder-path-dir:first"):Te(),h.scrollLeft(e.length?e.position().left:0)}function a(){var i,n,a=h.children("span.elfinder-path-dir"),e=a.length;"workzone"===l||e<2?a.attr("style",""):(h.width(h.css("max-width")),a.css({maxWidth:100/e+"%",display:"inline-block"}),i=h.width()-9,h.children("span.elfinder-path-other").each(function(){i-=Te(this).width()}),n=[],a.each(function(e){var t=Te(this).width();i-=t,t<this.scrollWidth&&n.push(e)}),h.width(""),n.length?(0<i&&(i/=n.length,Te.each(n,function(e,t){var n=Te(a[t]);n.css("max-width",n.width()+i)})),a.last().attr("style","")):a.attr("style",""))}var r="",o="",s=[],l="statusbar",d=p.res("class","hover"),c="path"+(ze.prototype.uniqueid?ze.prototype.uniqueid:"")+"-",u=Te('<div class="ui-widget-header ui-helper-clearfix elfinder-workzone-path"/>'),h=Te(this).addClass("elfinder-path").html("&nbsp;").on("mousedown","span.elfinder-path-dir",function(e){var t=Te(this).attr("id").substr(c.length);e.preventDefault(),t!=p.cwd().hash&&(Te(this).addClass(d),r?p.exec("search",r,{target:t,mime:s.join(" ")}):p.exec("open",t))}).prependTo(p.getUI("statusbar").show()),e=Te('<div class="elfinder-path-roots"/>').on("click",function(e){e.stopPropagation(),e.preventDefault();var t=Te.map(p.roots,function(e){return p.file(e)}),n=[];Te.each(t,function(e,t){t.phash||p.root(p.cwd().hash,!0)===t.hash||n.push({label:p.escape(t.i18||t.name),icon:"home",callback:function(){p.exec("open",t.hash)},options:{iconClass:t.csscls||"",iconImg:t.icon||""}})}),p.trigger("contextmenu",{raw:n,x:e.pageX,y:e.pageY})}).append('<span class="elfinder-button-icon elfinder-button-icon-menu" />').appendTo(u);p.bind("open searchend parents",function(){o=r="",s=[],h.html(n(p.cwd().hash)),1<Object.keys(p.roots).length?(h.css("margin",""),e.show()):(h.css("margin",0),e.hide()),a()}).bind("searchstart",function(e){e.data&&(r=e.data.query||"",o=e.data.target||"",s=e.data.mimes||[])}).bind("search",function(e){var t="";t=o?n(o):p.i18n("btnAll"),h.html('<span class="elfinder-path-other">'+p.i18n("searcresult")+": </span>"+t),a()}).bind("navbarshow navbarhide",function(e){var t=p.getUI("workzone");"navbarshow"===e.type?(t.height(t.height()+u.outerHeight()),h.prependTo(p.getUI("statusbar")),u.detach(),l="statusbar",p.unbind("open",i)):(u.append(h).insertBefore(t),t.height(t.height()-u.outerHeight()),l="workzone",i(),p.bind("open",i)),p.trigger("uiresize")}).bind("resize",a)})},Te.fn.elfinderplaces=function(z,O){return this.each(function(){function d(e){return e.substr(6)}function s(e){return"place-"+e}function c(){var e=[],n={};(e=Te.map(k.children().find("[id]"),function(e){return d(e.id)})).length?Te.each(e.reverse(),function(e,t){n[t]=l[t]}):n=null,z.storage(b,n)}function r(e,t){return Te(n.replace(/\{id\}/,s(e?e.hash:t)).replace(/\{name\}/,z.escape(e?e.i18||e.name:t)).replace(/\{cssclass\}/,e?z.perms2class(e)+(e.notfound?" elfinder-na":"")+(e.csscls?" "+e.csscls:""):"").replace(/\{permissions\}/,!e||e.read&&e.write&&!e.notfound?"":g).replace(/\{title\}/,e&&e.path?z.escape(e.path):"").replace(/\{symlink\}/,"").replace(/\{style\}/,""))}function a(e){var t,n;return"directory"===e.mime&&(n=e.hash,z.files().hasOwnProperty(n)||z.trigger("tree",{tree:[e]}),t=r(e,n),l[n]=e,k.prepend(t),C.addClass(p),w.toggle(1<k.children().length),!0)}function u(e){var t,n,i=null;return l[e]&&(delete l[e],(t=Te("#"+s(e))).length&&(i=t.text(),t.parent().remove(),n=k.children().length,w.toggle(1<n),n||(C.removeClass(p),T.removeClass(f),k.slideToggle(!1)))),i}function o(e,t){var n=e.hash,i=Te("#"+s(t||n)),a=r(e,n);return 0<i.length&&(i.parent().replaceWith(a),l[n]=e,!0)}var l={},e="class",h=z.res(e,"navdir"),p=z.res(e,"navcollapse"),f=z.res(e,"navexpand"),i=z.res(e,"hover"),t=z.res(e,"treeroot"),m=z.res(e,"adroppable"),n=z.res("tpl","placedir"),g=z.res("tpl","perms"),v=Te(z.res("tpl","navspinner")),b="places"+(O.suffix?O.suffix:""),y=null,w=Te('<span class="elfinder-button-icon elfinder-button-icon-sort elfinder-places-root-icon" title="'+z.i18n("cmdsort")+'"/>').hide().on("click",function(e){e.stopPropagation(),k.empty(),Te.each(l,function(e,t){var n=z.file(e)||t,i=r(n,e),a=null;if(n||i.hide(),k.children().length&&(Te.each(k.children(),function(){var e=Te(this);if((n.i18||n.name).localeCompare(e.children("."+h).text())<0)return a=!i.insertBefore(e)}),null!==a))return!0;Te("#"+s(e)).length||k.append(i)}),c()}),x=r({hash:"root-"+z.namespace,name:z.i18n(O.name,"places"),read:!0,write:!0}),C=x.children("."+h).addClass(t).click(function(e){e.stopPropagation(),C.hasClass(p)&&(T.toggleClass(f),k.slideToggle(),z.storage("placesState",T.hasClass(f)?1:0))}).append(w),k=x.children("."+z.res(e,"navsubtree")),T=Te(this).addClass(z.res(e,"tree")+" elfinder-places ui-corner-all").hide().append(x).appendTo(z.getUI("navbar")).on("mouseenter mouseleave","."+h,function(e){Te(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click","."+h,function(e){var t=Te(this);t.data("longtap")?e.stopPropagation():t.hasClass("elfinder-na")||z.exec("open",t.attr("id").substr(6))}).on("contextmenu","."+h+":not(."+t+")",function(e){var t=Te(this),o=t.attr("id").substr(6);e.preventDefault(),z.trigger("contextmenu",{raw:[{label:z.i18n("moveUp"),icon:"up",remain:!0,callback:function(){var e,t,n,i,a,r;t=Te("#"+s(e=o)),n=t.parent(),i=n.prev("div"),a="ui-state-hover",r=z.getUI("contextmenu"),y&&clearTimeout(y),i.length&&(r.find(":first").data("placesHash",e),t.addClass(a),n.insertBefore(i),i=n.prev("div"),y=setTimeout(function(){t.removeClass(a),r.find(":first").data("placesHash")===e&&r.hide().empty()},1500)),i.length||(t.removeClass(a),r.hide().empty()),c()}},"|",{label:z.i18n("rmFromPlaces"),icon:"rm",callback:function(){u(o),c()}}],x:e.pageX,y:e.pageY}),t.addClass("ui-state-hover"),z.getUI("contextmenu").children().on("mouseenter",function(){t.addClass("ui-state-hover")}),z.bind("closecontextmenu",function(){t.removeClass("ui-state-hover")})}).droppable({tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file",hoverClass:z.res("class","adroppable"),classes:{"ui-droppable-hover":z.res("class","adroppable")},over:function(e,t){var n=t.helper,i=Te.map(n.data("files"),function(e){return"directory"!==z.file(e).mime||l[e]?null:e});e.stopPropagation(),n.data("dropover",n.data("dropover")+1),z.insideWorkzone(e.pageX,e.pageY)&&(0<i.length?(n.addClass("elfinder-drag-helper-plus"),z.trigger("unlockfiles",{files:n.data("files"),helper:n})):Te(this).removeClass(m))},out:function(e,t){var n=t.helper,i=e.shiftKey||e.ctrlKey||e.metaKey;e.stopPropagation(),n.toggleClass("elfinder-drag-helper-move elfinder-drag-helper-plus",!!n.data("locked")||i).data("dropover",Math.max(n.data("dropover")-1,0)),Te(this).removeData("dropover").removeClass(m),z.trigger(i?"unlockfiles":"lockfiles",{files:n.data("files"),helper:n})},drop:function(e,t){var n=t.helper,i=!0;Te.each(n.data("files"),function(e,t){var n=z.file(t);n&&"directory"==n.mime&&!l[n.hash]?a(n):i=!1}),c(),i&&n.hide()}}).on("touchstart","."+h+":not(."+t+")",function(e){if(!(1<e.originalEvent.touches.length))var t=Te(this).attr("id").substr(6),n=Te(this).addClass(i).data("longtap",null).data("tmlongtap",setTimeout(function(){n.data("longtap",!0),z.trigger("contextmenu",{raw:[{label:z.i18n("rmFromPlaces"),icon:"rm",callback:function(){u(t),c()}}],x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY})},500))}).on("touchmove touchend","."+h+":not(."+t+")",function(e){clearTimeout(Te(this).data("tmlongtap")),"touchmove"==e.type&&Te(this).removeClass(i)});Te.fn.sortable&&k.addClass("touch-punch").sortable({appendTo:z.getUI(),revert:!1,helper:function(e){var t=Te(e.target).parent();return t.children().removeClass("ui-state-hover"),Te('<div class="ui-widget elfinder-place-drag elfinder-'+z.direction+'"/>').append(Te('<div class="elfinder-navbar"/>').show().append(t.clone()))},stop:function(e,t){var n=Te(t.item[0]),i=T.offset().top,a=T.offset().left,r=T.width(),o=T.height(),s=e.pageX,l=e.pageY;a<s&&s<a+r&&i<l&&l<l+o||(u(d(n.children(":first").attr("id"))),c())},update:function(e,t){c()}}),Te(this).on("regist",function(e,t){var n=!1;Te.each(t,function(e,t){t&&"directory"==t.mime&&!l[t.hash]&&a(t)&&(n=!0)}),n&&c()}),z.one("load",function(){var e,t;z.oldAPI||(T.show().parent().show(),l={},"string"==typeof(e=z.storage(b))?(e=Te.map(e.split(","),function(e){return e||null}),Te.each(e,function(e,t){var n=t.split("#");l[n[0]]=n[1]?n[1]:n[0]})):Te.isPlainObject(e)&&(l=e),z.trigger("placesload",{dirs:l,storageKey:b},!0),(t=Object.keys(l)).length&&(C.prepend(v),z.request({data:{cmd:"info",targets:t},preventDefault:!0}).done(function(e){var i={};Te.each(e.files,function(e,t){var n=t.hash;i[n]=t}),Te.each(l,function(e,t){a(i[e]||Te.extend({notfound:!0},t))}),0<z.storage("placesState")&&C.click()}).always(function(){v.remove()})),z.change(function(e){var n=!1;Te.each(e.data.changed,function(e,t){l[t.hash]&&("directory"!==t.mime?u(t.hash)&&(n=!0):o(t)&&(n=!0))}),n&&c()}).bind("rename",function(n){var i=!1;n.data.removed&&Te.each(n.data.removed,function(e,t){n.data.added[e]&&o(n.data.added[e],t)&&(i=!0)}),i&&c()}).bind("rm paste",function(e){var i=[],t=!1;e.data.removed&&Te.each(e.data.removed,function(e,t){var n=u(t);n&&i.push(n)}),i.length&&(t=!0),e.data.added&&i.length&&Te.each(e.data.added,function(e,t){1!==Te.inArray(t.name,i)&&"directory"==t.mime&&a(t)}),t&&c()}).bind("sync netmount",function(r){var e=Object.keys(l);e.length&&(C.prepend(v),z.request({data:{cmd:"info",targets:e},preventDefault:!0}).done(function(e){var i={},n=!1,a=z.cwd().hash;Te.each(e.files||[],function(e,t){var n=t.hash;i[n]=t,z.files().hasOwnProperty(t.hash)||z.trigger("tree",{tree:[t]})}),Te.each(l,function(e,t){!t.notfound!=!!i[e]?t.phash===a&&"netmount"!==r.type||i[e]&&"directory"!==i[e].mime?u(e)&&(n=!0):o(i[e]||Te.extend({notfound:!0},t))&&(n=!0):i[e]&&i[e].phash!=a&&o(i[e])}),n&&c()}).always(function(){v.remove()}))}))})})},Te.fn.elfindersearchbutton=function(h){return this.each(function(){function i(e){return o.namespace+e}function t(){u.data("inctm")&&clearTimeout(u.data("inctm")),a&&a.slideUp();var e=Te.trim(u.val()),t=!Te("#"+i("SearchFromAll")).prop("checked"),n=Te("#"+i("SearchMime")).prop("checked");t=t&&(Te("#"+i("SearchFromVol")).prop("checked")?o.root(o.cwd().hash):o.cwd().hash),n&&(n=e,e="."),e?h.exec(e,t,n).done(function(){r=!0,u.focus()}).fail(function(){d()}):o.trigger("searchend")}var a,r=!1,o=h.fm,n=h.options.incsearch||{enable:!1},s=o.getUI("toolbar"),e=o.res("class","searchbtn"),l=Te(this).hide().addClass("ui-widget-content elfinder-button "+e),d=function(){u.data("inctm")&&clearTimeout(u.data("inctm")),u.val("").blur(),(r||c)&&(r=!1,c="",o.lazy(function(){o.trigger("searchend")}))},c="",u=Te('<input type="text" size="42"/>').on("focus",function(){c="",a&&a.slideDown()}).on("blur",function(){a&&(a.data("infocus")?a.data("infocus",!1):a.slideUp())}).appendTo(l).on("keypress",function(e){e.stopPropagation()}).on("keydown",function(e){e.stopPropagation(),e.keyCode==Te.ui.keyCode.ENTER&&t(),e.keyCode==Te.ui.keyCode.ESCAPE&&(e.preventDefault(),d())});n.enable&&(n.minlen=n.minlen||2,n.wait=n.wait||500,u.attr("title",o.i18n("incSearchOnly")).on("compositionstart",function(){u.data("composing",!0)}).on("compositionend",function(){u.removeData("composing"),u.trigger("input")}).on("input",function(){u.data("composing")||(u.data("inctm")&&clearTimeout(u.data("inctm")),u.data("inctm",setTimeout(function(){var e=u.val();(0===e.length||e.length>=n.minlen)&&(c!==e&&o.trigger("incsearchstart",{query:e}),""===(c=e)&&1<o.searchStatus.state&&o.searchStatus.query&&u.val(o.searchStatus.query).select())},n.wait)))}),o.UA.ltIE8&&u.on("keydown",function(e){229===e.keyCode&&(u.data("imetm")&&clearTimeout(u.data("imetm")),u.data("composing",!0),u.data("imetm",setTimeout(function(){u.removeData("composing")},100)))}).on("keyup",function(e){u.data("imetm")&&clearTimeout(u.data("imetm")),u.data("composing")?e.keyCode===Te.ui.keyCode.ENTER&&u.trigger("compositionend"):u.trigger("input")})),Te('<span class="ui-icon ui-icon-search" title="'+h.title+'"/>').appendTo(l).click(t),Te('<span class="ui-icon ui-icon-close"/>').appendTo(l).click(d),o.bind("toolbarload",function(){var e=l.parent();if(e.length&&(s.prepend(l.show()),e.remove(),o.UA.ltIE7)){var t=l.children("ltr"==o.direction?".ui-icon-close":".ui-icon-search");t.css({right:"",left:parseInt(l.width())-t.outerWidth(!0)})}}),o.one("open",function(){(a=o.api<2.1?null:Te('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').append(Te('<div class="buttonset"/>').append(Te('<input id="'+i("SearchFromCwd")+'" name="serchfrom" type="radio" checked="checked"/><label for="'+i("SearchFromCwd")+'">'+o.i18n("btnCwd")+"</label>"),Te('<input id="'+i("SearchFromVol")+'" name="serchfrom" type="radio"/><label for="'+i("SearchFromVol")+'">'+o.i18n("btnVolume")+"</label>"),Te('<input id="'+i("SearchFromAll")+'" name="serchfrom" type="radio"/><label for="'+i("SearchFromAll")+'">'+o.i18n("btnAll")+"</label>")),Te('<div class="buttonset"/>').append(Te('<input id="'+i("SearchName")+'" name="serchcol" type="radio" checked="checked"/><label for="'+i("SearchName")+'">'+o.i18n("btnFileName")+"</label>"),Te('<input id="'+i("SearchMime")+'" name="serchcol" type="radio"/><label for="'+i("SearchMime")+'">'+o.i18n("btnMime")+"</label>"))).hide().appendTo(l))&&(a.find("div.buttonset").buttonset(),Te("#"+i("SearchFromAll")).next("label").attr("title",o.i18n("searchTarget",o.i18n("btnAll"))),Te("#"+i("SearchMime")).next("label").attr("title",o.i18n("searchMime")),a.on("mousedown","div.buttonset",function(e){e.stopPropagation(),a.data("infocus",!0)}).on("click","input",function(e){e.stopPropagation(),Te.trim(u.val())&&t()}))}).select(function(){u.blur()}).bind("searchend",function(){u.val("")}).bind("open parents",function(){var n=[],e=o.file(o.root(o.cwd().hash));e&&(Te.each(o.parents(o.cwd().hash),function(e,t){n.push(o.file(t).name)}),Te("#"+i("SearchFromCwd")).next("label").attr("title",o.i18n("searchTarget",n.join(o.option("separator")))),Te("#"+i("SearchFromVol")).next("label").attr("title",o.i18n("searchTarget",e.name)))}).shortcut({pattern:"ctrl+f f3",description:h.title,callback:function(){u.select().focus()}})})},Te.fn.elfindersortbutton=function(p){return this.each(function(){function e(){u.children("[rel]").removeClass(o+" "+s+" "+l).filter('[rel="'+n.sortType+'"]').addClass(o+" "+("asc"==n.sortOrder?s:l)),u.children(".elfinder-sort-stick").toggleClass(o,n.sortStickFolders),u.children(".elfinder-sort-tree").toggleClass(o,n.sortAlsoTreeview)}var n=p.fm,t=p.name,i=n.res("class","disabled"),a=n.res("class","hover"),r="elfinder-button-menu-item",o=r+"-selected",s=o+"-asc",l=o+"-desc",d=Te('<span class="elfinder-button-text">'+p.title+"</span>"),c=Te(this).addClass("ui-state-default elfinder-button elfinder-menubutton elfiner-button-"+t).attr("title",p.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+t+'"/>',d).hover(function(e){c.hasClass(i)||c.toggleClass(a)}).click(function(e){c.hasClass(i)||(e.stopPropagation(),u.is(":hidden")&&p.fm.getUI().click(),u.slideToggle(100))}),u=Te('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(c).on("mouseenter mouseleave","."+r,function(){Te(this).toggleClass(a)}).on("click","."+r,function(e){e.preventDefault(),e.stopPropagation(),h()}),h=function(){u.hide()};d.hide(),Te.each(n.sortRules,function(e,t){u.append(Te('<div class="'+r+'" rel="'+e+'"><span class="ui-icon ui-icon-arrowthick-1-n"/><span class="ui-icon ui-icon-arrowthick-1-s"/>'+n.i18n("sort"+e)+"</div>").data("type",e))}),u.children().click(function(e){var t=Te(this).attr("rel");p.exec([],{type:t,order:t==n.sortType?"asc"==n.sortOrder?"desc":"asc":n.sortOrder,stick:n.sortStickFolders,tree:n.sortAlsoTreeview})}),Te('<div class="'+r+" "+r+'-separated elfinder-sort-ext elfinder-sort-stick"><span class="ui-icon ui-icon-check"/>'+n.i18n("sortFoldersFirst")+"</div>").appendTo(u).click(function(){p.exec([],{type:n.sortType,order:n.sortOrder,stick:!n.sortStickFolders,tree:n.sortAlsoTreeview})}),Te.fn.elfindertree&&-1!==Te.inArray("tree",n.options.ui)&&Te('<div class="'+r+" "+r+'-separated elfinder-sort-ext elfinder-sort-tree"><span class="ui-icon ui-icon-check"/>'+n.i18n("sortAlsoTreeview")+"</div>").appendTo(u).click(function(){p.exec([],{type:n.sortType,order:n.sortOrder,stick:n.sortStickFolders,tree:!n.sortAlsoTreeview})}),n.bind("disable select",h).getUI().click(h),n.bind("sortchange",e),1<u.children().length?p.change(function(){c.toggleClass(i,p.disabled()),e()}).change():c.addClass(i)})},Te.fn.elfinderstat=function(u){return this.each(function(){function t(e,n){var i=0,a=0;Te.each(e,function(e,t){n&&t.phash!=n||(i++,a+=parseInt(t.size)||0)}),r.html(l+': <span class="elfinder-stat-incsearch"></span>'+i+", "+s+": "+u.formatSize(a))}function n(e){r.find("span.elfinder-stat-incsearch").html(e?e.hashes.length+" / ":"")}var r=Te(this).addClass("elfinder-stat-size"),o=Te('<div class="elfinder-stat-selected"/>').on("click","a",function(e){var t=Te(this).data("hash");e.preventDefault(),u.exec("opendir",[t])}),s=u.i18n("size"),l=u.i18n("items"),d=u.i18n("selected"),c=!1;u.getUI("statusbar").prepend(r).append(o).show(),u.bind("open reload add remove change searchend",function(){t(u.files(),u.cwd().hash)}).bind("searchend",function(){c=!1}).search(function(e){c=!0,t(e.data.files)}).select(function(){var e,n=0,i=0,t=u.selectedFiles(),a=[];if(1==t.length)return e=t[0],n=e.size,c&&a.push('<a href="#elf_'+e.phash+'" data-hash="'+e.hash+'">'+(e.path?e.path.replace(/\/[^\/]*$/,""):"..")+"</a>"),a.push(u.escape(e.name)),void o.html(a.join("/")+(0<n?", "+u.formatSize(n):""));Te.each(t,function(e,t){i++,n+=parseInt(t.size)||0}),o.html(i?d+": "+i+", "+s+": "+u.formatSize(n):"&nbsp;")}).bind("incsearch",function(e){n(e.data)}).bind("incsearchend",function(){n()})})},Te.fn.elfindertoast=function(r,e){var o={mode:"success",msg:"",showMethod:"fadeIn",showDuration:300,showEasing:"swing",onShown:void 0,hideMethod:"fadeOut",hideDuration:1500,hideEasing:"swing",onHidden:void 0,timeOut:3e3,extNode:void 0};return this.each(function(){r=Te.extend({},o,r||{});function t(e){i.stop(),i[r.showMethod]({duration:r.showDuration,easing:r.showEasing,complete:function(){r.onShown&&r.onShown(),!e&&r.timeOut&&(n=setTimeout(a,r.timeOut))}})}var n,i=Te(this),a=function(){i[r.hideMethod]({duration:r.hideDuration,easing:r.hideEasing,complete:function(){r.onHidden&&r.onHidden(),i.remove()}})};i.on("click",function(e){e.stopPropagation(),e.preventDefault(),i.stop().remove()}).on("mouseenter mouseleave",function(e){r.timeOut&&(n&&clearTimeout(n),n=null,"mouseenter"===e.type?t(!0):n=setTimeout(a,r.timeOut))}).hide().addClass("toast-"+r.mode).append(Te('<div class="elfinder-toast-msg"/>').html(r.msg)),r.extNode&&i.append(r.extNode),t()})},Te.fn.elfindertoolbar=function(v,b){return this.not(".elfinder-toolbar").each(function(){function a(e){var t;for(Te.each(p,function(e,t){t.detach()}),h.empty(),n=f.length;n--;)if(f[n]){for(o=Te('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>'),i=f[n].length;i--;)t=f[n][i],e&&-1!==Te.inArray(t,e)||!(r=u[t])||(s="elfinder"+r.options.ui,!p[t]&&Te.fn[s]&&(p[t]=Te("<div/>")[s](r)),p[t]&&(c&&p[t].find(".elfinder-button-text").show(),o.prepend(p[t])));o.children().length&&h.prepend(o),o.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"/>')}!h.data("swipeClose")&&h.children().length?h.show():h.hide(),v.trigger("toolbarload").trigger("uiresize")}var n,i,r,o,s,l,d,c,e,u=v._commands,h=Te(this).addClass("ui-helper-clearfix ui-widget-header ui-corner-top elfinder-toolbar"),t={displayTextLabel:!1,labelExcludeUA:["Mobile"],autoHideUA:["Mobile"]},p={},f=(e=b||[],Te.map(e,function(e){return Te.isPlainObject(e)?(t=Te.extend(t,e),null):[e]})),m=null,g="";c=null===(c=v.storage("toolbarTextLabel"))?t.displayTextLabel&&(!t.labelExcludeUA||!t.labelExcludeUA.length||!Te.map(t.labelExcludeUA,function(e){return!!v.UA[e]||null}).length):1==c,h.on("contextmenu",function(e){e.stopPropagation(),e.preventDefault(),v.trigger("contextmenu",{raw:[{label:v.i18n("textLabel"),icon:"accept",callback:function(){c=!c,h.height("").find(".elfinder-button-text")[c?"show":"hide"](),v.trigger("uiresize").storage("toolbarTextLabel",c?"1":"0")}}],x:e.pageX,y:e.pageY})}).on("touchstart",function(e){1<e.originalEvent.touches.length||(h.data("tmlongtap")&&clearTimeout(h.data("tmlongtap")),h.removeData("longtap").data("longtap",{x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}).data("tmlongtap",setTimeout(function(){h.removeData("longtapTm").trigger({type:"contextmenu",pageX:h.data("longtap").x,pageY:h.data("longtap").y}).data("longtap",{longtap:!0})},500)))}).on("touchmove touchend",function(e){h.data("tmlongtap")&&(("touchend"===e.type||4<Math.abs(h.data("longtap").x-e.originalEvent.touches[0].pageX)+Math.abs(h.data("longtap").y-e.originalEvent.touches[0].pageY))&&clearTimeout(h.data("tmlongtap")),h.removeData("longtapTm"))}).on("click",function(e){h.data("longtap")&&h.data("longtap").longtap&&(e.stopImmediatePropagation(),e.preventDefault())}).on("touchend click",".elfinder-button",function(e){h.data("longtap")&&h.data("longtap").longtap&&(e.stopImmediatePropagation(),e.preventDefault())}),h.prev().length&&h.parent().prepend(this),a(),v.bind("open sync select",function(e){var t,n,i=v.option("disabled");"select"===e.type&&(n=v.selected()).length&&(i=v.getDisabledCmds(n)),m&&m.toString()===i.sort().toString()||(a(i&&i.length?i:null),t=!0),m=i.concat().sort(),!t&&g===JSON.stringify(v.commandMap)||(g=JSON.stringify(v.commandMap),t||Te.each(Te("div.elfinder-button"),function(){var e=Te(this).data("origin");e&&Te(this).after(e).detach()}),Object.keys(v.commandMap).length&&Te.each(v.commandMap,function(e,t){var n,i=v._commands[t],a=i?"elfinder"+i.options.ui:null;a&&Te.fn[a]&&(n=p[e])&&(!p[t]&&Te.fn[a]&&(p[t]=Te("<div/>")[a](v._commands[t]),p[t]&&(c&&p[t].find(".elfinder-button-text").show(),i.extendsCmd&&p[t].children("span.elfinder-button-icon").addClass("elfinder-button-icon-"+i.extendsCmd))),p[t]&&(n.after(p[t]),p[t].data("origin",n.detach())))}))}),v.UA.Touch&&(void 0===(d=v.storage("autoHide")||{}).toolbar&&(d.toolbar=t.autoHideUA&&0<t.autoHideUA.length&&Te.map(t.autoHideUA,function(e){return!!v.UA[e]||null}).length,v.storage("autoHide",d)),d.toolbar&&v.one("init",function(){v.uiAutoHide.push(function(){h.stop(!0,!0).trigger("toggle",{duration:500,init:!0})})}),v.bind("load",function(){"none"!==(l=Te('<div class="elfinder-toolbar-swipe-handle"/>').hide().appendTo(v.getUI())).css("pointer-events")&&(l.remove(),l=null)}),h.on("toggle",function(e,t){var n=v.getUI("workzone"),i=h.is(":hidden"),a=n.height(),r=h.height(),o=h.outerHeight(!0)-r,s=Te.extend({step:function(e){n.height(a+(i?-1*(e+o):r-e)),v.trigger("resize")},always:function(){h.css("height",""),v.trigger("uiresize"),l&&(i?l.stop(!0,!0).hide():(l.height(t.handleH?t.handleH:""),v.resources.blink(l,"slowonce"))),t.init&&v.trigger("uiautohide")}},t);h.data("swipeClose",!i).stop(!0,!0).animate({height:"toggle"},s),d.toolbar=!i,v.storage("autoHide",Te.extend(v.storage("autoHide"),{toolbar:d.toolbar}))}))}),this},Te.fn.elfindertree=function(W,K){var B=W.res("class","tree");return this.not("."+B).each(function(){function s(e){var t=N.offset().left;return t<=e&&e<=t+N.width()}function f(n){return n.name=W.escape(n.i18||n.name),t.replace(/(?:\{([a-z]+)\})/gi,function(e,t){return n[t]||(p[t]?p[t](n):"")})}function y(e){return Te.map(e||[],function(e){return"directory"==e.mime?e:null})}function m(e){return e?Te("#"+W.navHash2Id(e)).next("."+T):R}function g(e,t){for(var n,i=e.children(":first");i.length;){if(W.file(W.navId2Hash(i.children("[id]").attr("id"))),(n=W.file(W.navId2Hash(i.children("[id]").attr("id"))))&&P(t,n)<0)return i;i=i.next()}return Te("")}function w(o){var e=Te(this),s=Te.Deferred();return e.data("autoScrTm")&&clearTimeout(e.data("autoScrTm")),e.data("autoScrTm",setTimeout(function(){var e=Te("#"+(o||W.navHash2Id(W.cwd().hash)));if(e.length){var t=R.parent().stop(!1,!0),n=t.offset().top,i=t.height(),a=n+i-e.outerHeight(),r=e.offset().top;r<n||a<r?t.animate({scrollTop:t.scrollTop()+r-n-i/3},{duration:"fast",complete:function(){s.resolve()}}):s.resolve()}else s.reject()},100)),s}var e="class",v=W.UA.Mobile,x=W.res(e,"treeroot"),C=K.openRootOnLoad,k=K.openCwdOnOpen,T=W.res(e,"navsubtree"),n=W.res(e,"treedir"),z="span."+n,O=W.res(e,"navcollapse"),S=W.res(e,"navexpand"),I="elfinder-subtree-loaded",D=W.res(e,"navarrow"),A=W.res(e,"active"),l=W.res(e,"adroppable"),d=W.res(e,"hover"),o=W.res(e,"disabled"),c=W.res(e,"draggable"),u=W.res(e,"droppable"),b="elfinder-navbar-wrapper-root",E="elfinder-navbar-wrapper-pastable",M="elfinder-navbar-wrapper-uploadable",i=W.droppable.drop,a=Te.extend(!0,{},W.droppable,{over:function(e,n){var i,t,a=Te(this),r=n.helper,o=d+" "+l;return e.stopPropagation(),r.data("dropover",r.data("dropover")+1),a.data("dropover",!0),n.helper.data("namespace")===W.namespace&&s(e.clientX)&&W.insideWorkzone(e.pageX,e.pageY)?(a.addClass(d),a.is("."+O+":not(."+S+")")&&a.data("expandTimer",setTimeout(function(){a.is("."+O+"."+d)&&a.children("."+D).click()},500)),a.is(".elfinder-ro,.elfinder-na")?(a.removeClass(l),void r.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus")):(i=W.navId2Hash(a.attr("id")),a.data("dropover",i),Te.each(n.helper.data("files"),function(e,t){if(t===i||W.file(t).phash===i&&!n.helper.hasClass("elfinder-drag-helper-plus"))return a.removeClass(o),!1}),r.data("locked")?t="elfinder-drag-helper-plus":(t="elfinder-drag-helper-move",(e.shiftKey||e.ctrlKey||e.metaKey)&&(t+=" elfinder-drag-helper-plus")),a.hasClass(l)&&r.addClass(t),void setTimeout(function(){a.hasClass(l)&&r.addClass(t)},20))):(a.removeClass(o),void r.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus"))},out:function(e,t){var n=Te(this),i=t.helper;e.stopPropagation(),i.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus").data("dropover",Math.max(i.data("dropover")-1,0)),n.data("expandTimer")&&clearTimeout(n.data("expandTimer")),n.removeData("dropover").removeClass(d+" "+l)},deactivate:function(){Te(this).removeData("dropover").removeClass(d+" "+l)},drop:function(e,t){s(e.clientX)&&i.call(this,e,t)}}),U=Te(W.res("tpl","navspinner")),t=W.res("tpl","navdir"),r=W.res("tpl","perms"),h=(W.res("tpl","lock"),W.res("tpl","symlink")),p={id:function(e){return W.navHash2Id(e.hash)},cssclass:function(e){var t=(e.phash&&!e.isroot?"":x)+" "+n+" "+W.perms2class(e);return e.dirs&&!e.link&&(t+=" "+O),K.getClass&&(t+=" "+K.getClass(e)),e.csscls&&(t+=" "+W.escape(e.csscls)),t},permissions:function(e){return e.read&&e.write?"":r},symlink:function(e){return e.alias?h:""},style:function(e){return e.icon?"style=\"background:url('"+W.escape(e.icon)+"') 0 0 no-repeat;background-size:contain;\"":""}},F=function(e){for(var t,n,i,a,r,o,s=e.length,l=[],d=s,c=Te(),u={},h={},p=!0;d--;)u[(t=e[d]).hash]||Te("#"+W.navHash2Id(t.hash)).length||(u[t.hash]=!0,(n=m(t.phash)).length?t.phash&&((a=!n.children().length)||(i=g(n,t)).length)?a?(h[t.phash]||(h[t.phash]=[]),h[t.phash].push(t)):(o=f(t),i.before(o),v||(c=c.add(o))):(o=f(t),n[p||t.phash?"append":"prepend"](o),p=!1,t.phash&&!t.isroot||(r=Te("#"+W.navHash2Id(t.hash)).parent().addClass(b),!t.disabled||t.disabled.length<1?r.addClass(E+" "+M):(-1===Te.inArray("paste",t.disabled)&&r.addClass(E),-1===Te.inArray("upload",t.disabled)&&r.addClass(M))),v||j(null,r)):l.push(t));Object.keys(h).length&&Te.each(h,function(e,t){var n=m(e),i=[];t.sort(P),Te.each(t,function(e,t){i.push(f(t))}),n.append(i.join("")),v||W.lazy(function(){j(null,n)})}),l.length&&l.length<s?F(l):!v&&c.length&&W.lazy(function(){j(c)})},P=function(e,t){if(W.sortAlsoTreeview){var n,i="asc"==W.sortOrder,a=W.sortType,r=W.sortRules;return n=i?r[W.sortType](e,t):r[W.sortType](t,e),"name"!==a&&0===n?n=i?r.name(e,t):r.name(t,e):n}return W.sortRules.name(e,t)},H=function(a,r,o,s){function l(e){var t=W.file(e);return!t||!t.isroot&&t.phash?"parents":"tree"}function d(e,t){var n,i;b[e+t]||("tree"===e&&t!==f&&(n=Te("#"+W.navHash2Id(t))).length&&(i=Te(W.res("tpl","navspinner")).insertBefore(n.children("."+D)),n.removeClass(O)),b[e+t]=!0,v.push(W.request({data:{cmd:e,target:t},preventFail:!0}).done(function(){Te("#"+W.navHash2Id("tree"===e?t:W.root(t))).addClass(I)}).always(function(){i&&(i.remove(),n.addClass(O+" "+S).next("."+T).show())})))}function e(e){for(var t,n,i=W.root(e);i;)i=(i=i&&W.file(i))&&(t=i.phash)&&0!==t.indexOf(i.volumeid)?("parents"===(n=l(t))&&d("tree",t),d(n,t),W.root(t)):null}var t,n,i,c,u,h,p=W.cwd(),f=p.hash,m=Te("#"+W.navHash2Id(f)),g=(a=a||!1,r=r||[],s=s||L,"parents"),v=[],b={};if(C&&((t=Te("#"+W.navHash2Id(W.root()))).hasClass(I)&&t.addClass(S).next("."+T).show(),C=!1),m.hasClass(A)||(R.find(z+"."+A).removeClass(A),m.addClass(A)),K.syncTree||!m.length){if(m.length&&(a||!o||!p.isroot))return a&&!o||(m.addClass(I),k&&m.hasClass(O)&&m.addClass(S).next("."+T).slideDown()),void(!s&&a||(c=m.parentsUntil("."+x).filter("."+T),u=c.length,h=1,c.show().prev(z).addClass(S,function(){a||u!=h++||w()}),u||a||w()));if(W.newAPI){if((n=W.file(f))&&n.phash&&!n.isroot&&(i=Te("#"+W.navHash2Id(n.phash))).length&&i.hasClass(I))return void W.lazy(function(){F([n]),H(a,[],!1,s)});a||(p.isroot&&p.phash?(g="tree"===l(p.phash)?"tree":"parents",e(f),f=p.phash):p.phash?e(p.phash):g=null),g&&d(g,f),(i=p.root?Te("#"+W.navHash2Id(p.root)):null)&&(U.insertBefore(i.children("."+D)),i.removeClass(O)),Te.when.apply(Te,v).done(function(e){var t,n,i;if(e=e||{tree:[]},W.api<2.1&&e.tree.push(p),1<(n=arguments.length))for(i=1;i<n;i++)arguments[i].tree&&arguments[i].tree.length&&e.tree.push.apply(e.tree,arguments[i].tree);t=y(e.tree),p.isroot&&p.hash===f&&!t.length&&(delete p.isroot,delete p.phash),r=JSON.parse(JSON.stringify(Te.merge(r,t))),F(r),_(r,I),!a&&p.isroot&&Te("#"+W.navHash2Id(p.hash).length)&&H(!0,[],o,s),f==p.hash&&W.visible()&&H(a,[],!1,s)}).always(function(){i&&(U.remove(),i.addClass(O+" "+I))})}}},j=function(e,t){var n;e||(t&&!t.closest("div."+b).hasClass(M)||(t||R.find("div."+M)).find(z+":not(.elfinder-ro,.elfinder-na)").addClass("native-droppable"),e=!t||t.closest("div."+b).hasClass(E)?(t||R.find("div."+E)).find(z+":not(."+u+")"):Te()),100<e.length&&(n=e.slice(100),e=e.slice(0,100)),e.droppable(a),n&&W.lazy(function(){j(n)},20)},_=function(e,n){var i=n==I?"."+O+":not(."+I+")":":not(."+O+")";Te.each(e,function(e,t){Te("#"+W.navHash2Id(t.phash)+i).filter(function(){return 0<Te.map(Te(this).next("."+T).children(),function(e){return Te(e).children().hasClass(x)?null:e}).length}).addClass(n)})},R=Te(this).addClass(B).on("mouseenter mouseleave",z,function(e){var t=Te(this),n="mouseenter"==e.type;t.hasClass(l+" "+o)||(v||!n||t.hasClass(x+" "+c+" elfinder-na elfinder-wo")||t.draggable(W.draggable),t.toggleClass(d,n))}).on("dragenter",z,function(e){if(e.originalEvent.dataTransfer){var t=Te(this);t.addClass(d),t.is("."+O+":not(."+S+")")&&t.data("expandTimer",setTimeout(function(){t.is("."+O+"."+d)&&t.children("."+D).click()},500))}}).on("dragleave",z,function(e){if(e.originalEvent.dataTransfer){var t=Te(this);t.data("expandTimer")&&clearTimeout(t.data("expandTimer")),t.removeClass(d)}}).on("click",z,function(e){var t=Te(this),n=W.navId2Hash(t.attr("id"));W.file(n);t.data("longtap")?e.stopPropagation():n==W.cwd().hash||t.hasClass(o)?(t.hasClass(O)&&t.children("."+D).click(),W.select({selected:[n],origin:"tree"})):W.exec("open",n).done(function(){W.select({selected:[n],origin:"tree"})})}).on("touchstart",z,function(e){if(!(1<e.originalEvent.touches.length))var t=e.originalEvent,n=Te(this).addClass(d).data("longtap",null).data("tmlongtap",setTimeout(function(e){n.data("longtap",!0),W.trigger("contextmenu",{type:"navbar",targets:[W.navId2Hash(n.attr("id"))],x:t.touches[0].pageX,y:t.touches[0].pageY})},500))}).on("touchmove touchend",z,function(e){clearTimeout(Te(this).data("tmlongtap")),"touchmove"==e.type&&Te(this).removeClass(d)}).on("click",z+"."+O+" ."+D,function(e){var t=Te(this),n=t.parent(z),i=n.next("."+T),a=Te.Deferred();e.stopPropagation(),n.hasClass(I)?(n.toggleClass(S),W.lazy(function(){30<(n.hasClass(S)?i.children().length+i.find("div.elfinder-navbar-subtree[style*=block]").children().length:i.find("div:visible").length)?(i.toggle(),W.draggingUiHelper&&W.draggingUiHelper.data("refreshPositions",1)):i.stop(!0,!0).slideToggle("normal",function(){W.draggingUiHelper&&W.draggingUiHelper.data("refreshPositions",1)})}).always(function(){a.resolve()})):(U.insertBefore(t),n.removeClass(O),W.request({cmd:"tree",target:W.navId2Hash(n.attr("id"))}).done(function(e){F(JSON.parse(JSON.stringify(y(e.tree)))),i.children().length&&(n.addClass(O+" "+S),30<i.children().length?(i.show(),W.draggingUiHelper&&W.draggingUiHelper.data("refreshPositions",1)):i.stop(!0,!0).slideDown("normal",function(){W.draggingUiHelper&&W.draggingUiHelper.data("refreshPositions",1)})),H(!0)}).always(function(e){U.remove(),n.addClass(I),W.one("treedone",function(){a.resolve()})})),t.data("dfrd",a)}).on("contextmenu",z,function(e){var t=Te(this);e.preventDefault(),W.trigger("contextmenu",{type:"navbar",targets:[W.navId2Hash(Te(this).attr("id"))],x:e.pageX,y:e.pageY}),t.addClass("ui-state-hover"),W.getUI("contextmenu").children().on("mouseenter",function(){t.addClass("ui-state-hover")}),W.bind("closecontextmenu",function(){t.removeClass("ui-state-hover")})}).on("scrolltoview",z,function(){var e=Te(this);w(e.attr("id")).done(function(){W.resources.blink(e,"lookme")})}).on("create."+W.namespace,function(e,t){var n=m(t.phash),i=t.move||!1,a=Te(f(t)).addClass("elfinder-navbar-wrapper-tmp"),r=W.selected();i&&r.length&&W.trigger("lockfiles",{files:r}),n.prepend(a)}),N=W.getUI("navbar").append(R).show(),q=W.sortAlsoTreeview,L=!1;W.open(function(e){var t=e.data,n=y(t.files),i=W.getUI("contextmenu");t.init&&R.empty(),W.UA.iOS&&N.removeClass("overflow-scrolling-touch").addClass("overflow-scrolling-touch"),L=!0,n.length?W.lazy(function(){i.data("cmdMaps")||i.data("cmdMaps",{}),F(n),_(n,I),Te.each(n,function(e,t){t.volumeid&&t.uiCmdMap&&Object.keys(t.uiCmdMap).length&&!i.data("cmdMaps")[t.volumeid]&&(i.data("cmdMaps")[t.volumeid]=t.uiCmdMap)}),H(!1,n,t.init),L=!1}):(H(!1,n,t.init),L=!1)}).add(function(e){var t=y(e.data.added);t.length&&(F(t),_(t,O))}).change(function(e){var t,n,i,a,r,o,s,l,d,c,u=y(e.data.changed),h=u.length;for(Te();h--;)if(t=u[h],(n=Te("#"+W.navHash2Id(t.hash))).length){if(c=n.parent(),t.phash){if(a=n.closest("."+T),r=m(t.phash),o=n.parent().next(),s=g(r,t),!r.length)continue;r[0]===a[0]&&o.get(0)===s.get(0)||(s.length?s.before(c):r.append(c))}l=n.hasClass(S),d=n.hasClass(I),i=Te(f(t)),n.replaceWith(i.children(z)),v||j(null,c),t.dirs&&(l||d)&&(n=Te("#"+W.navHash2Id(t.hash)))&&n.next("."+T).children().length&&(l&&n.addClass(S),d&&n.addClass(I))}W.cwd().hash&&H(!0)}).remove(function(e){for(var t,n,i=e.data.removed,a=i.length;a--;)(t=Te("#"+W.navHash2Id(i[a]))).length&&(n=t.closest("."+T),t.parent().detach(),n.children().length||n.hide().prev(z).removeClass(O+" "+S+" "+I))}).bind("lockfiles unlockfiles",function(e){var i="lockfiles"==e.type,a=!!e.data.helper&&e.data.helper.data("locked"),r=i&&!a?"disable":"enable",t=Te.map(e.data.files||[],function(e){var t=W.file(e);return t&&"directory"==t.mime?e:null});Te.each(t,function(e,t){var n=Te("#"+W.navHash2Id(t));n.length&&!a&&(n.hasClass(c)&&n.draggable(r),n.hasClass(u)&&n.droppable(r),n[i?"addClass":"removeClass"](o))})}).bind("sortchange",function(){if(W.sortAlsoTreeview||q!==W.sortAlsoTreeview){var e=y(W.files());q=W.sortAlsoTreeview,R.empty(),F(e),H()}})}),this},Te.fn.elfinderuploadbutton=function(i){return this.each(function(){var e=Te(this).elfinderbutton(i).off("click"),t=Te("<form/>").appendTo(e),n=Te('<input type="file" multiple="true" title="'+i.fm.i18n("selectForUpload")+'"/>').change(function(){var e=Te(this);e.val()&&(i.exec({input:e.remove()[0]}),n.clone(!0).appendTo(t))}).on("dragover",function(e){e.originalEvent.dataTransfer.dropEffect="copy"});t.append(n.clone(!0)),i.change(function(){t[i.disabled()?"hide":"show"]()}).change()})},Te.fn.elfinderviewbutton=function(i){return this.each(function(){var t=Te(this).elfinderbutton(i),n=t.children(".elfinder-button-icon");i.change(function(){var e="icons"==i.value;n.toggleClass("elfinder-button-icon-view-list",e),i.className=e?"view-list":"",i.title=i.fm.i18n(e?"viewlist":"viewicons"),t.attr("title",i.title)})})},Te.fn.elfinderworkzone=function(s){var l="elfinder-workzone";return this.not("."+l).each(function(){function e(){var t=o.height()-a,e=o.attr("style"),n=Math.round(i.height());o.css("overflow","hidden").children(":visible:not(."+l+")").each(function(){var e=Te(this);"absolute"!=e.css("position")&&"fixed"!=e.css("position")&&(t-=e.outerHeight(!0))}),o.attr("style",e||""),t=Math.max(0,Math.round(t)),r===t&&n===t||(r=Math.round(i.height()),i.height(t),s.trigger("wzresize"))}var i=Te(this).addClass(l),a=i.outerHeight(!0)-i.height(),r=Math.round(i.height()),o=i.parent();o.add(window).on("resize."+s.namespace,e),s.one("cssloaded",function(){a!==(a=i.outerHeight(!0)-i.height())&&s.trigger("uiresize")}).bind("uiresize",e)}),this},(ze.prototype.commands.back=function(){this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+left backspace"}],this.getstate=function(){return this.fm.history.canBack()?0:-1},this.exec=function(){return this.fm.history.back()}}).prototype={forceLoad:!0},ze.prototype.commands.colwidth=function(){this.alwaysEnabled=!0,this.updateOnSelect=!1,this.getstate=function(){return"fixed"===this.fm.getUI("cwd").find("table").css("table-layout")?0:-1},this.exec=function(){this.fm.getUI("cwd").trigger("colwidth")}},ze.prototype.commands.copy=function(){this.shortcuts=[{pattern:"ctrl+c ctrl+insert"}],this.getstate=function(e){var t=(e=this.files(e)).length;return!this._disabled&&t&&Te.map(e,function(e){return e.read?e:null}).length==t?0:-1},this.exec=function(e){var t=this.fm,n=Te.Deferred().fail(function(e){t.error(e)});return Te.each(this.files(e),function(e,t){if(!t.read)return!n.reject(["errCopy",t.name,"errPerm"])}),"rejected"==n.state()?n:n.resolve(t.clipboard(this.hashes(e)))}},ze.prototype.commands.cut=function(){var i=this.fm;this.shortcuts=[{pattern:"ctrl+x shift+insert"}],this.getstate=function(e){var t=(e=this.files(e)).length;return!this._disabled&&t&&Te.map(e,function(e){return!e.read||e.locked||i.isRoot(e)?null:e}).length==t?0:-1},this.exec=function(e){var n=Te.Deferred().fail(function(e){i.error(e)});return Te.each(this.files(e),function(e,t){return!t.read||t.locked||i.isRoot(t)?!n.reject(["errCopy",t.name,"errPerm"]):t.locked?!n.reject(["errLocked",t.name]):void 0}),"rejected"==n.state()?n:n.resolve(i.clipboard(this.hashes(e),!0))}},ze.prototype.commands.zipdl=function(){},ze.prototype.commands.download=function(){var o=this,s=this.fm,l=!1,d=!1;this.linkedCmds=["zipdl"],this.shortcuts=[{pattern:"shift+enter"}],this.getstate=function(e){var t=(e=this.hashes(e)).length,n=this.options.maxRequests||10;2<s.api&&s.getCommand("zipdl");return t<1?-1:(t=function(e,i){var n,a,r=2<s.api?s.getCommand("zipdl"):null;if(null!==r&&(1<s.searchStatus.state?d=s.searchStatus.mixed:s.leafRoots[s.cwd().hash]&&(n=s.cwd().volumeid,Te.each(e,function(e,t){if(0!==t.indexOf(n))return!(d=!0)})),l=s.isCommandEnabled("zipdl",e[0])),d){if(a=r?"zipdl":"download",!(e=Te.map(e,function(e){var t=s.file(e),n=t&&(r||"directory"!==t.mime)&&s.isCommandEnabled(a,e)?e:null;return t&&i&&!n&&Te("#"+s.cwdHash2Id(t.hash)).trigger("unselect"),n})).length)return[]}else if(!s.isCommandEnabled("download",e[0]))return[];return Te.map(o.files(e),function(e){var t=!e.read||!l&&"directory"==e.mime?null:e;return i&&!t&&Te("#"+s.cwdHash2Id(e.hash)).trigger("unselect"),t})}(e).length)&&(l||t<=n&&(!s.UA.IE&&!s.UA.Mobile||1==t))?0:-1},s.bind("contextmenu",function(e){function n(o){var e=o.url||s.url(o.hash);return{icon:"link",node:Te("<a/>").attr({href:e,target:"_blank",title:s.i18n("link")}).text(o.name).on("mousedown click touchstart touchmove touchend contextmenu",function(e){e.stopPropagation()}).on("dragstart",function(e){var t,n,i,a,r=e.dataTransfer||e.originalEvent.dataTransfer||null;if(l=null,r){r.effectAllowed="copyLink",r.setDragImage&&(l=Te('<div class="elfinder-drag-helper html5-native">').append((i=(t=o).mime,a=s.tmb(t),n='<div class="elfinder-cwd-icon '+s.mime2class(i)+' ui-corner-all"/>',a&&(n=Te(n).addClass(a.className).css("background-image","url('"+a.url+"')").get(0).outerHTML),n)).appendTo(Te(document.body)),r.setDragImage(l.get(0),50,47)),s.UA.IE||(r.setData("elfinderfrom",window.location.href+o.phash),r.setData("elfinderfrom:"+r.getData("elfinderfrom"),""))}}).on("dragend",function(e){l&&l.remove()})}}var t,i,a,s=o.fm,l=null;o.extra=null,!e.data||1===(t=e.data.targets||[]).length&&(i=s.file(t[0]))&&"directory"!==i.mime&&("1"!=i.url?o.extra=n(i):(o.extra={icon:"link",node:Te("<a/>").attr({href:"#",title:s.i18n("getLink"),draggable:"false"}).text(i.name).on("click touchstart",function(e){if(!("touchstart"===e.type&&1<e.originalEvent.touches.length)){var t=a.parent();e.stopPropagation(),e.preventDefault(),t.removeClass("ui-state-disabled").addClass("elfinder-button-icon-spinner"),s.request({data:{cmd:"url",target:i.hash},preventDefault:!0}).always(function(e){(t.removeClass("elfinder-button-icon-spinner"),e.url)?(s.file(i.hash).url=e.url,a.replaceWith(n(i).node)):t.addClass("ui-state-disabled")})}})},(a=o.extra.node).ready(function(){setTimeout(function(){a.parent().addClass("ui-state-disabled").css("pointer-events","auto")},10)})))}),this.exec=function(e){Efw("elfinder_download",{cmd:"download",home:s.options.customData.home,readonly:s.options.customData.readonly,id:s.options.customData.id,targets:e})}},ze.prototype.commands.duplicate=function(){var n=this.fm;this.getstate=function(e){var t=(e=this.files(e)).length;return!this._disabled&&t&&n.cwd().write&&Te.map(e,function(e){return e.read&&e.phash===n.cwd().hash&&!n.isRoot(e)?e:null}).length==t?0:-1},this.exec=function(e){var n=this.fm,t=this.files(e),i=t.length,a=Te.Deferred().fail(function(e){e&&n.error(e)});return i?(Te.each(t,function(e,t){if(!t.read||!n.file(t.phash).write)return!a.reject(["errCopy",t.name,"errPerm"])}),"rejected"==a.state()?a:n.request({data:{cmd:"duplicate",targets:this.hashes(e)},notify:{type:"copy",cnt:i}}).done(function(e){var t;e&&e.added&&e.added[0]&&n.one("duplicatedone",function(){(t=n.findCwdNodes(e.added)).length?t.trigger("scrolltoview"):(n.trigger("selectfiles",{files:Te.map(e.added,function(e){return e.hash})}),n.toast({msg:n.i18n(["complete",n.i18n("cmdduplicate")])}))})})):a.reject()}},(ze.prototype.commands.forward=function(){this.alwaysEnabled=!0,this.updateOnSelect=!0,this.shortcuts=[{pattern:"ctrl+right"}],this.getstate=function(){return this.fm.history.canForward()?0:-1},this.exec=function(){return this.fm.history.forward()}}).prototype={forceLoad:!0},ze.prototype.commands.fullscreen=function(){function e(e,t){t&&t.fullscreen&&n.update(void 0,"on"===t.fullscreen)}var n=this,i=this.fm;this.alwaysEnabled=!0,this.updateOnSelect=!1,this.value=!1,this.options={ui:"fullscreenbutton"},this.getstate=function(){return 0},this.exec=function(){var e=i.getUI().get(0),t=i.toggleFullscreen(e);n.update(void 0,t===e)},i.bind("init",function(){i.getUI().off("resize."+i.namespace,e).on("resize."+i.namespace,e)})},(ze.prototype.commands.getfile=function(){var p=this,e=this.fm;this.alwaysEnabled=!0,this.callback=e.options.getFileCallback,this._disabled="function"==typeof this.callback,this.getstate=function(e){var t,n,i=(e=this.files(e)).length;return this.callback&&i&&(t=e,n=p.options,t=Te.map(t,function(e){return("directory"!=e.mime||n.folders)&&e.read?e:null}),n.multiple||1==t.length?t:[]).length==i?0:-1},this.exec=function(e){function t(e){return o.onlyURL?o.multiple?Te.map(s,function(e){return e.url}):s[0].url:o.multiple?s:s[0]}var n,i,a,r=this.fm,o=this.options,s=this.files(e),l=s.length,d=r.option("url"),c=r.option("tmbUrl"),u=Te.Deferred().done(function(e){function t(){"close"==o.oncomplete?r.hide():"destroy"==o.oncomplete&&r.destroy()}var n;r.trigger("getfile",{files:e}),"object"==typeof(n=p.callback(e,r))&&"function"==typeof n.done?n.done(t).fail(function(e){e&&r.error(e)}):t()}),h=[];for(n=0;n<l;n++){if("directory"==(i=s[n]).mime&&!o.folders)return u.reject();i.baseUrl=d,"1"==i.url?h.push(r.request({data:{cmd:"url",target:i.hash},notify:{type:"url",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(e){e.url&&(r.file(this.hash).url=this.url=e.url)}.bind(i))):i.url=r.url(i.hash),o.onlyURL||(o.getPath&&(i.path=r.path(i.hash),""===i.path&&i.phash&&function(){var e=Te.Deferred();h.push(e),r.path(i.hash,!1,{}).done(function(e){i.path=e}).fail(function(){i.path=""}).always(function(){e.resolve()})}()),i.tmb&&1!=i.tmb&&(i.tmb=c+i.tmb),i.width||i.height||(i.dim?(a=i.dim.split("x"),i.width=a[0],i.height=a[1]):o.getImgSize&&-1!==i.mime.indexOf("image")&&h.push(r.request({data:{cmd:"dim",target:i.hash},notify:{type:"dim",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(e){if(e.dim){var t=e.dim.split("x"),n=r.file(this.hash);n.width=this.width=t[0],n.height=this.height=t[1]}}.bind(i)))))}return h.length?(Te.when.apply(null,h).always(function(){u.resolve(t())}),u):u.resolve(t())}}).prototype={forceLoad:!0},(ze.prototype.commands.home=function(){this.title="Home",this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+home ctrl+shift+up",description:"Home"}],this.getstate=function(){var e=this.fm.root(),t=this.fm.cwd().hash;return e&&t&&e!=t?0:-1},this.exec=function(){return this.fm.exec("open",this.fm.root())}}).prototype={forceLoad:!0},(ze.prototype.commands.info=function(){var n=this.fm,I="elfinder-info-spinner",D={calc:n.i18n("calc"),size:n.i18n("size"),unknown:n.i18n("unknown"),path:n.i18n("path"),aliasfor:n.i18n("aliasfor"),modify:n.i18n("modify"),perms:n.i18n("perms"),locked:n.i18n("locked"),dim:n.i18n("dim"),kind:n.i18n("kind"),files:n.i18n("files"),folders:n.i18n("folders"),roots:n.i18n("volumeRoots"),items:n.i18n("items"),yes:n.i18n("yes"),no:n.i18n("no"),link:n.i18n("link"),owner:n.i18n("owner"),group:n.i18n("group"),perm:n.i18n("perm"),getlink:n.i18n("getLink")};this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title {dirclass}"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}</div><table class="elfinder-info-tb">{content}</table>',itemTitle:'<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>',groupTitle:"<strong>{items}: {num}</strong>",row:"<tr><td>{label} : </td><td>{value}</td></tr>",spinner:'<span>{text}</span> <span class="'+I+" "+I+'-{name}"/>'},this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+i"}],this.init=function(){Te.each(D,function(e,t){D[e]=n.i18n(t)})},this.getstate=function(){return 0},this.exec=function(e){var t=this.files(e);t.length||(t=this.files([this.fm.cwd().hash]));function i(e,t){O.find("."+I+"-"+t).parent().html(e)}var a,n,r,o,s,l,d,c,u,h,p=this.fm,f=this.options,m=this.tpl,g=m.row,v=t.length,b=[],y=m.main,w="{label}",x="{value}",C=[],k={title:this.title,width:"auto",close:function(){Te(this).elfinderdialog("destroy"),Te.each(C,function(e,t){var n=t&&t.xhr?t.xhr:null;n&&"pending"==n.state()&&(n.quiet=!0,n.abort())})}},T=[],z=p.namespace+"-info-"+Te.map(t,function(e){return e.hash}).join("-"),O=p.getUI().find("#"+z),S=[];return v?O.length?(O.elfinderdialog("toTop"),Te.Deferred().resolve()):(1==v?(r=t[0],y=y.replace("{dirclass}",r.csscls?p.escape(r.csscls):"").replace("{class}",p.mime2class(r.mime)),o=m.itemTitle.replace("{name}",p.escape(r.i18||r.name)).replace("{kind}",'<span title="'+p.escape(r.mime)+'">'+p.mime2kind(r)+"</span>"),n=p.tmb(r),r.read?"directory"!=r.mime||r.alias?a=p.formatSize(r.size):(a=m.spinner.replace("{text}",D.calc).replace("{name}","size"),T.push(r.hash)):a=D.unknown,b.push(g.replace(w,D.size).replace(x,a)),r.alias&&b.push(g.replace(w,D.aliasfor).replace(x,r.alias)),(d=p.path(r.hash,!0))?b.push(g.replace(w,D.path).replace(x,p.escape(d))):(b.push(g.replace(w,D.path).replace(x,m.spinner.replace("{text}",D.calc).replace("{name}","path"))),C.push(p.path(r.hash,!0,{notify:null}).fail(function(){i(D.unknown,"path")}).done(function(e){i(e,"path")}))),b.push(g.replace(w,D.modify).replace(x,p.formatDate(r))),b.push(g.replace(w,D.perms).replace(x,p.formatPermissions(r))),b.push(g.replace(w,D.locked).replace(x,r.locked?D.yes:D.no)),r.owner&&b.push(g.replace(w,D.owner).replace(x,r.owner)),r.group&&b.push(g.replace(w,D.group).replace(x,r.group)),r.perm&&b.push(g.replace(w,D.perm).replace(x,p.formatFileMode(r.perm))),f.custom&&Te.each(f.custom,function(e,t){t.mimes&&!Te.map(t.mimes,function(e){return r.mime===e||0===r.mime.indexOf(e+"/")||null}).length||t.hashRegex&&!r.hash.match(t.hashRegex)||(b.push(g.replace(w,p.i18n(t.label)).replace(x,t.tpl.replace("{id}",z))),t.action&&"function"==typeof t.action&&S.push(t.action))})):(y=y.replace("{class}","elfinder-cwd-icon-group"),o=m.groupTitle.replace("{items}",D.items).replace("{num}",v),(s=Te.map(t,function(e){return"directory"==e.mime?1:null}).length)?(s-=l=Te.map(t,function(e){return"directory"!==e.mime||e.phash&&!e.isroot?null:1}).length,b.push(g.replace(w,D.kind).replace(x,l===v||s===v?D[l?"roots":"folders"]:Te.map({roots:l,folders:s,files:v-l-s},function(e,t){return e?D[t]+" "+e:null}).join(", "))),b.push(g.replace(w,D.size).replace(x,m.spinner.replace("{text}",D.calc).replace("{name}","size"))),T=Te.map(t,function(e){return e.hash})):(a=0,Te.each(t,function(e,t){var n=parseInt(t.size);0<=n&&0<=a?a+=n:a="unknown"}),b.push(g.replace(w,D.kind).replace(x,D.files)),b.push(g.replace(w,D.size).replace(x,p.formatSize(a))))),y=y.replace("{title}",o).replace("{content}",b.join("")),(O=p.dialog(y,k)).attr("id",z),r&&"1"==r.url&&O.on("click","."+I+"-url",function(){Te(this).parent().html(m.spinner.replace("{text}",p.i18n("ntfurl")).replace("{name}","url")),p.request({data:{cmd:"url",target:r.hash},preventDefault:!0}).fail(function(){i(name_esc,"url")}).done(function(e){e.url?(i('<a href="'+e.url+'" target="_blank">'+name_esc+"</a>"||name_esc,"url"),p.file(r.hash).url=e.url):i(name_esc,"url")})}),n&&Te("<img/>").on("load",function(){O.find(".elfinder-cwd-icon").addClass(n.className).css("background-image","url('"+n.url+"')")}).attr("src",n.url),T.length&&(c=T,p.autoSync("stop"),(u=Te.Deferred(),0<(h=Object.keys(p.leafRoots).length)?Te.each(p.leafRoots,function(e){var t,n,i,a;(t=e,n=Te.Deferred(),i=p.file(t),(a=i?i.phash:t)&&!p.file(a)?p.request({data:{cmd:"parents",target:a},preventFail:!0}).done(function(){p.one("parentsdone",function(){n.resolve()})}).fail(function(){n.resolve()}):n.resolve(),n).done(function(){--h<1&&u.resolve()})}):u.resolve(),u).done(function(){var e=[],t={},n=[];Te.each(c,function(){var i,a;e.push.apply(e,(i=p.file(this),a=[],"directory"===i.mime&&Te.each(p.leafRoots,function(e,t){var n;if(e===i.hash)a.push.apply(a,t);else for(n=(p.file(e)||{}).phash;n;)n===i.hash&&a.push.apply(a,t),n=(p.file(n)||{}).phash}),a))}),c.push.apply(c,e),Te.each(c,function(){var e=p.root(this);t[e]?t[e].push(this):t[e]=[this]}),Te.each(t,function(){n.push(p.request({data:{cmd:"size",targets:this},preventDefault:!0}))}),C.push.apply(C,n),Te.when.apply(Te,n).fail(function(){i(D.unknown,"size")}).done(function(){var e,t=0,n=arguments.length;for(e=0;e<n;e++)t+=parseInt(arguments[e].size);i(0<=t?p.formatSize(t):D.unknown,"size")}),p.autoSync()})),void(S.length&&Te.each(S,function(e,t){try{t(r,p,O)}catch(e){p.debug("error",e)}}))):Te.Deferred().reject()}}).prototype={forceLoad:!0},ze.prototype.commands.mkdir=function(){var i,a=this.fm,n=this;this.value="",this.disableOnSearch=!0,this.updateOnSelect=!1,this.mime="directory",this.prefix="untitled folder",this.exec=function(e){return this.origin=i||"cwd",e||this.options.intoNewFolderToolbtn||a.getUI("cwd").trigger("unselectall"),this.move=!("navbar"===this.origin||!a.selected().length),Te.proxy(a.res("mixin","make"),n)()},this.shortcuts=[{pattern:"ctrl+shift+n"}],this.init=function(){this.options.intoNewFolderToolbtn&&(this.options.ui="mkdirbutton")},a.bind("select",function(e){var t=e.data&&e.data.selected?e.data.selected:[];i=t.length&&e.data.origin||"",n.title=t.length&&"navbar"!==i?a.i18n("cmdmkdirin"):a.i18n("cmdmkdir"),n.update(void 0,n.title)}),this.getstate=function(e){var t=a.cwd(),n=(e="navbar"===i||e&&e[0]!=t.hash?this.files(e||a.selected()):[]).length;return"navbar"===i?!this._disabled&&n&&e[0].write&&e[0].read?0:-1:this._disabled||!t.write||n&&Te.map(e,function(e){return e.read&&!e.locked?e:null}).length!=n?-1:0}},ze.prototype.commands.mkfile=function(){this.disableOnSearch=!0,this.updateOnSelect=!1,this.mime="text/plain",this.prefix="untitled file.txt",this.exec=Te.proxy(this.fm.res("mixin","make"),this),this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1}},(ze.prototype.commands.open=function(){this.alwaysEnabled=!0,this._handlers={dblclick:function(e){e.preventDefault(),this.exec()},"select enable disable reload":function(e){this.update("disable"==e.type?-1:void 0)}},this.shortcuts=[{pattern:"ctrl+down numpad_enter"+("mac"!=this.fm.OS&&" enter")}],this.getstate=function(e){var t=(e=this.files(e)).length;return 1==t?e[0].read?0:-1:t&&!this.fm.UA.Mobile&&Te.map(e,function(e){return"directory"!=e.mime&&e.read?e:null}).length==t?0:-1},this.exec=function(e,t){var n,i=this.fm,a=Te.Deferred().fail(function(e){e&&i.error(e)}),r=this.files(e),o=r.length,s="object"==typeof t&&t.thash;t=this.options;if(!o&&!s)return a.reject();if(s||1==o&&(n=r[0])&&"directory"==n.mime)return s||!n||n.read?i.request({data:{cmd:"open",target:s||n.hash},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0,lazy:!1}):a.reject(["errOpen",n.name,"errPerm"]);if(r=Te.map(r,function(e){return"directory"!=e.mime?e:null}),o!=r.length)return a.reject();function l(){try{new RegExp(i.option("dispInlineRegex"))}catch(e){0}for(o=r.length;o--;)n=r[o],Efw("elfinder_file",{cmd:"file",home:i.options.customData.home,readonly:i.options.customData.readonly,id:i.options.customData.id,target:n.hash});return a.resolve(e)}return 1<o?i.confirm({title:"openMulti",text:["openMultiConfirm",o+""],accept:{label:"cmdopen",callback:function(){l()}},cancel:{label:"btnCancel",callback:function(){a.reject()}},buttons:i.getCommand("zipdl")&&i.isCommandEnabled("zipdl",i.cwd().hash)?[{label:"cmddownload",callback:function(){i.exec("download",e),a.reject()}}]:[]}):l(),a}}).prototype={forceLoad:!0},ze.prototype.commands.opendir=function(){this.alwaysEnabled=!0,this.getstate=function(){return 1!==this.fm.selected().length?-1:this.fm.getUI("workzone").hasClass("elfinder-search-result")?0:-1},this.exec=function(e){var t,n=this.fm,i=Te.Deferred(),a=this.files(e);return a.length&&a[0].phash?(t=a[0].phash,n.trigger("searchend",{noupdate:!0}),n.request({data:{cmd:"open",target:t},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!1}),i):i.reject()}},ze.prototype.commands.paste=function(){this.updateOnSelect=!1,this.handlers={changeclipboard:function(){this.update()}},this.shortcuts=[{pattern:"ctrl+v shift+insert"}],this.getstate=function(e){if(this._disabled)return-1;if(e){if(Te.isArray(e)){if(1!=e.length)return-1;e=this.fm.file(e[0])}}else e=this.fm.cwd();return this.fm.clipboard().length&&"directory"==e.mime&&e.write?0:-1},this.exec=function(a){var t,i,r,e,o,s,l,d,c,n,u=this,h=u.fm,p=(a=a?this.files(a)[0]:h.cwd(),h.clipboard()),f=p.length,m=!!f&&p[0].cut,g=m?"errMove":"errCopy",v=[],b=[],y=Te.Deferred().fail(function(e){e&&h.error(e)}).always(function(){h.unlockfiles({files:Te.map(p,function(e){return e.hash})})});return f&&a&&"directory"==a.mime?a.write?(t=h.parents(a.hash),Te.each(p,function(e,n){return n.read?m&&n.locked?!y.reject(["errLocked",n.name]):-1!==Te.inArray(n.hash,t)?!y.reject(["errCopyInItself",n.name]):n.mime&&"directory"!==n.mime&&!h.uploadMimeCheck(n.mime,a.hash)?!y.reject([g,n.name,"errUploadMime"]):((i=h.parents(n.hash)).pop(),-1!==Te.inArray(a.hash,i)&&Te.map(i,function(e){var t=h.file(e);return t.phash==a.hash&&t.name==n.name?t:null}).length?!y.reject(["errReplByChild",n.name]):void(n.phash==a.hash?b.push(n.hash):v.push({hash:n.hash,phash:n.phash,name:n.name}))):!y.reject([g,n.name,"errPerm"])}),"rejected"==y.state()?y:Te.when((n=b).length&&h._commands.duplicate?h.exec("duplicate",n):Te.Deferred().resolve(),(r=v,o=Te.Deferred(),s=[],l={},d=function(n){var e=s[n],t=r[e],i=n==s.length-1;t&&h.confirm({title:h.i18n(m?"moveFiles":"copyFiles"),text:["errExists",t.name,"confirmRepl"],all:!i,accept:{label:"btnYes",callback:function(e){i||e?c(r):d(++n)}},reject:{label:"btnNo",callback:function(e){var t;if(e)for(t=s.length;n<t--;)r[s[t]].remove=!0;else r[s[n]].remove=!0;i||e?c(r):d(++n)}},cancel:{label:"btnCancel",callback:function(){o.resolve()}},buttons:[]})},c=function(e){var t,n=[],i=(e=Te.map(e,function(e){return e.rename&&n.push(e.name),e.remove?null:e})).length;if(!i)return o.resolve();t=e[0].phash,e=Te.map(e,function(e){return e.hash}),h.request({data:{cmd:"paste",dst:a.hash,targets:e,cut:m?1:0,src:t,renames:n,hashes:l,suffix:h.options.backupSuffix},notify:{type:m?"move":"copy",cnt:i}}).done(function(e){var t,n;o.resolve(e),e&&e.added&&e.added[0]&&h.one("pastedone",function(){(t=h.findCwdNodes(e.added)).length?t.trigger("scrolltoview"):(a.hash!==h.cwd().hash?n=Te("<div/>").append(Te('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all"><span class="ui-button-text">'+h.i18n("cmdopendir")+"</span></button>").on("mouseenter mouseleave",function(e){Te(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click",function(){h.exec("open",a.hash).done(function(){h.one("opendone",function(){h.trigger("selectfiles",{files:Te.map(e.added,function(e){return e.hash})})})})})):h.trigger("selectfiles",{files:Te.map(e.added,function(e){return e.hash})}),h.toast({msg:h.i18n(["complete",h.i18n("cmd"+(m?"move":"copy"))]),extNode:n}))})}).always(function(){h.unlockfiles({files:e})})},h.isCommandEnabled(u.name,a.hash)&&r.length?(h.oldAPI?c(r):h.option("copyOverwrite")?(e=Te.map(r,function(e){return e.name}),a.hash==h.cwd().hash?x(Te.map(h.files(),function(e){return e.phash==a.hash?{hash:e.hash,name:e.name}:null})):h.request({data:{cmd:"ls",target:a.hash,intersect:e},notify:{type:"prepare",cnt:1,hideCnt:!0},preventFail:!0}).always(function(e){x(e.list)})):c(r),o):o.resolve())).always(function(){m&&h.clipboard([])})):y.reject([g,p[0].name,"errPerm"]):y.reject();function w(e,t){for(var n=[],i=e.length;i--;)-1!==Te.inArray(e[i].name,t)&&n.unshift(i);return n}function x(e){var t,n={};e&&(Te.isArray(e)?e.length&&("string"==typeof e[0]?s=w(r,e):(Te.each(e,function(e,t){n[t.name]=t.hash}),s=w(r,Te.map(n,function(e,t){return t})),Te.each(r,function(e,t){n[t.name]&&(l[n[t.name]]=t.name)}))):(t=[],s=Te.map(e,function(e){return"string"==typeof e?e:(t=t.concat(e),null)}),t.length&&(s=s.concat(t)),s=w(r,s),l=e)),s.length?d(0):c(r)}}},(ze.prototype.commands.reload=function(){var n=this,i=!1;this.alwaysEnabled=!0,this.updateOnSelect=!0,this.shortcuts=[{pattern:"ctrl+shift+r f5"}],this.getstate=function(){return 0},this.init=function(){this.fm.bind("search searchend",function(e){i="search"==e.type})},this.fm.bind("contextmenu",function(e){var t=n.fm;1e3<=t.options.sync&&(n.extra={icon:"accept",node:Te("<span/>").attr({title:t.i18n("autoSync")}).on("click touchstart",function(e){"touchstart"===e.type&&1<e.originalEvent.touches.length||(e.stopPropagation(),e.preventDefault(),Te(this).parent().toggleClass("ui-state-disabled",t.options.syncStart).parent().removeClass("ui-state-hover"),t.options.syncStart=!t.options.syncStart,t.autoSync(t.options.syncStart?null:"stop"))}).on("ready",function(){Te(this).parent().toggleClass("ui-state-disabled",!t.options.syncStart).css("pointer-events","auto")})})}),this.exec=function(){var e=this.fm;if(!i){var t=e.sync(),n=setTimeout(function(){e.notify({type:"reload",cnt:1,hideCnt:!0}),t.always(function(){e.notify({type:"reload",cnt:-1})})},e.notifyDelay);return t.always(function(){clearTimeout(n),e.trigger("reload")})}Te("div.elfinder-toolbar > div."+e.res("class","searchbtn")+" > span.ui-icon-search").click()}}).prototype={forceLoad:!0},ze.prototype.commands.rename=function(){this.shortcuts=[{pattern:"f2"+("mac"==this.fm.OS?" enter":"")}],this.getstate=function(e){e=this.files(e);return this._disabled||1!=e.length||!e[0].phash||e[0].locked?-1:0},this.exec=function(e,t){function n(){setTimeout(function(){b&&b.blur()},50)}function i(){C.is(":hidden")||C.addClass("ui-front").elfinderoverlay("hide").off("click",k),x.removeClass("ui-front").css("position","").off("unselect."+o.namespace,n),g?w.css("max-height",""):f||x.css("width","").parent("td").css("overflow","")}function a(){var e=Te.trim(b.val()),t=(b.parent(),!0);if(!z&&x.length){if(b.off("blur"),b[0].setSelectionRange&&b[0].setSelectionRange(0,0),e==c.name)return v.reject();if(o.options.validName&&o.options.validName.test)try{t=o.options.validName.test(e)}catch(e){t=!1}if(!e||".."===e||!t)return z=!0,o.error("errInvName",{modal:!0,close:y}),!1;if(o.fileByName(e,c.phash))return z=!0,o.error(["errExists",e],{modal:!0,close:y}),!1;i(),(f?b:w).html(o.escape(e)),o.lockfiles({files:[c.hash]}),o.request({data:{cmd:"rename",target:c.hash,name:e},notify:{type:"rename",cnt:1}}).fail(function(e){v.reject(),e&&Te.isArray(e)&&"errRename"===e[0]||o.sync()}).done(function(e){if(v.resolve(e),!f&&e&&e.added&&e.added[0]){var t=o.findCwdNodes(e.added);t.length&&t.trigger("scrolltoview")}}).always(function(){o.unlockfiles({files:[c.hash]})})}}var r,o=this.fm,s=o.getUI("cwd"),l=e||!!o.selected().length&&o.selected()||[o.cwd().hash],d=l.length,c=o.file(l.shift()),u=".elfinder-cwd-filename",h=(t=t||{},o.cwd().hash==c.hash),p=t._currentType?t._currentType:h?"navbar":"files",f="navbar"===p,m=Te("#"+o[f?"navHash2Id":"cwdHash2Id"](c.hash)),g="files"===p&&"list"!=o.storage("view"),v=Te.Deferred().done(function(e){h&&o.exec("open",e.added[0].hash)}).fail(function(e){var t=b.parent(),n=o.escape(c.i18||c.name);g&&(n=n.replace(/([_.])/g,"&#8203;$1")),f?b.replaceWith(n):t.length?(b.remove(),t.html(n)):(m.find(u).html(n),setTimeout(function(){s.find("#"+o.cwdHash2Id(c.hash)).click()},50)),e&&o.error(e)}).always(function(){i(),o.unbind("resize",T),o.enable()}),b=Te(g?"<textarea/>":'<input type="text"/>').on("keyup text",function(){g?(this.style.height="1px",this.style.height=this.scrollHeight+"px"):r&&(this.style.width=r+"px",this.scrollWidth>r&&(this.style.width=this.scrollWidth+10+"px"))}).on("keydown",function(e){e.stopImmediatePropagation(),e.keyCode==Te.ui.keyCode.ESCAPE?v.reject():e.keyCode==Te.ui.keyCode.ENTER&&(e.preventDefault(),b.blur())}).on("mousedown click dblclick",function(e){e.stopPropagation(),"dblclick"===e.type&&e.preventDefault()}).on("blur",a),y=function(){var e=b.val().replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/gi,"");z&&(z=!1,b.on("blur",a)),o.UA.Mobile&&C.on("click",k).removeClass("ui-front").elfinderoverlay("show"),b.select().focus(),b[0].setSelectionRange&&b[0].setSelectionRange(0,e.length)},w=f?m.contents().filter(function(){return 3==this.nodeType&&Te(this).parent().attr("id")===o.navHash2Id(c.hash)}):m.find(u),x=w.parent(),C=o.getUI("overlay"),k=function(e){z||(e.stopPropagation(),v.reject())},T=function(){m.trigger("scrolltoview")},z=!1;return x.addClass("ui-front").css("position","relative").on("unselect."+o.namespace,n),o.bind("resize",T),f?w.replaceWith(b.val(c.name)):(g?w.css("max-height","none"):f||(r=x.width(),x.width(r-15).parent("td").css("overflow","visible")),w.empty().append(b.val(c.name))),1<d?v.reject():c&&w.length?c.locked?v.reject(["errLocked",c.name]):(o.one("select",function(){b.parent().length&&c&&-1===Te.inArray(c.hash,o.selected())&&b.blur()}),b.trigger("keyup"),y(),v):v.reject("errCmdParams",this.title)}},ze.prototype.commands.rm=function(){this.shortcuts=[{pattern:"delete ctrl+backspace"}],this.getstate=function(e){var n=this.fm;return e=e||n.selected(),!this._disabled&&e.length&&Te.map(e,function(e){var t=n.file(e);return!t||t.locked||n.isRoot(t)?null:e}).length==e.length?0:-1},this.exec=function(e){var t,n,i,a,r,o,s,l,d=this.fm,c=Te.Deferred().fail(function(e){e&&d.error(e)}),u=this.files(e),h=u.length,p=d.cwd().hash,f='<div class="ui-helper-clearfix elfinder-rm-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}<div class="elfinder-rm-desc">{desc}</div></div>';return h?(Te.each(u,function(e,t){return d.isRoot(t)?!c.reject(["errRm",t.name,"errPerm"]):t.locked?!c.reject(["errLocked",t.name]):void 0}),"pending"==c.state()&&(t=this.hashes(e),s=[],(n=1<(h=u.length)?(Te.map(u,function(e){return"directory"==e.mime?1:null}).length||(r=0,Te.each(u,function(e,t){if(!t.size||"unknown"==t.size)return!(r="unknown");var n=parseInt(t.size);0<=n&&0<=r&&(r+=n)}),s.push(d.i18n("size")+": "+d.formatSize(r))),[Te(f.replace("{class}","elfinder-cwd-icon-group").replace("{title}","<strong>"+d.i18n("items")+": "+h+"</strong>").replace("{desc}",s.join("<br>")))]):(i=u[0],o=d.tmb(i),i.size&&s.push(d.i18n("size")+": "+d.formatSize(i.size)),s.push(d.i18n("modify")+": "+d.formatDate(i)),a=d.escape(i.i18||i.name).replace(/([_.])/g,"&#8203;$1"),[Te(f.replace("{class}",d.mime2class(i.mime)).replace("{title}","<strong>"+a+"</strong>").replace("{desc}",s.join("<br>")))])).push("confirmRm"),d.lockfiles({files:t}),l=d.confirm({title:this.title,text:n,accept:{label:"btnRm",callback:function(){d.request({data:{cmd:"rm",targets:t},notify:{type:"rm",cnt:h},preventFail:!0}).fail(function(e){c.reject(e)}).done(function(e){c.done(e)}).always(function(){d.unlockfiles({files:t})})}},cancel:{label:"btnCancel",callback:function(){d.unlockfiles({files:t}),1===t.length&&d.file(t[0]).phash!==p?d.select({selected:t}):d.selectfiles({files:t}),c.reject()}}}),o&&Te("<img/>").on("load",function(){l.find(".elfinder-cwd-icon").addClass(o.className).css("background-image","url('"+o.url+"')")}).attr("src",o.url)),c):c.reject()}},ze.prototype.commands.sort=function(){function e(){s.variants=[],Te.each(l.sortRules,function(e,t){var n={type:e,order:e==l.sortType?"asc"==l.sortOrder?"desc":"asc":l.sortOrder};if(-1!==Te.inArray(e,l.sorters)){var i=e==l.sortType?"asc"==n.order?"s":"n":"";s.variants.push([n,(i?'<span class="ui-icon ui-icon-arrowthick-1-'+i+'"></span>':"")+"&nbsp;"+l.i18n("sort"+e)])}}),s.variants.push("|"),s.variants.push([{type:l.sortType,order:l.sortOrder,stick:!l.sortStickFolders,tree:l.sortAlsoTreeview},(l.sortStickFolders?'<span class="ui-icon ui-icon-check"/>':"")+"&nbsp;"+l.i18n("sortFoldersFirst")]),l.ui.tree&&(s.variants.push("|"),s.variants.push([{type:l.sortType,order:l.sortOrder,stick:l.sortStickFolders,tree:!l.sortAlsoTreeview},(l.sortAlsoTreeview?'<span class="ui-icon ui-icon-check"/>':"")+"&nbsp;"+l.i18n("sortAlsoTreeview")]))}var s=this,l=s.fm;this.options={ui:"sortbutton"},l.bind("open sortchange",e).bind("open",function(){l.unbind("add",e).one("add",e),l.getUI("toolbar").find(".elfiner-button-sort .elfinder-button-menu .elfinder-button-menu-item").each(function(){var e=Te(this),t=e.attr("rel");e.toggle(!t||-1!==Te.inArray(t,l.sorters))})}).bind("cwdrender",function(){var o=Te(l.cwd).find("div.elfinder-cwd-wrapper-list table");o.length&&Te.each(l.sortRules,function(e,t){var n=o.find("thead tr td.elfinder-cwd-view-th-"+e);if(n.length){var i,a=e==l.sortType,r={type:e,order:a?"asc"==l.sortOrder?"desc":"asc":l.sortOrder};a&&(n.addClass("ui-state-active"),i="asc"==l.sortOrder?"n":"s",Te('<span class="ui-icon ui-icon-triangle-1-'+i+'"/>').appendTo(n)),Te(n).on("click",function(e){Te(this).data("dragging")||(e.stopPropagation(),l.getUI("cwd").data("longtap")||s.exec([],r))}).hover(function(){Te(this).addClass("ui-state-hover")},function(){Te(this).removeClass("ui-state-hover")})}})}),this.getstate=function(){return 0},this.exec=function(e,t){var n=this.fm,i=Te.extend({type:n.sortType,order:n.sortOrder,stick:n.sortStickFolders,tree:n.sortAlsoTreeview},t);return n.lazy(function(){n.setSort(i.type,i.order,i.stick,i.tree),this.resolve()})}},(ze.prototype.commands.up=function(){this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+up"}],this.getstate=function(){return this.fm.cwd().phash?0:-1},this.exec=function(){var e=this.fm,t=e.cwd().hash;return this.fm.cwd().phash?this.fm.exec("open",this.fm.cwd().phash).done(function(){e.one("opendone",function(){e.selectfiles({files:[t]})})}):Te.Deferred().reject()}}).prototype={forceLoad:!0},ze.prototype.commands.upload=function(){var y=this.fm.res("class","hover");this.disableOnSearch=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+u"}],this.getstate=function(e){var t,n=this.fm;e=e||[n.cwd().hash];return this._disabled||1!=e.length||(t=n.file(e[0])),t&&"directory"==t.mime&&t.write?0:-1},this.exec=function(e){function c(e){p.upload(e).fail(function(e){b.reject(e)}).done(function(e){var t;p.getUI("cwd");if(b.resolve(e),e&&e.added&&e.added[0]&&!p.ui.notify.children(".elfinder-notify-upload").length){var n=p.findCwdNodes(e.added);n.length?n.trigger("scrolltoview"):(v.hash!==f?t=Te("<div/>").append(Te('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">'+p.i18n("cmdopendir")+"</span></button>").on("mouseenter mouseleave",function(e){Te(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click",function(){p.exec("open",g).done(function(){p.one("opendone",function(){p.trigger("selectfiles",{files:Te.map(e.added,function(e){return e.hash})})})})})):p.trigger("selectfiles",{files:Te.map(e.added,function(e){return e.hash})}),p.toast({msg:p.i18n(["complete",p.i18n("cmdupload")]),extNode:t}))}})}function o(e){"files"!==e.type&&s.elfinderdialog("close"),m&&(e.target=m[0]),c(e)}function t(){var t=v.hash,o=Te.map(p.files(),function(e){return"directory"===e.mime&&e.write&&e.phash&&e.phash===t?e:null});return o.length?Te('<div class="elfinder-upload-dirselect elfinder-tabstop" title="'+p.i18n("folders")+'"/>').on("click",function(e){e.stopPropagation(),e.preventDefault(),o=p.sortFiles(o);function n(t,e){return{label:p.escape(t.i18||t.name),icon:e,remain:!1,callback:function(){var e=a.children(".ui-dialog-titlebar:first").find("span.elfinder-upload-target");m=[t.hash],e.html(" - "+p.escape(t.i18||t.name)),i.focus()},options:{className:m&&m.length&&t.hash===m[0]?"ui-state-active":"",iconClass:t.csscls||"",iconImg:t.icon||""}}}var i=Te(this),a=(p.cwd(),s.closest("div.ui-dialog")),r=[n(v,"opendir"),"|"];Te.each(o,function(e,t){r.push(n(t,"dir"))}),i.blur(),p.trigger("contextmenu",{raw:r,x:e.pageX||Te(this).offset().left,y:e.pageY||Te(this).offset().top,prevNode:a,fitHeight:!0})}).append('<span class="elfinder-button-icon elfinder-button-icon-dir" />'):Te()}function n(e,t){var n=Te('<input type="file" '+e+"/>").change(function(){o({input:n.get(0),type:"files"})}).on("dragover",function(e){e.originalEvent.dataTransfer.dropEffect="copy"});return Te('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-tabstop elfinder-focus"><span class="ui-button-text">'+p.i18n(t)+"</span></div>").append(Te("<form/>").append(n)).on("click",function(e){e.target===this&&(e.stopPropagation(),e.preventDefault(),n.click())}).hover(function(){Te(this).toggleClass(y)})}var s,i,a,r,l,d,u,h,p=this.fm,f=p.cwd().hash,m=(u=e&&e instanceof Array?e:null,e||(u=u||1!==(d=p.selected()).length||"directory"!==p.file(d[0]).mime?[f]:d),u),g=!m&&e&&e.target?e.target:m[0],v=g?p.file(g):p.cwd(),b=Te.Deferred();return i=function(e){e.stopPropagation(),e.preventDefault();var t,n=!1,i="",a=null,r="",o=null,s=e._target||null,l=e.dataTransfer||null,d=l.items&&l.items.length&&l.items[0].kind?l.items[0].kind:"";if(l){try{if((a=l.getData("elfinderfrom"))&&(r=window.location.href+p.cwd().hash,!s&&a===r||s===r))return void b.reject()}catch(e){}if("file"===d&&(l.items[0].getAsEntry||l.items[0].webkitGetAsEntry))n=l,i="data";else if("string"!==d&&l.files&&l.files.length&&-1===Te.inArray("Text",l.types))n=l.files,i="files";else{try{(o=l.getData("text/html"))&&o.match(/<(?:img|a)/i)&&(n=[o],i="html")}catch(e){}!n&&(o=l.getData("text"))&&(n=[o],i="text")}}n?c({files:n,type:i,target:s,dropEvt:e}):(t=["errUploadNoFiles"],"file"===d&&t.push("errFolderUpload"),p.error(t),b.reject())},!m&&e?e.input||e.files?(e.type="files",c(e)):e.dropEvt&&i(e.dropEvt):(a=function(e){var t,n=[],i=[];if((e=e.originalEvent||e).clipboardData){if(e.clipboardData.items&&e.clipboardData.items.length){i=e.clipboardData.items;for(var a=0;a<i.length;a++)"file"==e.clipboardData.items[a].kind&&(t=e.clipboardData.items[a].getAsFile(),n.push(t))}else e.clipboardData.files&&e.clipboardData.files.length&&(n=e.clipboardData.files);if(n.length)return void o({files:n,type:"files"})}var r=e.target||e.srcElement;setTimeout(function(){if(r.innerHTML){Te(r).find("img").each(function(e,t){t.src.match(/^webkit-fake-url:\/\//)&&Te(t).remove()});var e=r.innerHTML.replace(/<br[^>]*>/gi," "),t=e.match(/<[^>]+>/)?"html":"text";r.innerHTML="",o({files:[e],type:t})}},1)},s=Te('<div class="elfinder-upload-dialog-wrapper"/>').append(n("multiple","selectForUpload")),p.UA.Mobile||void 0===(h=document.createElement("input")).webkitdirectory&&void 0===h.directory||s.append(n("multiple webkitdirectory directory","selectFolder")),v.dirs&&(v.hash===f||Te("#"+p.navHash2Id(v.hash)).hasClass("elfinder-subtree-loaded")?t().appendTo(s):(r=Te('<div class="elfinder-upload-dirselect" title="'+p.i18n("nowLoading")+'"/>').append('<span class="elfinder-button-icon elfinder-button-icon-spinner" />').appendTo(s),p.request({cmd:"tree",target:v.hash}).done(function(){p.one("treedone",function(){r.replaceWith(t()),l.elfinderdialog("tabstopsInit")})}).fail(function(){r.remove()}))),p.dragUpload?Te('<div class="ui-corner-all elfinder-upload-dropbox elfinder-tabstop" contenteditable="true" data-ph="'+p.i18n("dropPasteFiles")+'"></div>').on("paste",function(e){a(e)}).on("mousedown click",function(){Te(this).focus()}).on("focus",function(){this.innerHTML=""}).on("mouseover",function(){Te(this).addClass(y)}).on("mouseout",function(){Te(this).removeClass(y)}).on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),Te(this).addClass(y)}).on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),Te(this).removeClass(y)}).on("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy",Te(this).addClass(y)}).on("drop",function(e){s.elfinderdialog("close"),m&&(e.originalEvent._target=m[0]),i(e.originalEvent)}).prependTo(s).after('<div class="elfinder-upload-dialog-or">'+p.i18n("or")+"</div>")[0]:Te('<div class="ui-corner-all elfinder-upload-dropbox" contenteditable="true">'+p.i18n("dropFilesBrowser")+"</div>").on("paste drop",function(e){a(e)}).on("mousedown click",function(){Te(this).focus()}).on("focus",function(){this.innerHTML=""}).on("dragenter mouseover",function(){Te(this).addClass(y)}).on("dragleave mouseout",function(){Te(this).removeClass(y)}).prependTo(s).after('<div class="elfinder-upload-dialog-or">'+p.i18n("or")+"</div>")[0],l=p.dialog(s,{title:this.title+'<span class="elfinder-upload-target">'+(v?" - "+p.escape(v.i18||v.name):"")+"</span>",modal:!0,resizable:!1,destroyOnClose:!0})),b}},ze.prototype.commands.view=function(){var n=this.fm;this.value=n.viewType,this.alwaysEnabled=!0,this.updateOnSelect=!1,this.options={ui:"viewbutton"},this.getstate=function(){return 0},this.exec=function(){var e=this,t=n.storage("view","list"==this.value?"icons":"list");return n.lazy(function(){n.viewchange(),e.update(void 0,t),this.resolve()})}},ze});
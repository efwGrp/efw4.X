/*!
 * elFinder - file manager for web
 * Version 2.1.20 (2017-01-11)
 * http://elfinder.org
 * 
 * Copyright 2009-2017, Studio 42
 * Licensed under a 3-clauses BSD license
 */
/*
 * Efw does not support commands:
 * search,resize,places,quicklook,netmount,netunmount,help,extract,chmod,archive
 * Efw Changed download upload send and so on.
 * Efw Adds setReadOnly setHome setHeight setWidth funtions to elfinder object.
 * minimized by https://jscompress.com/
 */
!function(e,t){if("function"==typeof define&&define.amd)define(["jquery","jquery-ui"],t);else if("undefined"!=typeof exports){var n,i;try{n=require("jquery"),i=require("jquery-ui")}catch(e){}module.exports=t(n)}else t(e.jQuery,e.jQuery.ui,!0)}(this,function(Ce,e,t){var a,r,o,s,l,d,n,i,c,u,h,ye=function(u,e){function k(e){var t,n,a,i,r,o,s,l={},d={};2.1<=j.api?(j.commandMap=e.options.uiCmdMap&&Object.keys(e.options.uiCmdMap).length?e.options.uiCmdMap:{},de!==JSON.stringify(j.commandMap)&&(de=JSON.stringify(j.commandMap),Object.keys(j.commandMap).length&&((n=j.getUI("contextmenu")).data("cmdMaps")||n.data("cmdMaps",{}),(t=e.cwd?e.cwd.volumeid:null)&&!n.data("cmdMaps")[t]&&(n.data("cmdMaps")[t]=j.commandMap)))):j.options.sync=0,e.init?J={}:(s=Y,a="elfinder-subtree-loaded "+j.res("class","navexpand"),j.res("class","navcollapse"),i=Object.keys(J),r=function(e,t){if(!J[t])return!0;var n="directory"===J[t].mime,i=J[t].phash;(!n||l[i]||!d[i]&&Ce("#"+j.navHash2Id(J[t].hash)).is(":hidden")&&100<Ce("#"+j.navHash2Id(i)).next(".elfinder-navbar-subtree").children().length)&&(n||i!==Y)&&-1===Ce.inArray(t,ee)?(n&&!l[i]&&(l[i]=!0,Ce("#"+j.navHash2Id(i)).removeClass(a).next(".elfinder-navbar-subtree").empty()),delete J[t]):n&&(d[i]=!0)},o=function(){i.length&&(Ce.each(i.splice(0,100),r),i.length&&setTimeout(o,20))},j.trigger("filesgc").one("filesgc",function(){i=[]}),j.one("opendone",function(){s!==Y&&(u.data("lazycnt")?j.one("lazydone",o):o())})),j.sorters=[],Y=e.cwd.hash,ce(e.files),J[Y]||ce([e.cwd]),j.lastDir(Y),j.autoSync()}var s,t,n,i,a,r,o,l,d,c,h,p,f,m,g,v,b,y,w,x,C,T,z,O,I,S,D,A,E,M,U,F,P,H,j=this,u=Ce(u),_=Ce("<div></div>").append(u.contents()),R=u.attr("style"),N=u.attr("id")||"",q="elfinder-"+(N||Math.random().toString().substr(2,7)),L="mousedown."+q,W="keydown."+q,K="keypress."+q,B=!0,X=!0,Y="",$={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:!0,uploadOverwrite:!0,uploadMaxSize:0,jpgQuality:100,tmbCrop:!1,tmb:!1},J={},V=[],G={},Q={},Z=[],ee=[],te=[],ne=[],ie=new j.command(j),ae="auto",re=400,oe="./sounds/",se=Ce(document.createElement("audio")).hide().appendTo("body")[0],le=0,de="",ce=function(e){for(var t,n={name:!0,perm:!0,date:!0,size:!0,kind:!0},i=0===j.sorters.length,a=e.length,r=0;r<a;r++)(t=e[r]).name&&t.hash&&t.mime&&(i&&t.phash===Y&&(Ce.each(j.sortRules,function(e){(n[e]||void 0!==t[e]||"mode"===e&&void 0!==t.perm)&&j.sorters.push(e)}),i=!1),t.isroot&&t.phash&&(j.leafRoots[t.phash]?-1===Ce.inArray(t.hash,j.leafRoots[t.phash])&&j.leafRoots[t.phash].push(t.hash):j.leafRoots[t.phash]=[t.hash],J[t.phash]&&(J[t.phash].dirs||(J[t.phash].dirs=1),t.ts&&(J[t.phash].ts||0)<t.ts&&(J[t.phash].ts=t.ts))),J[t.hash]=t)},ue=new Date,he=window.parent!==window,pe=function(){var n,e;if(he)try{(e=Ce("iframe",window.parent.document)).length&&Ce.each(e,function(e,t){if(t.contentWindow===window)return n=Ce(t),!1})}catch(e){}return n}();function fe(e){var t;e.target===window&&e.data&&e.data.elm&&(t=e.data.elm,f&&clearTimeout(f),f=setTimeout(function(){t.trigger("resize",{maximize:"on"})},100))}return this.api=null,this.newAPI=!1,this.oldAPI=!1,this.netDrivers=[],this.options=Ce.extend(!0,{},this._options,e||{}),this.options.cssAutoLoad&&(t=this,(o=Ce('head > script[src$="js/elfinder.min.js"],script[src$="js/elfinder.full.js"]:first')).length?(n=Ce("<style>.elfinder{visibility:hidden;overflow:hidden}</style>"),Ce("head").append(n),o=o.attr("src").replace(/js\/[^\/]+$/,""),t.loadCss([o+"css/elfinder.min.css",o+"css/theme.css"]),Ce.isArray(t.options.cssAutoLoad)&&t.loadCss(t.options.cssAutoLoad),a=1e3,i=setInterval(function(){0<--a&&"hidden"!==u.css("visibility")&&(clearInterval(i),n.remove(),t.trigger("cssloaded"))},10)):t.options.cssAutoLoad=!1),this.optionProperties=["icon","csscls","tmbUrl","uiCmdMap","netkey"],e.ui&&(this.options.ui=e.ui),e.commands&&(this.options.commands=e.commands),e.uiOptions&&e.uiOptions.toolbar&&(this.options.uiOptions.toolbar=e.uiOptions.toolbar),e.uiOptions&&e.uiOptions.cwd&&e.uiOptions.cwd.listView&&e.uiOptions.cwd.listView.columns&&(this.options.uiOptions.cwd.listView.columns=e.uiOptions.cwd.listView.columns),e.uiOptions&&e.uiOptions.cwd&&e.uiOptions.cwd.listView&&e.uiOptions.cwd.listView.columnsCustomName&&(this.options.uiOptions.cwd.listView.columnsCustomName=e.uiOptions.cwd.listView.columnsCustomName),he||this.options.enableAlways||2!==Ce("body").children().length||(this.options.enableAlways=!0),this.isCORS=!1,(o=document.createElement("a")).href=e.url,e.urlUpload&&e.urlUpload!==e.url&&((r=document.createElement("a")).href=e.urlUpload),(window.location.host!==o.host||r&&window.location.host!==r.host)&&(j.isCORS=!0,Ce.isPlainObject(j.options.customHeaders)||(j.options.customHeaders={}),Ce.isPlainObject(j.options.xhrFields)||(j.options.xhrFields={}),j.options.requestType="post",j.options.customHeaders["X-Requested-With"]="XMLHttpRequest",j.options.xhrFields.withCredentials=!0),Ce.extend(this.options.contextmenu,e.contextmenu),this.requestType=/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get",this.customData=Ce.isPlainObject(this.options.customData)?this.options.customData:{},this.customHeaders=Ce.isPlainObject(this.options.customHeaders)?this.options.customHeaders:{},this.xhrFields=Ce.isPlainObject(this.options.xhrFields)?this.options.xhrFields:{},this.abortCmdsOnOpen=this.options.abortCmdsOnOpen||["tmb"],this.id=N,this.navPrefix="nav"+(ye.prototype.uniqueid||"")+"-",this.cwdPrefix=ye.prototype.uniqueid?"cwd"+ye.prototype.uniqueid+"-":"",++ye.prototype.uniqueid,this.uploadURL=e.urlUpload||e.url,this.namespace=q,this.lang=this.i18[this.options.lang]&&this.i18[this.options.lang].messages?this.options.lang:"en",e="en"==this.lang?this.i18.en:Ce.extend(!0,{},this.i18.en,this.i18[this.lang]),this.direction=e.direction,this.messages=e.messages,this.dateFormat=this.options.dateFormat||e.dateFormat,this.fancyFormat=this.options.fancyDateFormat||e.fancyDateFormat,this.today=new Date(ue.getFullYear(),ue.getMonth(),ue.getDate()).getTime()/1e3,this.yesterday=this.today-86400,ue=this.options.UTCDate?"UTC":"",this.getHours="get"+ue+"Hours",this.getMinutes="get"+ue+"Minutes",this.getSeconds="get"+ue+"Seconds",this.getDate="get"+ue+"Date",this.getDay="get"+ue+"Day",this.getMonth="get"+ue+"Month",this.getFullYear="get"+ue+"FullYear",this.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+("rtl"==this.direction?"rtl":"ltr")+(this.UA.Touch?" elfinder-touch"+(this.options.resizable?" touch-punch":""):"")+(this.UA.Mobile?" elfinder-mobile":"")+" "+this.options.cssClass,this.zIndex,this.searchStatus={state:0,query:"",target:"",mime:"",mixed:!1,ininc:!1},this.storage=function(){try{return"localStorage"in window&&null!==window.localStorage?(j.UA.Safari&&(window.localStorage.setItem("elfstoragecheck",1),window.localStorage.removeItem("elfstoragecheck")),j.localStorage):j.cookie}catch(e){return j.cookie}}(),this.viewType=this.storage("view")||this.options.defaultView||"icons",this.sortType=this.storage("sortType")||this.options.sortType||"name",this.sortOrder=this.storage("sortOrder")||this.options.sortOrder||"asc",this.sortStickFolders=this.storage("sortStickFolders"),null===this.sortStickFolders?this.sortStickFolders=!!this.options.sortStickFolders:this.sortStickFolders=!!this.sortStickFolders,this.sortAlsoTreeview=this.storage("sortAlsoTreeview"),null===this.sortAlsoTreeview?this.sortAlsoTreeview=!!this.options.sortAlsoTreeview:this.sortAlsoTreeview=!!this.sortAlsoTreeview,this.sortRules=Ce.extend(!0,{},this._sortRules,this.options.sortRules),Ce.each(this.sortRules,function(e,t){"function"!=typeof t&&delete j.sortRules[e]}),this.compare=Ce.proxy(this.compare,this),this.notifyDelay=0<this.options.notifyDelay?parseInt(this.options.notifyDelay):500,this.draggingUiHelper=null,p=W+"draggable keyup."+q+"draggable",j.draggable={appendTo:u,addClasses:!1,distance:4,revert:!0,refreshPositions:!1,cursor:"crosshair",cursorAt:{left:50,top:47},scroll:!1,start:function(e,t){var n,i,a=t.helper,r=Ce.map(a.data("files")||[],function(e){return e||null}),o=!1;for(h=u.attr("style"),u.width(u.width()).height(u.height()),l="ltr"===j.direction,d=j.getUI("workzone").data("rectangle"),c=d.top+d.height,j.draggingUiHelper=a,n=r.length;n--;)if(i=r[n],J[i].locked){o=!0,a.data("locked",!0);break}o||j.trigger("lockfiles",{files:r}),a.data("autoScrTm",setInterval(function(){a.data("autoScr")&&j.autoScroll[a.data("autoScr")](a.data("autoScrVal"))},50))},drag:function(e,t){var n=t.helper;(t=d.top>e.pageY)||c<e.pageY?(d.cwdEdge>e.pageX?n.data("autoScr",(l?"navbar":"cwd")+(t?"Up":"Down")):n.data("autoScr",(l?"cwd":"navbar")+(t?"Up":"Down")),n.data("autoScrVal",Math.pow(t?d.top-e.pageY:e.pageY-c,1.3))):n.data("autoScr")&&n.data("refreshPositions",1).data("autoScr",null),n.data("refreshPositions")&&Ce(this).elfUiWidgetInstance("draggable")&&(0<n.data("refreshPositions")?(Ce(this).draggable("option",{refreshPositions:!0,elfRefresh:!0}),n.data("refreshPositions",-1)):(Ce(this).draggable("option",{refreshPositions:!1,elfRefresh:!1}),n.data("refreshPositions",null)))},stop:function(e,t){var n=t.helper;Ce(document).off(p),Ce(this).elfUiWidgetInstance("draggable")&&Ce(this).draggable("option",{refreshPositions:!1}),j.draggingUiHelper=null,j.trigger("focus").trigger("dragstop"),n.data("droped")||(t=Ce.map(n.data("files")||[],function(e){return e||null}),j.trigger("unlockfiles",{files:t}),j.trigger("selectfiles",{files:t})),j.enable(),u.attr("style",h),n.data("autoScrTm")&&clearInterval(n.data("autoScrTm"))},helper:function(e,t){function n(e){var t=e.mime,e=j.tmb(e),t='<div class="elfinder-cwd-icon '+j.mime2class(t)+' ui-corner-all"></div>';return e&&(t=Ce(t).addClass(e.className).css("background-image","url('"+e.url+"')").get(0).outerHTML),t}var i,a,r=this.id?Ce(this):Ce(this).parents("[id]:first"),o=Ce('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-status"></span></div>');return j.draggingUiHelper&&j.draggingUiHelper.stop(!0,!0),j.trigger("dragstart",{target:r[0],originalEvent:e}),i=r.hasClass(j.res("class","cwdfile"))?j.selected():[j.navId2Hash(r.attr("id"))],o.append(n(J[i[0]])).data("files",i).data("locked",!1).data("droped",!1).data("namespace",q).data("dropover",0),1<(r=i.length)&&o.append(n(J[i[r-1]])+'<span class="elfinder-drag-num">'+r+"</span>"),Ce(document).on(p,function(e){e=e.shiftKey||e.ctrlKey||e.metaKey;a!==e&&(a=e,o.is(":visible")&&o.data("dropover")&&!o.data("droped")&&(o.toggleClass("elfinder-drag-helper-plus",!!o.data("locked")||a),j.trigger(a?"unlockfiles":"lockfiles",{files:i,helper:o})))}),o}},this.droppable={greedy:!0,tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file,.elfinder-cwd-filename",hoverClass:this.res("class","adroppable"),classes:{"ui-droppable-hover":this.res("class","adroppable")},autoDisable:!0,drop:function(e,t){var n,i,a,r=Ce(this),o=Ce.map(t.helper.data("files")||[],function(e){return e||null}),s=[],l=[],d=[],c=t.helper.hasClass("elfinder-drag-helper-plus");if(void 0===e.button||t.helper.data("namespace")!==q||!j.insideWorkzone(e.pageX,e.pageY))return!1;for(i=r.hasClass(j.res("class","cwdfile"))?j.cwdId2Hash(r.attr("id")):r.hasClass(j.res("class","navdir"))?j.navId2Hash(r.attr("id")):Y,n=o.length;n--;)((a=o[n])!=i&&J[a].phash!=i?s:c&&a!==i&&J[i].write?l:d).push(a);if(d.length)return!1;t.helper.data("droped",!0),l.length&&(t.helper.hide(),j.exec("duplicate",l)),s.length&&(t.helper.hide(),j.clipboard(s,!c),j.exec("paste",i,void 0,i).always(function(){j.clipboard([]),j.trigger("unlockfiles",{files:o})}),j.trigger("drop",{files:o}))}},this.enabled=function(){return B&&this.visible()},this.visible=function(){return u[0].elfinder&&u.is(":visible")},this.isRoot=function(e){return!(!e.isroot&&e.phash)},this.root=function(n,e){var i,t;if(n=n||Y,!e&&(Ce.each(j.roots,function(e,t){if(0===n.indexOf(e))return i=t,!1}),i))return i;for(i=J[n];i&&i.phash&&(e||!i.isroot);)i=J[i.phash];if(i)return i.hash;for(;t in J&&J.hasOwnProperty(t);)if(!(i=J[t]).phash&&"directory"==!i.mime&&i.read)return i.hash;return""},this.cwd=function(){return J[Y]||{}},this.option=function(n,i){var a;return i=i||Y,j.optionsByHashes[i]&&void 0!==j.optionsByHashes[i][n]?j.optionsByHashes[i][n]:Y!==i?(a="",Ce.each(j.volOptions,function(e,t){if(0===i.indexOf(e))return a=t[n]||"",!1}),a):$[n]||""},this.getDisabledCmds=function(e){var n=[];return Ce.isArray(e)||(e=[e]),Ce.each(e,function(e,t){t=j.option("disabled",t);t&&Ce.each(t,function(e,t){-1===Ce.inArray(t,n)&&n.push(t)})}),n},this.file=function(e){return e?J[e]:void 0},this.files=function(){return Ce.extend(!0,{},J)},this.parents=function(e){for(var t,n=[];t=this.file(e);)n.unshift(t.hash),e=t.phash;return n},this.path2array=function(e,t){for(var n,i=[];e;){if(!(n=J[e])||!n.hash){i=[];break}i.unshift(t&&n.i18?n.i18:n.name),e=n.isroot?null:n.phash}return i},this.path=function(e,t,n){var i=J[e]&&J[e].path?J[e].path:this.path2array(e,t).join($.separator);if(n&&J[e]){n=Ce.extend({notify:{type:"parents",cnt:1,hideCnt:!0}},n);function a(){j.request({data:{cmd:"parents",target:J[e].phash},notify:s,preventFail:!0}).done(d).fail(function(){o.reject()})}var r,o=Ce.Deferred(),s=n.notify,l=!1,d=function(){j.one("parentsdone",function(){""===(i=j.path(e,t))&&l?(l=!1,a()):(s&&(clearTimeout(r),s.cnt=-parseInt(s.cnt||0),j.notify(s)),o.resolve(i))})};return i?o.resolve(i):(j.ui.tree?(s&&(r=setTimeout(function(){j.notify(s)},j.notifyDelay)),d(l=!0)):a(),o)}return i},this.url=function(e){var t,n=J[e];if(!n||!n.read)return"";if("1"==n.url&&this.request({data:{cmd:"url",target:e},preventFail:!0,options:{async:!1}}).done(function(e){n.url=e.url||""}).fail(function(){n.url=""}),n.url)return n.url;if(t=0===n.hash.indexOf(j.cwd().volumeid)?$.url:this.option("url",n.hash))return t+Ce.map(this.path2array(e),function(e){return encodeURIComponent(e)}).slice(1).join("/");e=Ce.extend({},this.customData,{cmd:"file",target:n.hash});return this.oldAPI&&(e.cmd="open",e.current=n.phash),this.options.url+(-1===this.options.url.indexOf("?")?"?":"&")+Ce.param(e,!0)},this.openUrl=function(e,t){var n=J[e],i="";if(!n||!n.read)return"";if(!t)if(n.url){if(1!=n.url)return n.url}else if($.url&&0===n.hash.indexOf(j.cwd().volumeid))return $.url+Ce.map(this.path2array(e),function(e){return encodeURIComponent(e)}).slice(1).join("/");return i=(i=this.options.url)+(-1===i.indexOf("?")?"?":"&")+(this.oldAPI?"cmd=open&current="+n.phash:"cmd=file")+"&target="+n.hash,t&&(i+="&download=1"),Ce.each(this.options.customData,function(e,t){i+="&"+encodeURIComponent(e)+"="+encodeURIComponent(t)}),i},this.tmb=function(e){var t,n="elfinder-cwd-bgurl",i="";return!(!Ce.isPlainObject(e)||((j.searchStatus.state&&0!==e.hash.indexOf(j.cwd().volumeid)?(t=j.option("tmbUrl",e.hash),j.option("tmbCrop",e.hash)):(t=$.tmbUrl,$.tmbCrop))&&(n+=" elfinder-cwd-bgurl-crop"),"self"===t&&0===e.mime.indexOf("image/")?(i=j.openUrl(e.hash),n+=" elfinder-cwd-bgself"):(j.oldAPI||t)&&e&&e.tmb&&1!=e.tmb&&(i=t+e.tmb),!i))&&{url:i,className:n}},this.selected=function(){return V.slice(0)},this.selectedFiles=function(){return Ce.map(V,function(e){return J[e]?Ce.extend({},J[e]):null})},this.fileByName=function(e,t){for(var n in J)if(J.hasOwnProperty(n)&&J[n].phash==t&&J[n].name==e)return J[n]},this.validResponse=function(e,t){return t.error||this.rules[this.rules[e]?e:"defaults"](t)},this.returnBytes=function(e){var t;return isNaN(e)?(t=(e=(e=e||"").replace(/b$/i,"")).charAt(e.length-1).toLowerCase(),e=e.replace(/[tgmk]$/i,""),"t"==t?e=1024*e*1024*1024*1024:"g"==t?e=1024*e*1024*1024:"m"==t?e=1024*e*1024:"k"==t&&(e*=1024),e=isNaN(e)?0:parseInt(e)):(e=parseInt(e))<1&&(e=0),e},this.request=function(e){function t(e){e.warning&&s.error(e.warning),h&&k(e),s.lazy(function(){e.removed&&e.removed.length&&s.remove(e),e.added&&e.added.length&&s.add(e),e.changed&&e.changed.length&&s.change(e)}).then(function(){return s.lazy(function(){s.trigger(u,e)})}).then(function(){return s.lazy(function(){s.trigger(u+"done")})}).then(function(){e.sync&&s.sync()})}function n(e,t){var n,i;switch(t){case"abort":n=e.quiet?"":["errConnect","errAbort"];break;case"timeout":n=["errConnect","errTimeout"];break;case"parsererror":n=["errResponse","errDataNotJSON"],e.responseText&&(s.debug("backend-debug",{debug:{phpErrors:[e.responseText]}}),Y||e.responseText&&n.push(e.responseText));break;default:if(e.responseText)try{(i=JSON.parse(e.responseText))&&i.error&&(n=i.error)}catch(e){}if(!n)if(403==e.status)n=["errConnect","errAccess","HTTP error "+e.status];else if(404==e.status)n=["errConnect","errNotFound","HTTP error "+e.status];else{if(414==e.status&&"get"===x.type)return x.type="post",void(d.xhr=e=s.transport.send(x).fail(n).done(C));n=e.quiet?"":["errConnect","HTTP error "+e.status]}}s.trigger(u+"done"),d.reject(n,e,t)}function i(e){if(s.trigger(u+"done"),"autosync"==e.type){if("stop"!=e.data.action)return}else if(!("unload"==e.type||"destroy"==e.type||"openxhrabort"==e.type||e.data.added&&e.data.added.length))return;"pending"==r.state()&&(r.quiet=!0,r.abort(),"unload"!=e.type&&"destroy"!=e.type&&s.autoSync())}var a,r,o,s=this,l=this.options,d=Ce.Deferred(),c=Ce.extend({},l.customData,{mimes:l.onlyMimes},e.data||e),u=c.cmd,h="open"===u,p=!(e.preventDefault||e.preventFail),f=!(e.preventDefault||e.preventDone),m=Ce.extend({},e.notify),g=!!e.cancel,v=!!e.raw,b=e.syncOnFail,y=!!e.lazy,w=e.prepare,x=Ce.extend({url:l.url,async:!0,type:this.requestType,dataType:"json",cache:!1,contentType:"application/json;charset=UTF-8",data:JSON.stringify({eventId:"elfinder_cmds",lang:efw.lang,params:c}),headers:this.customHeaders,xhrFields:this.xhrFields},e.options||{}),C=function(i){if(s.currentReqCmd=u,v)return i&&i.debug&&s.debug("backend-debug",i),d.resolve(i);if(!i)return d.reject(["errResponse","errDataEmpty"],r,i);if(i.actions)EfwClient.prototype._showActions(i.actions);else{if(!Ce.isPlainObject(i))return d.reject(["errResponse","errDataNotJSON"],r,i);if(i.error)return d.reject(i.error,r,i);if(!s.validResponse(u,i))return d.reject("errResponse",r,i);function e(){function e(n){s.leafRoots[c.target]&&i[n]&&Ce.each(s.leafRoots[c.target],function(e,t){(t=s.file(t))&&i[n].push(t)})}h?e("files"):"tree"===u&&e("tree"),i=s.normalize(i),s.api||(s.api=i.api||1,"2.0"==s.api&&void 0!==i.options.uploadMaxSize&&(s.api="2.1"),s.newAPI=2<=s.api,s.oldAPI=!s.newAPI),i.options&&($=Ce.extend({},$,i.options)),i.netDrivers&&(s.netDrivers=i.netDrivers),i.maxTargets&&(s.maxTargets=i.maxTargets),h&&c.init&&(s.uplMaxSize=s.returnBytes(i.uplMaxSize),s.uplMaxFile=i.uplMaxFile?parseInt(i.uplMaxFile):20),"function"==typeof w&&w(i),d.resolve(i),i.debug&&s.debug("backend-debug",i)}y?s.lazy(e):e()}},l=function(){if(d.fail(function(e,t,n){s.trigger(u+"fail",n),e&&(p?s.error(e):s.debug("error",s.i18n(e))),b&&s.sync()}),!u)return b=!1,d.reject("errCmdReq");if(s.maxTargets&&c.targets&&c.targets.length>s.maxTargets)return b=!1,d.reject(["errMaxTargets",s.maxTargets]);if(f&&d.done(t),m.type&&m.cnt&&(g&&(m.cancel=d),a=setTimeout(function(){s.notify(m),d.always(function(){m.cnt=-(parseInt(m.cnt)||0),s.notify(m)})},s.notifyDelay),d.always(function(){clearTimeout(a)})),h){for(;o=te.pop();)"pending"==o.state()&&(o.quiet=!0,o.abort());if(Y!==c.target)for(;o=ne.pop();)"pending"==o.state()&&(o.quiet=!0,o.abort())}return-1!==Ce.inArray(u,(s.cmdsToAdd+" autosync").split(" "))&&("autosync"!==u&&(s.autoSync("stop"),d.always(function(){s.autoSync()})),s.trigger("openxhrabort")),delete x.preventFail,d.xhr=r=s.transport.send(x).fail(n).done(C),h||c.compare&&"info"===u?(te.unshift(r),c.compare&&s.bind(s.cmdsToAdd+" autosync openxhrabort",i),d.always(function(){var e=Ce.inArray(r,te);c.compare&&s.unbind(s.cmdsToAdd+" autosync openxhrabort",i),-1!==e&&te.splice(e,1)})):-1!==Ce.inArray(u,s.abortCmdsOnOpen)&&(ne.unshift(r),d.always(function(){var e=Ce.inArray(r,ne);-1!==e&&ne.splice(e,1)})),s.bind("unload destroy",i),d.always(function(){s.unbind("unload destroy",i)}),d},e={opts:e,result:!0};return s.trigger("request."+u,e,!0),e.result?"object"==typeof e.result&&e.result.promise?(e.result.done(l).fail(function(){s.trigger(u+"done"),d.reject()}),d):l():(s.trigger(u+"done"),d.reject())},this.diff=function(e,n,i){var a={},r=[],o=[],s=[];return Ce.each(e,function(e,t){a[t.hash]=t}),Ce.each(J,function(e,t){a[e]||n&&t.phash!==n||o.push(e)}),Ce.each(a,function(e,t){var n=J[e];n?Ce.each(t,function(e){if((!i||-1===Ce.inArray(e,i))&&t[e]!==n[e])return s.push(t),!1}):r.push(t)}),Ce.each(o,function(e,t){var n=J[t],t=n.phash;t&&"directory"==n.mime&&-1===Ce.inArray(t,o)&&a[t]&&!function(e){for(var t=s.length;t--;)if(s[t].hash==e)return!0}(t)&&s.push(a[t])}),{added:r,removed:o,changed:s}},this.sync=function(r,n){this.autoSync("stop");var i,a,o,s=this,l=(i="",o=a=0,r&&n&&Ce.each(J,function(e,t){t.phash&&t.phash===r&&(++a,o=Math.max(o,t.ts)),i=a+":"+o}),i),d=Ce.Deferred().done(function(){s.trigger("sync")}),c=[this.request({data:{cmd:"open",reload:1,target:Y,tree:!r&&this.ui.tree?1:0,compare:l},preventDefault:!0})];return r||(Y!==this.root()&&c.push(this.request({data:{cmd:"parents",target:Y},preventDefault:!0})),Ce.each(function(){for(var e,t=[],n=s.file(s.root(Y)),i=n?n.volumeid:null,a=s.cwd().phash;a;)a=(e=s.file(a))?(0!==a.indexOf(i)&&(s.isRoot(e)||t.push({target:a,cmd:"tree"}),t.push({target:a,cmd:"parents"}),i=(n=s.file(s.root(a)))?n.volumeid:null),e.phash):null;return t}(),function(e,t){c.push(s.request({data:{cmd:t.cmd,target:t.target},preventDefault:!0}))})),Ce.when.apply(Ce,c).fail(function(e,t){n&&-1===Ce.inArray("errOpen",e)?d.reject(e&&0!=t.status?e:void 0):(d.reject(e),e&&s.request({data:{cmd:"open",target:s.lastDir("")||s.root(),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}}))}).done(function(e){var t,n,i;if(!e.actions){if(e.cwd.compare&&l===e.cwd.compare)return d.reject();if(t={tree:[]},1<(n=arguments.length))for(i=1;i<n;i++)arguments[i].tree&&arguments[i].tree.length&&t.tree.push.apply(t.tree,arguments[i].tree);s.api<2.1&&(t.tree=(t.tree||[]).push(e.cwd)),e=s.normalize(e),t=s.normalize(t);var a=s.diff(e.files.concat(t&&t.tree?t.tree:[]),r);return a.added.push(e.cwd),a.removed.length&&s.remove(a),a.added.length&&s.add(a),a.changed.length&&s.change(a),d.resolve(a)}}).always(function(){s.autoSync()}),d},this.upload=function(e){return this.transport.upload(e,this)},this.bind=function(e,t){var n;if("function"==typeof t)for(e=(""+e).toLowerCase().split(/\s+/),n=0;n<e.length;n++)void 0===G[e[n]]&&(G[e[n]]=[]),G[e[n]].push(t);return this},this.unbind=function(e,t){var n,i,a;for(e=(""+e).toLowerCase().split(/\s+/),n=0;n<e.length;n++)i=G[e[n]]||[],-1<(a=Ce.inArray(t,i))&&i.splice(a,1);return t=null,this},this.trigger=function(e,t,n){var i,a,r,o="open"===(e=e.toLowerCase()),s=G[e]||[];if(this.debug("event-"+e,t),o&&!n&&(r=JSON.stringify(t)),a=s.length)for(e=Ce.Event(e),n&&(e.data=t),i=0;i<a;i++)if(s[i]){s[i].length&&(n||(e.data=o?JSON.parse(r):Ce.extend(!0,{},t)));try{if(!1===s[i](e,this)||e.isDefaultPrevented()){this.debug("event-stoped",e.type);break}}catch(e){window.console&&window.console.log&&window.console.log(e)}}return this},this.getListeners=function(e){return e?G[e.toLowerCase()]:G},this.shortcut=function(e){var t,n,i,a,r;if(this.options.allowShortcuts&&e.pattern&&Ce.isFunction(e.callback))for(t=e.pattern.toUpperCase().split(/\s+/),a=0;a<t.length;a++)(i=1==(i=(r=(n=t[a]).split("+")).pop()).length?0<i?i:i.charCodeAt(0):0<i?i:Ce.ui.keyCode[i])&&!Q[n]&&(Q[n]={keyCode:i,altKey:-1!=Ce.inArray("ALT",r),ctrlKey:-1!=Ce.inArray("CTRL",r),shiftKey:-1!=Ce.inArray("SHIFT",r),type:e.type||"keydown",callback:e.callback,description:e.description,pattern:n});return this},this.shortcuts=function(){var n=[];return Ce.each(Q,function(e,t){n.push([t.pattern,j.i18n(t.description)])}),n},this.clipboard=function(e,n){function t(){return Ce.map(Z,function(e){return e.hash})}return void 0!==e&&(Z.length&&this.trigger("unlockfiles",{files:t()}),ee=[],Z=Ce.map(e||[],function(e){var t=J[e];return t?(ee.push(e),{hash:e,phash:t.phash,name:t.name,mime:t.mime,read:t.read,locked:t.locked,cut:!!n}):null}),this.trigger("changeclipboard",{clipboard:Z.slice(0,Z.length)}),n&&this.trigger("lockfiles",{files:t()})),Z.slice(0,Z.length)},this.isCommandEnabled=function(e,t){var n=j.cwd().volumeid||"",i=!t||n&&0===t.indexOf(n)?$.disabled:(i=j.option("disabled",t))||[];return!!this._commands[e]&&-1===Ce.inArray(e,i)},this.exec=function(e,t,n,i){return"open"===e&&((this.searchStatus.state||this.searchStatus.ininc)&&this.trigger("searchend",{noupdate:!0}),this.autoSync("stop")),this._commands[e]&&this.isCommandEnabled(e,i)?this._commands[e].exec(t,n):Ce.Deferred().reject("No such command")},this.dialog=function(e,t){function n(){!i.data("draged")&&i.is(":visible")&&i.elfinderdialog("posInit")}var i=Ce("<div></div>").append(e).appendTo(u).elfinderdialog(t,this),t=i.closest(".ui-dialog");return t.length&&(j.bind("resize",n),t.on("remove",function(){j.unbind("resize",n)})),i},this.toast=function(e){return Ce('<div class="ui-front"></div>').appendTo(this.ui.toast).elfindertoast(e||{},this)},this.getUI=function(e){return this.ui[e]||u},this.getCommand=function(e){return void 0===e?this._commands:this._commands[e]},this.resize=function(e,t){u.css("width",e).height(t).trigger("resize"),this.trigger("resize",{width:u.width(),height:u.height()})},this.restoreSize=function(){this.resize(ae,re)},this.show=function(){u.show(),this.enable().trigger("show")},this.hide=function(){this.options.enableAlways&&(X=B,B=!1),this.disable().trigger("hide"),u.hide()},this.lazy=function(e,t,i){function n(e){var t,n=u.data("lazycnt");e?(t=!u.data("lazyrepaint")&&i.repaint,n?u.data("lazycnt",++n):u.data("lazycnt",1).addClass("elfinder-processing"),t&&u.data("lazyrepaint",!0).css("display")):n&&1<n?u.data("lazycnt",--n):(t=u.data("lazyrepaint"),u.data("lazycnt",0).removeData("lazyrepaint").removeClass("elfinder-processing"),t&&u.css("display"),j.trigger("lazydone"))}var a=Ce.Deferred();return t=t||0,i=i||{},n(!0),setTimeout(function(){a.resolve(e.call(a)),n(!1)},t),a},this.destroy=function(){u&&u[0].elfinder&&(this.options.syncStart=!1,this.autoSync("forcestop"),this.trigger("destroy").disable(),Z=[],V=[],G={},Q={},Ce(window).off("."+q),Ce(document).off("."+q),j.trigger=function(){},u.off(),u.removeData(),u.empty(),u[0].elfinder=null,Ce(se).remove(),u.append(_.contents()).removeClass(this.cssClass).attr("style",R))},this.autoSync=function(e){var o;1e3<=j.options.sync&&(s&&(clearTimeout(s),s=null,j.trigger("autosync",{action:"stop"})),"stop"===e?++le:le=Math.max(0,--le),!le&&"forcestop"!==e&&j.options.syncStart&&(o=function(e){var r;$.syncMinMs&&(e||s)&&(e&&j.trigger("autosync",{action:"start"}),r=Math.max(j.options.sync,$.syncMinMs),s&&clearTimeout(s),s=setTimeout(function(){var n,i=!0,a=Y;$.syncChkAsTs&&(n=J[a].ts)?j.request({data:{cmd:"info",targets:[a],compare:n,reload:1},preventDefault:!0}).done(function(e){var t;i=!0,e.compare&&(t=e.compare)==n&&(i=!1),i?j.sync(a).always(function(){t&&(J[a].ts=t),o()}):o()}).fail(function(e,t){e&&0!=t.status?(j.error(e),-1!==Ce.inArray("errOpen",e)&&j.request({data:{cmd:"open",target:j.lastDir("")||j.root(),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}})):s=setTimeout(function(){o()},r)}):j.sync(Y,!0).always(function(){o()})},r))})(!0))},this.insideWorkzone=function(e,t,n){var i=this.getUI("workzone").data("rectangle");return n=n||1,!(e<i.left+n||e>i.left+i.width+n||t<i.top+n||t>i.top+i.height+n)},this.toFront=function(e){var t=u.children(":last");e=Ce(e),t.get(0)!==e.get(0)&&t.after(e)},this.getMaximizeCss=function(){return{width:"100%",height:"100%",margin:0,padding:0,top:0,left:0,display:"block",position:"fixed",zIndex:Math.max(j.zIndex?j.zIndex+1:0,1e3)}},function(){function i(){var i=0,a=0;Ce.each(u.children(".ui-dialog,.ui-draggable"),function(e,t){var n=Ce(t),t=n.position();t.top<0&&(n.css("top",i),i+=20),t.left<0&&(n.css("left",a),a+=20)})}he&&j.UA.Fullscreen&&(j.UA.Fullscreen=!1,pe&&void 0!==pe.attr("allowfullscreen")&&(j.UA.Fullscreen=!0));var a,t,r,o="elfinder-fullscreen",s="elfinder-fullscreen-native",l=j.UA.Fullscreen?{fullElm:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||null},exitFull:function(){return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():void 0},toFull:function(e){return e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():!!e.msRequestFullscreen&&e.msRequestFullscreen()}}:{fullElm:function(){var e;return u.hasClass(o)?u.get(0):(e=u.find("."+o)).length?e.get(0):null},exitFull:function(){var e;Ce(window).off("resize."+q,c),void 0!==t&&Ce("body").css("overflow",t),t=void 0,a&&(e=a.elm,d(e),Ce(e).trigger("resize",{fullscreen:"off"})),Ce(window).trigger("resize")},toFull:function(e){return t=Ce("body").css("overflow")||"",Ce("body").css("overflow","hidden"),Ce(e).css(j.getMaximizeCss()).addClass(o).trigger("resize",{fullscreen:"on"}),i(),Ce(window).on("resize."+q,c).trigger("resize"),!0}},d=function(e){a&&a.elm==e&&(Ce(e).removeClass(o+" "+s).attr("style",a.style),a=null)},c=function(e){var t;e.target===window&&(r&&clearTimeout(r),r=setTimeout(function(){(t=l.fullElm())&&Ce(t).trigger("resize",{fullscreen:"on"})},100))};Ce(document).on("fullscreenchange."+q+" webkitfullscreenchange."+q+" mozfullscreenchange."+q+" MSFullscreenChange."+q,function(e){var t,n;j.UA.Fullscreen&&(t=l.fullElm(),n=Ce(window),r&&clearTimeout(r),null===t?(n.off("resize."+q,c),a&&(t=a.elm,d(t),Ce(t).trigger("resize",{fullscreen:"off"}))):(Ce(t).addClass(o+" "+s).attr("style","width:100%; height:100%; margin:0; padding:0;").trigger("resize",{fullscreen:"on"}),n.on("resize."+q,c),i()),n.trigger("resize"))}),j.toggleFullscreen=function(e,t){var n=Ce(e).get(0),e=null;if(e=l.fullElm()){if(e==n){if(!0===t)return e}else if(!1===t)return e;return l.exitFull(),null}return!1===t?null:!(a={elm:n,style:Ce(n).attr("style")})!==l.toFull(n)?n:a=null}}(),m="elfinder-maximized",j.toggleMaximize=function(e,t){var n=Ce(e);n.hasClass(m)?!0!==t&&(e=n,Ce(window).off("resize."+q,fe),Ce("body").css("overflow",e.data("bodyOvf")),e.removeClass(m).attr("style",e.data("orgStyle")).removeData("bodyOvf").removeData("orgStyle"),e.trigger("resize",{maximize:"off"})):!1!==t&&((n=n).data("bodyOvf",Ce("body").css("overflow")||"").data("orgStyle",n.attr("style")).addClass(m).css(j.getMaximizeCss()),Ce("body").css("overflow","hidden"),Ce(window).on("resize."+q,{elm:n},fe).trigger("resize"))},Ce.fn.selectable&&Ce.fn.draggable&&Ce.fn.droppable?u.length?this.options.url?(Ce.extend(Ce.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,CONTEXTMENU:93}),this.dragUpload=!1,this.xhrUpload=("undefined"!=typeof XMLHttpRequestUpload||"undefined"!=typeof XMLHttpRequestEventTarget)&&"undefined"!=typeof File&&"undefined"!=typeof FormData,this.transport={},this.transport.send=function(e){return Ce.ajax(e)},this.transport.upload=Ce.proxy(this.uploads.xhr,this),this.dragUpload=!0,this.decodeRawString=Ce.isFunction(this.options.rawStringDecoder)?this.options.rawStringDecoder:function(e){return function(e){for(var t,n=String.fromCharCode,i=0,a=e.length,r="";t=e[i],i<a;i++)r+=t<=127?n(t):t<=223&&194<=t?n((31&t)<<6|63&e[++i]):t<=239&&224<=t?n((15&t)<<12|(63&e[++i])<<6|63&e[++i]):t<=247&&240<=t?n(55296|((7&t)<<8|(63&e[++i])<<2|e[++i]>>>4&3)-64,56320|(15&e[i++])<<6|63&e[i]):n(65533);return r}(function(e){var t,n,i,a=[];for("string"==typeof e&&(e=function(e){for(var t=0,n=e.length,i=[];t<n;t++)i.push(e.charCodeAt(t));return i}(e)),t=0,n=e.length;i=e[t],t<n;t++)55296<=i&&i<=56319?a.push(64+(1023&i)<<10|1023&e[++t]):a.push(i);return a}(e))},this.error=function(){var e=arguments[0],t=arguments[1]||null;return 1==arguments.length&&"function"==typeof e?j.bind("error",e):!0===e?this:j.trigger("error",{error:e,opts:t})},Ce.each(["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","selectfiles","unselectfiles","dragstart","dragstop","search","searchend","viewchange"],function(e,t){j[t]=function(){var e=arguments[0];return 1==arguments.length&&"function"==typeof e?j.bind(t,e):j.trigger(t,Ce.isPlainObject(e)?e:{})}}),this.enable(function(){!B&&j.visible()&&j.ui.overlay.is(":hidden")&&!u.children(".elfinder-dialog").find("."+j.res("class","editing")).length&&(B=!0,document.activeElement&&document.activeElement.blur(),u.removeClass("elfinder-disabled"))}).disable(function(){X=B,B=!1,u.addClass("elfinder-disabled")}).open(function(){V=[]}).select(function(e){var t=0,n=[];V=Ce.map(e.data.selected||e.data.value||[],function(e){return n.length||j.maxTargets&&++t>j.maxTargets?(n.push(e),null):J[e]?e:null}),n.length&&(j.trigger("unselectfiles",{files:n,inselect:!0}),j.toast({mode:"warning",msg:j.i18n(["errMaxTargets",j.maxTargets])}))}).error(function(e){var t={cssClass:"elfinder-dialog-error",title:j.i18n(j.i18n("error")),resizable:!1,destroyOnClose:!0,buttons:{}};t.buttons[j.i18n(j.i18n("btnClose"))]=function(){Ce(this).elfinderdialog("close")},e.data.opts&&Ce.isPlainObject(e.data.opts)&&Ce.extend(t,e.data.opts),j.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"></span>'+j.i18n(e.data.error),t)}).bind("tree parents",function(e){ce(e.data.tree||[])}).bind("tmb",function(e){Ce.each(e.data.images||[],function(e,t){J[e]&&(J[e].tmb=t)})}).add(function(e){ce(e.data.added||[])}).change(function(e){Ce.each(e.data.changed||[],function(e,n){var i=n.hash;J[i]&&Ce.each(["locked","hidden","width","height"],function(e,t){J[i][t]&&!n[t]&&delete J[i][t]}),J[i]=J[i]?Ce.extend(J[i],n):n})}).remove(function(e){var t=e.data.removed||[],n=t.length,i={},a=function(n){var e=J[n];e&&("directory"===e.mime&&(i[n]&&delete j.roots[i[n]],Ce.each(J,function(e,t){t.phash==n&&a(e)})),delete J[n])};for(Ce.each(j.roots,function(e,t){i[t]=e});n--;)a(t[n])}).bind("searchstart",function(e){Ce.extend(j.searchStatus,e.data),j.searchStatus.state=1}).bind("search",function(e){j.searchStatus.state=2,ce(e.data.files||[])}).bind("searchend",function(){j.searchStatus.state=0,j.searchStatus.mixed=!1}),!0===this.options.sound&&this.bind("rm",function(e){var t=se.canPlayType&&se.canPlayType('audio/wav; codecs="1"');t&&""!=t&&"no"!=t&&Ce(se).html('<source src="'+oe+'rm.wav" type="audio/wav">')[0].play()}),Ce.each(this.options.handlers,function(e,t){j.bind(e,t)}),this.history=new this.history(this),this.commands.getfile&&("function"==typeof this.options.getFileCallback?(this.bind("dblclick",function(e){e.preventDefault(),j.exec("getfile").fail(function(){j.exec("open")})}),this.shortcut({pattern:"enter",description:this.i18n("cmdgetfile"),callback:function(){j.exec("getfile").fail(function(){j.exec("mac"==j.OS?"rename":"open")})}}).shortcut({pattern:"ctrl+enter",description:this.i18n("mac"==this.OS?"cmdrename":"cmdopen"),callback:function(){j.exec("mac"==j.OS?"rename":"open")}})):this.options.getFileCallback=null),this.roots={},this.leafRoots={},this._commands={},Ce.isArray(this.options.commands)||(this.options.commands=[]),-1!==Ce.inArray("*",this.options.commands)&&(this.options.commands=Object.keys(this.commands)),Ce.each(this.commands,function(e,t){var n,i=Ce.extend({},t.prototype);if(Ce.isFunction(t)&&!j._commands[e]&&(t.prototype.forceLoad||-1!==Ce.inArray(e,j.options.commands))){if(n=t.prototype.extendsCmd||""){if(!Ce.isFunction(j.commands[n]))return!0;t.prototype=Ce.extend({},ie,new j.commands[n],t.prototype)}else t.prototype=Ce.extend({},ie,t.prototype);j._commands[e]=new t,t.prototype=i,i=j.options.commandsOptions[e]||{},n&&j.options.commandsOptions[n]&&(i=Ce.extend(!0,{},j.options.commandsOptions[n],i)),j._commands[e].setup(e,i),j._commands[e].linkedCmds.length&&Ce.each(j._commands[e].linkedCmds,function(e,t){var n=j.commands[t];Ce.isFunction(n)&&!j._commands[t]&&(n.prototype=ie,j._commands[t]=new n,j._commands[t].setup(t,j.options.commandsOptions[t]||{}))})}}),this.commandMap={},this.volOptions={},this.optionsByHashes={},u.addClass(this.cssClass).on(L,function(){B||j.enable()}),this.ui={workzone:Ce("<div></div>").appendTo(u).elfinderworkzone(this),navbar:Ce("<div></div>").appendTo(u).elfindernavbar(this,this.options.uiOptions.navbar||{}),contextmenu:Ce("<div></div>").appendTo(u).elfindercontextmenu(this),overlay:Ce("<div></div>").appendTo(u).elfinderoverlay({show:function(){j.disable()},hide:function(){X&&j.enable()}}),cwd:Ce("<div></div>").appendTo(u).elfindercwd(this,this.options.uiOptions.cwd||{}),notify:this.dialog("",{cssClass:"elfinder-dialog-notify",position:this.options.notifyDialog.position,absolute:!0,resizable:!1,autoOpen:!1,closeOnEscape:!1,title:"&nbsp;",width:parseInt(this.options.notifyDialog.width)}),statusbar:Ce('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"></div>').hide().appendTo(u),toast:Ce('<div class="elfinder-toast"></div>').appendTo(u),bottomtray:Ce('<div class="elfinder-bottomtray"></div>').appendTo(u)},this.uiAutoHide=[],this.one("open",function(){j.uiAutoHide.length&&setTimeout(function(){j.trigger("uiautohide")},500)}),this.bind("uiautohide",function(){j.uiAutoHide.length&&j.uiAutoHide.shift()()}),Ce.each(this.options.ui||[],function(e,t){var n="elfinder"+t,i=j.options.uiOptions[t]||{};!j.ui[t]&&Ce.fn[n]&&(j.ui[t]=Ce("<"+(i.tag||"div")+"></div>").appendTo(u),j.ui[t][n](j,i))}),(u[0].elfinder=this).options.resizable&&Ce.fn.resizable&&u.resizable({resize:function(e,t){j.resize(t.size.width,t.size.height)},handles:"se",minWidth:300,minHeight:200}),this.options.width&&(ae=this.options.width),this.options.height&&(re=parseInt(this.options.height)),this.options.soundPath&&(oe=this.options.soundPath.replace(/\/+$/,"")+"/"),j.resize(ae,re),Ce(document).on("click."+q,function(e){!B||j.options.enableAlways||Ce(e.target).closest(u).length||j.disable()}).on(W+" "+K,function(n){var e,i=n.keyCode,a=!(!n.ctrlKey&&!n.metaKey);B&&(Ce.each(Q,function(e,t){t.type==n.type&&t.keyCode==i&&t.shiftKey==n.shiftKey&&t.ctrlKey==a&&t.altKey==n.altKey&&(n.preventDefault(),n.stopPropagation(),t.callback(n,j),j.debug("shortcut-exec",e+" : "+t.description))}),i!=Ce.ui.keyCode.TAB||Ce(n.target).is(":input")||n.preventDefault(),"keydown"===n.type&&i==Ce.ui.keyCode.ESCAPE&&(u.find(".ui-widget:visible").length||j.clipboard().length&&j.clipboard([]),Ce.ui.ddmanager&&(e=Ce.ui.ddmanager.current)&&e.helper&&e.cancel(),u.find(".ui-widget.elfinder-button-menu").hide()))}),j.options.useBrowserHistory&&Ce(window).on("popstate."+q,function(e){e=e.originalEvent.state&&e.originalEvent.state.thash;e&&!Ce.isEmptyObject(j.files())&&j.request({data:{cmd:"open",target:e,onhistory:1},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0})}),Ce(window).on("resize."+q,function(e){e.target===this&&(g&&clearTimeout(g),g=setTimeout(function(){j.trigger("resize",{width:u.width(),height:u.height()})},100))}).on("beforeunload."+q,function(e){var t,n;return u.is(":visible")&&(j.ui.notify.children().length&&-1!==Ce.inArray("hasNotifyDialog",j.options.windowCloseConfirm)?t=j.i18n("ntfsmth"):u.find("."+j.res("class","editing")).length&&-1!==Ce.inArray("editingFile",j.options.windowCloseConfirm)?t=j.i18n("editingFile"):(n=Object.keys(j.selected()).length)&&-1!==Ce.inArray("hasSelectedItem",j.options.windowCloseConfirm)?t=j.i18n("hasSelected",""+n):(n=Object.keys(j.clipboard()).length)&&-1!==Ce.inArray("hasClipboardData",j.options.windowCloseConfirm)&&(t=j.i18n("hasClipboard",""+n)),t)?e.returnValue=t:void j.trigger("unload")}),Ce(window).on("message."+q,function(e){var t,n,i=e.originalEvent||null;if(i&&0===j.uploadURL.indexOf(i.origin))try{(n=(t=JSON.parse(i.data)).data||null)&&(n.error?(t.bind&&j.trigger(t.bind+"fail",n),j.error(n.error)):(n.warning&&j.error(n.warning),n.removed&&n.removed.length&&j.remove(n),n.added&&n.added.length&&j.add(n),n.changed&&n.changed.length&&j.change(n),t.bind&&(j.trigger(t.bind,n),j.trigger(t.bind+"done")),n.sync&&j.sync()))}catch(e){j.sync()}}),j.options.enableAlways?(Ce(window).on("focus."+q,function(e){e.target===this&&j.enable()}),he&&Ce(window.top).on("focus."+q,function(){!j.enable()||pe&&!pe.is(":visible")||setTimeout(function(){Ce(window).focus()},10)})):he&&Ce(window).on("blur."+q,function(e){B&&e.target===this&&j.disable()}),v=j.getUI("navbar"),b=j.getUI("cwd").parent(),j.autoScroll={navbarUp:function(e){v.scrollTop(Math.max(0,v.scrollTop()-e))},navbarDown:function(e){v.scrollTop(v.scrollTop()+e)},cwdUp:function(e){b.scrollTop(Math.max(0,b.scrollTop()-e))},cwdDown:function(e){b.scrollTop(b.scrollTop()+e)}},j.dragUpload&&(x="native-drag-enter",C="native-drag-disable",K="class",T=j.res(K,"navdir"),j.res(K,"droppable"),j.res(K,"adroppable"),j.res(K,"navarrow"),z=j.res(K,"adroppable"),O=j.getUI("workzone"),I="ltr"===j.direction,u.on("dragenter",function(e){ge(),me(e)&&(e.preventDefault(),e.stopPropagation(),y=O.data("rectangle"))}).on("dragleave",function(e){ge(),me(e)&&(e.preventDefault(),e.stopPropagation())}).on("dragover",function(n){var i;me(n)?(n.preventDefault(),n.stopPropagation(),n.originalEvent.dataTransfer.dropEffect="none",w=w||setTimeout(function(){var e,t=y.top+y.height;((i=n.pageY<y.top)||n.pageY>t)&&(e=y.cwdEdge>n.pageX?(I?"navbar":"cwd")+(i?"Up":"Down"):(I?"cwd":"navbar")+(i?"Up":"Down"),j.autoScroll[e](Math.pow(i?y.top-n.pageY:n.pageY-t,1.3))),w=null},20)):ge()}).on("drop",function(e){ge(),me(e)&&(e.stopPropagation(),e.preventDefault())}),u.on("dragenter",".native-droppable",function(e){if(e.originalEvent.dataTransfer){var n,t=Ce(e.currentTarget),i=null;if(!(e.currentTarget.id||null)){i=j.cwd(),t.data(C,!1);try{Ce.each(e.originalEvent.dataTransfer.types,function(e,t){"elfinderfrom:"===t.substr(0,13)&&(n=t.substr(13).toLowerCase())})}catch(e){}}i&&(!i.write||n&&n===(window.location.href+i.hash).toLowerCase())?t.data(C,!0):(e.preventDefault(),e.stopPropagation(),t.data(x,!0),t.addClass(z))}}).on("dragleave",".native-droppable",function(e){var t;e.originalEvent.dataTransfer&&(t=Ce(e.currentTarget),e.preventDefault(),e.stopPropagation(),t.data(x)?t.data(x,!1):t.removeClass(z))}).on("dragover",".native-droppable",function(e){var t;e.originalEvent.dataTransfer&&(t=Ce(e.currentTarget),e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect=t.data(C)?"none":"copy",t.data(x,!1))}).on("drop",".native-droppable",function(e){var t;e.originalEvent&&e.originalEvent.dataTransfer&&(t=Ce(e.currentTarget),e.preventDefault(),e.stopPropagation(),t.removeClass(z),N=e.currentTarget.id?t.hasClass(T)?j.navId2Hash(e.currentTarget.id):j.cwdId2Hash(e.currentTarget.id):j.cwd().hash,e.originalEvent._target=N,j.exec("upload",{dropEvt:e.originalEvent,target:N},void 0,N))})),j.UA.Touch&&(P=j.getUI("navbar"),H=j.getUI("toolbar"),u.on("touchstart touchmove touchend",function(e){if("touchend"===e.type)return D=S=!1,void be();var t,n,i,a=e.originalEvent.touches||[{}],r=a[0].pageX||null,o=a[0].pageY||null,s="ltr"===j.direction;null===r||null===o||"touchstart"===e.type&&1<a.length||("touchstart"===e.type?(A=u.offset(),E=u.width(),P&&(S=!1,P.is(":hidden")?(F=F||Math.max(50,E/10),(s?r-A.left:E+A.left-r)<F&&(S=r)):(M=P.width(),t=Math.max.apply(Math,Ce.map(P.children(".elfinder-tree"),function(e){return Ce(e).width()})),t=s?r<A.left+M&&t-P.scrollLeft()-5<=M:r>A.left+E-M&&t+P.scrollLeft()-5<=M,S=!!t&&(F=Math.max(50,E/10),r))),H&&(U=H.height(),o-A.top<(H.is(":hidden")?50:U+30)?(D=o,Ce(document).on("touchmove."+q,ve),setTimeout(function(){be()},500)):D=!1)):(P&&!1!==S&&(n=(s?r<S:S<r)?"navhide":"navshow",t=Math.abs(S-r),("navhide"==n&&.6*M<t||("navhide"==n?M/3:45)<t&&("navshow"==n||(s?r<A.left+20:r>A.left+E-20)))&&(j.getUI("navbar").trigger(n,{handleW:F}),S=!1)),H&&!1!==D&&(n=H.offset().top,Math.abs(D-o)>Math.min(45,U/3)&&("slideDown"==(i=o<D?"slideUp":"slideDown")||o<n+20)&&(H.is("slideDown"==i?":hidden":":visible")&&(H.stop(!0,!0).trigger("toggle",{duration:100,handleH:50}),be()),D=!1))))})),he&&u.on("click",function(e){Ce(window).focus()}),this.options.enableByMouseOver&&u.on("mouseenter",function(e){he&&Ce(window).focus(),j.enabled()||j.enable()}),this.options.cssAutoLoad||this.trigger("cssloaded"),void this.trigger("init").request({data:{cmd:"open",target:j.startDir(),init:1,tree:this.ui.tree?1:0},preventDone:!0,notify:{type:"open",cnt:1,hideCnt:!0},freeze:!0}).fail(function(){j.trigger("fail").disable().lastDir(""),G={},Q={},Ce(document).add(u).off("."+q),j.trigger=function(){}}).done(function(t){var e=u.css("z-index");e&&"auto"!==e&&"inherit"!==e?j.zIndex=e:u.parents().each(function(e,t){t=Ce(t).css("z-index");if("auto"!==t&&"inherit"!==t&&(t=parseInt(t)))return j.zIndex=t,!1}),j.load().debug("api",j.api),u.trigger("resize"),k(t),j.trigger("open",t),he&&j.options.enableAlways&&Ce(window).focus(),t.selectedFolderHash&&j.request({data:{cmd:"open",target:t.selectedFolderHash}}).done(function(e){t.selectedFileHash&&window.setTimeout(function(){Ce("#"+t.selectedFileHash,"#"+j.id).click()},500)})})):alert(this.i18n("errURL")):alert(this.i18n("errNode")):alert(this.i18n("errJqui"));function me(e){return"TEXTAREA"!==e.target.nodeName&&"INPUT"!==e.target.nodeName&&0===Ce(e.target).closest("div.ui-dialog-content").length}function ge(){w&&clearTimeout(w),w=null}function ve(e){e.preventDefault()}function be(){Ce(document).off("touchmove",ve)}};function p(e,t){var n,i;1<e.originalEvent.touches.length||(d(e.currentTarget).hasClass("touch-punch-keep-default")||e.preventDefault(),n=e.originalEvent.changedTouches[0],(i=document.createEvent("MouseEvents")).initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i))}return void 0!==(t=t||!1)&&!t||(window.elFinder=ye),ye.prototype={uniqueid:0,res:function(e,t){return this.resources[e]&&this.resources[e][t]},OS:-1!==navigator.userAgent.indexOf("Mac")?"mac":-1!==navigator.userAgent.indexOf("Win")?"win":"other",UA:(t=!document.uniqueID&&!window.opera&&!window.sidebar&&window.localStorage&&"WebkitAppearance"in document.documentElement.style,{ltIE6:void 0===window.addEventListener&&void 0===document.documentElement.style.maxHeight,ltIE7:void 0===window.addEventListener&&void 0===document.querySelectorAll,ltIE8:void 0===window.addEventListener&&void 0===document.getElementsByClassName,IE:document.uniqueID,Firefox:window.sidebar,Opera:window.opera,Webkit:t,Chrome:t&&window.chrome,Safari:t&&!window.chrome,Mobile:void 0!==window.orientation,Touch:void 0!==window.ontouchstart,iOS:navigator.platform.match(/^iP(?:[ao]d|hone)/),Fullscreen:void 0!==(document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen)}),currentReqCmd:"",i18:{en:{translator:"",language:"English",direction:"ltr",dateFormat:"d.m.Y H:i",fancyDateFormat:"$1 H:i",messages:{}},months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["msJan","msFeb","msMar","msApr","msMay","msJun","msJul","msAug","msSep","msOct","msNov","msDec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},kinds:{unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/msword":"MsWord","application/vnd.ms-word":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"MsWord","application/vnd.ms-word.document.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"MsWord","application/vnd.ms-word.template.macroEnabled.12":"MsWord","application/vnd.ms-excel":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"MsExcel","application/vnd.ms-excel.sheet.macroEnabled.12":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"MsExcel","application/vnd.ms-excel.template.macroEnabled.12":"MsExcel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"MsExcel","application/vnd.ms-excel.addin.macroEnabled.12":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.presentation":"MsPP","application/vnd.ms-powerpoint.presentation.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"MsPP","application/vnd.ms-powerpoint.slideshow.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.template":"MsPP","application/vnd.ms-powerpoint.template.macroEnabled.12":"MsPP","application/vnd.ms-powerpoint.addin.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slide":"MsPP","application/vnd.ms-powerpoint.slide.macroEnabled.12":"MsPP","application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/vnd.oasis.opendocument.text-template":"OO","application/vnd.oasis.opendocument.text-web":"OO","application/vnd.oasis.opendocument.text-master":"OO","application/vnd.oasis.opendocument.graphics":"OO","application/vnd.oasis.opendocument.graphics-template":"OO","application/vnd.oasis.opendocument.presentation":"OO","application/vnd.oasis.opendocument.presentation-template":"OO","application/vnd.oasis.opendocument.spreadsheet":"OO","application/vnd.oasis.opendocument.spreadsheet-template":"OO","application/vnd.oasis.opendocument.chart":"OO","application/vnd.oasis.opendocument.formula":"OO","application/vnd.oasis.opendocument.database":"OO","application/vnd.oasis.opendocument.image":"OO","application/vnd.openofficeorg.extension":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF","application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML","application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/x-xz":"XZ","application/zip":"ZIP","application/x-zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML","text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader","text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","text/x-markdown":"Markdown","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF","image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG","audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash","video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"},rules:{defaults:function(e){return!(!e||e.added&&!Ce.isArray(e.added)||e.removed&&!Ce.isArray(e.removed)||e.changed&&!Ce.isArray(e.changed))},open:function(e){return e&&e.cwd&&e.files&&Ce.isPlainObject(e.cwd)&&Ce.isArray(e.files)},tree:function(e){return e&&e.tree&&Ce.isArray(e.tree)},parents:function(e){return e&&e.tree&&Ce.isArray(e.tree)},tmb:function(e){return e&&e.images&&(Ce.isPlainObject(e.images)||Ce.isArray(e.images))},upload:function(e){return e&&(Ce.isPlainObject(e.added)||Ce.isArray(e.added))},search:function(e){return e&&e.files&&Ce.isArray(e.files)}},commands:{},cmdsToAdd:"archive duplicate extract mkdir mkfile paste rm upload",parseUploadData:function(e){var t;if(!Ce.trim(e))return{error:["errResponse","errDataEmpty"]};try{t=JSON.parse(e)}catch(e){return{error:["errResponse","errDataNotJSON"]}}return this.validResponse("upload",t)?((t=this.normalize(t)).removed=Ce.merge(t.removed||[],Ce.map(t.added||[],function(e){return e.hash})),t):{error:["errResponse"]}},iframeCnt:0,uploads:{xhrUploading:!1,checkExists:function(a,i,r){function o(){for(var e=a.length;-1<--e;)a[e]._remove=!0}var s,e,l,d,c,u,h,p=Ce.Deferred();return 2.1<=r.api&&"object"==typeof a[0]?(l=[],d={},c=[],u=[],h=function(n){var i=n==u.length-1,e={title:r.i18n("cmdupload"),text:["errExists",u[n].name,"confirmRepl"],all:!i,accept:{label:"btnYes",callback:function(e){i||e?p.resolve(l,d):h(++n)}},reject:{label:"btnNo",callback:function(e){var t;if(e)for(t=u.length;n<t--;)a[u[t].i]._remove=!0;else a[u[n].i]._remove=!0;i||e?p.resolve(l,d):h(++n)}},cancel:{label:"btnCancel",callback:function(){o(),p.resolve(l,d)}},buttons:[]};0<r.iframeCnt&&delete e.reject,r.confirm(e)},r.file(i).read?(s=Ce.map(a,function(e,t){return e.name?{i:t,name:e.name}:null}),e=Ce.map(s,function(e){return e.name}),r.request({data:{cmd:"ls",target:i,intersect:e},notify:{type:"preupload",cnt:1,hideCnt:!0},preventFail:!0}).done(function(e){var t,n;e&&(e.error?o():r.options.overwriteUploadConfirm&&!r.UA.iOS&&r.option("uploadOverwrite",i)&&e.list&&(Ce.isArray(e.list)?c=e.list||[]:(t=[],c=Ce.map(e.list,function(e){return"string"==typeof e?e:(t=t.concat(e),null)}),t.length&&(c=c.concat(t)),d=e.list),u=Ce.map(s,function(e){return-1!==Ce.inArray(e.name,c)?e:null}),c.length&&i==r.cwd().hash&&(n=Ce.map(r.files(),function(e){return e.phash==i?e.name:null}),Ce.map(c,function(e){return-1===Ce.inArray(e,n)||null}).length&&r.sync()))),0<u.length?h(0):p.resolve([])}).fail(function(e){o(),p.resolve([]),e&&r.error(e)})):p.resolve([]),p):p.resolve([])},checkFile:function(e,l,o){if(e.checked||"files"==e.type)return e.files;if("data"==e.type){var i=Ce.Deferred(),d=[],c=[],u=0,h=[],p=function(e){for(var t,n,i,a=[],r=l.options.folderUploadExclude[l.OS]||null,o=e.length,s=0;s<o;s++)(i=e[s])&&(i.isFile?(u++,i.file(function(e){r&&e.name.match(r)||(c.push(i.fullPath||""),d.push(e)),u--})):i.isDirectory&&2.1<=l.api&&(u++,h.push(i.fullPath),t=i.createReader(),a=[],(n=function(){t.readEntries(function(e){if(e.length)a=a.concat((e=e,Array.prototype.slice.call(e||[],0))),n();else{for(var t=0;t<a.length;t++)p([a[t]]);u--}},function(){u--})})()))},s=Ce.map(e.files.items,function(e){return e.getAsEntry?e.getAsEntry():e.webkitGetAsEntry()});return 0<s.length?(l.uploads.checkExists(s,o,l).done(function(t,a){var n,r=[];l.options.overwriteUploadConfirm&&!l.UA.iOS&&l.option("uploadOverwrite",o)&&(s=Ce.map(s,function(n){var i,e;return n.isDirectory&&-1!==(e=Ce.inArray(n.name,t))&&(t.splice(e,1),e=l.uniqueName(n.name+l.options.backupSuffix,null,""),Ce.each(a,function(e,t){if(n.name==t)return i=e,!1}),i=i||l.fileByName(n.name,o).hash,l.lockfiles({files:[i]}),e=l.request({data:{cmd:"rename",target:i,name:e},notify:{type:"rename",cnt:1}}).fail(function(e){n._remove=!0,l.sync()}).always(function(){l.unlockfiles({files:[i]})}),r.push(e)),n._remove?null:n})),Ce.when.apply(Ce,r).done(function(){0<s.length?(n=setTimeout(function(){l.notify({type:"readdir",cnt:1,hideCnt:!0})},l.options.notifyDelay),p(s),setTimeout(function e(){0<u?setTimeout(e,10):(n&&clearTimeout(n),l.notify({type:"readdir",cnt:-1}),i.resolve([d,c,t,a,h]))},10)):i.reject()})}),i.promise()):i.reject()}var a=[],r=[],t=e.files[0];if("html"==e.type){var f,e=Ce("<html></html>").append(Ce.parseHTML(t.replace(/ src=/gi," _elfsrc=")));Ce("img[_elfsrc]",e).each(function(){var e,t=Ce(this),n=t.closest("a");n&&n.attr("href")&&n.attr("href").match(/\.(?:jpe?g|gif|bmp|png)/i)&&(e=n.attr("href")),(t=t.attr("_elfsrc"))&&(e?(-1==Ce.inArray(e,a)&&a.push(e),-1==Ce.inArray(t,r)&&r.push(t)):-1==Ce.inArray(t,a)&&a.push(t))}),(f=Ce("a[href]",e)).each(function(){var e,t,n;Ce(this).text()&&(t=Ce(this).attr("href"),(n=document.createElement("a")).href=t,!(e=n).href||1!==f.length&&e.pathname.match(/(?:\.html?|\/[^\/.]*)$/i)||-1==Ce.inArray(e.href,a)&&-1==Ce.inArray(e.href,r)&&a.push(e.href))})}else for(var n,m=/(http[^<>"{}|\\^\[\]`\s]+)/gi;n=m.exec(t);)n=n[1].replace(/&amp;/g,"&"),-1==Ce.inArray(n,a)&&a.push(n);return a},xhr:function(I,S){function D(e){i.children(".elfinder-notify-upload").children(".elfinder-notify-cancel")[e?"show":"hide"]()}function A(e){return e=e||l,setTimeout(function(){n=!0,E.notify({type:"upload",cnt:L,progress:r-o,size:e,cancel:function(){a.trigger("uploadabort"),N.resolve()}}),o=r,I.multiupload?W&&D(!0):D(W&&r<e)},E.options.notifyDelay)}var E=S||this,a=E.getUI(),M=new XMLHttpRequest,U=null,F=I.checked,P=I.isDataType||"data"==I.type,H=I.target||E.cwd().hash,j=I.dropEvt||null,_=-1!=E.option("uploadMaxConn",H),R=Math.min(5,Math.max(1,E.option("uploadMaxConn",H))),t=0,N=Ce.Deferred().fail(function(e){var t;E.uploads.xhrUploading&&(setTimeout(function(){E.sync()},5e3),(t=s.length?(P?s[0]:s)[0]:{})._cid&&(q=new FormData,s=[{_chunkfail:!0}],q.append("chunk",t._chunk),q.append("cid",t._cid),P=!1,m(s))),E.uploads.xhrUploading=!1,s=null,e&&E.error(e)}).done(function(e){M=null,E.uploads.xhrUploading=!1,s=null,e&&(E.currentReqCmd="upload",e.warning&&E.error(e.warning),e.removed&&E.remove(e),e.added&&E.add(e),e.changed&&E.change(e),E.trigger("upload",e),E.trigger("uploaddone"),e.sync&&E.sync(),e.debug&&S.debug("backend-debug",e))}).always(function(){a.off("uploadabort",e),Ce(window).off("unload",e),U&&clearTimeout(U),F&&!I.multiupload&&B()&&E.notify({type:"upload",cnt:-L,progress:0,size:0}),d&&i.children(".elfinder-notify-chunkmerge").length&&E.notify({type:"chunkmerge",cnt:-1})}),q=new FormData,s=I.input?I.input.files:E.uploads.checkFile(I,E,H),L=(I.checked&&P?s[0]:s).length,r=0,o=0,l=0,n=!1,i=E.ui.notify,W=!0,K=!1,B=function(){return n=n||i.children(".elfinder-notify-upload").length},e=function(){K=!0,M&&(M.quiet=!0,M.abort()),B()&&E.notify({type:"upload",cnt:-1*i.children(".elfinder-notify-upload").data("cnt"),progress:0,size:0})},X=I.renames||null,Y=I.hashes||null,d=!1;if(a.one("uploadabort",e),Ce(window).one("unload."+S.namespace,e),d||(o=r),!P&&!L)return N.reject(["errUploadNoFiles"]);M.addEventListener("error",function(){0==M.status?K?N.reject():!P&&I.files&&Ce.map(I.files,function(e){return e.type||e.size!==(E.UA.Safari?1802:0)?null:e}).length?(errors.push("errFolderUpload"),N.reject(["errAbort","errFolderUpload"])):I.input&&Ce.map(I.input.files,function(e){return e.type||e.size!==(E.UA.Safari?1802:0)?null:e}).length?N.reject(["errUploadNoFiles"]):t++<=30?(B()&&o&&E.notify({type:"upload",cnt:0,progress:0,size:o}),M.quiet=!0,M.abort(),o=r=0,setTimeout(function(){K||(M.open("POST",E.uploadURL,!0),M.send(q))},1e4)):(a.trigger("uploadabort"),N.reject(["errAbort","errTimeout"])):(a.trigger("uploadabort"),N.reject("errConnect"))},!1),M.addEventListener("load",function(e){var t=M.status,n=0,i="";if(400<=t?i=500<t?"errResponse":"errConnect":M.responseText||(i=["errResponse","errDataEmpty"]),i){a.trigger("uploadabort");t=(P?s[0]:s)[0];return N.reject(t._cid?null:i)}r=l,B()&&(n=r-o)&&E.notify({type:"upload",cnt:0,progress:n,size:0}),S.request({data:{cmd:"open",target:I.target,saveupload:1,reload:1,tree:1,compare:""}}),N.resolve({})},!1),M.upload.addEventListener("loadstart",function(e){!d&&e.lengthComputable&&(r=e.loaded,t&&(r=0),l=e.total,r=r||parseInt(.05*l),B()&&(E.notify({type:"upload",cnt:0,progress:r-o,size:I.multiupload?0:l}),o=r))},!1),M.upload.addEventListener("progress",function(e){var t;e.lengthComputable&&!d&&M.readyState<2&&(r=e.loaded,!I.checked&&0<r&&!U&&(U=A(M._totalSize-r)),l||(l=e.total,r=r||parseInt(.05*l)),t=r-o,B()&&.05<=t/e.total&&(E.notify({type:"upload",cnt:0,progress:t,size:0}),o=r),!I.multiupload&&l<=r&&D(W=!1))},!1);var c,u,h,p,f,m=function(e,t){var n,i,a,r,o,s,l,d,c,u,h,p,f,m=0,g=1,v=[],b=0,y=L,w=0,x=[],C=(new Date).getTime().toString().substr(-9),k=Math.min((S.uplMaxSize||2097152)-8190,S.options.uploadMaxChunkSize),T=!_&&"",z=function(t,e){var n,i,a,r=[];if(!K){for(;t.length&&r.length<e;)r.push(t.shift());if(i=r.length){a=i;for(var o=0;o<i&&!K;o++)n=P?r[o][0][0]._cid||null:r[o][0]._cid||null,f[n]?p--:S.exec("upload",{type:I.type,isDataType:P,files:r[o],checked:!0,target:H,dropEvt:j,renames:X,hashes:Y,multiupload:!0},void 0,H).fail(function(e){e&&"No such command"===e&&(K=!0,S.error(["errUpload","errPerm"])),n&&(f[n]=!0)}).always(function(e){e&&e.added&&(u=Ce.merge(u,e.added)),p<=++h&&(S.trigger("multiupload",{added:u}),U&&clearTimeout(U),B()&&E.notify({type:"upload",cnt:-L,progress:0,size:0})),t.length?z(t,1):--a<=1&&D(W=!1)})}}(r.length<1||K)&&(K?(U&&clearTimeout(U),n&&(f[n]=!0),N.reject()):(N.resolve(),E.uploads.xhrUploading=!1))},O=function(){E.uploads.xhrUploading?setTimeout(function(){O()},100):(E.uploads.xhrUploading=!0,z(v,R))};if(!F&&(P||"files"==I.type)){for((n=S.option("uploadMaxSize",H))||(n=0),r=0;r<e.length;r++){try{i=(d=e[r]).size,!1===T&&(T="",2.1<=E.api&&("slice"in d?T="slice":"mozSlice"in d?T="mozSlice":"webkitSlice"in d&&(T="webkitSlice")))}catch(e){L--,y--;continue}if(n&&n<i||!T&&S.uplMaxSize&&i>S.uplMaxSize)E.error(E.i18n("errUploadFile",d.name)+" "+E.i18n("errUploadFileSize")),L--,y--;else if(!d.type||E.uploadMimeCheck(d.type,H))if(T&&k<i){for(o=0,s=k,l=-1,y=Math.floor(i/k),a=d.lastModified?Math.round(d.lastModified/1e3):0,w+=i,x[C]=0;o<=i;)(c=d[T](o,s))._chunk=d.name+"."+ ++l+"_"+y+".part",c._cid=C,c._range=o+","+c.size+","+i,c._mtime=a,x[C]++,m&&b++,void 0===v[b]&&(v[b]=[],P&&(v[b][0]=[],v[b][1]=[])),m=k,g=1,P?(v[b][0].push(c),v[b][1].push(t[r])):v[b].push(c),s=(o=s)+k;null==c?(E.error(E.i18n("errUploadFile",d.name)+" "+E.i18n("errUploadFileSize")),L--,y--):(y+=l,m=0,g=1,b++)}else(S.uplMaxSize&&m+i>=S.uplMaxSize||g>S.uplMaxFile)&&(m=0,g=1,b++),void 0===v[b]&&(v[b]=[],P&&(v[b][0]=[],v[b][1]=[])),P?(v[b][0].push(d),v[b][1].push(t[r])):v[b].push(d),m+=i,w+=i,g++;else E.error(E.i18n("errUploadFile",d.name)+" "+E.i18n("errUploadMime")+" ("+E.escape(d.type)+")"),L--,y--}if(0==v.length)return!(I.checked=!0);if(1<v.length)return U=A(w),u=[],h=0,p=v.length,f=[],O(),!0;P?(e=v[0][0],t=v[0][1]):e=v[0]}return F||(S.UA.Safari&&I.files?M._totalSize=w:U=A(w)),F=!0,e.length||N.reject(["errUploadNoFiles"]),M.open("POST",E.uploadURL,!0),S.customHeaders&&Ce.each(S.customHeaders,function(e){M.setRequestHeader(e,this)}),S.xhrFields&&Ce.each(S.xhrFields,function(e){e in M&&(M[e]=this)}),q.append("cmd","upload"),q.append(E.newAPI?"target":"current",H),X&&X.length&&(Ce.each(X,function(e,t){q.append("renames[]",t)}),q.append("suffix",S.options.backupSuffix)),Y&&Ce.each(Y,function(e,t){q.append("hashes["+e+"]",t)}),Ce.each(E.options.customData,function(e,t){q.append(e,t)}),Ce.each(E.options.onlyMimes,function(e,t){q.append("mimes["+e+"]",t)}),Ce.each(e,function(e,t){t._chunkmerged?(q.append("chunk",t._chunkmerged),q.append("upload[]",t._name),q.append("mtime[]",t._mtime)):(t._chunkfail?(q.append("upload[]","chunkfail"),q.append("mimes","chunkfail")):q.append("upload[]",t),t._chunk?(q.append("chunk",t._chunk),q.append("cid",t._cid),q.append("range",t._range),q.append("mtime[]",t._mtime)):q.append("mtime[]",t.lastModified?Math.round(t.lastModified/1e3):0)),S.UA.iOS&&q.append("overwrite",0)}),P&&Ce.each(t,function(e,t){q.append("upload_path[]",t)}),j&&q.append("dropWith",parseInt((j.altKey?"1":"0")+(j.ctrlKey?"1":"0")+(j.metaKey?"1":"0")+(j.shiftKey?"1":"0"),2)),M.send(q),!0};return P?F?m(s[0],s[1]):s.done(function(n){X=[],(L=n[0].length)?n[4]&&n[4].length?S.request({data:{cmd:"mkdir",target:H,dirs:n[4]},notify:{type:"mkdir",cnt:n[4].length}}).fail(function(e){"errCmdParams"===(e=e||["errUnknown"])[0]?R=1:(R=0,N.reject(e))}).done(function(t){t.hashes&&(n[1]=Ce.map(n[1],function(e){return""===(e=e.replace(/\/[^\/]*$/,""))?H:t.hashes[e]}))}).always(function(e){R&&(X=n[2],Y=n[3],m(n[0],n[1]))}):(n[1]=Ce.map(n[1],function(){return H}),X=n[2],Y=n[3],m(n[0],n[1])):N.reject(["errUploadNoFiles"])}).fail(function(){N.reject()}):0<s.length?null==X?(c=[],u=[],h=S.options.folderUploadExclude[S.OS]||null,Ce.each(s,function(e,t){var n=t.webkitRelativePath||t.relativePath||"";if(!n)return!1;h&&t.name.match(h)?(t._remove=!0,n=void 0):(n=n.replace(/\/[^\/]*$/,""))&&-1===Ce.inArray(n,c)&&c.push(n),u.push(n)}),S.getUI().find("div.elfinder-upload-dialog-wrapper").elfinderdialog("close"),X=[],Y={},c.length?(p=Ce.map(c,function(e){return-1===e.indexOf("/")?{name:e}:null}),f=[],S.uploads.checkExists(p,H,S).done(function(n,i){var a,r,o=[];S.options.overwriteUploadConfirm&&!S.UA.iOS&&S.option("uploadOverwrite",H)&&(f=Ce.map(p,function(e){return e._remove?e.name:null}),p=Ce.map(p,function(e){return e._remove?null:e})),f.length&&Ce.each(u.concat(),function(e,t){0===Ce.inArray(t,f)&&(s[e]._remove=!0,delete u[e])}),s=Ce.map(s,function(e){return e._remove?null:e}),u=Ce.map(u,function(e){return void 0===e?null:e}),p.length?(Ce.Deferred(),n.length?Ce.each(n,function(e,t){a=S.uniqueName(t+S.options.backupSuffix,null,""),Ce.each(i,function(e,t){if(n[0]==t)return r=e,!1}),r=r||S.fileByName(n[0],H).hash,S.lockfiles({files:[r]}),o.push(S.request({data:{cmd:"rename",target:r,name:a},notify:{type:"rename",cnt:1}}).fail(function(e){N.reject(e),S.sync()}).always(function(){S.unlockfiles({files:[r]})}))}):o.push(null),Ce.when.apply(Ce,o).done(function(){S.request({data:{cmd:"mkdir",target:H,dirs:c},notify:{type:"mkdir",cnt:c.length}}).fail(function(e){"errCmdParams"===(e=e||["errUnknown"])[0]?R=1:(R=0,N.reject(e))}).done(function(t){t.hashes&&(u=Ce.map(u.concat(),function(e){return""===e?H:t.hashes["/"+e]}))}).always(function(e){R&&(P=!0,m(s,u)||N.reject())})})):N.reject()})):S.uploads.checkExists(s,H,S).done(function(e,t){S.options.overwriteUploadConfirm&&!S.UA.iOS&&S.option("uploadOverwrite",H)&&(X=e,Y=t,s=Ce.map(s,function(e){return e._remove?null:e})),0<(L=s.length)&&m(s)||N.reject()})):m(s)||N.reject():N.reject(),N}},one:function(n,i){var a=this,r=function(e,t){return setTimeout(function(){a.unbind(n,r)},3),i.apply(a.getListeners(e.type),arguments)};return this.bind(n,r)},localStorage:function(t,n){var e,i,a=window.localStorage,r="elfinder-"+t+this.id;if(t=window.location.pathname+"-elfinder-"+t+this.id,null===n)return a.removeItem(t);if(void 0===n&&!(e=a.getItem(t))&&(i=a.getItem(r))&&(n=i,a.removeItem(r)),void 0!==n){"string"!=(r=typeof n)&&"number"!=r&&(n=JSON.stringify(n));try{a.setItem(t,n)}catch(e){try{a.clear(),a.setItem(t,n)}catch(e){self.debug("error",e.toString())}}e=a.getItem(t)}if(e&&("{"===e.substr(0,1)||"["===e.substr(0,1)))try{return JSON.parse(e)}catch(e){}return e},cookie:function(e,t){var n,i,a,r,o;if(e="elfinder-"+e+this.id,void 0!==t)return n=Ce.extend({},this.options.cookie),null===t?(t="",n.expires=-1):"string"!=(o=typeof t)&&"number"!=o&&(t=JSON.stringify(t)),"number"==typeof n.expires&&((o=new Date).setTime(o.getTime()+864e5*n.expires),n.expires=o),document.cookie=e+"="+encodeURIComponent(t)+"; expires="+n.expires.toUTCString()+(n.path?"; path="+n.path:"")+(n.domain?"; domain="+n.domain:"")+(n.secure?"; secure":""),t;if(document.cookie&&""!=document.cookie)for(i=document.cookie.split(";"),e+="=",a=0;a<i.length;a++)if(i[a]=Ce.trim(i[a]),i[a].substring(0,e.length)==e){if("{"===(r=decodeURIComponent(i[a].substring(e.length))).substr(0,1)||"["===r.substr(0,1))try{return JSON.parse(r)}catch(e){}return r}return""},startDir:function(){var e=window.location.hash;return e&&e.match(/^#elf_/)?e.replace(/^#elf_/,""):this.options.startPathHash||this.lastDir()},lastDir:function(e){return this.options.rememberLastDir?this.storage("lastdir",e):""},_node:Ce("<span></span>"),escape:function(e){return this._node.text(e).html().replace(/"/g,"&quot;").replace(/'/g,"&#039;")},normalize:function(e){function t(n){var e,i;return n&&n.hash&&n.name&&n.mime?("application/x-empty"==n.mime&&(n.mime="text/plain"),n.options&&(l.optionsByHashes[n.hash]=n.options),n.phash&&"directory"!==n.mime||(n.volumeid&&(e=n.volumeid,l.isRoot(n)&&(l.volOptions[e]||(l.volOptions[e]={}),i=l.volOptions[e],n.options&&(i=Ce.extend(i,n.options)),n.disabled&&(i.disabled=n.disabled),n.tmbUrl&&(i.tmbUrl=n.tmbUrl),Ce.each(l.optionProperties,function(e,t){i[t]&&(n[t]=i[t])}),l.roots[e]=n.hash),s!==e&&(s=e,o=l.option("i18nFolderName",e))),!n.i18&&l.isRoot(n)&&(a="volume_"+n.name,r=l.i18n(!1,a),a!==r&&(n.i18=r)),o&&!n.i18&&(a="folder_"+n.name,r=l.i18n(!1,a),a!==r&&(n.i18=r)),l.leafRoots[n.hash]&&(n.dirs||(n.dirs=1),Ce.each(l.leafRoots[n.hash],function(){var e=l.file(this);e&&e.ts&&(n.ts||0)<e.ts&&(n.ts=e.ts)}))),n):null}var a,r,o,s,l=this;return e.cwd&&(e.cwd.volumeid&&e.options&&Object.keys(e.options).length&&(l.volOptions[e.cwd.volumeid]=e.options),e.cwd=t(e.cwd)),e.files&&(e.files=Ce.map(e.files,t)),e.tree&&(e.tree=Ce.map(e.tree,t)),e.added&&(e.added=Ce.map(e.added,t)),e.changed&&(e.changed=Ce.map(e.changed,t)),e.api&&(e.init=!0),e.cwd&&e.cwd.options&&e.options&&Ce.extend(e.options,e.cwd.options),e},setSort:function(e,t,n,i){this.storage("sortType",this.sortType=this.sortRules[e]?e:"name"),this.storage("sortOrder",this.sortOrder=/asc|desc/.test(t)?t:"asc"),this.storage("sortStickFolders",(this.sortStickFolders=!!n)?1:""),this.storage("sortAlsoTreeview",(this.sortAlsoTreeview=!!i)?1:""),this.trigger("sortchange")},_sortRules:{name:function(e,t){return ye.prototype.naturalCompare(e.i18||e.name,t.i18||t.name)},size:function(e,t){e=parseInt(e.size)||0,t=parseInt(t.size)||0;return e===t?0:t<e?1:-1},kind:function(e,t){return ye.prototype.naturalCompare(e.mime,t.mime)},date:function(e,t){e=e.ts||e.date,t=t.ts||t.date;return e===t?0:t<e?1:-1},perm:function(e,t){function n(e){return(e.write?2:0)+(e.read?1:0)}e=n(e),t=n(t);return e===t?0:t<e?1:-1},mode:function(e,t){e=e.mode||e.perm||"",t=t.mode||t.perm||"";return ye.prototype.naturalCompare(e,t)},owner:function(e,t){e=e.owner||"",t=t.owner||"";return ye.prototype.naturalCompare(e,t)},group:function(e,t){e=e.group||"",t=t.group||"";return ye.prototype.naturalCompare(e,t)}},sorters:[],naturalCompare:function(e,t){var g=ye.prototype.naturalCompare;return void 0===g.loc&&(g.loc=navigator.userLanguage||navigator.browserLanguage||navigator.language||"en-US"),void 0===g.sort&&(0<"11".localeCompare("2",g.loc,{numeric:!0})?window.Intl&&window.Intl.Collator?g.sort=new Intl.Collator(g.loc,{numeric:!0}).compare:g.sort=function(e,t){return e.localeCompare(t,g.loc,{numeric:!0})}:(g.sort=function(e,t){function n(e){return g.sort.insensitive&&(""+e).toLowerCase()||""+e}var i,a,r,o=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,s=/(^[ ]*|[ ]*$)/g,l=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,d=/^0x[0-9a-f]+$/i,c=/^0/,u=/^[\x01\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e]/,e=n(e).replace(s,"").replace(/^_/,"")||"",s=n(t).replace(s,"").replace(/^_/,"")||"",h=e.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=s.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),e=parseInt(e.match(d))||1!=h.length&&e.match(l)&&Date.parse(e),s=parseInt(s.match(d))||e&&s.match(l)&&Date.parse(s)||null;if(s){if(e<s)return-1;if(s<e)return 1}for(var f=0,m=Math.max(h.length,p.length);f<m;f++){if(i=!(h[f]||"").match(c)&&parseFloat(h[f])||h[f]||0,a=!(p[f]||"").match(c)&&parseFloat(p[f])||p[f]||0,isNaN(i)!==isNaN(a)){if(isNaN(i)&&("string"!=typeof i||!i.match(u)))return 1;if("string"!=typeof a||!a.match(u))return-1}if(0===parseInt(i,10)&&(i=0),0===parseInt(a,10)&&(a=0),typeof i!=typeof a&&(i+="",a+=""),g.sort.insensitive&&"string"==typeof i&&"string"==typeof a&&0!==(r=i.localeCompare(a,g.loc)))return r;if(i<a)return-1;if(a<i)return 1}return 0},g.sort.insensitive=!0)),g.sort(e,t)},compare:function(e,t){var n=this.sortType,i="asc"==this.sortOrder,a=this.sortStickFolders,r=this.sortRules,o=r[n],s="directory"==e.mime,l="directory"==t.mime;if(a){if(s&&!l)return-1;if(!s&&l)return 1}return o=i?o(e,t):o(t,e),"name"!==n&&0===o?o=i?r.name(e,t):r.name(t,e):o},sortFiles:function(e){return e.sort(this.compare)},notify:function(e){function t(){s._esc&&Ce(document).off("keydown",s._esc),s.remove(),o.children().length||o.elfinderdialog("close")}var n,i,a=e.type,r=this.i18n(void 0!==e.msg?e.msg:this.messages["ntf"+a]?"ntf"+a:"ntfsmth"),o=this.ui.notify,s=o.children(".elfinder-notify-"+a),l=s.children("div.elfinder-notify-cancel").children("button"),d=e.cnt,c=void 0!==e.size?parseInt(e.size):null,u=void 0!==e.progress&&0<=e.progress?e.progress:null,h=e.cancel;return a&&(s.length?void 0!==e.msg&&s.children("span.elfinder-notify-msg").html(r):(s=Ce('<div class="elfinder-notify elfinder-notify-{type}"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"></span><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"></span><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"></div></div><div class="elfinder-notify-cancel"></div></div>'.replace(/\{type\}/g,a).replace(/\{msg\}/g,r)).appendTo(o).data("cnt",0),null!=u&&s.data({progress:0,total:0}),h&&(l=Ce('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+this.i18n("btnCancel")+"</span></button>").hover(function(e){Ce(this).toggleClass("ui-state-hover","mouseenter"==e.type)}),s.children("div.elfinder-notify-cancel").append(l))),0<(r=d+parseInt(s.data("cnt")))?(h&&l.length&&(Ce.isFunction(h)||"object"==typeof h&&h.promise)&&(s._esc=function(e){"keydown"==e.type&&e.keyCode!=Ce.ui.keyCode.ESCAPE||(e.preventDefault(),e.stopPropagation(),t(),h.promise?(h.xhr&&(h.xhr.quiet=!0,h.xhr.abort()),h.reject()):h(e))},l.on("click",function(e){s._esc(e)}),Ce(document).on("keydown."+this.namespace,s._esc)),e.hideCnt||s.children(".elfinder-notify-cnt").text("("+r+")"),o.is(":hidden")&&o.elfinderdialog("open",this),s.data("cnt",r),null!=u&&0<=(n=s.data("total"))&&0<=(i=s.data("progress"))&&(n+=null!=c?c:d,i+=u,null==c&&d<0&&(i+=100*d),s.data({progress:i,total:n}),null!=c&&(i*=100,n=Math.max(1,n)),u=parseInt(i/n),s.find(".elfinder-notify-progress").animate({width:(u<100?u:100)+"%"},20))):t()),this},confirm:function(e){var n,i=this,a=!1,r={cssClass:"elfinder-dialog-confirm",modal:!0,resizable:!1,title:this.i18n(e.title||"confirmReq"),buttons:{},close:function(){a||e.cancel.callback(),Ce(this).elfinderdialog("destroy")}},t=this.i18n("apllyAll");return r.buttons[this.i18n(e.accept.label)]=function(){e.accept.callback(!(!n||!n.prop("checked"))),a=!0,Ce(this).elfinderdialog("close")},e.reject&&(r.buttons[this.i18n(e.reject.label)]=function(){e.reject.callback(!(!n||!n.prop("checked"))),a=!0,Ce(this).elfinderdialog("close")}),e.buttons&&0<e.buttons.length&&Ce.each(e.buttons,function(e,t){r.buttons[i.i18n(t.label)]=function(){t.callback(!(!n||!n.prop("checked"))),a=!0,Ce(this).elfinderdialog("close")}}),r.buttons[this.i18n(e.cancel.label)]=function(){Ce(this).elfinderdialog("close")},e.all&&(r.create=function(){var e=Ce('<div class="elfinder-dialog-confirm-applyall"></div>');n=Ce('<input type="checkbox">'),Ce(this).next().find(".ui-dialog-buttonset").prepend(e.append(Ce("<label>"+t+"</label>").prepend(n)))}),e.optionsCallback&&Ce.isFunction(e.optionsCallback)&&e.optionsCallback(r),this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"></span>'+this.i18n(e.text),r)},uniqueName:function(e,t,n){var i,a,r=0,o="";if(e=this.i18n(e),t=t||this.cwd().hash,n=void 0===n?" ":n,(i=e.match(/^(.+)(\.[^.]+)$/))&&(o=i[2],e=i[1]),a=e+o,!this.fileByName(a,t))return a;for(;r<1e4;)if(a=e+n+ ++r+o,!this.fileByName(a,t))return a;return e+Math.random()+o},i18n:function(){function e(e){var t;return 0===e.indexOf("#")&&(t=r.file(e.substr(1)))?t.name:e}var n,t,i,a,r=this,o=this.messages,s=[],l=[],d=0;for(arguments.length&&!1===arguments[0]&&(a=function(e){return e},d=1),n=d;n<arguments.length;n++)if(i=arguments[n],Ce.isArray(i))for(t=0;t<i.length;t++)i[t]instanceof jQuery?s.push(i[t]):void 0!==i[t]&&s.push(e(""+i[t]));else i instanceof jQuery?s.push(i[t]):void 0!==i&&s.push(e(""+i));for(n=0;n<s.length;n++)-1===Ce.inArray(n,l)&&(i="string"==typeof(i=s[n])?(i=o[i]||(a?a(i):r.escape(i))).replace(/\$(\d+)/g,function(e,t){return 0<(t=n+parseInt(t))&&s[t]&&l.push(t),a?a(s[t]):r.escape(s[t])}):i.get(0).outerHTML,s[n]=i);return Ce.map(s,function(e,t){return-1===Ce.inArray(t,l)?e:null}).join("<br>")},mime2class:function(e){var t="elfinder-cwd-icon-";return t+(e=e.split("/"))[0]+("image"!=e[0]&&e[1]?" "+t+e[1].replace(/(\.|\+)/g,"-"):"")},mime2kind:function(e){var t,n="object"==typeof e,i=n?e.mime:e;return n&&e.alias&&"symlink-broken"!=i?t="Alias":this.kinds[i]&&(t=!n||"directory"!==i||e.phash&&!e.isroot?this.kinds[i]:"Root"),t=t||(0===i.indexOf("text")?"Text":0===i.indexOf("image")?"Image":0===i.indexOf("audio")?"Audio":0===i.indexOf("video")?"Video":0===i.indexOf("application")?"App":i),this.messages["kind"+t]?this.i18n("kind"+t):i},formatDate:function(e,t){var n,i,a,r,o,s,l,d,c,u=this,t=t||e.ts,h=u.i18;return u.options.clientFormatDate&&0<t?(n=new Date(1e3*t),s=n[u.getHours](),l=12<s?s-12:s,d=n[u.getMinutes](),c=n[u.getSeconds](),i=n[u.getDate](),a=n[u.getDay](),r=n[u.getMonth]()+1,o=n[u.getFullYear](),n=(t>=this.yesterday?this.fancyFormat:this.dateFormat).replace(/[a-z]/gi,function(e){switch(e){case"d":return 9<i?i:"0"+i;case"j":return i;case"D":return u.i18n(h.daysShort[a]);case"l":return u.i18n(h.days[a]);case"m":return 9<r?r:"0"+r;case"n":return r;case"M":return u.i18n(h.monthsShort[r-1]);case"F":return u.i18n(h.months[r-1]);case"Y":return o;case"y":return(""+o).substr(2);case"H":return 9<s?s:"0"+s;case"G":return s;case"g":return l;case"h":return 9<l?l:"0"+l;case"a":return 12<=s?"pm":"am";case"A":return 12<=s?"PM":"AM";case"i":return 9<d?d:"0"+d;case"s":return 9<c?c:"0"+c}return e}),t>=this.yesterday?n.replace("$1",this.i18n(t>=this.today?"Today":"Yesterday")):n):e.date?e.date.replace(/([a-z]+)\s/i,function(e,t){return u.i18n(t)+" "}):u.i18n("dateUnknown")},perms2class:function(e){var t="";return e.read||e.write?e.read?e.write||(t="elfinder-ro"):t="elfinder-wo":t="elfinder-na",e.type&&(t+=" elfinder-"+this.escape(e.type)),t},formatPermissions:function(e){var t=[];return e.read&&t.push(this.i18n("read")),e.write&&t.push(this.i18n("write")),t.length?t.join(" "+this.i18n("and")+" "):this.i18n("noaccess")},formatSize:function(e){var t=1,n="b";return"unknown"==e?this.i18n("unknown"):(1073741824<e?(t=1073741824,n="GB"):1048576<e?(t=1048576,n="MB"):1024<e&&(t=1024,n="KB"),(0<(e/=t)?1048576<=t?e.toFixed(2):Math.round(e):0)+" "+n)},formatFileMode:function(e,t){var n,i,a,r,o,s,l,d;if(t=t||this.options.fileModeStyle.toLowerCase(),(e=Ce.trim(e)).match(/[rwxs-]{9}$/i)){if(l=e=e.substr(-9),"string"==t)return l;for(d="",n=a=0;n<7;n+=3)r=0,(i=e.substr(n,3)).match(/[r]/i)&&(r+=4),i.match(/[w]/i)&&(r+=2),i.match(/[xs]/i)&&(i.match(/[xs]/)&&(r+=1),i.match(/[s]/i)&&(0==n?a+=4:3==n&&(a+=2))),d+=r.toString(8);a&&(d=a.toString(8)+d)}else{if(d=(e=parseInt(e,8))?e.toString(8):"",!e||"octal"==t)return d;for(a=0,3<(i=e.toString(8)).length&&(i=i.substr(-4),a=parseInt(i.substr(0,1),8),i=i.substr(1)),s=2==(2&a),o=4==(4&a),l="",n=0;n<3;n++)4==(4&parseInt(i.substr(n,1),8))?l+="r":l+="-",2==(2&parseInt(i.substr(n,1),8))?l+="w":l+="-",1==(1&parseInt(i.substr(n,1),8))?l+=0==n&&o||1==n&&s?"s":"x":l+="-"}return"both"==t?l+" ("+d+")":"string"==t?l:d},uploadMimeCheck:function(i,e){e=e||this.cwd().hash;var t=!0,n=this.option("uploadMime",e),a=function(e){var n=!1;return"string"==typeof e&&"all"===e.toLowerCase()?n=!0:Ce.isArray(e)&&e.length&&Ce.each(e,function(e,t){if("all"===(t=t.toLowerCase())||0===i.indexOf(t))return!(n=!0)}),n};return i&&Ce.isPlainObject(n)&&(i=i.toLowerCase(),e=a(n.allow),a=a(n.deny),"allow"===n.firstOrder?t=!a&&!0===e:(t=!0)!==a||e||(t=!1)),t},sequence:function(n){var e=n.length,i=function(e,t){return n[++t]?i(e.then(n[t]),t):e};return 1<e?i(n[0](),0):n[0]()},reloadContents:function(n){var t,i=Ce.Deferred();try{t=Ce('<iframe width="1" height="1" scrolling="no" frameborder="no" style="position:absolute; top:-1px; left:-1px" crossorigin="use-credentials">').attr("src",n).one("load",function(){var t=Ce(this);try{this.contentDocument.location.reload(!0),t.one("load",function(){t.remove(),i.resolve()})}catch(e){t.attr("src","").attr("src",n).one("load",function(){t.remove(),i.resolve()})}}).appendTo("body")}catch(e){t&&t.remove(),i.reject()}return i},makeNetmountOptionOauth:function(s,e,l,d){return{vars:{},name:e,inputs:{offline:Ce('<input type="checkbox">').on("change",function(){Ce(this).parents("table.elfinder-netmount-tb").find("select:first").trigger("change","reset")}),host:Ce('<span><span class="elfinder-info-spinner"></span></span><input type="hidden">'),path:Ce('<input type="text" value="root">'),user:Ce('<input type="hidden">'),pass:Ce('<input type="hidden">')},select:function(n,e,t){var i=this.inputs,a=i.offline,r=Ce(i.host[0]),t=t||null;this.vars.mbtn=i.host.closest(".ui-dialog").children(".ui-dialog-buttonpane:first").find("button.elfinder-btncnt-0"),r.data("inrequest")||!r.find("span.elfinder-info-spinner").length&&"reset"!==t&&("winfocus"!==t||r.siblings("span.elfinder-button-icon-reload").length)?(a.closest("tr")[d||i.user.val()?"hide":"show"](),r.data("funcexpup")&&r.data("funcexpup")()):(1===a.parent().children().length&&(i.path.parent().prev().html(n.i18n("folderId")),a.attr("title",n.i18n("offlineAccess")),a.uniqueId().after(Ce("<label></label>").attr("for",a.attr("id")).html(" "+n.i18n("offlineAccess")))),r.data("inrequest",!0).empty().addClass("elfinder-info-spinner").parent().find("span.elfinder-button-icon").remove(),n.request({data:{cmd:"netmount",protocol:s,host:l,user:"init",options:{id:n.id,offline:a.prop("checked")?1:0,pass:i.host[1].value}},preventDefault:!0}).done(function(e){r.removeClass("elfinder-info-spinner").html(e.body.replace(/\{msg:([^}]+)\}/g,function(e,t){return n.i18n(t,l)}))}),d&&a.closest("tr").hide()),this.vars.mbtn[Ce(i.host[1]).val()?"show":"hide"]()},done:function(n,e){var t=this.inputs,i=this.protocol,a=Ce(t.host[0]),r=Ce(t.host[1]),o="&nbsp;";if(d&&t.offline.closest("tr").hide(),"makebtn"==e.mode)a.removeClass("elfinder-info-spinner").removeData("expires").removeData("funcexpup"),t.host.find("input").hover(function(){Ce(this).toggleClass("ui-state-hover")}),r.val(""),t.path.val("root").next().remove(),t.user.val(""),t.pass.val(""),d||t.offline.closest("tr").show(),this.vars.mbtn.hide();else{if(e.expires&&(o="()",a.data("expires",e.expires)),a.html(l+o).removeClass("elfinder-info-spinner"),e.expires&&(a.data("funcexpup",function(){var e=Math.floor((a.data("expires")-+new Date/1e3)/60);e<3?a.parent().children(".elfinder-button-icon-reload").click():(a.text(a.text().replace(/\(.*\)/,"("+n.i18n(["minsLeft",e])+")")),setTimeout(function(){a.is(":visible")&&a.data("funcexpup")()},6e4))}),a.data("funcexpup")()),e.reset)return void i.trigger("change","reset");a.parent().append(Ce('<span class="elfinder-button-icon elfinder-button-icon-reload" title="'+n.i18n("reAuth")+'">').on("click",function(){r.val("reauth"),i.trigger("change","reset")})),r.val(s),this.vars.mbtn.show(),e.folders&&t.path.next().remove().end().after(Ce("<div></div>").append(Ce('<select class="ui-corner-all" style="max-width:200px;">').append(Ce(Ce.map(e.folders,function(e,t){return'<option value="'+(t+"").trim()+'">'+n.escape(e)+"</option>"}).join(""))).on("change",function(){t.path.val(Ce(this).val())}))),t.user.val("done"),t.pass.val("done"),t.offline.closest("tr").hide()}a.removeData("inrequest")},fail:function(e,t){Ce(this.inputs.host[0]).removeData("inrequest"),this.protocol.trigger("change","reset")}}},findCwdNodes:function(e,n){var i=this,a=this.getUI("cwd"),r=this.cwd().hash,o=Ce();return n=n||{},Ce.each(e,function(e,t){if(t.phash===r&&(o=o.add(a.find("#"+i.cwdHash2Id(t.hash))),n.firstOnly))return!1}),o},convAbsUrl:function(e){if(e.match(/^http/i))return e;if("//"===e.substr(0,2))return window.location.protocol+e;var t=window.location.protocol+"//"+window.location.host,n=/[^\/]+\/\.\.\//,i="/"===e.substr(0,1)?t+e:t+window.location.pathname.replace(/\/[^\/]+$/,"/")+e;for(i=i.replace("/./","/");n.test(i);)i=i.replace(n,"");return i},navHash2Id:function(e){return this.navPrefix+e},navId2Hash:function(e){return"string"==typeof e&&e.substr(this.navPrefix.length)},cwdHash2Id:function(e){return this.cwdPrefix+e},cwdId2Hash:function(e){return"string"==typeof e&&e.substr(this.cwdPrefix.length)},isInWindow:function(e,t){return!(!t&&e.is(":hidden"))&&(!!(e=e.get(0))&&(e=e.getBoundingClientRect(),!!document.elementFromPoint(e.left,e.top)))},loadScript:function(t,n,i,a){var e={dataType:"script",cache:!0},r=null;return Ce.isFunction(n)&&(r=function(){var e,t;a&&void 0===a.obj[a.name]?(e=a.timeout?a.timeout/10:1e3,t=setInterval(function(){0<--e&&void 0!==a.obj[a.name]&&(clearInterval(t),n())},10)):n()}),i&&"tag"===i.loadType?(Ce.each(t,function(e,t){Ce("head").append(Ce('<script defer="defer">').attr("src",t))}),r()):(i=Ce.isPlainObject(i)?Ce.extend(e,i):e,function e(){Ce.ajax(Ce.extend(i,{url:t.shift(),success:t.length?e:r}))}()),this},loadCss:function(e){var n=this;return"string"==typeof e&&(e=[e]),Ce.each(e,function(e,t){t=n.convAbsUrl(t).replace(/^https?:/i,""),Ce("head > link[href='+url+']").length||Ce("head").append('<link rel="stylesheet" type="text/css" href="'+t+'">')}),this},log:function(e){return window.console&&window.console.log&&window.console.log(e),this},debug:function(e,t){var n=this.options.debug;return("all"==n||!0===n||Ce.isArray(n)&&-1!=Ce.inArray(e,n))&&window.console&&window.console.log&&window.console.log("elfinder debug: ["+e+"] ["+this.id+"]",t),"backend-debug"===e&&this.trigger("backenddebug",t),this},time:function(e){window.console&&window.console.time&&window.console.time(e)},timeEnd:function(e){window.console&&window.console.timeEnd&&window.console.timeEnd(e)},setReadOnly:function(e){this.options.customData.readonly=e,this.options.customData.id=this.id,this.exec("reload")},setHome:function(e,t){this.options.customData.home=e,this.options.customData.id=this.id,this.options.customData.selection=t;t=this.id;Ce("#"+t).after('<div id="_after_'+t+'"></div>'),Ce("#"+t).remove(),Ce("#_after_"+t).after('<div id="'+t+'"></div>'),window[t]=Ce("#"+t).elfinder(this.options).elfinder("instance")},setHeight:function(e){this.options.height=e,this.resize(this.options.width,this.options.height)},setWidth:function(e){this.options.width=e,this.resize(this.options.width,this.options.height)}},Object.keys||(Object.keys=(a=Object.prototype.hasOwnProperty,r=!{toString:null}.propertyIsEnumerable("toString"),s=(o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var t,n=[];for(t in e)a.call(e,t)&&n.push(t);if(r)for(var i=0;i<s;i++)a.call(e,o[i])&&n.push(o[i]);return n})),ye.prototype.version="2.1.20",Ce.ui&&Ce.ui.ddmanager&&(l=Ce.ui.ddmanager.prepareOffsets,Ce.ui.ddmanager.prepareOffsets=function(e,t){if("mousedown"===t.type||e.options.elfRefresh)for(var n,i=Ce.ui.ddmanager.droppables[e.options.scope]||[],a=i.length,r=0;r<a;r++)(n=i[r]).options.autoDisable&&(!n.options.disabled||1<n.options.autoDisable)&&(n.options.disabled=function(e){if(e.is(":hidden"))return!0;e=e[0].getBoundingClientRect();return!document.elementFromPoint(e.left,e.top)}(n.element),n.options.autoDisable=n.options.disabled?2:1);return l(e,t)}),(d=jQuery).support.touch="ontouchend"in document,d.support.touch&&(t=d.ui.mouse.prototype,n=t._mouseInit,i=t._mouseDestroy,t._touchStart=function(e){!c&&this._mouseCapture(e.originalEvent.changedTouches[0])&&(u=e.originalEvent.changedTouches[0].screenX.toFixed(0),h=e.originalEvent.changedTouches[0].screenY.toFixed(0),c=!0,this._touchMoved=!1,p(e,"mouseover"),p(e,"mousemove"),p(e,"mousedown"))},t._touchMove=function(e){var t,n;c&&(t=e.originalEvent.changedTouches[0].screenX.toFixed(0),n=e.originalEvent.changedTouches[0].screenY.toFixed(0),Math.abs(u-t)<=2&&Math.abs(h-n)<=2||(this._touchMoved=!0,p(e,"mousemove")))},t._touchEnd=function(e){c&&(p(e,"mouseup"),p(e,"mouseout"),this._touchMoved||p(e,"click"),c=!1,this._touchMoved=!1)},t._mouseInit=function(){var e=this;e.element.hasClass("touch-punch")&&e.element.bind({touchstart:d.proxy(e,"_touchStart"),touchmove:d.proxy(e,"_touchMove"),touchend:d.proxy(e,"_touchEnd")}),n.call(e)},t._mouseDestroy=function(){var e=this;e.element.hasClass("touch-punch")&&e.element.unbind({touchstart:d.proxy(e,"_touchStart"),touchmove:d.proxy(e,"_touchMove"),touchend:d.proxy(e,"_touchEnd")}),i.call(e)}),Ce.fn.elfinder=function(t){return"instance"==t?this.getElFinder():this.each(function(){var e="string"==typeof t?t:"";switch(this.elfinder||new ye(this,"object"==typeof t?t:{}),e){case"close":case"hide":this.elfinder.hide();break;case"open":case"show":this.elfinder.show();break;case"destroy":this.elfinder.destroy()}})},Ce.fn.getElFinder=function(){var e;return this.each(function(){if(this.elfinder)return e=this.elfinder,!1}),e},Ce.fn.elfUiWidgetInstance=function(t){try{return this[t]("instance")}catch(e){var n=this.data("ui-"+t);return n&&"object"==typeof n&&n.widgetFullName==="ui-"+t?n:null}},ye.prototype._options={url:"",requestType:"get",transport:{},urlUpload:"",dragUploadAllow:"auto",overwriteUploadConfirm:!0,uploadMaxChunkSize:10485760,folderUploadExclude:{win:/^(?:desktop\.ini|thumbs\.db)$/i,mac:/^\.ds_store$/i},iframeTimeout:0,customData:{},handlers:{},customHeaders:{},xhrFields:{},lang:"en",cssAutoLoad:!0,cssClass:"",commands:["*"],commandsOptions:{getfile:{onlyURL:!1,multiple:!1,folders:!1,oncomplete:"",getPath:!0,getImgSize:!1},open:{method:"post"},upload:{ui:"button"},download:{maxRequests:10},quicklook:{autoplay:!0,width:450,height:300,googleDocsMimes:[]},edit:{mimes:[],editors:[],encodings:["Big5","Big5-HKSCS","Cp437","Cp737","Cp775","Cp850","Cp852","Cp855","Cp857","Cp858","Cp862","Cp866","Cp874","EUC-CN","EUC-JP","EUC-KR","ISO-2022-CN","ISO-2022-JP","ISO-2022-KR","ISO-8859-1","ISO-8859-2","ISO-8859-3","ISO-8859-4","ISO-8859-5","ISO-8859-6","ISO-8859-7","ISO-8859-8","ISO-8859-9","ISO-8859-13","ISO-8859-15","KOI8-R","KOI8-U","Shift-JIS","Windows-1250","Windows-1251","Windows-1252","Windows-1253","Windows-1254","Windows-1257"]},search:{incsearch:{enable:!0,minlen:1,wait:500}},info:{nullUrlDirLinkSelf:!0,custom:{}},mkdir:{intoNewFolderToolbtn:!1},resize:{grid8px:"enable"},help:{view:["about","shortcuts","help","debug"]}},getFileCallback:null,defaultView:"icons",startPathHash:"",sound:!0,ui:["toolbar","tree","path","stat"],uiOptions:{toolbar:[["back","forward"],["mkdir","mkfile","upload"],["info","chmod"],["quicklook"],["copy","cut","paste"],["rm"],["duplicate","rename","resize"],["view","sort"],["help"],["fullscreen"],{displayTextLabel:!1,labelExcludeUA:["Mobile"],autoHideUA:["Mobile"]}],tree:{openRootOnLoad:!0,openCwdOnOpen:!0,syncTree:!0},navbar:{minWidth:150,maxWidth:500,autoHideUA:[]},cwd:{oldSchool:!1,showSelectCheckboxUA:["Touch"],listView:{columns:["perm","date","size","kind"],columnsCustomName:{},fixedHeader:!0}}},onlyMimes:[],sortRules:{},sortType:"name",sortOrder:"asc",sortStickFolders:!0,sortAlsoTreeview:!1,clientFormatDate:!0,UTCDate:!1,dateFormat:"",fancyDateFormat:"",fileModeStyle:"both",width:"auto",height:400,resizable:!0,notifyDelay:500,notifyDialog:{position:{top:"12px",right:"12px"},width:280},allowShortcuts:!0,rememberLastDir:!1,reloadClearHistory:!1,useBrowserHistory:!1,showFiles:50,showThreshold:50,validName:!1,backupSuffix:"~",sync:0,syncStart:!0,loadTmbs:5,cookie:{expires:30,domain:"",path:"/",secure:!1},contextmenu:{navbar:["open","download","|","upload","mkdir","|","copy","cut","paste","duplicate","|","rm","|","rename","|","archive","|","places","info","chmod","netunmount"],cwd:["reload","back","|","upload","mkdir","mkfile","paste","|","view","sort","colwidth","|","info","|","fullscreen"],files:["getfile","|","open","download","opendir","|","upload","mkdir","|","copy","cut","paste","duplicate","|","rm","|","rename","|","info"]},enableAlways:!1,enableByMouseOver:!0,windowCloseConfirm:["hasNotifyDialog","editingFile"],rawStringDecoder:"object"==typeof Encoding&&Ce.isFunction(Encoding.convert)?function(e){return Encoding.convert(e,{to:"UNICODE",type:"string"})}:null,debug:["error","warning","event-destroy"]},ye.prototype.history=function(n){function t(){o=[n.cwd().hash],r=!(i=0)}function e(e){return e&&a.canForward()||!e&&a.canBack()?(r=!1,n.exec("open",o[e?++i:--i]).fail(t)):Ce.Deferred().reject()}var i,a=this,r=!0,o=[],s=n.options.useBrowserHistory&&window.history&&window.history.pushState?window.history:null;this.canBack=function(){return 0<i},this.canForward=function(){return i<o.length-1},this.back=e,this.forward=function(){return e(!0)},n.open(function(){var e=o.length,t=n.cwd().hash;r&&(0<=i&&i+1<e&&o.splice(i+1),o[o.length-1]!=t&&o.push(t),i=o.length-1),r=!0,s&&(s.state?s.state.thash!=t&&s.pushState({thash:t},null,location.pathname+location.search+"#elf_"+t):s.replaceState({thash:t},null,location.pathname+location.search+"#elf_"+t))}).reload(n.options.reloadClearHistory&&t)},ye.prototype.command=function(t){this.fm=t,this.name="",this.className="",this.title="",this.linkedCmds=[],this.state=-1,this.alwaysEnabled=!1,this._disabled=!1,this.disableOnSearch=!1,this.updateOnSelect=!0,this._handlers={enable:function(){this.update(void 0,this.value)},disable:function(){this.update(-1,this.value)},"open reload load sync":function(){this._disabled=!(this.alwaysEnabled||this.fm.isCommandEnabled(this.name)),this.update(void 0,this.value),this.change()}},this.handlers={},this.shortcuts=[],this.options={ui:"button"},this.setup=function(t,e){var n,i,a,r,o=this,s=this.fm;for(this.name=t,this.title=s.messages["cmd"+t]?s.i18n("cmd"+t):this.extendsCmd&&s.messages["cmd"+this.extendsCmd]?s.i18n("cmd"+this.extendsCmd):t,this.options=Ce.extend({},this.options,e),this.listeners=[],e.shortcuts&&("function"==typeof e.shortcuts?a=e.shortcuts(this.fm,this.shortcuts):Ce.isArray(e.shortcuts)&&(a=e.shortcuts),this.shortcuts=a||[]),this.updateOnSelect&&(this._handlers.select=function(){this.update(void 0,this.value)}),Ce.each(Ce.extend({},o._handlers,o.handlers),function(e,t){s.bind(e,Ce.proxy(t,o))}),n=0;n<this.shortcuts.length;n++)i=this.shortcuts[n],r=i.callback||o.exec,i.callback=function(){s.isCommandEnabled(o.name)&&r.call(o)},i.description||(i.description=this.title),s.shortcut(i);this.disableOnSearch&&s.bind("search searchend",function(e){o._disabled="search"===e.type||!(this.alwaysEnabled||s.isCommandEnabled(t)),o.update(void 0,o.value)}),this.init()},this.init=function(){},this.exec=function(e,t){return Ce.Deferred().reject()},this.disabled=function(){return this.state<0},this.enabled=function(){return-1<this.state},this.active=function(){return 0<this.state},this.getstate=function(){return-1},this.update=function(e,t){var n=this.state,i=this.value;this._disabled?this.state=-1:this.state=void 0!==e?e:this.getstate(),this.value=t,n==this.state&&i==this.value||this.change()},this.change=function(e){var t,n;if("function"==typeof e)this.listeners.push(e);else for(n=0;n<this.listeners.length;n++){t=this.listeners[n];try{t(this.state,this.value)}catch(e){this.fm.debug("error",e)}}return this},this.hashes=function(e){return e?Ce.map(Ce.isArray(e)?e:[e],function(e){return t.file(e)?e:null}):t.selected()},this.files=function(e){var t=this.fm;return e?Ce.map(Ce.isArray(e)?e:[e],function(e){return t.file(e)||null}):t.selectedFiles()}},ye.prototype.resources={class:{hover:"ui-state-hover",active:"ui-state-active",disabled:"ui-state-disabled",draggable:"ui-draggable",droppable:"ui-droppable",adroppable:"elfinder-droppable-active",cwdfile:"elfinder-cwd-file",cwd:"elfinder-cwd",tree:"elfinder-tree",treeroot:"elfinder-navbar-root",navdir:"elfinder-navbar-dir",navdirwrap:"elfinder-navbar-dir-wrapper",navarrow:"elfinder-navbar-arrow",navsubtree:"elfinder-navbar-subtree",navcollapse:"elfinder-navbar-collapsed",navexpand:"elfinder-navbar-expanded",treedir:"elfinder-tree-dir",placedir:"elfinder-place-dir",searchbtn:"elfinder-button-search",editing:"elfinder-to-editing"},tpl:{perms:'<span class="elfinder-perms"></span>',lock:'<span class="elfinder-lock"></span>',symlink:'<span class="elfinder-symlink"></span>',navicon:'<span class="elfinder-nav-icon"></span>',navspinner:'<span class="elfinder-navbar-spinner"></span>',navdir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"><span class="elfinder-navbar-arrow"></span><span class="elfinder-navbar-icon" {style}></span>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree" style="display:none"></div></div>',placedir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}" title="{title}"><span class="elfinder-navbar-arrow"></span><span class="elfinder-navbar-icon" {style}></span>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree" style="display:none"></div></div>'},mimes:{text:["application/x-empty","application/javascript","application/xhtml+xml","audio/x-mp3-playlist","application/x-web-config","application/docbook+xml","application/x-php","application/x-perl","application/x-awk","application/x-config","application/x-csh","application/xml"]},mixin:{make:function(){function i(){O.is(":hidden")||O.addClass("ui-front").elfinderoverlay("hide").off("click",S),z.removeClass("ui-front").css("position",""),m?t.css("max-height",""):n&&n.css("width","").parent("td").css("overflow","")}var e,t,n,a,r,o,s,l=this.fm,d=this.name,c=l.getUI("workzone"),u=this.origin&&"navbar"===this.origin?"tree":"cwd",h=l.getUI(u),p="tree"==u,f=p?"navHash2Id":"cwdHash2Id",m=!p&&"list"!=l.storage("view"),g=l.selected(),v=this.move||!1,b=c.hasClass("elfinder-cwd-wrapper-empty"),y=Ce.Deferred().fail(function(e){r&&a.attr("class",r),b&&c.addClass("elfinder-cwd-wrapper-empty"),g&&(v&&l.trigger("unlockfiles",{files:g}),l.clipboard([]),l.trigger("selectfiles",{files:g})),e&&l.error(e)}).always(function(){i(),I(),l.enable(),l.trigger("resMixinMake")}),w="tmp_"+parseInt(1e5*Math.random()),x=(p?l.file(g[0]):l.cwd()).hash,C=new Date,k={hash:w,phash:x,name:l.uniqueName(this.prefix,x),mime:this.mime,read:!0,write:!0,date:"Today "+C.getHours()+":"+C.getMinutes(),move:v},T=this.data||{},z=h.trigger("create."+l.namespace,k).find("#"+l[f](w)).on("unselect."+l.namespace,function(){setTimeout(function(){D&&D.blur()},50)}),O=l.getUI("overlay"),I=function(){l.unbind("resize",E),D.remove(),p&&z.closest(".elfinder-navbar-wrapper").remove(),z.remove()},S=function(e){M||(I(),e.stopPropagation(),y.reject())},D=Ce(m?"<textarea></textarea>":'<input type="text">').on("keyup text",function(){m?(this.style.height="1px",this.style.height=this.scrollHeight+"px"):e&&(this.style.width=e+"px",this.scrollWidth>e&&(this.style.width=this.scrollWidth+10+"px"))}).keydown(function(e){e.stopImmediatePropagation(),e.keyCode==Ce.ui.keyCode.ESCAPE?y.reject():e.keyCode==Ce.ui.keyCode.ENTER&&D.blur()}).mousedown(function(e){e.stopPropagation()}).blur(function(){var e=Ce.trim(D.val()),t=D.parent(),n=!0;if(!M&&t.length){if(l.options.validName&&l.options.validName.test)try{n=l.options.validName.test(e)}catch(e){n=!1}return e&&".."!==e&&n?l.fileByName(e,x)?(M=!0,l.error(["errExists",e],{modal:!0,close:A}),!1):(t=g&&v?l.exec("cut",g):null,void Ce.when(t).done(function(){i(),D.hide().before(Ce("<span>").text(e)),l.lockfiles({files:[w]}),l.request({data:Ce.extend({cmd:d,name:e,target:x},T||{}),notify:{type:d,cnt:1},preventFail:!0,syncOnFail:!0}).fail(function(e){l.unlockfiles({files:[w]}),M=!0,D.show().prev().remove(),l.error(e,{modal:!0,close:A})}).done(function(i){var a,e,r;y.resolve(i),i&&i.added&&i.added[0]&&(a=i.added[0],e=a.hash,r=h.find("#"+l[f](e)),g&&v&&l.one(d+"done",function(){l.exec("paste",e)}),l.one(d+"done",function(){var e,t,n={directory:{cmd:"open",msg:"cmdopendir"},default:{cmd:"open",msg:"cmdopen"}};r=h.find("#"+l[f](a.hash)),1===i.added.length&&(e=n[a.mime]||n.default,t=Ce("<div></div>").append(Ce('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">'+l.i18n(e.msg)+"</span></button>").on("mouseenter mouseleave",function(e){Ce(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click",function(){l.exec(e.cmd,a.hash)}))),r.length?(r.trigger("scrolltoview"),!v&&t&&l.toast({msg:l.i18n(["complete",l.i18n("cmd"+d)]),extNode:t})):(l.trigger("selectfiles",{files:Ce.map(i.added,function(e){return e.hash})}),v||l.toast({msg:l.i18n(["complete",l.i18n("cmd"+d)]),extNode:t}))}))})}).fail(function(){y.reject()})):(M=!0,l.error("errInvName",{modal:!0,close:A}),!1)}}),A=function(){var e=D.val().replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/gi,"");M=!1,l.UA.Mobile&&O.on("click",S).removeClass("ui-front").elfinderoverlay("show"),D.select().focus(),D[0].setSelectionRange&&D[0].setSelectionRange(0,e.length)},E=function(){z.trigger("scrolltoview")},M=!1;return!p&&this.disabled()||!z.length?y.reject():(p?(a=Ce("#"+l[f](x)),o=l.res("class","navcollapse"),s=l.res("class","navexpand"),u=l.res("class","navarrow"),C=l.res("class","navsubtree"),z.closest("."+C).show(),a.hasClass(o)||(r=a.attr("class"),a.addClass(o+" "+s+" elfinder-subtree-loaded")),a.is("."+o+":not(."+s+")")&&a.children("."+u).click().data("dfrd").done(function(){D.val()===k.name&&D.val(l.uniqueName(this.prefix,x)).select().focus()}.bind(this)),(t=z.contents().filter(function(){return 3==this.nodeType&&Ce(this).parent().attr("id")===l.navHash2Id(k.hash)})).replaceWith(D.val(k.name))):(b&&c.removeClass("elfinder-cwd-wrapper-empty"),t=z.find(".elfinder-cwd-filename"),n=t.parent(),z.css("position","relative").addClass("ui-front"),m?t.css("max-height","none"):(e=n.width(),n.width(e-15).parent("td").css("overflow","visible")),t.empty("").append(D.val(k.name))),l.bind("resize",E),D.trigger("keyup"),A(),y)}},blink:function(e,t){var n={slowonce:function(){e.hide().delay(250).fadeIn(750).delay(500).fadeOut(3500)},lookme:function(){e.show().fadeOut(500).fadeIn(750)}},n=n[t=t||"slowonce"]||n.lookme;e.stop(!0,!0),n()}},Ce.fn.dialogelfinder=function(i){var a="elfinderPosition",r="elfinderDestroyOnClose";if(this.not(".elfinder").each(function(){Ce(document);var e=Ce('<div class="ui-widget-header dialogelfinder-drag ui-corner-top">'+(i.title||"Files")+"</div>"),t=(Ce('<a href="#" class="dialogelfinder-drag-close ui-corner-all"><span class="ui-icon ui-icon-closethick"> </span></a>').appendTo(e).click(function(e){e.preventDefault(),t.dialogelfinder("close")}),Ce(this).addClass("dialogelfinder").css("position","absolute").hide().appendTo("body").draggable({handle:".dialogelfinder-drag",containment:"window",stop:function(){t.trigger("resize"),n.trigger("resize")}}).elfinder(i).prepend(e)),n=t.elfinder("instance");t.width(parseInt(t.width())||840).data(r,!!i.destroyOnClose).find(".elfinder-toolbar").removeClass("ui-corner-top"),i.position&&t.data(a,i.position),!1!==i.autoOpen&&Ce(this).dialogelfinder("open")}),"open"==i){var e,t=(e=Ce(this)).data(a)||{top:parseInt(Ce(document).scrollTop()+(Ce(window).height()<e.height()?2:(Ce(window).height()-e.height())/2)),left:parseInt(Ce(document).scrollLeft()+(Ce(window).width()<e.width()?2:(Ce(window).width()-e.width())/2))};e.is(":hidden")&&(e.addClass("ui-front").css(t).show().trigger("resize"),setTimeout(function(){e.trigger("resize").mousedown()},200))}else if("close"==i)(e=Ce(this).removeClass("ui-front")).is(":visible")&&(e.data(r)?e.elfinder("destroy").remove():e.elfinder("close"));else if("instance"==i)return Ce(this).getElFinder();return this},Ce.fn.elfinderbutton=function(l){return this.each(function(){var n,e="class",t=l.fm,i=t.res(e,"disabled"),a=t.res(e,"active"),r=t.res(e,"hover"),o="elfinder-button-menu-item",t=Ce('<span class="elfinder-button-text">'+l.title+"</span>"),s=Ce(this).addClass("ui-state-default elfinder-button").attr("title",l.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+(l.className||l.name)+'"></span>',t).hover(function(e){s.hasClass(i)||s["mouseleave"==e.type?"removeClass":"addClass"](r)}).click(function(e){s.hasClass(i)||(n&&1<l.variants.length?(n.is(":hidden")&&l.fm.getUI().click(),e.stopPropagation(),n.slideToggle(100)):l.exec())}),e=function(){n.hide()};t.hide(),Ce.isArray(l.variants)&&(s.addClass("elfinder-menubutton"),n=Ce('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu ui-corner-all"></div>').hide().appendTo(s).on("mouseenter mouseleave","."+o,function(){Ce(this).toggleClass(r)}).on("click","."+o,function(e){e.preventDefault(),e.stopPropagation(),s.removeClass(r),n.hide(),l.exec(l.fm.selected(),Ce(this).data("value"))}),l.fm.bind("disable select",e).getUI().click(e),l.change(function(){n.html(""),Ce.each(l.variants,function(e,t){n.append(Ce('<div class="'+o+'">'+t[1]+"</div>").data("value",t[0]).addClass(t[0]==l.value?"elfinder-button-menu-item-selected":""))})})),l.change(function(){l.disabled()?s.removeClass(a+" "+r).addClass(i):(s.removeClass(i),s[l.active()?"addClass":"removeClass"](a))}).change()})},Ce.fn.elfindercontextmenu=function(I){return this.each(function(){function p(e,t,n,i){var a="",r="",o="";return i&&(i.className&&(a=" "+i.className),i.iconClass&&(o=i.iconClass,t=""),i.iconImg&&(r=" style=\"background:url('"+I.escape(i.iconImg)+"') 0 0 no-repeat;background-size:contain;\"")),Ce(s.replace("{icon}",t?"elfinder-button-icon-"+t:o||"").replace("{label}",e).replace("{style}",r).replace("{className}",a)).click(function(e){e.stopPropagation(),e.preventDefault(),n()})}function h(e){var t=e.keyCode,n=Ce.ui.keyCode.ESCAPE,i=Ce.ui.keyCode.ENTER,a=Ce.ui.keyCode.LEFT,r=Ce.ui.keyCode.RIGHT,o=Ce.ui.keyCode.UP,s=Ce.ui.keyCode.DOWN,l="ltr"===I.direction?r:a,d=l===r?a:r;-1!==Ce.inArray(t,[n,i,a,r,o,s])&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t==n||t===d?g&&v&&b?(b.trigger("mouseleave"),g.addClass("ui-state-hover"),b=v=null):t==n&&z():t==o||t==s?v?(b&&b.trigger("mouseleave"),t==s&&(!b||v.length<=++v._cur)?v._cur=0:t==o&&(!b||--v._cur<0)&&(v._cur=v.length-1),b=v.eq(v._cur).trigger("mouseenter")):(v=null,g&&g.trigger("mouseleave"),t==s&&(!g||c.length<=++c._cur)?c._cur=0:t==o&&(!g||--c._cur<0)&&(c._cur=c.length-1),g=c.eq(c._cur).addClass("ui-state-hover")):!g||t!=i&&t!==l||(g.hasClass("elfinder-contextmenu-group")?b?t==i&&b.click():(g.trigger("mouseenter"),(v=g.find("div."+x))._cur=0,b=v.first().addClass("ui-state-hover")):t==i&&g.click()))}var f,m,c,g,v,b,y,w="elfinder-contextmenu-item",x="elfinder-contextsubmenu-item",t={distance:8,start:function(){C.data("touching")&&C.find(".ui-state-hover").removeClass("ui-state-hover")},stop:function(){C.data("draged",!0)}},C=Ce(this).addClass("touch-punch ui-helper-reset ui-front ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-"+I.direction).hide().on("touchstart",function(e){C.data("touching",!0)}).on("touchend",function(e){C.removeData("touching")}).on("mouseenter mouseleave","."+w,function(e){Ce(this).toggleClass("ui-state-hover",!("mouseenter"!==e.type&&(C.data("draged")||!C.data("submenuKeep")))),C.data("draged")&&C.data("submenuKeep")&&C.find(".elfinder-contextmenu-sub:visible").parent().addClass("ui-state-hover")}).on("mouseenter mouseleave",".elfinder-contextmenu-extra-icon",function(e){Ce(this).parent().toggleClass("ui-state-hover","mouseleave"===e.type)}).on("mouseenter mouseleave","."+w+",."+x,function(e){function t(n,i){Ce.each(i?v:c,function(e,t){if(n[0]===t)return(i?v:c)._cur=e,i?b=n:g=n,!1})}var n,i;e.originalEvent&&(n=Ce(this),"mouseenter"===e.type?n.hasClass(x)?(b&&b.removeClass("ui-state-hover"),v=g.find("div."+x),t(n,!0)):(g&&g.removeClass("ui-state-hover"),t(n)):n.hasClass(x)?v=b=null:(g&&g.removeClass("ui-state-hover"),i=g,setTimeout(function(){i===g&&(g=null)},250)))}).on("contextmenu",function(){return!1}).on("mouseup",function(){setTimeout(function(){C.removeData("draged")},100)}).draggable(t),k="ltr"==I.direction?"left":"right",d=Ce.extend({},I.options.contextmenu),s='<div class="'+w+'{className}"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"{style}></span><span>{label}</span></div>',T=function(e,t,n){var i,a=C.outerWidth(),r=C.outerHeight(),o=f.attr("style"),s=f.offset(),l=f.width(),d=f.height(),c=I.UA.Mobile?40:2,u=I.UA.Mobile?20:2,e=e-(s?s.left:0),t=t-(s?s.top:0),n=Ce.extend(n||{},{top:Math.max(0,t+u+r<d?t+u:t-(t+r-d)),left:Math.max(0,e<a+c||e+c+a<l?e+c:e-c-a),opacity:"1"});y=!0,I.autoSync("stop"),I.toFront(C),f.width(l),C.stop().removeAttr("style").css(n).show(),f.attr("style",o),n[k]=parseInt(C.width()),C.find(".elfinder-contextmenu-sub").css(n),I.UA.iOS&&Ce("div.elfinder div.overflow-scrolling-touch").css("-webkit-overflow-scrolling","auto"),b=v=g=null,Ce(document).on("keydown."+I.namespace,h),(n=Ce._data(document).events)&&n.keydown&&n.keydown.unshift(n.keydown.pop()),I.UA.Mobile&&(i="touchstart.contextmenuAutoToggle",C.data("hideTm")&&clearTimeout(C.data("hideTm")),C.is(":visible")&&C.on("touchstart",function(e){1<e.originalEvent.touches.length||(C.stop().show(),C.data("hideTm")&&clearTimeout(C.data("hideTm")))}).data("hideTm",setTimeout(function(){m.find(".elfinder-cwd-file").off(i),m.find(".elfinder-cwd-file.ui-selected").one(i,function(e){if(!(1<e.originalEvent.touches.length)){var t=Ce(e.target);if(C.first().length&&!t.is("input:checkbox")&&!t.hasClass("elfinder-cwd-select"))return T(e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),!1;m.find(".elfinder-cwd-file").off(i)}}).one("unselect."+I.namespace,function(){m.find(".elfinder-cwd-file").off(i)}),C.fadeOut({duration:300,fail:function(){C.css("opacity","1").show()}})},4500)))},z=function(){if(Ce(document).off("keydown."+I.namespace,h),O=null,C.is(":visible")||C.children().length){C.removeAttr("style").hide().empty().removeData("submenuKeep");try{C.draggable("instance")||C.draggable(t)}catch(e){C.hasClass("ui-draggable")||C.draggable(t)}C.data("prevNode")&&(C.data("prevNode").after(C),C.removeData("prevNode")),I.trigger("closecontextmenu"),I.UA.iOS&&Ce("div.elfinder div.overflow-scrolling-touch").css("-webkit-overflow-scrolling","touch")}y&&I.searchStatus.state<1&&!I.searchStatus.ininc&&I.autoSync(),y=!1},O=null;I.one("load",function(){f=I.getUI(),m=I.getUI("cwd"),I.bind("contextmenu",function(e){var t,a,r,o,s,l,u,h,n=e.data,i={};n.type&&"files"===n.type||m.trigger("unselectall"),z(),n.type&&n.targets?(a=n.type,r=n.targets,s=o=!1,l={},u=[],h="cwd"===a,O=a,C.data("cmdMaps")&&Ce.each(C.data("cmdMaps"),function(e,t){if(0==r[0].indexOf(e,0))return l=t,!1}),h||(u=I.getDisabledCmds(r)),"navbar"===a&&I.select({selected:r,origin:"navbar"}),1<(e=I.selected().length)&&C.append('<div class="ui-corner-top ui-widget-header elfinder-contextmenu-header"><span>'+I.i18n("selectedItems",""+e)+"</span></div>"),c=Ce(),Ce.each(d[a]||[],function(e,t){var n,d,c,i;if("|"!==t){if(l[t]&&(t=l[t]),!(n=I.getCommand(t))||h||I.searchStatus.state&&n.disableOnSearch||(n.__disabled=n._disabled,n._disabled=!(n.alwaysEnabled||I._commands[t]&&-1===Ce.inArray(t,u)),Ce.each(n.linkedCmds,function(e,t){var n;(n=I.getCommand(t))&&(n.__disabled=n._disabled,n._disabled=!(n.alwaysEnabled||I._commands[t]&&-1===Ce.inArray(t,u)))})),n&&-1!=n.getstate(r)){if(n.variants){if(!n.variants.length)return;d=p(n.title,n.className||n.name,function(){}),c=Ce('<div class="ui-front ui-corner-all elfinder-contextmenu-sub"></div>').hide().appendTo(d.append('<span class="elfinder-contextmenu-arrow"></span>')),i=function(e){var t,n,i,a,r,o,s,l;e?(t=f.attr("style"),f.width(f.width()),c.css({left:"auto",right:"auto"}),n=(o=d.offset()).left,i=o.top,a=d.outerWidth(),r=c.outerWidth(!0),s=c.outerHeight(!0),e=(l=f.offset()).left+f.width(),o=l.top+f.height(),l=n+a+r-e,e=r<n&&0<l?I.UA.Mobile?10-r:a-l:a,"right"==k&&n<r&&(e=I.UA.Mobile?30-a:a-(r-n)),s=0<(l=i+5+s-o)&&i<o?5-l:0<l?30-s:5,C.find(".elfinder-contextmenu-sub:visible").hide().parent().removeClass("ui-state-hover"),c.css({top:s}).css(k,e).show(),f.attr("style",t)):c.hide()},d.addClass("elfinder-contextmenu-group").on("touchstart",".elfinder-contextmenu-sub",function(e){d.data("touching",!0)}).on("mouseleave",".elfinder-contextmenu-sub",function(e){C.data("draged")||C.removeData("submenuKeep")}).on("click","."+x,function(e){e.stopPropagation(),C.data("draged")||(C.hide(),e=Ce(this).data("exec"),Ce.isPlainObject(e)&&(e._currentType=a),z(),n.exec(r,e))}).on("touchend",function(e){C.data("submenuKeep",!0)}).on("mouseenter mouseleave",function(e){"mouseleave"===e.type?C.data("submenuKeep")||d.data("timer",setTimeout(function(){d.removeData("timer"),i(!1)},250)):(d.data("timer")&&(clearTimeout(d.data("timer")),d.removeData("timer")),d.data("touching")||i(!0)),d.removeData("touching")}),Ce.each(n.variants,function(e,t){c.append("|"===t?'<div class="elfinder-contextmenu-separator"></div>':Ce('<div class="'+w+" "+x+'"><span>'+t[1]+"</span></div>").data("exec",t[0]))})}else d=p(n.title,n.className||n.name,function(){C.data("draged")||(z(),n.exec(r,{_currentType:a}))}),n.extra&&n.extra.node?(Ce('<span class="elfinder-button-icon elfinder-button-icon-'+(n.extra.icon||"")+' elfinder-contextmenu-extra-icon"></span>').append(n.extra.node).appendTo(d),Ce(n.extra.node).trigger("ready")):d.remove(".elfinder-contextmenu-extra-icon");n.extendsCmd&&d.children("span.elfinder-button-icon").addClass("elfinder-button-icon-"+n.extendsCmd),s&&C.append('<div class="elfinder-contextmenu-separator"></div>'),C.append(d),s=!(o=!0)}n&&void 0!==n.__disabled&&(n._disabled=n.__disabled,delete n.__disabled,Ce.each(n.linkedCmds,function(e,t){(t=I.getCommand(t))&&(t._disabled=t.__disabled,delete t.__disabled)}))}else o&&(s=!0)}),c=C.children("div."+w)):n.raw&&(t=n.raw,O="raw",Ce.each(t,function(e,t){var n;"|"===t?C.append('<div class="elfinder-contextmenu-separator"></div>'):t.label&&"function"==typeof t.callback&&(n=p(t.label,t.icon,function(){C.data("draged")||(t.remain||z(),t.callback())},t.options||null),C.append(n))}),c=C.children("div."+w)),C.children().length&&((t=n.prevNode||null)&&(C.data("prevNode",C.prev()),t.after(C)),n.fitHeight&&(i={maxHeight:Math.min(I.getUI().height(),Ce(window).height()),overflowY:"auto"},C.draggable("destroy").removeClass("ui-draggable")),T(n.x,n.y,i))}).one("destroy",function(){C.remove()}).bind("disable",z).bind("select",function(){"files"===O&&z()}).getUI().click(z)}).shortcut({pattern:"mac"===I.OS?"ctrl+m":"contextmenu shift+f10",description:"contextmenu",callback:function(e){e.stopPropagation(),e.preventDefault(),Ce(document).one("contextmenu."+I.namespace,function(e){e.preventDefault(),e.stopPropagation()});var t,n,i,a,e=I.selected();e.length?(t="files",n=e,a=Ce("#"+I.cwdHash2Id(e[0]))):(t="cwd",n=[I.cwd().hash],i=I.getUI("workzone").offset()),a&&a.length||(a=I.getUI("workzone")),(i=a.offset()).top+=a.height()/2,i.left+=a.width()/2,I.trigger("contextmenu",{type:t,targets:n,x:i.left,y:i.top})}})})},Ce.fn.elfindercwd=function(we,xe){return this.not(".elfinder-cwd").each(function(){function r(){return'<tr id="{id}" class="'+n+' {permsclass} {dirclass}" title="{tooltip}"{css}><td class="elfinder-col-name"><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"{style}></span>{marker}<span class="elfinder-cwd-filename">{name}</span></div>'+U+"</td>"+function(){for(var e="",t=0;t<M.length;t++)e+='<td class="elfinder-col-'+M[t]+'">{'+M[t]+"}</td>";return e}()+"</tr>"}function p(n){return H[m?"row":"icon"].replace(/\{([a-z0-9_]+)\}/g,function(e,t){return N[t]?N[t](n,we):n[t]||""})}function i(e){Ce("#"+we.cwdHash2Id(e)).trigger(u)}function t(){we.cwd().hash,U&&ge.find("input").prop("checked",!0),we.lazy(function(){var e;pe.find("[id]:not(."+y+"):not(.elfinder-cwd-parent)").trigger(u),W=we.maxTargets&&(E||A).length>we.maxTargets?(e=Ce.map(E||A,function(e){return we.file(e)||null}),e=we.sortFiles(e),Ce.map(e,function(e){return e.hash})):(E||A).concat(),B(),U&&ge.data("pending",!1)},0,{repaint:!0})}function s(){U&&ge.find("input").prop("checked",!1),W.length?(L=!1,W=[],pe.find("[id]."+y).trigger(h),U&&pe.find("input:checkbox").prop("checked",!1)):we.select({selected:[]}),B(),U&&ge.data("pending",!1),pe.removeClass("elfinder-cwd-allselected")}function a(t){function n(e){e&&(be=Ce(p(Ce.extend(!0,{},e,{name:"..",mime:"directory"}))).addClass("elfinder-cwd-parent").bind("mousedown click mouseup touchstart touchmove touchend dblclick mouseenter",function(e){e.preventDefault(),e.stopPropagation()}).dblclick(function(){we.exec("open",we.cwdId2Hash(this.id))}),(m?pe.find("tbody"):pe).prepend(be))}var t=we.cwd().phash,e=we.file(t)||null;e?n(e):we.getUI("tree").hasClass("elfinder-tree")?we.one("parents",function(){n(we.file(t)||null)}):we.request({data:{cmd:"parents",target:we.cwd().hash},preventFail:!0}).done(function(e){n(we.file(t)||null)})}function o(e,t){var n,i,a,r,o,s=m?pe.find("tbody"):pe,l=e.length,d={},c={},u=!!Ce.htmlPrefilter,h=Ce(u?document.createDocumentFragment():"<div></div>");if(G<l)he(),W=e.concat(),B();else{for(l&&ye.removeClass("elfinder-cwd-wrapper-empty");l--;)i=(n=e[l]).hash,Ce("#"+we.cwdHash2Id(i)).length||((a=function(e){for(var t,n=pe.find("[id]:first");n.length;){if(t=we.file(we.cwdId2Hash(n.attr("id"))),!n.hasClass("elfinder-cwd-parent")&&t&&we.compare(e,t)<0)return n;n=n.next("[id]")}}(n))&&!a.length&&(a=null),!a&&0<=(o=function(e){for(var t=Y.length,n=0;n<t;n++)if(we.compare(e,Y[n])<0)return n;return t||-1}(n))?Y.splice(o,0,n):(h.empty().append(p(n)),"directory"!==n.mime||f||ie(h),r=u?h:h.children(),a?a.before(r):s.append(r)),Ce("#"+we.cwdHash2Id(i)).length&&"directory"!==n.mime&&n.tmb&&(1==n.tmb?c[i]=n.tmb:d[i]=n.tmb));te(),se(s),(Object.keys(d).length||Object.keys(c).length)&&(Object.keys($.attachTmbs).length<1&&(fe.off(J,ae).on(J,ae),we.unbind("resize",ae).bind("resize",ae)),Ce.extend($.attachTmbs,d,c),Object.keys(d).length&&ae(d,"change"===t&&"resize"===we.currentReqCmd),Object.keys(c).length&&ae(c))}}function l(e){var t,n,i=e.length;if(we.cwd().hash||"open"===we.currentReqCmd){for(;i--;)if(n=e[i],(t=Ce("#"+we.cwdHash2Id(n))).length)try{t.remove(),--$.renderd}catch(e){we.debug("error",e)}else-1!=(n=function(e){for(var t=Y.length;t--;)if(Y[t].hash==e)return t;return-1}(n))&&Y.splice(n,1);te()}else Ce.each(D.reverse(),function(e,n){if(we.files()[n])return we.one(we.currentReqCmd+"done",function(e,t){t.cwd().hash||t.exec("open",n)}),!1})}function d(t){function n(){var e=0;fe.siblings("div.elfinder-panel:visible").each(function(){e+=Ce(this).outerHeight(!0)}),fe.height(ye.height()-e-fe._padding)}t&&n(),ve&&clearTimeout(ve),ve=setTimeout(function(){var e;t||n(),pe.css("height","auto"),e=fe[0].clientHeight-parseInt(fe.css("padding-top"))-parseInt(fe.css("padding-bottom"))-parseInt(pe.css("margin-top")),pe.outerHeight(!0)<e&&pe.height(e)},20),m&&!F&&ee()}var e,f=we.UA.Mobile,m="list"==we.viewType,u="select."+we.namespace,h="unselect."+we.namespace,c="disable."+we.namespace,g="enable."+we.namespace,v="class",n=we.res(v,"cwdfile"),b="."+n,y="ui-selected",w=we.res(v,"disabled"),x=we.res(v,"draggable"),C=we.res(v,"droppable"),k=we.res(v,"hover"),T=we.res(v,"adroppable"),z=n+"-tmp",O=0<we.options.loadTmbs?we.options.loadTmbs:5,I="",S={},D=[],A=[],E=void 0,M=[],U=Ce.map(xe.showSelectCheckboxUA,function(e){return!(!we.UA[e]&&!e.match(/^all$/i))||null}).length?'<div class="elfinder-cwd-select"><input type="checkbox"></div>':"",F=!1,P=null,H={icon:'<div id="{id}" class="'+n+' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on"{style}></div>{marker}</div><div class="elfinder-cwd-filename" title="{nametitle}">{name}</div>'+U+"</div>",row:""},j=we.res("tpl","perms"),_=we.res("tpl","lock"),R=we.res("tpl","symlink"),N={id:function(e){return we.cwdHash2Id(e.hash)},name:function(e){e=we.escape(e.i18||e.name);return m||(e=e.replace(/([_.])/g,"&#8203;$1")),e},nametitle:function(e){return we.escape(e.i18||e.name)},permsclass:function(e){return we.perms2class(e)},perm:function(e){return we.formatPermissions(e)},dirclass:function(e){var t="directory"==e.mime?"directory":"";return e.isroot&&(t+=" isroot"),e.csscls&&(t+=" "+we.escape(e.csscls)),xe.getClass&&(t+=" "+xe.getClass(e)),t},style:function(e){return e.icon?"style=\"background:url('"+we.escape(e.icon)+"') 0 0 no-repeat;background-size:contain;\"":""},mime:function(e){return we.mime2class(e.mime)},size:function(e){return"directory"!==e.mime||e.size?we.formatSize(e.size):"-"},date:function(e){return we.formatDate(e)},kind:function(e){return we.mime2kind(e)},mode:function(e){return e.perm?we.formatFileMode(e.perm):""},modestr:function(e){return e.perm?we.formatFileMode(e.perm,"string"):""},modeoct:function(e){return e.perm?we.formatFileMode(e.perm,"octal"):""},modeboth:function(e){return e.perm?we.formatFileMode(e.perm,"both"):""},marker:function(e){return(e.alias||"symlink-broken"==e.mime?R:"")+(e.read&&e.write?"":j)+(e.locked?_:"")},tooltip:function(e){var t=we.formatDate(e)+(0<e.size?" ("+we.formatSize(e.size)+")":""),n="",n=I&&e.path?we.escape(e.path.replace(/\/[^\/]*$/,"")):e.tooltip?we.escape(e.tooltip).replace(/\r/g,"&#13;"):"";return m&&(n+=(n?"&#13;":"")+we.escape(e.i18||e.name)),n?n+"&#13;"+t:t}},q=Ce(),L=!1,W=[],K=void 0,B=function(){var e;U&&(e=W.length===A.length,ge.find("input").prop("checked",e),pe[e?"addClass":"removeClass"]("elfinder-cwd-allselected")),we.trigger("select",{selected:W})},X=function(e,t){var n=e.position().top,i=e.outerHeight(!0),a=fe.scrollTop(),r=fe.get(0).clientHeight,o=Z?Z.outerHeight(!0):0;a+r<n+o+i?fe.scrollTop(parseInt(n+o+i-r)):n<a&&fe.scrollTop(n),m&&fe.scrollLeft(0),t&&we.resources.blink(e,"lookme")},Y=[],$={},J="elfscrstop",V={filter:b,stop:B,delay:250,appendTo:"body",autoRefresh:!1,selected:function(e,t){Ce(t.selected).trigger(u)},unselected:function(e,t){Ce(t.unselected).trigger(h)}},G=we.options.showFiles,Q=function(){function e(e){var t,n,e=e||null,i=[],a=!1,r={},o="self"===we.option("tmbUrl"),e=Y.splice(0,G+(e||0)/($.hpi||1));$.renderd+=e.length,Y.length||(me.hide(),fe.off(J,Q)),t=[],i=Ce.map(e,function(e){return e.hash&&e.name?("directory"==e.mime&&(a=!0),(e.tmb||o&&0===e.mime.indexOf("image/"))&&(r[e.hash]=e.tmb),S[e.hash]&&t.push(e.hash),p(e)):null}),d.empty().append(i.join("")),a&&!f&&ie(d),n=[],W.length&&d.find("[id]:not(."+y+"):not(.elfinder-cwd-parent)").each(function(){-1!==Ce.inArray(we.cwdId2Hash(this.id),W)&&n.push(Ce(this))}),s.append(l?d:d.children()),n.length&&(Ce.each(n,function(e,t){t.trigger(u)}),B()),t.length&&we.trigger("lockfiles",{files:t}),$.hpi||se(s,e.length),m&&(pe.find("thead").show(),ee({fitWidth:!P})),Object.keys(r).length&&(Object.keys($.attachTmbs).length<1&&(fe.off(J,ae).on(J,ae),we.unbind("resize",ae).bind("resize",ae)),Ce.extend($.attachTmbs,r),ae(r)),fe.trigger(J)}var t,n,s=m?pe.children("table").children("tbody"):pe,i=!1,l=!!Ce.htmlPrefilter,d=Ce(l?document.createDocumentFragment():"<div></div>");$.renderd?i||0<(t=fe.height()+fe.scrollTop()+we.options.showThreshold+$.row-$.renderd*$.hpi)&&(i=!0,we.lazy(function(){e(t),i=!1})):(i=!0,fe.scrollTop(0),n=we.cwd().phash,e(),xe.oldSchool&&n&&!I&&a(),m&&(P&&te(),ee({fitWidth:!0})),$.itemH=(m?s.find("tr:first"):s.find("[id]:first")).outerHeight(!0),we.trigger("cwdrender"),i=!1)},Z=null,ee=function(e){if(xe.listView.fixedHeader){function t(){var e,t="ltr"===we.direction?(e=-1*fe.scrollLeft(),"left"):(e=fe.scrollLeft(),"right");i.css(t)!==e&&i.css(t,e)}var n,i,a,r,o,s,l,d,c,u,e=e||{},h=pe.find("tbody"),p=h.children("tr:first");if(p.length){if(a=h.parent(),Z?o=(r=Ce("#"+we.namespace+"-cwd-thead")).children("tr:first"):(u=!0,h.addClass("elfinder-cwd-fixheader"),h=(o=(r=pe.find("thead").attr("id",we.namespace+"-cwd-thead")).children("tr:first")).outerHeight(!0),pe.css("margin-top",h-parseInt(a.css("padding-top"))),i=Ce("<div/>").addClass(pe.attr("class")).append(Ce("<table/>").append(r)),Z=Ce("<div></div>").addClass(fe.attr("class")+" elfinder-cwd-fixheader").removeClass("ui-droppable native-droppable").css(fe.position()).css("height",h).append(i),"rtl"===we.direction&&Z.css("right",we.getUI().width()-fe.width()+"px"),t(),fe.after(Z).on("scroll.fixheader resize.fixheader",function(e){t(),"resize"===e.type&&(e.stopPropagation(),ee())})),u||e.fitWidth||2<Math.abs(p.outerWidth()-o.outerWidth())){n=M.length+1;for(var f=0;f<n&&(s=o.children("td:eq("+f+")"),l=p.children("td:eq("+f+")"),d=s.width(),c=l.width(),void 0===s.data("delta")&&s.data("delta",s.outerWidth()-d-(l.outerWidth()-c)),c-=s.data("delta"),u||e.fitWidth||d!==c);f++)s.css("width",c+"px")}Z.data("widthTimer")&&clearTimeout(Z.data("widthTimer")),Z.data("widthTimer",setTimeout(function(){Z&&("rtl"===we.direction&&Z.css("right",we.getUI().width()-fe.width()+"px"),Z.css(fe.position()).css("width",pe.outerWidth()+"px"))},10))}}},te=function(){var e,i;m&&P&&(e="elfinder-cwd-colwidth",(i=pe.find("tr[id]:first")).hasClass(e)||(pe.find("tr."+e).removeClass(e).find("td").css("width",""),i.addClass(e),pe.find("table:first").css("table-layout","fixed"),Ce.each(Ce.merge(["name"],M),function(e,t){var n=P[t]||i.find("td.elfinder-col-"+t).width();i.find("td.elfinder-col-"+t).width(n)})))},ne=Ce.extend({},we.droppable,{over:function(e,t){var n,i,a,r=Ce(this),o=t.helper,s=e.shiftKey||e.ctrlKey||e.metaKey;if(e.stopPropagation(),o.data("dropover",o.data("dropover")+1),r.data("dropover",!0),o.data("namespace")!==we.namespace||!we.insideWorkzone(e.pageX,e.pageY))return r.removeClass(T),void o.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus");r.hasClass(we.res(v,"cwdfile"))?(n=we.cwdId2Hash(r.attr("id")),r.data("dropover",n)):(n=we.cwd().hash,we.cwd().write&&r.data("dropover",n)),a=we.file(o.data("files")[0]).phash===n,r.data("dropover")===n?Ce.each(o.data("files"),function(e,t){if(t===n||a&&!s&&!o.hasClass("elfinder-drag-helper-plus"))return r.removeClass(T),!1}):r.removeClass(T),o.data("locked")||a?i="elfinder-drag-helper-plus":(i="elfinder-drag-helper-move",s&&(i+=" elfinder-drag-helper-plus")),r.hasClass(T)&&o.addClass(i),setTimeout(function(){r.hasClass(T)&&o.addClass(i)},20)},out:function(e,t){t=t.helper;e.stopPropagation(),t.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus").data("dropover",Math.max(t.data("dropover")-1,0)),Ce(this).removeData("dropover").removeClass(T)},deactivate:function(){Ce(this).removeData("dropover").removeClass(T)},drop:function(e,t){s(),we.droppable.drop.call(this,e,t)}}),ie=function(e){var t=(e=e||(m?pe.find("tbody"):pe)).children(".directory:not(."+C+",.elfinder-na,.elfinder-ro)");we.isCommandEnabled("paste")&&t.droppable(ne),we.isCommandEnabled("upload")&&t.addClass("native-droppable"),e.children(".isroot").each(function(e,t){var n=Ce(t),t=we.cwdId2Hash(t.id);we.isCommandEnabled("paste",t)?n.hasClass(C+",elfinder-na,elfinder-ro")||n.droppable(ne):n.hasClass(C)&&n.droppable("destroy"),we.isCommandEnabled("upload",t)?n.hasClass("native-droppable,elfinder-na,elfinder-ro")||n.addClass("native-droppable"):n.hasClass("native-droppable")&&n.removeClass("native-droppable")})},ae=function(e,l){we.option("tmbUrl");function t(e,t){var n,i,a,r,o=Ce("#"+we.cwdHash2Id(e)),s=[];o.length&&we.isInWindow(o,!0)&&("1"!=t?((n=we.file(e)).tmb!==t&&(n.tmb=t),i=we.tmb(n),l?we.reloadContents(i.url).done(function(){o.find(".elfinder-cwd-icon").addClass(i.className).css("background-image","url('"+i.url+"')")}):(a=o,r=i,Ce("<img>").on("load",function(){a.find(".elfinder-cwd-icon").addClass(r.className).css("background-image","url('"+r.url+"')")}).attr("src",r.url))):(l?s:$.getTmbs).push(e),d.push(e)),Ce.each(d,function(e,t){delete $.attachTmbs[t]}),l?re(s):$.getTmbs.length&&re(),Object.keys($.attachTmbs).length<1&&$.getTmbs.length<1&&(fe.off(J,ae),we.unbind("resize",ae))}var d=[];Ce.isPlainObject(e)&&Object.keys(e).length?(Ce.extend($.attachTmbs,e),Ce.each(e,t)):($.attachThumbTm&&clearTimeout($.attachThumbTm),$.attachThumbTm=setTimeout(function(){Ce.each($.attachTmbs,t)},0))},re=function(t){var e=[],n=!1;$.gettingTmb&&!t||(t||($.gettingTmb=!0),we.oldAPI?we.request({data:{cmd:"tmb",current:we.cwd().hash},preventFail:!0}).done(function(e){$.gettingTmb=!1,e.images&&Object.keys(e.images).length&&ae(e.images),e.tmb&&re()}).fail(function(){$.gettingTmb=!1}):(e=t?(n=!0,t.splice(0,O)):$.getTmbs.splice(0,O)).length&&(n||we.isInWindow(Ce("#"+we.cwdHash2Id(e[0])),!0)||we.isInWindow(Ce("#"+we.cwdHash2Id(e[e.length-1])),!0)?we.request({data:{cmd:"tmb",targets:e},preventFail:!0}).done(function(e){$.gettingTmb=!1,e.images&&Object.keys(e.images).length&&ae(e.images,n),n?t.length&&re(t):$.getTmbs.length&&re()}).fail(function(){$.gettingTmb=!1}):(Ce.each(e,function(e,t){$.attachTmbs[t]="1"}),$.gettingTmb=!1,ae())))},oe={name:we.i18n("name"),perm:we.i18n("perms"),date:we.i18n("modify"),size:we.i18n("size"),kind:we.i18n("kind"),modestr:we.i18n("mode"),modeoct:we.i18n("mode"),modeboth:we.i18n("mode")},se=function(e,t){var n,i=1;e=e||(m?pe.find("tbody"):pe),0<Y.length&&(e.css({height:"auto"}),n=e.height(),t&&(m||(i=Math.floor(e.width()/e.find("[id]:first").width()),t=Math.ceil(t/i)*i),$.hpi=n/t,$.row=$.hpi*i),me.css({top:$.hpi*Y.length+n+"px"}).show())},le=function(e){e.preventDefault(),we.trigger("contextmenu",{type:"cwd",targets:[we.cwd().hash],x:e.pageX,y:e.pageY})},de=function(e){1<e.originalEvent.touches.length||(pe.data("longtap",null),fe.data("touching",{x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}),e.target!==this&&e.target!==pe.get(0)||pe.data("tmlongtap",setTimeout(function(){pe.data("longtap",!0),we.trigger("contextmenu",{type:"cwd",targets:[we.cwd().hash],x:fe.data("touching").x,y:fe.data("touching").y})},500)))},ce=function(e){"touchmove"===e.type&&(!fe.data("touching")||4<Math.abs(fe.data("touching").x-e.originalEvent.touches[0].pageX)+Math.abs(fe.data("touching").y-e.originalEvent.touches[0].pageY))&&fe.data("touching",null),clearTimeout(pe.data("tmlongtap"))},ue=function(e){pe.data("longtap")&&(e.preventDefault(),e.stopPropagation())},he=function(){var e;ye.append(ge).removeClass("elfinder-cwd-wrapper-empty elfinder-search-result elfinder-incsearch-result"),(1<we.searchStatus.state||we.searchStatus.ininc)&&ye.addClass("elfinder-search-result"+(we.searchStatus.ininc?" elfinder-incsearch-result":"")),q=Ce();try{pe.empty()}catch(e){pe.html("")}Z&&(fe.off("scroll.fixheader resize.fixheader"),Z.remove(),Z=null),pe.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-"+(m?"list":"icons")).attr("style","").css("height","auto"),me.hide(),fe[m?"addClass":"removeClass"]("elfinder-cwd-wrapper-list")._padding=parseInt(fe.css("padding-top"))+parseInt(fe.css("padding-bottom")),we.UA.iOS&&fe.removeClass("overflow-scrolling-touch").addClass("overflow-scrolling-touch"),m&&(pe.html("<table><thead></thead><tbody></tbody></table>"),e=Ce('<tr class="ui-state-default"><td class="elfinder-cwd-view-th-name">'+oe.name+"</td>"+function(){for(var e="",t="",n=Ce.extend({},oe,xe.listView.columnsCustomName),i=0;i<M.length;i++)e=void 0!==n[M[i]]?n[M[i]]:we.i18n(M[i]),t+='<td class="elfinder-cwd-view-th-'+M[i]+' sortable-item">'+e+"</td>";return t}()+"</tr>"),pe.find("thead").hide().append(e.on("contextmenu."+we.namespace,le).on("touchstart."+we.namespace,"td",de).on("touchmove."+we.namespace+" touchend."+we.namespace+" mouseup."+we.namespace,"td",ce).on("click."+we.namespace,"td",ue)).find("td:first").append(ge),Ce.fn.sortable&&e.addClass("touch-punch touch-punch-keep-default").sortable({axis:"x",distance:8,items:"> .sortable-item",start:function(e,t){Ce(t.item[0]).data("dragging",!0),t.placeholder.width(t.helper.removeClass("ui-state-hover").width()).removeClass("ui-state-active").addClass("ui-state-hover").css("visibility","visible")},update:function(e,t){var n,i,a=Ce(t.item[0]).attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","");M=Ce.map(Ce(this).children(),function(e){e=Ce(e).attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","");return i||(a===e?i=!0:n=e),"name"===e?null:e}),H.row=r(),we.storage("cwdCols",M),n=".elfinder-col-"+n+":first",a=".elfinder-col-"+a+":first",we.lazy(function(){pe.find("tbody tr").each(function(){var e=Ce(this);e.children(n).after(e.children(a))})})},stop:function(e,t){setTimeout(function(){Ce(t.item[0]).removeData("dragging")},100)}}),Ce.fn.resizable&&e.find("td").addClass("touch-punch").resizable({handles:"ltr"===we.direction?"e":"w",start:function(e,t){var n=pe.find("td.elfinder-col-"+t.element.attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","")+":first");t.element.data("resizeTarget",n).data("targetWidth",n.width()),F=!0,"fixed"!==pe.find("table").css("table-layout")&&(pe.find("tbody tr:first td").each(function(){Ce(this).width(Ce(this).width())}),pe.find("table").css("table-layout","fixed"))},resize:function(e,t){t.element.data("resizeTarget").width(t.element.data("targetWidth")-(t.originalSize.width-t.size.width))},stop:function(){ee({fitWidth:!(F=!1)}),P={},pe.find("tbody tr:first td").each(function(){var e=Ce(this).attr("class").split(" ")[0].replace("elfinder-col-","");P[e]=Ce(this).width()}),we.storage("cwdColWidth",P)}}).find(".ui-resizable-handle").addClass("ui-icon ui-icon-grip-dotted-vertical")),we.lazy(function(){Y=Ce.map(E||A,function(e){return we.file(e)||null}),Y=we.sortFiles(Y),$={renderd:0,attachTmbs:{},getTmbs:[],lazyOpts:{tm:0}},ye[Y.length<1?"addClass":"removeClass"]("elfinder-cwd-wrapper-empty"),fe.off(J,Q).on(J,Q).trigger(J),we.cwd().write?(fe[we.isCommandEnabled("upload")?"addClass":"removeClass"]("native-droppable"),fe.droppable("enable")):fe.removeClass("native-droppable").droppable("disable").removeClass("ui-state-disabled")})},pe=Ce(this).addClass("ui-helper-clearfix elfinder-cwd").attr("unselectable","on").on("click."+we.namespace,b,function(e){var t,n,i,a,r=this.id?Ce(this):Ce(this).parents("[id]:first"),o=Ce(e.target);if(U&&(o.is("input:checkbox")||o.hasClass("elfinder-cwd-select")))return e.stopPropagation(),e.preventDefault(),fe.data("touching")||(r.trigger(r.hasClass(y)?h:u),B()),setTimeout(function(){o.prop("checked",r.hasClass(y))},10),!1;if(pe.data("longtap"))e.stopPropagation();else{if(e.shiftKey&&(t=r.prevAll(K||"."+y+":first"),n=r.nextAll(K||"."+y+":first"),i=t.length,a=n.length),e.shiftKey&&(i||a))(i?r.prevUntil("#"+t.attr("id")):r.nextUntil("#"+n.attr("id"))).add(r).trigger(u);else if(e.ctrlKey||e.metaKey)r.trigger(r.hasClass(y)?h:u);else{if(fe.data("touching")&&r.hasClass(y))return fe.data("touching",null),void we.dblclick({file:we.cwdId2Hash(this.id)});s(),r.trigger(u)}B()}}).on("dblclick."+we.namespace,b,function(e){we.dblclick({file:we.cwdId2Hash(this.id)})}).on("touchstart."+we.namespace,b,function(e){var t,n;1<e.originalEvent.touches.length||(t=this.id?Ce(this):Ce(this).parents("[id]:first"),n=Ce(e.target),fe.data("touching",{x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}),U&&(n.is("input:checkbox")||n.hasClass("elfinder-cwd-select"))?setTimeout(function(){fe.data("touching")&&(t.trigger(t.hasClass(y)?h:u),B())},150):"INPUT"!=e.target.nodeName&&"TEXTAREA"!=e.target.nodeName&&(t.prevAll("."+y+":first").length,t.nextAll("."+y+":first").length,pe.data("longtap",null),t.addClass(k).data("tmlongtap",setTimeout(function(){pe.data("longtap",!0),("TD"!=e.target.nodeName||0<we.selected().length)&&(t.trigger(u),B(),we.trigger("contextmenu",{type:"files",targets:we.selected(),x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}))},500))))}).on("touchmove."+we.namespace+" touchend."+we.namespace,b,function(e){var t;"INPUT"==e.target.nodeName||"TEXTAREA"==e.target.nodeName||Ce(e.target).hasClass("elfinder-cwd-select")||(t=this.id?Ce(this):Ce(this).parents("[id]:first"),clearTimeout(t.data("tmlongtap")),"touchmove"===e.type?(fe.data("touching",null),t.removeClass(k)):fe.data("touching")&&!pe.data("longtap")&&t.hasClass(y)&&(e.preventDefault(),fe.data("touching",null),we.dblclick({file:we.cwdId2Hash(this.id)})))}).on("mouseenter."+we.namespace,b,function(e){var t=Ce(this),i=null,n=m?t:t.children("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename");f||t.hasClass(z)||n.hasClass(x)||n.hasClass(w)||n.on("mousedown",function(e){e.shiftKey&&!we.UA.IE&&pe.data("selectable")&&(pe.selectable("destroy").data("selectable",!1),setTimeout(function(){pe.selectable(V).data("selectable",!0)},10)),n.draggable("option","disabled",e.shiftKey).removeClass("ui-state-disabled"),e.shiftKey?n.attr("draggable","true"):n.removeAttr("draggable").draggable("option","cursorAt",{left:50-parseInt(Ce(e.currentTarget).css("margin-left")),top:47})}).on("dragstart",function(e){var t=e.dataTransfer||e.originalEvent.dataTransfer||null;if(i=null,t&&!we.UA.IE){var n=this.id?Ce(this):Ce(this).parents("[id]:first"),a=Ce("<span>"),r="",o=null,s=null,l=[],e=function(e){var t=e.mime,e=we.tmb(e),t='<div class="elfinder-cwd-icon '+we.mime2class(t)+' ui-corner-all"></div>';return e&&(t=Ce(t).addClass(e.className).css("background-image","url('"+e.url+"')").get(0).outerHTML),t},d=[];return n.trigger(u),B(),Ce.each(W,function(e,t){var n=we.file(t),i=n.url;if(n&&"directory"!==n.mime){if(i){if("1"==i)return d.push(t),!0}else i=we.url(n.hash);i&&(i=we.convAbsUrl(i),l.push(t),Ce("<a>").attr("href",i).text(i).appendTo(a),r+=i+"\n",o=o||n.mime+":"+n.name+":"+i,s=s||i+"\n"+n.name)}}),d.length?(Ce.each(d,function(e,t){var n=we.file(t);n.url="",we.request({data:{cmd:"url",target:t},notify:{type:"url",cnt:1},preventDefault:!0}).always(function(e){n.url=e.url||"1"})}),!1):!!r&&(t.setDragImage&&(i=Ce('<div class="elfinder-drag-helper html5-native"></div>').append(e(we.file(l[0]))).appendTo(Ce(document.body)),1<(n=l.length)&&i.append(e(we.file(l[n-1]))+'<span class="elfinder-drag-num">'+n+"</span>"),t.setDragImage(i.get(0),50,47)),t.effectAllowed="copyLink",t.setData("DownloadURL",o),t.setData("text/x-moz-url",s),t.setData("text/uri-list",r),t.setData("text/plain",r),t.setData("text/html",a.html()),t.setData("elfinderfrom",window.location.href+we.cwd().hash),void t.setData("elfinderfrom:"+t.getData("elfinderfrom"),""))}}).on("dragend",function(e){s(),i&&i.remove()}).draggable(we.draggable)}).on(u,b,function(e){var t=Ce(this),n=we.cwdId2Hash(t.attr("id"));L||t.hasClass(w)||(K="#"+this.id,t.addClass(y).children().addClass(k).find("input:checkbox").prop("checked",!0),-1===Ce.inArray(n,W)&&W.push(n),q=pe.find("[id]."+y+":last").next())}).on(h,b,function(e){var t=Ce(this),n=we.cwdId2Hash(t.attr("id"));L||(t.removeClass(y).children().removeClass(k).find("input:checkbox").prop("checked",!1),pe.hasClass("elfinder-cwd-allselected")&&(U&&ge.children("input").prop("checked",!1),pe.removeClass("elfinder-cwd-allselected")),-1!==(n=Ce.inArray(n,W))&&(K=void 0,W.splice(n,1)))}).on(c,b,function(){var e=Ce(this).removeClass(k+" "+y).addClass(w),t=e.children(),n=m?e:t.find("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename");t.removeClass(k+" "+y),e.hasClass(C)&&e.droppable("disable"),n.hasClass(x)&&n.draggable("disable")}).on(g,b,function(){var e=Ce(this).removeClass(w),t=m?e:e.children("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename");e.hasClass(C)&&e.droppable("enable"),t.hasClass(x)&&t.draggable("enable")}).on("scrolltoview",b,function(){X(Ce(this),!0)}).on("mouseenter."+we.namespace+" mouseleave."+we.namespace,b,function(e){we.trigger("hover",{hash:we.cwdId2Hash(Ce(this).attr("id")),type:e.type}),Ce(this).toggleClass(k,"mouseenter"==e.type)}).on("contextmenu."+we.namespace,function(e){var t=Ce(e.target).closest("."+n);t.length&&("TD"!=e.target.nodeName||-1<Ce.inArray(we.cwdId2Hash(t.get(0).id),we.selected()))&&(e.stopPropagation(),e.preventDefault(),t.hasClass(w)||fe.data("touching")||(t.hasClass(y)||(s(),t.trigger(u),B()),we.trigger("contextmenu",{type:"files",targets:we.selected(),x:e.pageX,y:e.pageY})))}).on("click."+we.namespace,function(e){e.target!==this||pe.data("longtap")||e.shiftKey||e.ctrlKey||e.metaKey||s()}).on("create."+we.namespace,function(e,t){var n=m?pe.find("tbody"):pe,i=n.find(".elfinder-cwd-parent"),a=t.move||!1,t=Ce(p(t)).addClass(z),r=we.selected();r.length?a&&we.trigger("lockfiles",{files:r}):s(),i.length?i.after(t):n.prepend(t),te(),fe.scrollTop(0).scrollLeft(0)}).on("unselectall",s).on("selectfile",function(e,t){Ce("#"+we.cwdHash2Id(t)).trigger(u),B()}).on("colwidth",function(){m&&(pe.find("table").css("table-layout","").find("td").css("width",""),ee({fitWidth:!0}),we.storage("cwdColWidth",P=null))}),fe=Ce('<div class="elfinder-cwd-wrapper"></div>').droppable(Ce.extend({},ne,{autoDisable:!1})).on("contextmenu."+we.namespace,le).on("touchstart."+we.namespace,de).on("touchmove."+we.namespace+" touchend."+we.namespace,ce).on("click."+we.namespace,ue).on("scroll."+we.namespace,function(){$.seltm&&clearTimeout($.seltm),$.scrtm&&clearTimeout($.scrtm),$.scrtm&&Math.abs(($.scrolltop||0)-($.scrolltop=Ce(this).scrollTop()))<2?($.scrtm=0,fe.trigger(J)):$.scrtm=setTimeout(function(){$.scrtm=0,fe.trigger(J)},100)}),me=Ce("<div>&nbsp;</div>").css({position:"absolute",width:"1px",height:"1px"}).hide(),ge=U?Ce('<div class="elfinder-cwd-selectall"><input type="checkbox"></div>').attr("title",we.i18n("selectall")).on("touchstart mousedown click",function(e){return e.stopPropagation(),e.preventDefault(),!Ce(this).data("pending")&&"click"!==e.type&&(ge.data("pending",!0),void(pe.hasClass("elfinder-cwd-allselected")?(ge.find("input").prop("checked",!1),setTimeout(function(){s()},10)):t()))}):Ce(),ve=null,be=Ce(this).parent().resize(d),ye=be.children(".elfinder-workzone").append(fe.append(this).append(me)),N=Ce.extend(N,xe.replacement||{});try{P=we.storage("cwdColWidth")?we.storage("cwdColWidth"):null}catch(e){P=null}(M=we.storage("cwdCols"))?(M=Ce.map(M,function(e){return-1!==xe.listView.columns.indexOf(e)?e:null}),xe.listView.columns.length>M.length&&Ce.each(xe.listView.columns,function(e,t){-1===M.indexOf(t)&&M.push(t)})):M=xe.listView.columns,H.row=r(),f&&Ce("body").on("touchstart touchmove touchend",function(e){}),U&&pe.addClass("elfinder-has-checkbox"),Ce(window).on("scroll."+we.namespace,function(){e&&clearTimeout(e),e=setTimeout(function(){fe.trigger(J)},50)}),Ce(document).on("keydown."+we.namespace,function(e){e.keyCode==Ce.ui.keyCode.ESCAPE&&(we.getUI().find(".ui-widget:visible").length||s())}),we.one("init",function(){var i,a,r,e=document.createElement("style");document.head.appendChild(e),(e=e.sheet).insertRule('.elfinder-cwd-wrapper-empty .elfinder-cwd:after{ content:"'+we.i18n("emptyFolder")+'" }',0),e.insertRule('.elfinder-cwd-wrapper-empty .ui-droppable .elfinder-cwd:after{ content:"'+we.i18n("emptyFolder"+(f?"LTap":"Drop"))+'" }',1),e.insertRule('.elfinder-cwd-wrapper-empty .ui-droppable-disabled .elfinder-cwd:after{ content:"'+we.i18n("emptyFolder")+'" }',2),e.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result .elfinder-cwd:after{ content:"'+we.i18n("emptySearch")+'" }',3),e.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-incsearch-result .elfinder-cwd:after{ content:"'+we.i18n("emptyIncSearch")+'" }',3),f||(pe.selectable(V).data("selectable",!0),i=function(){pe.data("selectable")&&($.seltm&&clearTimeout($.seltm),$.seltm=0,pe.selectable("enable").selectable("refresh"))},fe.on(J,function(){pe.off("mousedown",i).one("mousedown",i),$.seltm=setTimeout(function(){pe.off("mousedown",i),i()},2e3)}),r=Ce('<div style="position:absolute"></div>'),(a=we.getUI()).on("resize",function(e,t){var n;t&&t.fullscreen&&(n=a.offset(),"on"===t.fullscreen?(r.css({top:-1*n.top,left:-1*n.left}).appendTo(a),V.appendTo=r):(r.detach(),V.appendTo="body"),pe.selectable("option",{appendTo:V.appendTo})),i()}))}).bind("open add remove searchend",function(){var t=we.cwd().hash;A=Ce.map(we.files(),function(e){return e.phash==t?e.hash:null})}).bind("open",function(){D=we.parents(we.cwd().hash),E=void 0,s(),he(),d()}).bind("search",function(e){A=Ce.map(e.data.files,function(e){return e.hash}),E=void 0,we.searchStatus.ininc=!1,he(),we.autoSync("stop"),d()}).bind("searchend",function(e){(I||E)&&(I="",E&&we.trigger("incsearchend",e.data),e.data&&e.data.noupdate||he()),we.autoSync(),d()}).bind("searchstart",function(e){s(),I=e.data.query}).bind("incsearchstart",function(e){W=[],we.lazy(function(){var t;(I=e.data.query||"")?(t=new RegExp(I.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g,"\\$1"),"i"),E=Ce.map(A,function(e){e=we.file(e);return e&&(e.name.match(t)||e.i18&&e.i18.match(t))?e.hash:null}),we.trigger("incsearch",{hashes:E,query:I}).searchStatus.ininc=!0,he(),we.autoSync("stop")):we.trigger("incsearchend"),d()})}).bind("incsearchend",function(e){I="",we.searchStatus.ininc=!1,E=void 0,e.data&&e.data.noupdate||he(),we.autoSync()}).bind("sortchange",function(){var e=fe.scrollLeft();he(),we.one("cwdrender",function(){fe.scrollLeft(e),W.length&&B(),d()})}).bind("viewchange",function(){var e="list"==we.storage("view"),t=pe.hasClass("elfinder-cwd-allselected");e!=m&&(m=e,we.viewType=m?"list":"icons",he(),t&&(pe.addClass("elfinder-cwd-allselected"),ge.find("input").prop("checked",!0)),W.length&&B()),d()}).bind("wzresize",function(){var e,t=m?pe.find("tbody"):pe;d(!0),$.hpi&&se(t,t.find("[id]").length),e=pe.offset(),ye.data("rectangle",Ce.extend({width:ye.width(),height:ye.height(),cwdEdge:"ltr"===we.direction?e.left:e.left+pe.width()},ye.offset())),$.itemH=(m?t.find("tr:first"):t.find("[id]:first")).outerHeight(!0)}).bind("changeclipboard",function(e){S={},e.data&&e.data.clipboard&&e.data.clipboard.length&&Ce.each(e.data.clipboard,function(e,t){t.cut&&(S[t.hash]=!0)})}).bind("resMixinMake",function(){te()}).bind("tmbreload",function(e){var n={},e=e.data&&e.data.files?e.data.files:null;Ce.each(e,function(e,t){t.tmb&&"1"!=t.tmb&&(n[t.hash]=t.tmb)}),Object.keys(n).length&&ae(n,!0)}).add(function(e){var t=we.cwd().hash,n=I?new RegExp(I.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g,"\\$1"),"i"):null,e=n?Ce.map(e.data.added||[],function(e){return we.searchStatus.ininc&&e.phash!=t||!(e.name.match(n)||e.i18&&e.i18.match(n))?null:e}):Ce.map(e.data.added||[],function(e){return e.phash==t?e:null});o(e),m&&d(),fe.trigger(J)}).change(function(e){var t=we.cwd().hash,n=we.selected();I?Ce.each(e.data.changed||[],function(e,t){l([t.hash]),-1!==t.name.indexOf(I)&&(o([t],"change"),-1!==Ce.inArray(t.hash,n)&&i(t.hash))}):Ce.each(Ce.map(e.data.changed||[],function(e){return e.phash==t?e:null}),function(e,t){l([t.hash]),o([t],"change"),-1!==Ce.inArray(t.hash,n)&&i(t.hash)}),B()}).remove(function(e){var t=m?pe.find("tbody"):pe;l(e.data.removed||[]),B(),Y.length<1&&t.children().length<1?(ye.addClass("elfinder-cwd-wrapper-empty"),U&&ge.find("input").prop("checked",!1),me.hide(),fe.off(J,Q),d()):(se(t),fe.trigger(J))}).dragstart(function(e){var t=Ce(e.data.target),e=e.data.originalEvent;t.hasClass(b.substr(1))&&(t.hasClass(y)||(e.ctrlKey||e.metaKey||e.shiftKey||s(),t.trigger(u),B())),pe.selectable("disable").removeClass(w),L=!0}).dragstop(function(){pe.selectable("enable"),L=!1}).bind("lockfiles unlockfiles selectfiles unselectfiles",function(e){var t,a,r,n={lockfiles:c,unlockfiles:g,selectfiles:u,unselectfiles:h}[e.type],i=e.data.files||[],o=i.length,s=e.data.helper||Ce();if(0<o&&(t=we.parents(i[0])),n!==u&&n!==h||(r=(a=n===u)?W.concat():W,Ce.each(i,function(e,t){var n=Ce.inArray(t,r),i=pe.hasClass("elfinder-cwd-allselected");-1===n?a&&W.push(t):(i&&(U&&ge.children("input").prop("checked",!1),pe.removeClass("elfinder-cwd-allselected"),i=!1),a||W.splice(n,1))})),!s.data("locked")){for(;o--;)Ce("#"+we.cwdHash2Id(i[o])).trigger(n);e.data.inselect||B()}fe.data("dropover")&&-1!==t.indexOf(fe.data("dropover"))&&(e="lockfiles"!==e.type,s.toggleClass("elfinder-drag-helper-plus",e),fe.toggleClass(T,e))}).bind("mkdir mkfile duplicate upload rename archive extract paste multiupload",function(e){var n;"upload"==e.type&&e.data._multiupload||(n=we.cwd().hash,s(),Ce.each((e.data.added||[]).concat(e.data.changed||[]),function(e,t){t&&t.phash==n&&i(t.hash)}),B())}).shortcut({pattern:"ctrl+a",description:"selectall",callback:t}).shortcut({pattern:"left right up down shift+left shift+right shift+up shift+down",description:"selectfiles",type:"keydown",callback:function(e){!function(e,t){var n,i,a,r,o,s=Ce.ui.keyCode,l=e==s.LEFT||e==s.UP,d=pe.find("[id]."+y);function c(e,t){return e[t+"All"]("[id]:not(."+w+"):not(.elfinder-cwd-parent):first")}if(d.length)if((a=c(n=d.filter(l?":first":":last"),l?"prev":"next")).length)if(m||e==s.LEFT||e==s.RIGHT)i=a;else if(r=n.position().top,o=n.position().left,i=n,l){for(;i=i.prev("[id]"),i.length&&!(i.position().top<r&&i.position().left<=o););i.hasClass(w)&&(i=c(i,"next"))}else{for(;i=i.next("[id]"),i.length&&!(i.position().top>r&&i.position().left>=o););i.hasClass(w)&&(i=c(i,"prev")),i.length||(a=pe.find("[id]:not(."+w+"):last")).position().top>r&&(i=a)}else i=n;else i=q.length?l?q.prev():q:pe.find("[id]:not(."+w+"):not(.elfinder-cwd-parent):"+(l?"last":"first"));i&&i.length&&!i.hasClass("elfinder-cwd-parent")&&(n&&t?i=n.add(n[l?"prevUntil":"nextUntil"]("#"+i.attr("id"))).add(i):d.trigger(h),i.trigger(u),X(i.filter(l?":first":":last")),B())}(e.keyCode,e.shiftKey)}}).shortcut({pattern:"home",description:"selectffile",callback:function(e){s(),X(pe.find("[id]:first").trigger(u)),B()}}).shortcut({pattern:"end",description:"selectlfile",callback:function(e){s(),X(pe.find("[id]:last").trigger(u)),B()}}).shortcut({pattern:"page_up",description:"pageTurning",callback:function(e){$.itemH&&fe.scrollTop(Math.round(fe.scrollTop()-Math.floor((fe.height()+(m?-1*$.itemH:16))/$.itemH)*$.itemH))}}).shortcut({pattern:"page_down",description:"pageTurning",callback:function(e){$.itemH&&fe.scrollTop(Math.round(fe.scrollTop()+Math.floor((fe.height()+(m?-1*$.itemH:16))/$.itemH)*$.itemH))}})}),this},Ce.fn.elfinderdialog=function(b,y){var e,w,x=-1!=window.navigator.platform.indexOf("Win");return y&&y.ui?w=y.getUI():(w=this.closest(".elfinder"),y=y||w.elfinder("instance")),"string"==typeof b?(e=this.closest(".ui-dialog")).length&&("open"==b?"none"==e.css("display")&&e.fadeIn(120,function(){e.trigger("open")}):"close"==b||"destroy"==b?(e.stop(!0),(e.is(":visible")||w.is(":hidden"))&&e.hide().trigger("close"),"destroy"==b&&e.remove()):"toTop"==b?e.trigger("totop"):"posInit"==b?e.trigger("posinit"):"tabstopsInit"==b&&e.trigger("tabstopsInit")):((b=Ce.extend({},Ce.fn.elfinderdialog.defaults,b)).allowMinimize&&"auto"===b.allowMinimize&&(b.allowMinimize=!!this.find("textarea,input").length),b.headerBtnPos&&"auto"===b.headerBtnPos&&(b.headerBtnPos=x?"right":"left"),b.headerBtnOrder&&"auto"===b.headerBtnOrder&&(b.headerBtnOrder=x?"close:maximize:minimize":"close:minimize:maximize"),b.modal&&b.allowMinimize&&(b.allowMinimize=!1),this.filter(":not(.ui-dialog-content)").each(function(){function e(){(m=v.find("."+s)).length&&(m.attr("tabindex","-1"),m.filter("."+l).length||u.children("."+s+":"+(x?"first":"last")).addClass(l))}function o(n){var i=m.filter(":visible"),a=n?null:i.filter("."+l+":first");return a&&a.length||(a=i.first()),n&&Ce.each(i,function(e,t){if(t===n&&i[e+1])return a=i.eq(e+1),!1}),a}var i=Ce(this).addClass("ui-dialog-content ui-widget-content"),t="elfinder-dialog-active",n="elfinder-dialog",a="elfinder-dialog-notify",r="ui-state-hover",s="elfinder-tabstop",l="elfinder-focus",d=parseInt(1e6*Math.random()),c=Ce('<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="elfinder-dialog-title">'+b.title+"</span></div>"),u=Ce('<div class="ui-dialog-buttonset"></div>'),h=Ce('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"></div>').append(u),p=0,f=0,m=Ce(),g={close:function(){c.prepend(Ce('<span class="ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button"><span class="ui-icon ui-icon-closethick"></span></span>').on("mousedown",function(e){e.preventDefault(),e.stopPropagation(),i.elfinderdialog("close")}))},maximize:function(){b.allowMaximize&&(v.on("resize",function(e,t){var n;if(t&&t.maximize){if(n=c.find(".elfinder-titlebar-full"),t="on"===t.maximize,n.children("span.ui-icon").toggleClass("ui-icon-plusthick",!t).toggleClass("ui-icon-arrowreturnthick-1-s",t),t){try{v.hasClass("ui-draggable")&&v.draggable("disable"),v.hasClass("ui-resizable")&&v.resizable("disable")}catch(e){}void 0===n.data("style")&&(i.height(i.height()),n.data("style",i.attr("style")||"")),i.css("width","100%").css("height",v.height()-v.children(".ui-dialog-titlebar").outerHeight(!0)-h.outerHeight(!0))}else{i.attr("style",n.data("style")),n.removeData("style");try{v.hasClass("ui-draggable")&&v.draggable("enable"),v.hasClass("ui-resizable")&&v.resizable("enable")}catch(e){}}v.trigger("resize")}}),c.prepend(Ce('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-full"><span class="ui-icon ui-icon-plusthick"></span></span>').on("mousedown",function(e){e.preventDefault(),e.stopPropagation(),y.toggleMaximize(v)})))},minimize:function(){b.allowMinimize&&c.on("dblclick",function(e){Ce(this).children(".elfinder-titlebar-minimize").trigger("mousedown")}).prepend(Ce('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-minimize"><span class="ui-icon ui-icon-minusthick"></span></span>').on("mousedown",function(e){var t,n=Ce(this);if(e.preventDefault(),e.stopPropagation(),void 0!==n.data("style"))w.append(v),v.attr("style",n.data("style")).removeClass("elfinder-dialog-minimized").off("mousedown.minimize"),n.removeData("style").show(),c.children(".elfinder-titlebar-full").show(),v.children(".ui-widget-content").slideDown("fast",function(){var e;if(this===v.children(".ui-widget-content:first").get(0)){if(v.find("."+y.res("class","editing"))&&y.disable(),e={minimize:"off"},v.hasClass("elfinder-maximized"))e.maximize="on";else try{v.hasClass("ui-draggable")&&v.draggable("enable"),v.hasClass("ui-resizable")&&v.resizable("enable")}catch(e){}v.trigger("resize",e)}});else{try{v.hasClass("ui-draggable")&&v.draggable("disable"),v.hasClass("ui-resizable")&&v.resizable("disable")}catch(e){}n.data("style",v.attr("style")||"").hide(),c.children(".elfinder-titlebar-full").hide(),t=v.width(),v.children(".ui-widget-content").slideUp("fast",function(){this===v.children(".ui-widget-content:first").get(0)&&(v.trigger("resize",{minimize:"on"}),v.attr("style","").css({maxWidth:t}).addClass("elfinder-dialog-minimized").one("mousedown.minimize",function(e){n.trigger("mousedown")}).appendTo(y.getUI("bottomtray")))})}}))}},v=Ce('<div class="ui-front ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog touch-punch '+n+" "+b.cssClass+'"></div>').hide().append(i).appendTo(w).draggable({handle:".ui-dialog-titlebar",containment:"document",stop:function(e,t){v.css({height:b.height}),i.data("draged",!0)}}).css({width:b.width,height:b.height}).on("mousedown",function(e){v.hasClass("ui-front")||setTimeout(function(){v.is(":visible:not(.elfinder-dialog-minimized)")&&v.trigger("totop")},10)}).on("open",function(){var e=Ce(this),r=e.outerWidth()>w.width()-10?w.width()-10:null;r&&e.css({width:r,left:"5px"}),v.hasClass(a)||w.children("."+n+":visible:not(."+a+")").each(function(){var e=Ce(this),t=parseInt(e.css("top")),n=parseInt(e.css("left")),i=parseInt(v.css("top")),a=parseInt(v.css("left"));e[0]==v[0]||t!=i&&n!=a||v.css({top:t+(r?15:10)+"px",left:(r?5:n+10)+"px"})}),v.data("modal")&&y.getUI("overlay").elfinderoverlay("show"),v.trigger("totop"),"function"==typeof b.open&&Ce.proxy(b.open,i[0])(),y.UA.Mobile&&o().focus(),b.closeOnEscape&&Ce(document).on("keyup."+d,function(e){e.keyCode==Ce.ui.keyCode.ESCAPE&&v.hasClass(t)&&i.elfinderdialog("close")})}).on("close",function(){var e;b.closeOnEscape&&Ce(document).off("keyup."+d),b.allowMaximize&&y.toggleMaximize(v,!1),v.data("modal")&&y.getUI("overlay").elfinderoverlay("hide"),"function"==typeof b.close?Ce.proxy(b.close,i[0])():b.destroyOnClose&&v.hide().remove(),(e=w.children("."+n+":visible")).length?e.filter(":last").trigger("totop"):setTimeout(function(){y.enable()},20)}).on("totop",function(){v.hasClass("elfinder-dialog-minimized")&&c.children(".elfinder-titlebar-minimize").trigger("mousedown"),y.toFront(v),w.children("."+n).removeClass(t+" ui-front"),v.addClass(t+" ui-front"),y.UA.Mobile||o().focus()}).on("posinit",function(){var e=b.position;e||v.data("resizing")||(e={top:Math.max(0,parseInt((w.height()-v.outerHeight())/2-42))+"px",left:Math.max(0,parseInt((w.width()-v.outerWidth())/2))+"px"}),b.absolute&&(e.position="absolute"),e&&v.css(e)}).on("resize",function(e,t){"function"==typeof b.resize&&Ce.proxy(b.resize,i[0])(e,t)}).on("tabstopsInit",e).on("focus","."+s,function(){Ce(this).addClass(r).parent("label").addClass(r),this.id&&Ce(this).parent().find("label[for="+this.id+"]").addClass(r)}).on("blur","."+s,function(){Ce(this).removeClass(r).parent("label").removeClass(r),this.id&&Ce(this).parent().find("label[for="+this.id+"]").removeClass(r)}).on("mouseenter mouseleave","."+s,function(e){var t=Ce(this);b.btnHoverFocus?"mouseenter"==e.type&&t.focus():t.toggleClass(r,"mouseenter"==e.type)}).on("keydown","."+s,function(e){var n,i,a,t=Ce(this);t.is(":focus")&&(e.stopPropagation(),e.keyCode==Ce.ui.keyCode.ENTER?(e.preventDefault(),t.click()):e.keyCode==Ce.ui.keyCode.TAB&&e.shiftKey||e.keyCode==Ce.ui.keyCode.LEFT||e.keyCode==Ce.ui.keyCode.UP?t.is("input:text")&&!e.ctrlKey&&!e.metaKey&&e.keyCode==Ce.ui.keyCode.LEFT||t.is("select")&&e.keyCode!=Ce.ui.keyCode.TAB||t.is("textarea")&&!e.ctrlKey&&!e.metaKey||(e.preventDefault(),n=this,i=m.filter(":visible"),a=i.last(),Ce.each(i,function(e,t){if(t===n&&i[e-1])return a=i.eq(e-1),!1}),a.focus()):e.keyCode!=Ce.ui.keyCode.TAB&&e.keyCode!=Ce.ui.keyCode.RIGHT&&e.keyCode!=Ce.ui.keyCode.DOWN||t.is("input:text")&&!e.ctrlKey&&!e.metaKey&&e.keyCode==Ce.ui.keyCode.RIGHT||t.is("select")&&e.keyCode!=Ce.ui.keyCode.TAB||t.is("textarea")&&!e.ctrlKey&&!e.metaKey||(e.preventDefault(),o(this).focus()))}).data({modal:b.modal});v.prepend(c),Ce.each(b.headerBtnOrder.split(":").reverse(),function(e,t){g[t]&&g[t]()}),x&&c.children(".elfinder-titlebar-button").addClass("elfinder-titlebar-button-right"),Ce.each(b.buttons,function(e,t){t=Ce('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-btncnt-'+f+++" "+s+'"><span class="ui-button-text">'+e+"</span></button>").on("click",Ce.proxy(t,i[0]));x?u.append(t):u.prepend(t)}),u.children().length&&(v.append(h),v.show(),h.find("button").each(function(e,t){p+=Ce(t).outerWidth(!0)}),v.hide(),p+=20,v.width()<p&&v.width(p)),v.trigger("posinit").data("margin-y",i.outerHeight(!0)-i.height()),b.resizable&&Ce.fn.resizable&&v.resizable({minWidth:b.minWidth,minHeight:b.minHeight,start:function(){!0!==v.data("resizing")&&v.data("resizing")&&clearTimeout(v.data("resizing")),v.data("resizing",!0)},stop:function(){v.data("resizing",setTimeout(function(){v.data("resizing",!1)},200))},resize:function(e,t){var n=0;v.children(".ui-widget-header,.ui-dialog-buttonpane").each(function(){n+=Ce(this).outerHeight(!0)}),i.height(t.size.height-n-v.data("margin-y")),v.trigger("resize")}}),"function"==typeof b.create&&Ce.proxy(b.create,this)(),e(),b.autoOpen&&i.elfinderdialog("open")})),this},Ce.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:!1,resizable:!0,autoOpen:!0,closeOnEscape:!0,destroyOnClose:!1,buttons:{},btnHoverFocus:!0,position:null,absolute:!1,width:320,height:"auto",minWidth:200,minHeight:110,allowMinimize:"auto",allowMaximize:!1,headerBtnPos:"auto",headerBtnOrder:"auto"},Ce.fn.elfinderfullscreenbutton=function(i){return this.each(function(){var t=Ce(this).elfinderbutton(i),n=t.children(".elfinder-button-icon");i.change(function(){var e=i.value;n.toggleClass("elfinder-button-icon-unfullscreen",e),t.attr("title",e?i.fm.i18n("reinstate"):i.fm.i18n("cmdfullscreen")),i.className=e?"unfullscreen":"",i.title=i.fm.i18n(e?"reinstate":"cmdfullscreen")})})},Ce.fn.elfindermkdirbutton=function(t){return this.each(function(){var e=Ce(this).elfinderbutton(t);t.change(function(){e.attr("title",t.value)})})},Ce.fn.elfindernavbar=function(d,c){return this.not(".elfinder-navbar").each(function(){function a(){var e=d.getUI("cwd"),t=d.getUI("workzone"),n=t.data("rectangle"),i=e.offset();t.data("rectangle",Ce.extend(n,{cwdEdge:"ltr"===d.direction?i.left:i.left+e.width()}))}var n,r,o,t,s=Ce(this).hide().addClass("ui-state-default elfinder-navbar"),e=s.parent().children(".elfinder-workzone").append(s),i=s.outerHeight()-s.height(),l="ltr"==d.direction;d.one("cssloaded",function(){i!==(i=s.outerHeight()-s.height())&&d.trigger("wzresize")}).bind("wzresize",function(){s.height(e.height()-i)}),d.UA.Touch&&(void 0===(o=d.storage("autoHide")||{}).navbar&&(o.navbar=c.autoHideUA&&0<c.autoHideUA.length&&Ce.map(c.autoHideUA,function(e){return!!d.UA[e]||null}).length,d.storage("autoHide",o)),o.navbar&&d.one("init",function(){d.uiAutoHide.push(function(){s.stop(!0,!0).trigger("navhide",{duration:"slow",init:!0})})}),d.bind("load",function(){"none"!==(r=Ce('<div class="elfinder-navbar-swipe-handle"></div>').hide().appendTo(e)).css("pointer-events")&&(r.remove(),r=null)}),s.on("navshow navhide",function(e,t){var n="navshow"===e.type?"show":"hide",e=t&&t.duration?t.duration:"fast",i=t&&t.handleW?t.handleW:Math.max(50,d.getUI().width()/10);s.stop(!0,!0)[n](e,function(){"show"==n?r&&r.stop(!0,!0).hide():r&&(r.width(i||""),d.resources.blink(r,"slowonce")),d.trigger("navbar"+n).getUI("cwd").trigger("resize"),t.init&&d.trigger("uiautohide"),a()}),o.navbar="show"!=n,d.storage("autoHide",Ce.extend(d.storage("autoHide"),{navbar:o.navbar}))})),Ce.fn.resizable&&!d.UA.Mobile&&(n=s.resizable({handles:l?"e":"w",minWidth:c.minWidth||150,maxWidth:c.maxWidth||500,stop:function(e,t){d.storage("navbarWidth",t.size.width),a()}}).on("resize scroll",function(t){l||"resize"!==t.type||s.css("left",0),clearTimeout(Ce(this).data("posinit")),Ce(this).data("posinit",setTimeout(function(){var e=d.UA.Opera&&s.scrollLeft()?20:2;n.css({top:parseInt(s.scrollTop())+"px",left:l?"auto":parseInt(s.scrollLeft()+e),right:l?-1*parseInt(s.scrollLeft()-e):"auto"}),"resize"===t.type&&d.getUI("cwd").trigger("resize")},50))}).find(".ui-resizable-handle").addClass("ui-front"),d.one("open",function(){setTimeout(function(){s.trigger("resize")},150)})),(t=d.storage("navbarWidth"))?s.width(t):d.UA.Mobile&&d.one("cssloaded",function(){s.data("defWidth",s.width()),Ce(window).on("resize."+d.namespace,function(e){t=s.parent().width()/2,s.data("defWidth")>t?s.width(t):s.width(s.data("defWidth")),s.data("width",s.width())})})}),this},Ce.fn.elfinderoverlay=function(e){var t,n,i,a=this.parent().elfinder("instance");return this.filter(":not(.elfinder-overlay)").each(function(){e=Ce.extend({},e),Ce(this).addClass("ui-front ui-widget-overlay elfinder-overlay").hide().mousedown(function(e){e.preventDefault(),e.stopPropagation()}).data({cnt:0,show:"function"==typeof e.show?e.show:function(){},hide:"function"==typeof e.hide?e.hide:function(){}})}),"show"==e&&(n=(t=this.eq(0)).data("cnt")+1,i=t.data("show"),a.toFront(t),t.data("cnt",n),t.is(":hidden")&&(t.show(),i())),"hide"==e&&(n=(t=this.eq(0)).data("cnt")-1,i=t.data("hide"),t.data("cnt",n),n<=0&&(t.hide(),i())),this},Ce.fn.elfinderpanel=function(a){return this.each(function(){var n=Ce(this).addClass("elfinder-panel ui-state-default ui-corner-all"),i="margin-"+("ltr"==a.direction?"left":"right");a.one("load",function(e){var t=a.getUI("navbar");n.css(i,parseInt(t.outerWidth(!0))),t.on("resize",function(){n.is(":visible")&&n.css(i,parseInt(t.outerWidth(!0)))})})})},Ce.fn.elfinderpath=function(p){return this.each(function(){function n(a){var r=[];return Ce.each(p.parents(a),function(e,t){var n=a===t?"elfinder-path-dir elfinder-path-cwd":"elfinder-path-dir",i=p.file(t),i=p.escape(i.i18||i.name);r.push('<span id="'+c+t+'" class="'+n+'" title="'+i+'">'+i+"</span>")}),r.join('<span class="elfinder-path-other">'+p.option("separator")+"</span>")}function i(){var e;h.children("span.elfinder-path-dir").attr("style",""),e="ltr"===p.direction?Ce("#"+c+p.cwd().hash).prevAll("span.elfinder-path-dir:first"):Ce(),h.scrollLeft(e.length?e.position().left:0)}function a(){var n,i,a=h.children("span.elfinder-path-dir"),e=a.length;"workzone"===l||e<2?a.attr("style",""):(h.width(h.css("max-width")),a.css({maxWidth:100/e+"%",display:"inline-block"}),n=h.width()-9,h.children("span.elfinder-path-other").each(function(){n-=Ce(this).width()}),i=[],a.each(function(e){var t=Ce(this).width();n-=t,t<this.scrollWidth&&i.push(e)}),h.width(""),i.length?(0<n&&(n/=i.length,Ce.each(i,function(e,t){t=Ce(a[t]);t.css("max-width",t.width()+n)})),a.last().attr("style","")):a.attr("style",""))}var r="",o="",s=[],l="statusbar",d=p.res("class","hover"),c="path"+(ye.prototype.uniqueid||"")+"-",u=Ce('<div class="ui-widget-header ui-helper-clearfix elfinder-workzone-path"></div>'),h=Ce(this).addClass("elfinder-path").html("&nbsp;").on("mousedown","span.elfinder-path-dir",function(e){var t=Ce(this).attr("id").substr(c.length);e.preventDefault(),t!=p.cwd().hash&&(Ce(this).addClass(d),r?p.exec("search",r,{target:t,mime:s.join(" ")}):p.exec("open",t))}).prependTo(p.getUI("statusbar").show()),e=Ce('<div class="elfinder-path-roots"></div>').on("click",function(e){e.stopPropagation(),e.preventDefault();var t=Ce.map(p.roots,function(e){return p.file(e)}),n=[];Ce.each(t,function(e,t){t.phash||p.root(p.cwd().hash,!0)===t.hash||n.push({label:p.escape(t.i18||t.name),icon:"home",callback:function(){p.exec("open",t.hash)},options:{iconClass:t.csscls||"",iconImg:t.icon||""}})}),p.trigger("contextmenu",{raw:n,x:e.pageX,y:e.pageY})}).append('<span class="elfinder-button-icon elfinder-button-icon-menu" ></span>').appendTo(u);p.bind("open searchend parents",function(){o=r="",s=[],h.html(n(p.cwd().hash)),1<Object.keys(p.roots).length?(h.css("margin",""),e.show()):(h.css("margin",0),e.hide()),a()}).bind("searchstart",function(e){e.data&&(r=e.data.query||"",o=e.data.target||"",s=e.data.mimes||[])}).bind("search",function(e){var t="",t=o?n(o):p.i18n("btnAll");h.html('<span class="elfinder-path-other">'+p.i18n("searcresult")+": </span>"+t),a()}).bind("navbarshow navbarhide",function(e){var t=p.getUI("workzone");"navbarshow"===e.type?(t.height(t.height()+u.outerHeight()),h.prependTo(p.getUI("statusbar")),u.detach(),l="statusbar",p.unbind("open",i)):(u.append(h).insertBefore(t),t.height(t.height()-u.outerHeight()),l="workzone",i(),p.bind("open",i)),p.trigger("uiresize")}).bind("resize",a)})},Ce.fn.elfinderplaces=function(z,O){return this.each(function(){function s(e){return e.substr(6)}function l(e){return"place-"+e}function d(){var e=[],n={};(e=Ce.map(k.children().find("[id]"),function(e){return s(e.id)})).length?Ce.each(e.reverse(),function(e,t){n[t]=u[t]}):n=null,z.storage(b,n)}function r(e,t){return Ce(m.replace(/\{id\}/,l(e?e.hash:t)).replace(/\{name\}/,z.escape(e?e.i18||e.name:t)).replace(/\{cssclass\}/,e?z.perms2class(e)+(e.notfound?" elfinder-na":"")+(e.csscls?" "+e.csscls:""):"").replace(/\{permissions\}/,!e||e.read&&e.write&&!e.notfound?"":g).replace(/\{title\}/,e&&e.path?z.escape(e.path):"").replace(/\{symlink\}/,"").replace(/\{style\}/,""))}function a(e){var t,n;return"directory"===e.mime&&(n=e.hash,z.files().hasOwnProperty(n)||z.trigger("tree",{tree:[e]}),t=r(e,n),u[n]=e,k.prepend(t),C.addClass(i),w.toggle(1<k.children().length),!0)}function c(e){var t=null;return u[e]&&(delete u[e],(e=Ce("#"+l(e))).length&&(t=e.text(),e.parent().remove(),e=k.children().length,w.toggle(1<e),e||(C.removeClass(i),T.removeClass(n),k.slideToggle(!1)))),t}function o(e,t){var n=e.hash,i=Ce("#"+l(t||n)),t=r(e,n);return 0<i.length&&(i.parent().replaceWith(t),u[n]=e,!0)}var u={},e="class",h=z.res(e,"navdir"),i=z.res(e,"navcollapse"),n=z.res(e,"navexpand"),p=z.res(e,"hover"),t=z.res(e,"treeroot"),f=z.res(e,"adroppable"),m=z.res("tpl","placedir"),g=z.res("tpl","perms"),v=Ce(z.res("tpl","navspinner")),b="places"+(O.suffix||""),y=null,w=Ce('<span class="elfinder-button-icon elfinder-button-icon-sort elfinder-places-root-icon" title="'+z.i18n("cmdsort")+'"></span>').hide().on("click",function(e){e.stopPropagation(),k.empty(),Ce.each(u,function(e,t){var n=z.file(e)||t,i=r(n,e),a=null;if(n||i.hide(),k.children().length&&(Ce.each(k.children(),function(){var e=Ce(this);if((n.i18||n.name).localeCompare(e.children("."+h).text())<0)return a=!i.insertBefore(e)}),null!==a))return!0;Ce("#"+l(e)).length||k.append(i)}),d()}),x=r({hash:"root-"+z.namespace,name:z.i18n(O.name,"places"),read:!0,write:!0}),C=x.children("."+h).addClass(t).click(function(e){e.stopPropagation(),C.hasClass(i)&&(T.toggleClass(n),k.slideToggle(),z.storage("placesState",T.hasClass(n)?1:0))}).append(w),k=x.children("."+z.res(e,"navsubtree")),T=Ce(this).addClass(z.res(e,"tree")+" elfinder-places ui-corner-all").hide().append(x).appendTo(z.getUI("navbar")).on("mouseenter mouseleave","."+h,function(e){Ce(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click","."+h,function(e){var t=Ce(this);t.data("longtap")?e.stopPropagation():t.hasClass("elfinder-na")||z.exec("open",t.attr("id").substr(6))}).on("contextmenu","."+h+":not(."+t+")",function(e){var t=Ce(this),o=t.attr("id").substr(6);e.preventDefault(),z.trigger("contextmenu",{raw:[{label:z.i18n("moveUp"),icon:"up",remain:!0,callback:function(){var e,t,n,i,a,r;t=Ce("#"+l(e=o)),n=t.parent(),i=n.prev("div"),a="ui-state-hover",r=z.getUI("contextmenu"),y&&clearTimeout(y),i.length&&(r.find(":first").data("placesHash",e),t.addClass(a),n.insertBefore(i),i=n.prev("div"),y=setTimeout(function(){t.removeClass(a),r.find(":first").data("placesHash")===e&&r.hide().empty()},1500)),i.length||(t.removeClass(a),r.hide().empty()),d()}},"|",{label:z.i18n("rmFromPlaces"),icon:"rm",callback:function(){c(o),d()}}],x:e.pageX,y:e.pageY}),t.addClass("ui-state-hover"),z.getUI("contextmenu").children().on("mouseenter",function(){t.addClass("ui-state-hover")}),z.bind("closecontextmenu",function(){t.removeClass("ui-state-hover")})}).droppable({tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file",hoverClass:z.res("class","adroppable"),classes:{"ui-droppable-hover":z.res("class","adroppable")},over:function(e,t){var n=t.helper,t=Ce.map(n.data("files"),function(e){return"directory"!==z.file(e).mime||u[e]?null:e});e.stopPropagation(),n.data("dropover",n.data("dropover")+1),z.insideWorkzone(e.pageX,e.pageY)&&(0<t.length?(n.addClass("elfinder-drag-helper-plus"),z.trigger("unlockfiles",{files:n.data("files"),helper:n})):Ce(this).removeClass(f))},out:function(e,t){var n=t.helper,t=e.shiftKey||e.ctrlKey||e.metaKey;e.stopPropagation(),n.toggleClass("elfinder-drag-helper-move elfinder-drag-helper-plus",!!n.data("locked")||t).data("dropover",Math.max(n.data("dropover")-1,0)),Ce(this).removeData("dropover").removeClass(f),z.trigger(t?"unlockfiles":"lockfiles",{files:n.data("files"),helper:n})},drop:function(e,t){var t=t.helper,n=!0;Ce.each(t.data("files"),function(e,t){t=z.file(t);t&&"directory"==t.mime&&!u[t.hash]?a(t):n=!1}),d(),n&&t.hide()}}).on("touchstart","."+h+":not(."+t+")",function(e){var t,n;1<e.originalEvent.touches.length||(t=Ce(this).attr("id").substr(6),n=Ce(this).addClass(p).data("longtap",null).data("tmlongtap",setTimeout(function(){n.data("longtap",!0),z.trigger("contextmenu",{raw:[{label:z.i18n("rmFromPlaces"),icon:"rm",callback:function(){c(t),d()}}],x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY})},500)))}).on("touchmove touchend","."+h+":not(."+t+")",function(e){clearTimeout(Ce(this).data("tmlongtap")),"touchmove"==e.type&&Ce(this).removeClass(p)});Ce.fn.sortable&&k.addClass("touch-punch").sortable({appendTo:z.getUI(),revert:!1,helper:function(e){e=Ce(e.target).parent();return e.children().removeClass("ui-state-hover"),Ce('<div class="ui-widget elfinder-place-drag elfinder-'+z.direction+'"></div>').append(Ce('<div class="elfinder-navbar"></div>').show().append(e.clone()))},stop:function(e,t){var n=Ce(t.item[0]),i=T.offset().top,a=T.offset().left,r=T.width(),o=T.height(),t=e.pageX,e=e.pageY;a<t&&t<a+r&&i<e&&e<e+o||(c(s(n.children(":first").attr("id"))),d())},update:function(e,t){d()}}),Ce(this).on("regist",function(e,t){var n=!1;Ce.each(t,function(e,t){t&&"directory"==t.mime&&!u[t.hash]&&a(t)&&(n=!0)}),n&&d()}),z.one("load",function(){var e;z.oldAPI||(T.show().parent().show(),u={},"string"==typeof(e=z.storage(b))?(e=Ce.map(e.split(","),function(e){return e||null}),Ce.each(e,function(e,t){t=t.split("#");u[t[0]]=t[1]||t[0]})):Ce.isPlainObject(e)&&(u=e),z.trigger("placesload",{dirs:u,storageKey:b},!0),(e=Object.keys(u)).length&&(C.prepend(v),z.request({data:{cmd:"info",targets:e},preventDefault:!0}).done(function(e){var i={};Ce.each(e.files,function(e,t){var n=t.hash;i[n]=t}),Ce.each(u,function(e,t){a(i[e]||Ce.extend({notfound:!0},t))}),0<z.storage("placesState")&&C.click()}).always(function(){v.remove()})),z.change(function(e){var n=!1;Ce.each(e.data.changed,function(e,t){u[t.hash]&&("directory"!==t.mime?c(t.hash)&&(n=!0):o(t)&&(n=!0))}),n&&d()}).bind("rename",function(n){var i=!1;n.data.removed&&Ce.each(n.data.removed,function(e,t){n.data.added[e]&&o(n.data.added[e],t)&&(i=!0)}),i&&d()}).bind("rm paste",function(e){var n=[],t=!1;e.data.removed&&Ce.each(e.data.removed,function(e,t){t=c(t);t&&n.push(t)}),n.length&&(t=!0),e.data.added&&n.length&&Ce.each(e.data.added,function(e,t){1!==Ce.inArray(t.name,n)&&"directory"==t.mime&&a(t)}),t&&d()}).bind("sync netmount",function(r){var e=Object.keys(u);e.length&&(C.prepend(v),z.request({data:{cmd:"info",targets:e},preventDefault:!0}).done(function(e){var i={},n=!1,a=z.cwd().hash;Ce.each(e.files||[],function(e,t){var n=t.hash;i[n]=t,z.files().hasOwnProperty(t.hash)||z.trigger("tree",{tree:[t]})}),Ce.each(u,function(e,t){!t.notfound!=!!i[e]?t.phash===a&&"netmount"!==r.type||i[e]&&"directory"!==i[e].mime?c(e)&&(n=!0):o(i[e]||Ce.extend({notfound:!0},t))&&(n=!0):i[e]&&i[e].phash!=a&&o(i[e])}),n&&d()}).always(function(){v.remove()}))}))})})},Ce.fn.elfindersortbutton=function(p){return this.each(function(){function e(){u.children("[rel]").removeClass(o+" "+s+" "+l).filter('[rel="'+n.sortType+'"]').addClass(o+" "+("asc"==n.sortOrder?s:l)),u.children(".elfinder-sort-stick").toggleClass(o,n.sortStickFolders),u.children(".elfinder-sort-tree").toggleClass(o,n.sortAlsoTreeview)}var n=p.fm,t=p.name,i=n.res("class","disabled"),a=n.res("class","hover"),r="elfinder-button-menu-item",o=r+"-selected",s=o+"-asc",l=o+"-desc",d=Ce('<span class="elfinder-button-text">'+p.title+"</span>"),c=Ce(this).addClass("ui-state-default elfinder-button elfinder-menubutton elfiner-button-"+t).attr("title",p.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+t+'"></span>',d).hover(function(e){c.hasClass(i)||c.toggleClass(a)}).click(function(e){c.hasClass(i)||(e.stopPropagation(),u.is(":hidden")&&p.fm.getUI().click(),u.slideToggle(100))}),u=Ce('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu ui-corner-all"></div>').hide().appendTo(c).on("mouseenter mouseleave","."+r,function(){Ce(this).toggleClass(a)}).on("click","."+r,function(e){e.preventDefault(),e.stopPropagation(),h()}),h=function(){u.hide()};d.hide(),Ce.each(n.sortRules,function(e,t){u.append(Ce('<div class="'+r+'" rel="'+e+'"><span class="ui-icon ui-icon-arrowthick-1-n"></span><span class="ui-icon ui-icon-arrowthick-1-s"></span>'+n.i18n("sort"+e)+"</div>").data("type",e))}),u.children().click(function(e){var t=Ce(this).attr("rel");p.exec([],{type:t,order:t==n.sortType?"asc"==n.sortOrder?"desc":"asc":n.sortOrder,stick:n.sortStickFolders,tree:n.sortAlsoTreeview})}),Ce('<div class="'+r+" "+r+'-separated elfinder-sort-ext elfinder-sort-stick"><span class="ui-icon ui-icon-check"></span>'+n.i18n("sortFoldersFirst")+"</div>").appendTo(u).click(function(){p.exec([],{type:n.sortType,order:n.sortOrder,stick:!n.sortStickFolders,tree:n.sortAlsoTreeview})}),Ce.fn.elfindertree&&-1!==Ce.inArray("tree",n.options.ui)&&Ce('<div class="'+r+" "+r+'-separated elfinder-sort-ext elfinder-sort-tree"><span class="ui-icon ui-icon-check"></span>'+n.i18n("sortAlsoTreeview")+"</div>").appendTo(u).click(function(){p.exec([],{type:n.sortType,order:n.sortOrder,stick:n.sortStickFolders,tree:!n.sortAlsoTreeview})}),n.bind("disable select",h).getUI().click(h),n.bind("sortchange",e),1<u.children().length?p.change(function(){c.toggleClass(i,p.disabled()),e()}).change():c.addClass(i)})},Ce.fn.elfinderstat=function(u){return this.each(function(){function t(e,n){var i=0,a=0;Ce.each(e,function(e,t){n&&t.phash!=n||(i++,a+=parseInt(t.size)||0)}),r.html(l+': <span class="elfinder-stat-incsearch"></span>'+i+", "+s+": "+u.formatSize(a))}function n(e){r.find("span.elfinder-stat-incsearch").html(e?e.hashes.length+" / ":"")}var r=Ce(this).addClass("elfinder-stat-size"),o=Ce('<div class="elfinder-stat-selected"></div>').on("click","a",function(e){var t=Ce(this).data("hash");e.preventDefault(),u.exec("opendir",[t])}),s=u.i18n("size"),l=u.i18n("items"),d=u.i18n("selected"),c=!1;u.getUI("statusbar").prepend(r).append(o).show(),u.bind("open reload add remove change searchend",function(){t(u.files(),u.cwd().hash)}).bind("searchend",function(){c=!1}).search(function(e){c=!0,t(e.data.files)}).select(function(){var e,n=0,i=0,t=u.selectedFiles(),a=[];if(1==t.length)return e=t[0],n=e.size,c&&a.push('<a href="#elf_'+e.phash+'" data-hash="'+e.hash+'">'+(e.path?e.path.replace(/\/[^\/]*$/,""):"..")+"</a>"),a.push(u.escape(e.name)),void o.html(a.join("/")+(0<n?", "+u.formatSize(n):""));Ce.each(t,function(e,t){i++,n+=parseInt(t.size)||0}),o.html(i?d+": "+i+", "+s+": "+u.formatSize(n):"&nbsp;")}).bind("incsearch",function(e){n(e.data)}).bind("incsearchend",function(){n()})})},Ce.fn.elfindertoast=function(r,e){var o={mode:"success",msg:"",showMethod:"fadeIn",showDuration:300,showEasing:"swing",onShown:void 0,hideMethod:"fadeOut",hideDuration:1500,hideEasing:"swing",onHidden:void 0,timeOut:3e3,extNode:void 0};return this.each(function(){r=Ce.extend({},o,r||{});function t(e){i.stop(),i[r.showMethod]({duration:r.showDuration,easing:r.showEasing,complete:function(){r.onShown&&r.onShown(),!e&&r.timeOut&&(n=setTimeout(a,r.timeOut))}})}var n,i=Ce(this),a=function(){i[r.hideMethod]({duration:r.hideDuration,easing:r.hideEasing,complete:function(){r.onHidden&&r.onHidden(),i.remove()}})};i.on("click",function(e){e.stopPropagation(),e.preventDefault(),i.stop().remove()}).on("mouseenter mouseleave",function(e){r.timeOut&&(n&&clearTimeout(n),n=null,"mouseenter"===e.type?t(!0):n=setTimeout(a,r.timeOut))}).hide().addClass("toast-"+r.mode).append(Ce('<div class="elfinder-toast-msg"></div>').html(r.msg)),r.extNode&&i.append(r.extNode),t()})},Ce.fn.elfindertoolbar=function(v,b){return this.not(".elfinder-toolbar").each(function(){function a(e){var t;for(Ce.each(h,function(e,t){t.detach()}),u.empty(),n=p.length;n--;)if(p[n]){for(o=Ce('<div class="ui-widget-content ui-corner-all elfinder-buttonset"></div>'),i=p[n].length;i--;)t=p[n][i],e&&-1!==Ce.inArray(t,e)||!(r=c[t])||(s="elfinder"+r.options.ui,!h[t]&&Ce.fn[s]&&(h[t]=Ce("<div></div>")[s](r)),h[t]&&(g&&h[t].find(".elfinder-button-text").show(),o.prepend(h[t])));o.children().length&&u.prepend(o),o.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"></span>')}!u.data("swipeClose")&&u.children().length?u.show():u.hide(),v.trigger("toolbarload").trigger("uiresize")}var n,i,r,o,s,l,d,e,c=v._commands,u=Ce(this).addClass("ui-helper-clearfix ui-widget-header ui-corner-top elfinder-toolbar"),t={displayTextLabel:!1,labelExcludeUA:["Mobile"],autoHideUA:["Mobile"]},h={},p=(e=b||[],Ce.map(e,function(e){return Ce.isPlainObject(e)?(t=Ce.extend(t,e),null):[e]})),f=null,m="",g=v.storage("toolbarTextLabel");g=null===g?t.displayTextLabel&&(!t.labelExcludeUA||!t.labelExcludeUA.length||!Ce.map(t.labelExcludeUA,function(e){return!!v.UA[e]||null}).length):1==g,u.on("contextmenu",function(e){e.stopPropagation(),e.preventDefault(),v.trigger("contextmenu",{raw:[{label:v.i18n("textLabel"),icon:"accept",callback:function(){g=!g,u.height("").find(".elfinder-button-text")[g?"show":"hide"](),v.trigger("uiresize").storage("toolbarTextLabel",g?"1":"0")}}],x:e.pageX,y:e.pageY})}).on("touchstart",function(e){1<e.originalEvent.touches.length||(u.data("tmlongtap")&&clearTimeout(u.data("tmlongtap")),u.removeData("longtap").data("longtap",{x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}).data("tmlongtap",setTimeout(function(){u.removeData("longtapTm").trigger({type:"contextmenu",pageX:u.data("longtap").x,pageY:u.data("longtap").y}).data("longtap",{longtap:!0})},500)))}).on("touchmove touchend",function(e){u.data("tmlongtap")&&(("touchend"===e.type||4<Math.abs(u.data("longtap").x-e.originalEvent.touches[0].pageX)+Math.abs(u.data("longtap").y-e.originalEvent.touches[0].pageY))&&clearTimeout(u.data("tmlongtap")),u.removeData("longtapTm"))}).on("click",function(e){u.data("longtap")&&u.data("longtap").longtap&&(e.stopImmediatePropagation(),e.preventDefault())}).on("touchend click",".elfinder-button",function(e){u.data("longtap")&&u.data("longtap").longtap&&(e.stopImmediatePropagation(),e.preventDefault())}),u.prev().length&&u.parent().prepend(this),a(),v.bind("open sync select",function(e){var t,n,i=v.option("disabled");"select"===e.type&&(n=v.selected()).length&&(i=v.getDisabledCmds(n)),f&&f.toString()===i.sort().toString()||(a(i&&i.length?i:null),t=!0),f=i.concat().sort(),!t&&m===JSON.stringify(v.commandMap)||(m=JSON.stringify(v.commandMap),t||Ce.each(Ce("div.elfinder-button"),function(){var e=Ce(this).data("origin");e&&Ce(this).after(e).detach()}),Object.keys(v.commandMap).length&&Ce.each(v.commandMap,function(e,t){var n,i=v._commands[t],a=i?"elfinder"+i.options.ui:null;a&&Ce.fn[a]&&(n=h[e])&&(!h[t]&&Ce.fn[a]&&(h[t]=Ce("<div></div>")[a](v._commands[t]),h[t]&&(g&&h[t].find(".elfinder-button-text").show(),i.extendsCmd&&h[t].children("span.elfinder-button-icon").addClass("elfinder-button-icon-"+i.extendsCmd))),h[t]&&(n.after(h[t]),h[t].data("origin",n.detach())))}))}),v.UA.Touch&&(void 0===(d=v.storage("autoHide")||{}).toolbar&&(d.toolbar=t.autoHideUA&&0<t.autoHideUA.length&&Ce.map(t.autoHideUA,function(e){return!!v.UA[e]||null}).length,v.storage("autoHide",d)),d.toolbar&&v.one("init",function(){v.uiAutoHide.push(function(){u.stop(!0,!0).trigger("toggle",{duration:500,init:!0})})}),v.bind("load",function(){"none"!==(l=Ce('<div class="elfinder-toolbar-swipe-handle"></div>').hide().appendTo(v.getUI())).css("pointer-events")&&(l.remove(),l=null)}),u.on("toggle",function(e,t){var n=v.getUI("workzone"),i=u.is(":hidden"),a=n.height(),r=u.height(),o=u.outerHeight(!0)-r,s=Ce.extend({step:function(e){n.height(a+(i?-1*(e+o):r-e)),v.trigger("resize")},always:function(){u.css("height",""),v.trigger("uiresize"),l&&(i?l.stop(!0,!0).hide():(l.height(t.handleH||""),v.resources.blink(l,"slowonce"))),t.init&&v.trigger("uiautohide")}},t);u.data("swipeClose",!i).stop(!0,!0).animate({height:"toggle"},s),d.toolbar=!i,v.storage("autoHide",Ce.extend(v.storage("autoHide"),{toolbar:d.toolbar}))}))}),this},Ce.fn.elfindertree=function(W,K){var B=W.res("class","tree");return this.not("."+B).each(function(){function s(e){var t=N.offset().left;return t<=e&&e<=t+N.width()}function f(n){return n.name=W.escape(n.i18||n.name),t.replace(/(?:\{([a-z]+)\})/gi,function(e,t){return n[t]||(p[t]?p[t](n):"")})}function b(e){return Ce.map(e||[],function(e){return"directory"==e.mime?e:null})}function m(e){return e?Ce("#"+W.navHash2Id(e)).next("."+k):R}function g(e,t){for(var n,i=e.children(":first");i.length;){if(W.file(W.navId2Hash(i.children("[id]").attr("id"))),(n=W.file(W.navId2Hash(i.children("[id]").attr("id"))))&&P(t,n)<0)return i;i=i.next()}return Ce("")}function y(r){var e=Ce(this),o=Ce.Deferred();return e.data("autoScrTm")&&clearTimeout(e.data("autoScrTm")),e.data("autoScrTm",setTimeout(function(){var e,t,n,i,a=Ce("#"+(r||W.navHash2Id(W.cwd().hash)));a.length?(i=(t=(e=R.parent().stop(!1,!0)).offset().top)+(n=e.height())-a.outerHeight(),(a=a.offset().top)<t||i<a?e.animate({scrollTop:e.scrollTop()+a-t-n/3},{duration:"fast",complete:function(){o.resolve()}}):o.resolve()):o.reject()},100)),o}var e="class",v=W.UA.Mobile,w=W.res(e,"treeroot"),x=K.openRootOnLoad,C=K.openCwdOnOpen,k=W.res(e,"navsubtree"),n=W.res(e,"treedir"),T="span."+n,z=W.res(e,"navcollapse"),O=W.res(e,"navexpand"),I="elfinder-subtree-loaded",S=W.res(e,"navarrow"),D=W.res(e,"active"),l=W.res(e,"adroppable"),d=W.res(e,"hover"),r=W.res(e,"disabled"),o=W.res(e,"draggable"),c=W.res(e,"droppable"),A="elfinder-navbar-wrapper-root",E="elfinder-navbar-wrapper-pastable",M="elfinder-navbar-wrapper-uploadable",i=W.droppable.drop,a=Ce.extend(!0,{},W.droppable,{over:function(e,n){var i,t,a=Ce(this),r=n.helper,o=d+" "+l;return e.stopPropagation(),r.data("dropover",r.data("dropover")+1),a.data("dropover",!0),n.helper.data("namespace")===W.namespace&&s(e.clientX)&&W.insideWorkzone(e.pageX,e.pageY)?(a.addClass(d),a.is("."+z+":not(."+O+")")&&a.data("expandTimer",setTimeout(function(){a.is("."+z+"."+d)&&a.children("."+S).click()},500)),a.is(".elfinder-ro,.elfinder-na")?(a.removeClass(l),void r.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus")):(i=W.navId2Hash(a.attr("id")),a.data("dropover",i),Ce.each(n.helper.data("files"),function(e,t){if(t===i||W.file(t).phash===i&&!n.helper.hasClass("elfinder-drag-helper-plus"))return a.removeClass(o),!1}),r.data("locked")?t="elfinder-drag-helper-plus":(t="elfinder-drag-helper-move",(e.shiftKey||e.ctrlKey||e.metaKey)&&(t+=" elfinder-drag-helper-plus")),a.hasClass(l)&&r.addClass(t),void setTimeout(function(){a.hasClass(l)&&r.addClass(t)},20))):(a.removeClass(o),void r.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus"))},out:function(e,t){var n=Ce(this),t=t.helper;e.stopPropagation(),t.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus").data("dropover",Math.max(t.data("dropover")-1,0)),n.data("expandTimer")&&clearTimeout(n.data("expandTimer")),n.removeData("dropover").removeClass(d+" "+l)},deactivate:function(){Ce(this).removeData("dropover").removeClass(d+" "+l)},drop:function(e,t){s(e.clientX)&&i.call(this,e,t)}}),U=Ce(W.res("tpl","navspinner")),t=W.res("tpl","navdir"),u=W.res("tpl","perms"),h=(W.res("tpl","lock"),W.res("tpl","symlink")),p={id:function(e){return W.navHash2Id(e.hash)},cssclass:function(e){var t=(e.phash&&!e.isroot?"":w)+" "+n+" "+W.perms2class(e);return e.dirs&&!e.link&&(t+=" "+z),K.getClass&&(t+=" "+K.getClass(e)),e.csscls&&(t+=" "+W.escape(e.csscls)),t},permissions:function(e){return e.read&&e.write?"":u},symlink:function(e){return e.alias?h:""},style:function(e){return e.icon?"style=\"background:url('"+W.escape(e.icon)+"') 0 0 no-repeat;background-size:contain;\"":""}},F=function(e){for(var t,n,i,a,r,o,s=e.length,l=[],d=s,c=Ce(),u={},h={},p=!0;d--;)u[(t=e[d]).hash]||Ce("#"+W.navHash2Id(t.hash)).length||(u[t.hash]=!0,(n=m(t.phash)).length?t.phash&&((a=!n.children().length)||(i=g(n,t)).length)?a?(h[t.phash]||(h[t.phash]=[]),h[t.phash].push(t)):(o=f(t),i.before(o),v||(c=c.add(o))):(o=f(t),n[p||t.phash?"append":"prepend"](o),p=!1,t.phash&&!t.isroot||(r=Ce("#"+W.navHash2Id(t.hash)).parent().addClass(A),!t.disabled||t.disabled.length<1?r.addClass(E+" "+M):(-1===Ce.inArray("paste",t.disabled)&&r.addClass(E),-1===Ce.inArray("upload",t.disabled)&&r.addClass(M))),v||j(null,r)):l.push(t));Object.keys(h).length&&Ce.each(h,function(e,t){var n=m(e),i=[];t.sort(P),Ce.each(t,function(e,t){i.push(f(t))}),n.append(i.join("")),v||W.lazy(function(){j(null,n)})}),l.length&&l.length<s?F(l):!v&&c.length&&W.lazy(function(){j(c)})},P=function(e,t){if(W.sortAlsoTreeview){var n="asc"==W.sortOrder,i=W.sortType,a=W.sortRules,r=n?a[W.sortType](e,t):a[W.sortType](t,e);return"name"!==i&&0===r?r=n?a.name(e,t):a.name(t,e):r}return W.sortRules.name(e,t)},H=function(a,r,o,s){function l(e){return!(e=W.file(e))||!e.isroot&&e.phash?"parents":"tree"}function d(e,t){var n,i;v[e+t]||("tree"===e&&t!==p&&(n=Ce("#"+W.navHash2Id(t))).length&&(i=Ce(W.res("tpl","navspinner")).insertBefore(n.children("."+S)),n.removeClass(z)),v[e+t]=!0,g.push(W.request({data:{cmd:e,target:t},preventFail:!0}).done(function(){Ce("#"+W.navHash2Id("tree"===e?t:W.root(t))).addClass(I)}).always(function(){i&&(i.remove(),n.addClass(z+" "+O).next("."+k).show())})))}function e(e){for(var t,n,i=W.root(e);i;)i=(i=i&&W.file(i))&&(t=i.phash)&&0!==t.indexOf(i.volumeid)?("parents"===(n=l(t))&&d("tree",t),d(n,t),W.root(t)):null}var t,n,i,c,u,h=W.cwd(),p=h.hash,f=Ce("#"+W.navHash2Id(p)),a=a||!1,r=r||[],s=s||L,m="parents",g=[],v={};if(x&&((t=Ce("#"+W.navHash2Id(W.root()))).hasClass(I)&&t.addClass(O).next("."+k).show(),x=!1),f.hasClass(D)||(R.find(T+"."+D).removeClass(D),f.addClass(D)),K.syncTree||!f.length){if(f.length&&(a||!o||!h.isroot))return a&&!o||(f.addClass(I),C&&f.hasClass(z)&&f.addClass(O).next("."+k).slideDown()),void(!s&&a||(f=f.parentsUntil("."+w).filter("."+k),c=f.length,u=1,f.show().prev(T).addClass(O,function(){a||c!=u++||y()}),c||a||y()));W.newAPI&&((n=W.file(p))&&n.phash&&!n.isroot&&(i=Ce("#"+W.navHash2Id(n.phash))).length&&i.hasClass(I)?W.lazy(function(){F([n]),H(a,[],!1,s)}):(a||(h.isroot&&h.phash?(m="tree"===l(h.phash)?"tree":"parents",e(p),p=h.phash):h.phash?e(h.phash):m=null),m&&d(m,p),(i=h.root?Ce("#"+W.navHash2Id(h.root)):null)&&(U.insertBefore(i.children("."+S)),i.removeClass(z)),Ce.when.apply(Ce,g).done(function(e){var t,n,i;if(e=e||{tree:[]},W.api<2.1&&e.tree.push(h),1<(n=arguments.length))for(i=1;i<n;i++)arguments[i].tree&&arguments[i].tree.length&&e.tree.push.apply(e.tree,arguments[i].tree);t=b(e.tree),h.isroot&&h.hash===p&&!t.length&&(delete h.isroot,delete h.phash),r=JSON.parse(JSON.stringify(Ce.merge(r,t))),F(r),_(r,I),!a&&h.isroot&&Ce("#"+W.navHash2Id(h.hash).length)&&H(!0,[],o,s),p==h.hash&&W.visible()&&H(a,[],!1,s)}).always(function(){i&&(U.remove(),i.addClass(z+" "+I))})))}},j=function(e,t){var n;e||(t&&!t.closest("div."+A).hasClass(M)||(t||R.find("div."+M)).find(T+":not(.elfinder-ro,.elfinder-na)").addClass("native-droppable"),e=!t||t.closest("div."+A).hasClass(E)?(t||R.find("div."+E)).find(T+":not(."+c+")"):Ce()),100<e.length&&(n=e.slice(100),e=e.slice(0,100)),e.droppable(a),n&&W.lazy(function(){j(n)},20)},_=function(e,n){var i=n==I?"."+z+":not(."+I+")":":not(."+z+")";Ce.each(e,function(e,t){Ce("#"+W.navHash2Id(t.phash)+i).filter(function(){return 0<Ce.map(Ce(this).next("."+k).children(),function(e){return Ce(e).children().hasClass(w)?null:e}).length}).addClass(n)})},R=Ce(this).addClass(B).on("mouseenter mouseleave",T,function(e){var t=Ce(this),e="mouseenter"==e.type;t.hasClass(l+" "+r)||(v||!e||t.hasClass(w+" "+o+" elfinder-na elfinder-wo")||t.draggable(W.draggable),t.toggleClass(d,e))}).on("dragenter",T,function(e){var t;e.originalEvent.dataTransfer&&((t=Ce(this)).addClass(d),t.is("."+z+":not(."+O+")")&&t.data("expandTimer",setTimeout(function(){t.is("."+z+"."+d)&&t.children("."+S).click()},500)))}).on("dragleave",T,function(e){e.originalEvent.dataTransfer&&((e=Ce(this)).data("expandTimer")&&clearTimeout(e.data("expandTimer")),e.removeClass(d))}).on("click",T,function(e){var t=Ce(this),n=W.navId2Hash(t.attr("id"));W.file(n);t.data("longtap")?e.stopPropagation():n==W.cwd().hash||t.hasClass(r)?(t.hasClass(z)&&t.children("."+S).click(),W.select({selected:[n],origin:"tree"})):W.exec("open",n).done(function(){W.select({selected:[n],origin:"tree"})})}).on("touchstart",T,function(e){var t,n;1<e.originalEvent.touches.length||(t=e.originalEvent,n=Ce(this).addClass(d).data("longtap",null).data("tmlongtap",setTimeout(function(e){n.data("longtap",!0),W.trigger("contextmenu",{type:"navbar",targets:[W.navId2Hash(n.attr("id"))],x:t.touches[0].pageX,y:t.touches[0].pageY})},500)))}).on("touchmove touchend",T,function(e){clearTimeout(Ce(this).data("tmlongtap")),"touchmove"==e.type&&Ce(this).removeClass(d)}).on("click",T+"."+z+" ."+S,function(e){var t=Ce(this),n=t.parent(T),i=n.next("."+k),a=Ce.Deferred();e.stopPropagation(),n.hasClass(I)?(n.toggleClass(O),W.lazy(function(){30<(n.hasClass(O)?i.children().length+i.find("div.elfinder-navbar-subtree[style*=block]").children().length:i.find("div:visible").length)?(i.toggle(),W.draggingUiHelper&&W.draggingUiHelper.data("refreshPositions",1)):i.stop(!0,!0).slideToggle("normal",function(){W.draggingUiHelper&&W.draggingUiHelper.data("refreshPositions",1)})}).always(function(){a.resolve()})):(U.insertBefore(t),n.removeClass(z),W.request({cmd:"tree",target:W.navId2Hash(n.attr("id"))}).done(function(e){F(JSON.parse(JSON.stringify(b(e.tree)))),i.children().length&&(n.addClass(z+" "+O),30<i.children().length?(i.show(),W.draggingUiHelper&&W.draggingUiHelper.data("refreshPositions",1)):i.stop(!0,!0).slideDown("normal",function(){W.draggingUiHelper&&W.draggingUiHelper.data("refreshPositions",1)})),H(!0)}).always(function(e){U.remove(),n.addClass(I),W.one("treedone",function(){a.resolve()})})),t.data("dfrd",a)}).on("contextmenu",T,function(e){var t=Ce(this);e.preventDefault(),W.trigger("contextmenu",{type:"navbar",targets:[W.navId2Hash(Ce(this).attr("id"))],x:e.pageX,y:e.pageY}),t.addClass("ui-state-hover"),W.getUI("contextmenu").children().on("mouseenter",function(){t.addClass("ui-state-hover")}),W.bind("closecontextmenu",function(){t.removeClass("ui-state-hover")})}).on("scrolltoview",T,function(){var e=Ce(this);y(e.attr("id")).done(function(){W.resources.blink(e,"lookme")})}).on("create."+W.namespace,function(e,t){var n=m(t.phash),i=t.move||!1,a=Ce(f(t)).addClass("elfinder-navbar-wrapper-tmp"),t=W.selected();i&&t.length&&W.trigger("lockfiles",{files:t}),n.prepend(a)}),N=W.getUI("navbar").append(R).show(),q=W.sortAlsoTreeview,L=!1;W.open(function(e){var t=e.data,n=b(t.files),i=W.getUI("contextmenu");t.init&&R.empty(),W.UA.iOS&&N.removeClass("overflow-scrolling-touch").addClass("overflow-scrolling-touch"),L=!0,n.length?W.lazy(function(){i.data("cmdMaps")||i.data("cmdMaps",{}),F(n),_(n,I),Ce.each(n,function(e,t){t.volumeid&&t.uiCmdMap&&Object.keys(t.uiCmdMap).length&&!i.data("cmdMaps")[t.volumeid]&&(i.data("cmdMaps")[t.volumeid]=t.uiCmdMap)}),H(!1,n,t.init),L=!1}):(H(!1,n,t.init),L=!1)}).add(function(e){e=b(e.data.added);e.length&&(F(e),_(e,z))}).change(function(e){var t,n,i,a,r,o,s,l=b(e.data.changed),d=l.length;for(Ce();d--;)if(t=l[d],(n=Ce("#"+W.navHash2Id(t.hash))).length){if(s=n.parent(),t.phash){if(i=n.closest("."+k),a=m(t.phash),r=n.parent().next(),o=g(a,t),!a.length)continue;a[0]===i[0]&&r.get(0)===o.get(0)||(o.length?o.before(s):a.append(s))}r=n.hasClass(O),o=n.hasClass(I),a=Ce(f(t)),n.replaceWith(a.children(T)),v||j(null,s),t.dirs&&(r||o)&&(n=Ce("#"+W.navHash2Id(t.hash)))&&n.next("."+k).children().length&&(r&&n.addClass(O),o&&n.addClass(I))}W.cwd().hash&&H(!0)}).remove(function(e){for(var t,n,i=e.data.removed,a=i.length;a--;)(t=Ce("#"+W.navHash2Id(i[a]))).length&&(n=t.closest("."+k),t.parent().detach(),n.children().length||n.hide().prev(T).removeClass(z+" "+O+" "+I))}).bind("lockfiles unlockfiles",function(e){var n="lockfiles"==e.type,i=!!e.data.helper&&e.data.helper.data("locked"),a=n&&!i?"disable":"enable",e=Ce.map(e.data.files||[],function(e){var t=W.file(e);return t&&"directory"==t.mime?e:null});Ce.each(e,function(e,t){t=Ce("#"+W.navHash2Id(t));t.length&&!i&&(t.hasClass(o)&&t.draggable(a),t.hasClass(c)&&t.droppable(a),t[n?"addClass":"removeClass"](r))})}).bind("sortchange",function(){var e;!W.sortAlsoTreeview&&q===W.sortAlsoTreeview||(e=b(W.files()),q=W.sortAlsoTreeview,R.empty(),F(e),H())})}),this},Ce.fn.elfinderuploadbutton=function(i){return this.each(function(){var e=Ce(this).elfinderbutton(i).off("click"),t=Ce("<form></form>").appendTo(e),n=Ce('<input type="file" multiple="true" title="'+i.fm.i18n("selectForUpload")+'">').change(function(){var e=Ce(this);e.val()&&(i.exec({input:e.remove()[0]}),n.clone(!0).appendTo(t))}).on("dragover",function(e){e.originalEvent.dataTransfer.dropEffect="copy"});t.append(n.clone(!0)),i.change(function(){t[i.disabled()?"hide":"show"]()}).change()})},Ce.fn.elfinderviewbutton=function(i){return this.each(function(){var t=Ce(this).elfinderbutton(i),n=t.children(".elfinder-button-icon");i.change(function(){var e="icons"==i.value;n.toggleClass("elfinder-button-icon-view-list",e),i.className=e?"view-list":"",i.title=i.fm.i18n(e?"viewlist":"viewicons"),t.attr("title",i.title)})})},Ce.fn.elfinderworkzone=function(s){var l="elfinder-workzone";return this.not("."+l).each(function(){function e(){var t=o.height()-a,e=o.attr("style"),n=Math.round(i.height());o.css("overflow","hidden").children(":visible:not(."+l+")").each(function(){var e=Ce(this);"absolute"!=e.css("position")&&"fixed"!=e.css("position")&&(t-=e.outerHeight(!0))}),o.attr("style",e||""),t=Math.max(0,Math.round(t)),r===t&&n===t||(r=Math.round(i.height()),i.height(t),s.trigger("wzresize"))}var i=Ce(this).addClass(l),a=i.outerHeight(!0)-i.height(),r=Math.round(i.height()),o=i.parent();o.add(window).on("resize."+s.namespace,e),s.one("cssloaded",function(){a!==(a=i.outerHeight(!0)-i.height())&&s.trigger("uiresize")}).bind("uiresize",e)}),this},(ye.prototype.commands.back=function(){this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+left backspace"}],this.getstate=function(){return this.fm.history.canBack()?0:-1},this.exec=function(){return this.fm.history.back()}}).prototype={forceLoad:!0},ye.prototype.commands.colwidth=function(){this.alwaysEnabled=!0,this.updateOnSelect=!1,this.getstate=function(){return"fixed"===this.fm.getUI("cwd").find("table").css("table-layout")?0:-1},this.exec=function(){this.fm.getUI("cwd").trigger("colwidth")}},ye.prototype.commands.copy=function(){this.shortcuts=[{pattern:"ctrl+c ctrl+insert"}],this.getstate=function(e){var t=(e=this.files(e)).length;return!this._disabled&&t&&Ce.map(e,function(e){return e.read?e:null}).length==t?0:-1},this.exec=function(e){var t=this.fm,n=Ce.Deferred().fail(function(e){t.error(e)});return Ce.each(this.files(e),function(e,t){if(!t.read)return!n.reject(["errCopy",t.name,"errPerm"])}),"rejected"==n.state()?n:n.resolve(t.clipboard(this.hashes(e)))}},ye.prototype.commands.cut=function(){var i=this.fm;this.shortcuts=[{pattern:"ctrl+x shift+insert"}],this.getstate=function(e){var t=(e=this.files(e)).length;return!this._disabled&&t&&Ce.map(e,function(e){return!e.read||e.locked||i.isRoot(e)?null:e}).length==t?0:-1},this.exec=function(e){var n=Ce.Deferred().fail(function(e){i.error(e)});return Ce.each(this.files(e),function(e,t){return!t.read||t.locked||i.isRoot(t)?!n.reject(["errCopy",t.name,"errPerm"]):t.locked?!n.reject(["errLocked",t.name]):void 0}),"rejected"==n.state()?n:n.resolve(i.clipboard(this.hashes(e),!0))}},ye.prototype.commands.zipdl=function(){},ye.prototype.commands.download=function(){var s=this,o=this.fm,l=!1,d=!1;this.linkedCmds=["zipdl"],this.shortcuts=[{pattern:"shift+enter"}],this.getstate=function(e){var t=(e=this.hashes(e)).length,n=this.options.maxRequests||10;2<o.api&&o.getCommand("zipdl");return!(t<1)&&(t=function(e,n){var i,a,r=2<o.api?o.getCommand("zipdl"):null;if(null!==r&&(1<o.searchStatus.state?d=o.searchStatus.mixed:o.leafRoots[o.cwd().hash]&&(i=o.cwd().volumeid,Ce.each(e,function(e,t){if(0!==t.indexOf(i))return!(d=!0)})),l=o.isCommandEnabled("zipdl",e[0])),d){if(a=r?"zipdl":"download",!(e=Ce.map(e,function(e){var t=o.file(e),e=t&&(r||"directory"!==t.mime)&&o.isCommandEnabled(a,e)?e:null;return t&&n&&!e&&Ce("#"+o.cwdHash2Id(t.hash)).trigger("unselect"),e})).length)return[]}else if(!o.isCommandEnabled("download",e[0]))return[];return Ce.map(s.files(e),function(e){var t=!e.read||!l&&"directory"==e.mime?null:e;return n&&!t&&Ce("#"+o.cwdHash2Id(e.hash)).trigger("unselect"),t})}(e).length)&&(l||t<=n&&(!o.UA.IE&&!o.UA.Mobile||1==t))?0:-1},o.bind("contextmenu",function(e){function n(i){var e=i.url||r.url(i.hash);return{icon:"link",node:Ce("<a></a>").attr({href:e,target:"_blank",title:r.i18n("link")}).text(i.name).on("mousedown click touchstart touchmove touchend contextmenu",function(e){e.stopPropagation()}).on("dragstart",function(e){var t,n,e=e.dataTransfer||e.originalEvent.dataTransfer||null;o=null,e&&(e.effectAllowed="copyLink",e.setDragImage&&(o=Ce('<div class="elfinder-drag-helper html5-native">').append((n=(t=i).mime,t=r.tmb(t),n='<div class="elfinder-cwd-icon '+r.mime2class(n)+' ui-corner-all"></div>',t&&(n=Ce(n).addClass(t.className).css("background-image","url('"+t.url+"')").get(0).outerHTML),n)).appendTo(Ce(document.body)),e.setDragImage(o.get(0),50,47)),r.UA.IE||(e.setData("elfinderfrom",window.location.href+i.phash),e.setData("elfinderfrom:"+e.getData("elfinderfrom"),"")))}).on("dragend",function(e){o&&o.remove()})}}var i,a,t,r=s.fm,o=null;s.extra=null,e.data&&1===(t=e.data.targets||[]).length&&(i=r.file(t[0]))&&"directory"!==i.mime&&("1"!=i.url?s.extra=n(i):(s.extra={icon:"link",node:Ce("<a></a>").attr({href:"#",title:r.i18n("getLink"),draggable:"false"}).text(i.name).on("click touchstart",function(e){var t;"touchstart"===e.type&&1<e.originalEvent.touches.length||(t=a.parent(),e.stopPropagation(),e.preventDefault(),t.removeClass("ui-state-disabled").addClass("elfinder-button-icon-spinner"),r.request({data:{cmd:"url",target:i.hash},preventDefault:!0}).always(function(e){t.removeClass("elfinder-button-icon-spinner"),e.url?(r.file(i.hash).url=e.url,a.replaceWith(n(i).node)):t.addClass("ui-state-disabled")}))})},(a=s.extra.node).ready(function(){setTimeout(function(){a.parent().addClass("ui-state-disabled").css("pointer-events","auto")},10)})))}),this.exec=function(e){Efw("elfinder_download",{cmd:"download",home:o.options.customData.home,isAbs:o.options.customData.isAbs,readonly:o.options.customData.readonly,id:o.options.customData.id,targets:e},o.options.appurl)}},ye.prototype.commands.duplicate=function(){var n=this.fm;this.getstate=function(e){var t=(e=this.files(e)).length;return!this._disabled&&t&&n.cwd().write&&Ce.map(e,function(e){return e.read&&e.phash===n.cwd().hash&&!n.isRoot(e)?e:null}).length==t?0:-1},this.exec=function(e){var n=this.fm,t=this.files(e),i=t.length,a=Ce.Deferred().fail(function(e){e&&n.error(e)});return i?(Ce.each(t,function(e,t){if(!t.read||!n.file(t.phash).write)return!a.reject(["errCopy",t.name,"errPerm"])}),"rejected"==a.state()?a:n.request({data:{cmd:"duplicate",targets:this.hashes(e)},notify:{type:"copy",cnt:i}}).done(function(e){var t;e&&e.added&&e.added[0]&&n.one("duplicatedone",function(){(t=n.findCwdNodes(e.added)).length?t.trigger("scrolltoview"):(n.trigger("selectfiles",{files:Ce.map(e.added,function(e){return e.hash})}),n.toast({msg:n.i18n(["complete",n.i18n("cmdduplicate")])}))})})):a.reject()}},(ye.prototype.commands.forward=function(){this.alwaysEnabled=!0,this.updateOnSelect=!0,this.shortcuts=[{pattern:"ctrl+right"}],this.getstate=function(){return this.fm.history.canForward()?0:-1},this.exec=function(){return this.fm.history.forward()}}).prototype={forceLoad:!0},ye.prototype.commands.fullscreen=function(){function e(e,t){t&&t.fullscreen&&n.update(void 0,"on"===t.fullscreen)}var n=this,i=this.fm;this.alwaysEnabled=!0,this.updateOnSelect=!1,this.value=!1,this.options={ui:"fullscreenbutton"},this.getstate=function(){return 0},this.exec=function(){var e=i.getUI().get(0),t=i.toggleFullscreen(e);n.update(void 0,t===e)},i.bind("init",function(){i.getUI().off("resize."+i.namespace,e).on("resize."+i.namespace,e)})},(ye.prototype.commands.getfile=function(){var p=this,e=this.fm;this.alwaysEnabled=!0,this.callback=e.options.getFileCallback,this._disabled="function"==typeof this.callback,this.getstate=function(e){var t,n=(e=this.files(e)).length;return this.callback&&n&&(e=e,t=p.options,e=Ce.map(e,function(e){return("directory"!=e.mime||t.folders)&&e.read?e:null}),(t.multiple||1==e.length?e:[]).length==n)?0:-1},this.exec=function(e){function t(e){return r.onlyURL?r.multiple?Ce.map(o,function(e){return e.url}):o[0].url:r.multiple?o:o[0]}for(var n,i,a=this.fm,r=this.options,o=this.files(e),s=o.length,l=a.option("url"),d=a.option("tmbUrl"),c=Ce.Deferred().done(function(e){function t(){"close"==r.oncomplete?a.hide():"destroy"==r.oncomplete&&a.destroy()}a.trigger("getfile",{files:e}),"object"==typeof(e=p.callback(e,a))&&"function"==typeof e.done?e.done(t).fail(function(e){e&&a.error(e)}):t()}),u=[],h=0;h<s;h++){if("directory"==(n=o[h]).mime&&!r.folders)return c.reject();n.baseUrl=l,"1"==n.url?u.push(a.request({data:{cmd:"url",target:n.hash},notify:{type:"url",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(e){e.url&&(a.file(this.hash).url=this.url=e.url)}.bind(n))):n.url=a.url(n.hash),r.onlyURL||(r.getPath&&(n.path=a.path(n.hash),""===n.path&&n.phash&&function(){var e=Ce.Deferred();u.push(e),a.path(n.hash,!1,{}).done(function(e){n.path=e}).fail(function(){n.path=""}).always(function(){e.resolve()})}()),n.tmb&&1!=n.tmb&&(n.tmb=d+n.tmb),n.width||n.height||(n.dim?(i=n.dim.split("x"),n.width=i[0],n.height=i[1]):r.getImgSize&&-1!==n.mime.indexOf("image")&&u.push(a.request({data:{cmd:"dim",target:n.hash},notify:{type:"dim",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(e){var t;e.dim&&(t=e.dim.split("x"),(e=a.file(this.hash)).width=this.width=t[0],e.height=this.height=t[1])}.bind(n)))))}return u.length?(Ce.when.apply(null,u).always(function(){c.resolve(t())}),c):c.resolve(t())}}).prototype={forceLoad:!0},(ye.prototype.commands.home=function(){this.title="Home",this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+home ctrl+shift+up",description:"Home"}],this.getstate=function(){var e=this.fm.root(),t=this.fm.cwd().hash;return e&&t&&e!=t?0:-1},this.exec=function(){return this.fm.exec("open",this.fm.root())}}).prototype={forceLoad:!0},(ye.prototype.commands.info=function(){var n=this.fm,z="elfinder-info-spinner",O={calc:n.i18n("calc"),size:n.i18n("size"),unknown:n.i18n("unknown"),path:n.i18n("path"),aliasfor:n.i18n("aliasfor"),modify:n.i18n("modify"),perms:n.i18n("perms"),locked:n.i18n("locked"),dim:n.i18n("dim"),kind:n.i18n("kind"),files:n.i18n("files"),folders:n.i18n("folders"),roots:n.i18n("volumeRoots"),items:n.i18n("items"),yes:n.i18n("yes"),no:n.i18n("no"),link:n.i18n("link"),owner:n.i18n("owner"),group:n.i18n("group"),perm:n.i18n("perm"),getlink:n.i18n("getLink")};this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title {dirclass}"><span class="elfinder-cwd-icon {class} ui-corner-all"></span>{title}</div><table class="elfinder-info-tb">{content}</table>',itemTitle:'<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>',groupTitle:"<strong>{items}: {num}</strong>",row:"<tr><td>{label} : </td><td>{value}</td></tr>",spinner:'<span>{text}</span> <span class="'+z+" "+z+'-{name}"></span>'},this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+i"}],this.init=function(){Ce.each(O,function(e,t){O[e]=n.i18n(t)})},this.getstate=function(){return 0},this.exec=function(e){var t=this.files(e);t.length||(t=this.files([this.fm.cwd().hash]));function i(e,t){k.find("."+z+"-"+t).parent().html(e)}var n,a,r,o,s,l,d,c,u=this.fm,h=this.options,p=this.tpl,f=p.row,m=t.length,g=[],v=p.main,b="{label}",y="{value}",w=[],x={title:this.title,width:"auto",close:function(){Ce(this).elfinderdialog("destroy"),Ce.each(w,function(e,t){t=t&&t.xhr?t.xhr:null;t&&"pending"==t.state()&&(t.quiet=!0,t.abort())})}},e=[],C=u.namespace+"-info-"+Ce.map(t,function(e){return e.hash}).join("-"),k=u.getUI().find("#"+C),T=[];return m?k.length?(k.elfinderdialog("toTop"),Ce.Deferred().resolve()):(1==m?(r=t[0],v=v.replace("{dirclass}",r.csscls?u.escape(r.csscls):"").replace("{class}",u.mime2class(r.mime)),o=p.itemTitle.replace("{name}",u.escape(r.i18||r.name)).replace("{kind}",'<span title="'+u.escape(r.mime)+'">'+u.mime2kind(r)+"</span>"),a=u.tmb(r),r.read?"directory"!=r.mime||r.alias?n=u.formatSize(r.size):(n=p.spinner.replace("{text}",O.calc).replace("{name}","size"),e.push(r.hash)):n=O.unknown,g.push(f.replace(b,O.size).replace(y,n)),r.alias&&g.push(f.replace(b,O.aliasfor).replace(y,r.alias)),(s=u.path(r.hash,!0))?g.push(f.replace(b,O.path).replace(y,u.escape(s))):(g.push(f.replace(b,O.path).replace(y,p.spinner.replace("{text}",O.calc).replace("{name}","path"))),w.push(u.path(r.hash,!0,{notify:null}).fail(function(){i(O.unknown,"path")}).done(function(e){i(e,"path")}))),g.push(f.replace(b,O.modify).replace(y,u.formatDate(r))),g.push(f.replace(b,O.perms).replace(y,u.formatPermissions(r))),g.push(f.replace(b,O.locked).replace(y,r.locked?O.yes:O.no)),r.owner&&g.push(f.replace(b,O.owner).replace(y,r.owner)),r.group&&g.push(f.replace(b,O.group).replace(y,r.group)),r.perm&&g.push(f.replace(b,O.perm).replace(y,u.formatFileMode(r.perm))),h.custom&&Ce.each(h.custom,function(e,t){t.mimes&&!Ce.map(t.mimes,function(e){return r.mime===e||0===r.mime.indexOf(e+"/")||null}).length||t.hashRegex&&!r.hash.match(t.hashRegex)||(g.push(f.replace(b,u.i18n(t.label)).replace(y,t.tpl.replace("{id}",C))),t.action&&"function"==typeof t.action&&T.push(t.action))})):(v=v.replace("{class}","elfinder-cwd-icon-group"),o=p.groupTitle.replace("{items}",O.items).replace("{num}",m),(s=Ce.map(t,function(e){return"directory"==e.mime?1:null}).length)?(s-=h=Ce.map(t,function(e){return"directory"!==e.mime||e.phash&&!e.isroot?null:1}).length,g.push(f.replace(b,O.kind).replace(y,h===m||s===m?O[h?"roots":"folders"]:Ce.map({roots:h,folders:s,files:m-h-s},function(e,t){return e?O[t]+" "+e:null}).join(", "))),g.push(f.replace(b,O.size).replace(y,p.spinner.replace("{text}",O.calc).replace("{name}","size"))),e=Ce.map(t,function(e){return e.hash})):(n=0,Ce.each(t,function(e,t){t=parseInt(t.size);0<=t&&0<=n?n+=t:n="unknown"}),g.push(f.replace(b,O.kind).replace(y,O.files)),g.push(f.replace(b,O.size).replace(y,u.formatSize(n))))),v=v.replace("{title}",o).replace("{content}",g.join("")),(k=u.dialog(v,x)).attr("id",C),r&&"1"==r.url&&k.on("click","."+z+"-url",function(){Ce(this).parent().html(p.spinner.replace("{text}",u.i18n("ntfurl")).replace("{name}","url")),u.request({data:{cmd:"url",target:r.hash},preventDefault:!0}).fail(function(){i(name_esc,"url")}).done(function(e){e.url?(i('<a href="'+e.url+'" target="_blank">'+name_esc+"</a>"||name_esc,"url"),u.file(r.hash).url=e.url):i(name_esc,"url")})}),a&&Ce("<img>").on("load",function(){k.find(".elfinder-cwd-icon").addClass(a.className).css("background-image","url('"+a.url+"')")}).attr("src",a.url),e.length&&(l=e,u.autoSync("stop"),d=Ce.Deferred(),0<(c=Object.keys(u.leafRoots).length)?Ce.each(u.leafRoots,function(e){var t,n;t=e,n=Ce.Deferred(),e=u.file(t),(t=e?e.phash:t)&&!u.file(t)?u.request({data:{cmd:"parents",target:t},preventFail:!0}).done(function(){u.one("parentsdone",function(){n.resolve()})}).fail(function(){n.resolve()}):n.resolve(),n.done(function(){--c<1&&d.resolve()})}):d.resolve(),d.done(function(){var e=[],t={},n=[];Ce.each(l,function(){var i,a;e.push.apply(e,(i=u.file(this),a=[],"directory"===i.mime&&Ce.each(u.leafRoots,function(e,t){var n;if(e===i.hash)a.push.apply(a,t);else for(n=(u.file(e)||{}).phash;n;)n===i.hash&&a.push.apply(a,t),n=(u.file(n)||{}).phash}),a))}),l.push.apply(l,e),Ce.each(l,function(){var e=u.root(this);t[e]?t[e].push(this):t[e]=[this]}),Ce.each(t,function(){n.push(u.request({data:{cmd:"size",targets:this},preventDefault:!0}))}),w.push.apply(w,n),Ce.when.apply(Ce,n).fail(function(){i(O.unknown,"size")}).done(function(){for(var e=0,t=arguments.length,n=0;n<t;n++)e+=parseInt(arguments[n].size);i(0<=e?u.formatSize(e):O.unknown,"size")}),u.autoSync()})),void(T.length&&Ce.each(T,function(e,t){try{t(r,u,k)}catch(e){u.debug("error",e)}}))):Ce.Deferred().reject()}}).prototype={forceLoad:!0},ye.prototype.commands.mkdir=function(){var i,a=this.fm,n=this;this.value="",this.disableOnSearch=!0,this.updateOnSelect=!1,this.mime="directory",this.prefix="untitled folder",this.exec=function(e){return this.origin=i||"cwd",e||this.options.intoNewFolderToolbtn||a.getUI("cwd").trigger("unselectall"),this.move=!("navbar"===this.origin||!a.selected().length),Ce.proxy(a.res("mixin","make"),n)()},this.shortcuts=[{pattern:"ctrl+shift+n"}],this.init=function(){this.options.intoNewFolderToolbtn&&(this.options.ui="mkdirbutton")},a.bind("select",function(e){var t=e.data&&e.data.selected?e.data.selected:[];i=t.length&&e.data.origin||"",n.title=t.length&&"navbar"!==i?a.i18n("cmdmkdirin"):a.i18n("cmdmkdir"),n.update(void 0,n.title)}),this.getstate=function(e){var t=a.cwd(),n=(e="navbar"===i||e&&e[0]!=t.hash?this.files(e||a.selected()):[]).length;return"navbar"===i?!this._disabled&&n&&e[0].write&&e[0].read?0:-1:this._disabled||!t.write||n&&Ce.map(e,function(e){return e.read&&!e.locked?e:null}).length!=n?-1:0}},ye.prototype.commands.mkfile=function(){this.disableOnSearch=!0,this.updateOnSelect=!1,this.mime="text/plain",this.prefix="untitled file.txt",this.exec=Ce.proxy(this.fm.res("mixin","make"),this),this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1}},(ye.prototype.commands.open=function(){this.alwaysEnabled=!0,this._handlers={dblclick:function(e){e.preventDefault(),this.exec()},"select enable disable reload":function(e){this.update("disable"==e.type?-1:void 0)}},this.shortcuts=[{pattern:"ctrl+down numpad_enter"+("mac"!=this.fm.OS&&" enter")}],this.getstate=function(e){var t=(e=this.files(e)).length;return 1==t?e[0].read?0:-1:t&&!this.fm.UA.Mobile&&Ce.map(e,function(e){return"directory"!=e.mime&&e.read?e:null}).length==t?0:-1},this.exec=function(e,t){var n,i=this.fm,a=Ce.Deferred().fail(function(e){e&&i.error(e)}),r=this.files(e),o=r.length,s="object"==typeof t&&t.thash,t=this.options;if(!o&&!s)return a.reject();if(s||1==o&&(n=r[0])&&"directory"==n.mime)return s||!n||n.read?i.request({data:{cmd:"open",target:s||n.hash},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0,lazy:!1}):a.reject(["errOpen",n.name,"errPerm"]);if(r=Ce.map(r,function(e){return"directory"!=e.mime?e:null}),o!=r.length)return a.reject();function l(){try{new RegExp(i.option("dispInlineRegex"))}catch(e){0}for(o=r.length;o--;)n=r[o],Efw("elfinder_file",{cmd:"file",home:i.options.customData.home,isAbs:i.options.customData.isAbs,readonly:i.options.customData.readonly,id:i.options.customData.id,target:n.hash},i.options.appurl);return a.resolve(e)}return 1<o?i.confirm({title:"openMulti",text:["openMultiConfirm",o+""],accept:{label:"cmdopen",callback:function(){l()}},cancel:{label:"btnCancel",callback:function(){a.reject()}},buttons:i.getCommand("zipdl")&&i.isCommandEnabled("zipdl",i.cwd().hash)?[{label:"cmddownload",callback:function(){i.exec("download",e),a.reject()}}]:[]}):l(),a}}).prototype={forceLoad:!0},ye.prototype.commands.opendir=function(){this.alwaysEnabled=!0,this.getstate=function(){return 1===this.fm.selected().length&&this.fm.getUI("workzone").hasClass("elfinder-search-result")?0:-1},this.exec=function(e){var t=this.fm,n=Ce.Deferred(),e=this.files(e);return e.length&&e[0].phash?(e=e[0].phash,t.trigger("searchend",{noupdate:!0}),t.request({data:{cmd:"open",target:e},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!1}),n):n.reject()}},ye.prototype.commands.paste=function(){this.updateOnSelect=!1,this.handlers={changeclipboard:function(){this.update()}},this.shortcuts=[{pattern:"ctrl+v shift+insert"}],this.getstate=function(e){if(this._disabled)return-1;if(e){if(Ce.isArray(e)){if(1!=e.length)return-1;e=this.fm.file(e[0])}}else e=this.fm.cwd();return this.fm.clipboard().length&&"directory"==e.mime&&e.write?0:-1},this.exec=function(a){var n,i,r,e,o,s,l,d,c,t,u=this,h=u.fm,a=a?this.files(a)[0]:h.cwd(),p=h.clipboard(),f=p.length,m=!!f&&p[0].cut,g=m?"errMove":"errCopy",v=[],b=[],y=Ce.Deferred().fail(function(e){e&&h.error(e)}).always(function(){h.unlockfiles({files:Ce.map(p,function(e){return e.hash})})});return f&&a&&"directory"==a.mime?a.write?(n=h.parents(a.hash),Ce.each(p,function(e,t){return t.read?m&&t.locked?!y.reject(["errLocked",t.name]):-1!==Ce.inArray(t.hash,n)?!y.reject(["errCopyInItself",t.name]):t.mime&&"directory"!==t.mime&&!h.uploadMimeCheck(t.mime,a.hash)?!y.reject([g,t.name,"errUploadMime"]):((i=h.parents(t.hash)).pop(),-1!==Ce.inArray(a.hash,i)&&Ce.map(i,function(e){e=h.file(e);return e.phash==a.hash&&e.name==t.name?e:null}).length?!y.reject(["errReplByChild",t.name]):void(t.phash==a.hash?b.push(t.hash):v.push({hash:t.hash,phash:t.phash,name:t.name}))):!y.reject([g,t.name,"errPerm"])}),"rejected"==y.state()?y:Ce.when((t=b).length&&h._commands.duplicate?h.exec("duplicate",t):Ce.Deferred().resolve(),(r=v,o=Ce.Deferred(),s=[],l={},d=function(n){var e=s[n],e=r[e],i=n==s.length-1;e&&h.confirm({title:h.i18n(m?"moveFiles":"copyFiles"),text:["errExists",e.name,"confirmRepl"],all:!i,accept:{label:"btnYes",callback:function(e){i||e?c(r):d(++n)}},reject:{label:"btnNo",callback:function(e){var t;if(e)for(t=s.length;n<t--;)r[s[t]].remove=!0;else r[s[n]].remove=!0;i||e?c(r):d(++n)}},cancel:{label:"btnCancel",callback:function(){o.resolve()}},buttons:[]})},c=function(e){var t,n=[],i=(e=Ce.map(e,function(e){return e.rename&&n.push(e.name),e.remove?null:e})).length;if(!i)return o.resolve();t=e[0].phash,e=Ce.map(e,function(e){return e.hash}),h.request({data:{cmd:"paste",dst:a.hash,targets:e,cut:m?1:0,src:t,renames:n,hashes:l,suffix:h.options.backupSuffix},notify:{type:m?"move":"copy",cnt:i}}).done(function(e){var t,n;o.resolve(e),e&&e.added&&e.added[0]&&h.one("pastedone",function(){(t=h.findCwdNodes(e.added)).length?t.trigger("scrolltoview"):(a.hash!==h.cwd().hash?n=Ce("<div></div>").append(Ce('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all"><span class="ui-button-text">'+h.i18n("cmdopendir")+"</span></button>").on("mouseenter mouseleave",function(e){Ce(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click",function(){h.exec("open",a.hash).done(function(){h.one("opendone",function(){h.trigger("selectfiles",{files:Ce.map(e.added,function(e){return e.hash})})})})})):h.trigger("selectfiles",{files:Ce.map(e.added,function(e){return e.hash})}),h.toast({msg:h.i18n(["complete",h.i18n("cmd"+(m?"move":"copy"))]),extNode:n}))})}).always(function(){h.unlockfiles({files:e})})},h.isCommandEnabled(u.name,a.hash)&&r.length?(!h.oldAPI&&h.option("copyOverwrite")?(e=Ce.map(r,function(e){return e.name}),a.hash==h.cwd().hash?x(Ce.map(h.files(),function(e){return e.phash==a.hash?{hash:e.hash,name:e.name}:null})):h.request({data:{cmd:"ls",target:a.hash,intersect:e},notify:{type:"prepare",cnt:1,hideCnt:!0},preventFail:!0}).always(function(e){x(e.list)})):c(r),o):o.resolve())).always(function(){m&&h.clipboard([])})):y.reject([g,p[0].name,"errPerm"]):y.reject();function w(e,t){for(var n=[],i=e.length;i--;)-1!==Ce.inArray(e[i].name,t)&&n.unshift(i);return n}function x(e){var t,n={};e&&(Ce.isArray(e)?e.length&&("string"==typeof e[0]?s=w(r,e):(Ce.each(e,function(e,t){n[t.name]=t.hash}),s=w(r,Ce.map(n,function(e,t){return t})),Ce.each(r,function(e,t){n[t.name]&&(l[n[t.name]]=t.name)}))):(t=[],s=Ce.map(e,function(e){return"string"==typeof e?e:(t=t.concat(e),null)}),t.length&&(s=s.concat(t)),s=w(r,s),l=e)),s.length?d(0):c(r)}}},(ye.prototype.commands.reload=function(){var n=this,i=!1;this.alwaysEnabled=!0,this.updateOnSelect=!0,this.shortcuts=[{pattern:"ctrl+shift+r f5"}],this.getstate=function(){return 0},this.init=function(){this.fm.bind("search searchend",function(e){i="search"==e.type})},this.fm.bind("contextmenu",function(e){var t=n.fm;1e3<=t.options.sync&&(n.extra={icon:"accept",node:Ce("<span></span>").attr({title:t.i18n("autoSync")}).on("click touchstart",function(e){"touchstart"===e.type&&1<e.originalEvent.touches.length||(e.stopPropagation(),e.preventDefault(),Ce(this).parent().toggleClass("ui-state-disabled",t.options.syncStart).parent().removeClass("ui-state-hover"),t.options.syncStart=!t.options.syncStart,t.autoSync(t.options.syncStart?null:"stop"))}).on("ready",function(){Ce(this).parent().toggleClass("ui-state-disabled",!t.options.syncStart).css("pointer-events","auto")})})}),this.exec=function(){var e=this.fm;if(!i){var t=e.sync(),n=setTimeout(function(){e.notify({type:"reload",cnt:1,hideCnt:!0}),t.always(function(){e.notify({type:"reload",cnt:-1})})},e.notifyDelay);return t.always(function(){clearTimeout(n),e.trigger("reload")})}Ce("div.elfinder-toolbar > div."+e.res("class","searchbtn")+" > span.ui-icon-search").click()}}).prototype={forceLoad:!0},ye.prototype.commands.rename=function(){this.shortcuts=[{pattern:"f2"+("mac"==this.fm.OS?" enter":"")}],this.getstate=function(e){e=this.files(e);return this._disabled||1!=e.length||!e[0].phash||e[0].locked?-1:0},this.exec=function(e,t){function n(){setTimeout(function(){g&&g.blur()},50)}function i(){w.is(":hidden")||w.addClass("ui-front").elfinderoverlay("hide").off("click",x),y.removeClass("ui-front").css("position","").off("unselect."+o.namespace,n),f?b.css("max-height",""):h||y.css("width","").parent("td").css("overflow","")}function a(){var e=Ce.trim(g.val()),t=(g.parent(),!0);if(!k&&y.length){if(g.off("blur"),g[0].setSelectionRange&&g[0].setSelectionRange(0,0),e==d.name)return m.reject();if(o.options.validName&&o.options.validName.test)try{t=o.options.validName.test(e)}catch(e){t=!1}return e&&".."!==e&&t?o.fileByName(e,d.phash)?(k=!0,o.error(["errExists",e],{modal:!0,close:v}),!1):(i(),(h?g:b).html(o.escape(e)),o.lockfiles({files:[d.hash]}),void o.request({data:{cmd:"rename",target:d.hash,name:e},notify:{type:"rename",cnt:1}}).fail(function(e){m.reject(),e&&Ce.isArray(e)&&"errRename"===e[0]||o.sync()}).done(function(e){m.resolve(e),!h&&e&&e.added&&e.added[0]&&((e=o.findCwdNodes(e.added)).length&&e.trigger("scrolltoview"))}).always(function(){o.unlockfiles({files:[d.hash]})})):(k=!0,o.error("errInvName",{modal:!0,close:v}),!1)}}var r,o=this.fm,s=o.getUI("cwd"),l=e||!!o.selected().length&&o.selected()||[o.cwd().hash],e=l.length,d=o.file(l.shift()),c=".elfinder-cwd-filename",t=t||{},u=o.cwd().hash==d.hash,t=t._currentType||(u?"navbar":"files"),h="navbar"===t,p=Ce("#"+o[h?"navHash2Id":"cwdHash2Id"](d.hash)),f="files"===t&&"list"!=o.storage("view"),m=Ce.Deferred().done(function(e){u&&o.exec("open",e.added[0].hash)}).fail(function(e){var t=g.parent(),n=o.escape(d.i18||d.name);f&&(n=n.replace(/([_.])/g,"&#8203;$1")),h?g.replaceWith(n):t.length?(g.remove(),t.html(n)):(p.find(c).html(n),setTimeout(function(){s.find("#"+o.cwdHash2Id(d.hash)).click()},50)),e&&o.error(e)}).always(function(){i(),o.unbind("resize",C),o.enable()}),g=Ce(f?"<textarea></textarea>":'<input type="text">').on("keyup text",function(){f?(this.style.height="1px",this.style.height=this.scrollHeight+"px"):r&&(this.style.width=r+"px",this.scrollWidth>r&&(this.style.width=this.scrollWidth+10+"px"))}).on("keydown",function(e){e.stopImmediatePropagation(),e.keyCode==Ce.ui.keyCode.ESCAPE?m.reject():e.keyCode==Ce.ui.keyCode.ENTER&&(e.preventDefault(),g.blur())}).on("mousedown click dblclick",function(e){e.stopPropagation(),"dblclick"===e.type&&e.preventDefault()}).on("blur",a),v=function(){var e=g.val().replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/gi,"");k&&(k=!1,g.on("blur",a)),o.UA.Mobile&&w.on("click",x).removeClass("ui-front").elfinderoverlay("show"),g.select().focus(),g[0].setSelectionRange&&g[0].setSelectionRange(0,e.length)},b=h?p.contents().filter(function(){return 3==this.nodeType&&Ce(this).parent().attr("id")===o.navHash2Id(d.hash)}):p.find(c),y=b.parent(),w=o.getUI("overlay"),x=function(e){k||(e.stopPropagation(),m.reject())},C=function(){p.trigger("scrolltoview")},k=!1;return y.addClass("ui-front").css("position","relative").on("unselect."+o.namespace,n),o.bind("resize",C),h?b.replaceWith(g.val(d.name)):(f?b.css("max-height","none"):h||(r=y.width(),y.width(r-15).parent("td").css("overflow","visible")),b.empty().append(g.val(d.name))),1<e?m.reject():d&&b.length?d.locked?m.reject(["errLocked",d.name]):(o.one("select",function(){g.parent().length&&d&&-1===Ce.inArray(d.hash,o.selected())&&g.blur()}),g.trigger("keyup"),v(),m):m.reject("errCmdParams",this.title)}},ye.prototype.commands.rm=function(){this.shortcuts=[{pattern:"delete ctrl+backspace"}],this.getstate=function(e){var n=this.fm;return e=e||n.selected(),!this._disabled&&e.length&&Ce.map(e,function(e){var t=n.file(e);return!t||t.locked||n.isRoot(t)?null:e}).length==e.length?0:-1},this.exec=function(e){var t,n,i,a,r,o=this.fm,s=Ce.Deferred().fail(function(e){e&&o.error(e)}),l=this.files(e),d=l.length,c=o.cwd().hash,u='<div class="ui-helper-clearfix elfinder-rm-title"><span class="elfinder-cwd-icon {class} ui-corner-all"></span>{title}<div class="elfinder-rm-desc">{desc}</div></div>';return d?(Ce.each(l,function(e,t){return o.isRoot(t)?!s.reject(["errRm",t.name,"errPerm"]):t.locked?!s.reject(["errLocked",t.name]):void 0}),"pending"==s.state()&&(t=this.hashes(e),a=[],(a=1<(d=l.length)?(Ce.map(l,function(e){return"directory"==e.mime?1:null}).length||(n=0,Ce.each(l,function(e,t){if(!t.size||"unknown"==t.size)return!(n="unknown");t=parseInt(t.size);0<=t&&0<=n&&(n+=t)}),a.push(o.i18n("size")+": "+o.formatSize(n))),[Ce(u.replace("{class}","elfinder-cwd-icon-group").replace("{title}","<strong>"+o.i18n("items")+": "+d+"</strong>").replace("{desc}",a.join("<br>")))]):(e=l[0],i=o.tmb(e),e.size&&a.push(o.i18n("size")+": "+o.formatSize(e.size)),a.push(o.i18n("modify")+": "+o.formatDate(e)),l=o.escape(e.i18||e.name).replace(/([_.])/g,"&#8203;$1"),[Ce(u.replace("{class}",o.mime2class(e.mime)).replace("{title}","<strong>"+l+"</strong>").replace("{desc}",a.join("<br>")))])).push("confirmRm"),o.lockfiles({files:t}),r=o.confirm({title:this.title,text:a,accept:{label:"btnRm",callback:function(){o.request({data:{cmd:"rm",targets:t},notify:{type:"rm",cnt:d},preventFail:!0}).fail(function(e){s.reject(e)}).done(function(e){s.done(e)}).always(function(){o.unlockfiles({files:t})})}},cancel:{label:"btnCancel",callback:function(){o.unlockfiles({files:t}),1===t.length&&o.file(t[0]).phash!==c?o.select({selected:t}):o.selectfiles({files:t}),s.reject()}}}),i&&Ce("<img>").on("load",function(){r.find(".elfinder-cwd-icon").addClass(i.className).css("background-image","url('"+i.url+"')")}).attr("src",i.url)),s):s.reject()}},ye.prototype.commands.sort=function(){function e(){o.variants=[],Ce.each(s.sortRules,function(e,t){var n,i={type:e,order:e==s.sortType?"asc"==s.sortOrder?"desc":"asc":s.sortOrder};-1!==Ce.inArray(e,s.sorters)&&(n=e==s.sortType?"asc"==i.order?"s":"n":"",o.variants.push([i,(n?'<span class="ui-icon ui-icon-arrowthick-1-'+n+'"></span>':"")+"&nbsp;"+s.i18n("sort"+e)]))}),o.variants.push("|"),o.variants.push([{type:s.sortType,order:s.sortOrder,stick:!s.sortStickFolders,tree:s.sortAlsoTreeview},(s.sortStickFolders?'<span class="ui-icon ui-icon-check"></span>':"")+"&nbsp;"+s.i18n("sortFoldersFirst")]),s.ui.tree&&(o.variants.push("|"),o.variants.push([{type:s.sortType,order:s.sortOrder,stick:s.sortStickFolders,tree:!s.sortAlsoTreeview},(s.sortAlsoTreeview?'<span class="ui-icon ui-icon-check"></span>':"")+"&nbsp;"+s.i18n("sortAlsoTreeview")]))}var o=this,s=o.fm;this.options={ui:"sortbutton"},s.bind("open sortchange",e).bind("open",function(){s.unbind("add",e).one("add",e),s.getUI("toolbar").find(".elfiner-button-sort .elfinder-button-menu .elfinder-button-menu-item").each(function(){var e=Ce(this),t=e.attr("rel");e.toggle(!t||-1!==Ce.inArray(t,s.sorters))})}).bind("cwdrender",function(){var r=Ce(s.cwd).find("div.elfinder-cwd-wrapper-list table");r.length&&Ce.each(s.sortRules,function(e,t){var n,i,a=r.find("thead tr td.elfinder-cwd-view-th-"+e);a.length&&(i=e==s.sortType,n={type:e,order:i?"asc"==s.sortOrder?"desc":"asc":s.sortOrder},i&&(a.addClass("ui-state-active"),i="asc"==s.sortOrder?"n":"s",Ce('<span class="ui-icon ui-icon-triangle-1-'+i+'"></span>').appendTo(a)),Ce(a).on("click",function(e){Ce(this).data("dragging")||(e.stopPropagation(),s.getUI("cwd").data("longtap")||o.exec([],n))}).hover(function(){Ce(this).addClass("ui-state-hover")},function(){Ce(this).removeClass("ui-state-hover")}))})}),this.getstate=function(){return 0},this.exec=function(e,t){var n=this.fm,i=Ce.extend({type:n.sortType,order:n.sortOrder,stick:n.sortStickFolders,tree:n.sortAlsoTreeview},t);return n.lazy(function(){n.setSort(i.type,i.order,i.stick,i.tree),this.resolve()})}},(ye.prototype.commands.up=function(){this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+up"}],this.getstate=function(){return this.fm.cwd().phash?0:-1},this.exec=function(){var e=this.fm,t=e.cwd().hash;return this.fm.cwd().phash?this.fm.exec("open",this.fm.cwd().phash).done(function(){e.one("opendone",function(){e.selectfiles({files:[t]})})}):Ce.Deferred().reject()}}).prototype={forceLoad:!0},ye.prototype.commands.upload=function(){var y=this.fm.res("class","hover");this.disableOnSearch=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+u"}],this.getstate=function(e){var t,n=this.fm,e=e||[n.cwd().hash];return this._disabled||1!=e.length||(t=n.file(e[0])),t&&"directory"==t.mime&&t.write?0:-1},this.exec=function(e){function c(e){h.upload(e).fail(function(e){v.reject(e)}).done(function(e){var t,n;h.getUI("cwd");v.resolve(e),e&&e.added&&e.added[0]&&!h.ui.notify.children(".elfinder-notify-upload").length&&((n=h.findCwdNodes(e.added)).length?n.trigger("scrolltoview"):(g.hash!==p?t=Ce("<div></div>").append(Ce('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">'+h.i18n("cmdopendir")+"</span></button>").on("mouseenter mouseleave",function(e){Ce(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click",function(){h.exec("open",m).done(function(){h.one("opendone",function(){h.trigger("selectfiles",{files:Ce.map(e.added,function(e){return e.hash})})})})})):h.trigger("selectfiles",{files:Ce.map(e.added,function(e){return e.hash})}),h.toast({msg:h.i18n(["complete",h.i18n("cmdupload")]),extNode:t})))})}function o(e){"files"!==e.type&&s.elfinderdialog("close"),f&&(e.target=f[0]),c(e)}function t(){var t=g.hash,o=Ce.map(h.files(),function(e){return"directory"===e.mime&&e.write&&e.phash&&e.phash===t?e:null});return o.length?Ce('<div class="elfinder-upload-dirselect elfinder-tabstop" title="'+h.i18n("folders")+'"></div>').on("click",function(e){e.stopPropagation(),e.preventDefault(),o=h.sortFiles(o);function n(t,e){return{label:h.escape(t.i18||t.name),icon:e,remain:!1,callback:function(){var e=a.children(".ui-dialog-titlebar:first").find("span.elfinder-upload-target");f=[t.hash],e.html(" - "+h.escape(t.i18||t.name)),i.focus()},options:{className:f&&f.length&&t.hash===f[0]?"ui-state-active":"",iconClass:t.csscls||"",iconImg:t.icon||""}}}var i=Ce(this),a=(h.cwd(),s.closest("div.ui-dialog")),r=[n(g,"opendir"),"|"];Ce.each(o,function(e,t){r.push(n(t,"dir"))}),i.blur(),h.trigger("contextmenu",{raw:r,x:e.pageX||Ce(this).offset().left,y:e.pageY||Ce(this).offset().top,prevNode:a,fitHeight:!0})}).append('<span class="elfinder-button-icon elfinder-button-icon-dir"></span>'):Ce()}function n(e,t){var n=Ce('<input type="file" '+e+">").change(function(){o({input:n.get(0),type:"files"})}).on("dragover",function(e){e.originalEvent.dataTransfer.dropEffect="copy"});return Ce('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-tabstop elfinder-focus"><span class="ui-button-text">'+h.i18n(t)+"</span></div>").append(Ce("<form></form>").append(n)).on("click",function(e){e.target===this&&(e.stopPropagation(),e.preventDefault(),n.click())}).hover(function(){Ce(this).toggleClass(y)})}var s,i,a,r,l,d,u,h=this.fm,p=h.cwd().hash,f=(d=e&&e instanceof Array?e:null,e||(d=d||1!==(l=h.selected()).length||"directory"!==h.file(l[0]).mime?[p]:l),d),m=!f&&e&&e.target?e.target:f[0],g=m?h.file(m):h.cwd(),v=Ce.Deferred(),b=function(e){e.stopPropagation(),e.preventDefault();var t,n,i,a=!1,r="",o=null,s=e._target||null,l=e.dataTransfer||null,d=l.items&&l.items.length&&l.items[0].kind?l.items[0].kind:"";if(l){try{if(t=l.getData("elfinderfrom"),t&&(n=window.location.href+h.cwd().hash,!s&&t===n||s===n))return void v.reject()}catch(e){}if("file"===d&&(l.items[0].getAsEntry||l.items[0].webkitGetAsEntry))a=l,r="data";else if("string"!==d&&l.files&&l.files.length&&-1===Ce.inArray("Text",l.types))a=l.files,r="files";else{try{(o=l.getData("text/html"))&&o.match(/<(?:img|a)/i)&&(a=[o],r="html")}catch(e){}!a&&(o=l.getData("text"))&&(a=[o],r="text")}}a?c({files:a,type:r,target:s,dropEvt:e}):(i=["errUploadNoFiles"],"file"===d&&i.push("errFolderUpload"),h.error(i),v.reject())};return!f&&e?e.input||e.files?(e.type="files",c(e)):e.dropEvt&&b(e.dropEvt):(i=function(e){var t,n,i=[];if((e=e.originalEvent||e).clipboardData){if(e.clipboardData.items&&e.clipboardData.items.length){t=e.clipboardData.items;for(var a=0;a<t.length;a++)"file"==e.clipboardData.items[a].kind&&(n=e.clipboardData.items[a].getAsFile(),i.push(n))}else e.clipboardData.files&&e.clipboardData.files.length&&(i=e.clipboardData.files);if(i.length)return void o({files:i,type:"files"})}var r=e.target||e.srcElement;setTimeout(function(){var e,t;r.innerHTML&&(Ce(r).find("img").each(function(e,t){t.src.match(/^webkit-fake-url:\/\//)&&Ce(t).remove()}),t=(e=r.innerHTML.replace(/<br[^>]*>/gi," ")).match(/<[^>]+>/)?"html":"text",r.innerHTML="",o({files:[e],type:t}))},1)},s=Ce('<div class="elfinder-upload-dialog-wrapper"></div>').append(n("multiple","selectForUpload")),h.UA.Mobile||void 0===(u=document.createElement("input")).webkitdirectory&&void 0===u.directory||s.append(n("multiple webkitdirectory directory","selectFolder")),g.dirs&&(g.hash===p||Ce("#"+h.navHash2Id(g.hash)).hasClass("elfinder-subtree-loaded")?t().appendTo(s):(a=Ce('<div class="elfinder-upload-dirselect" title="'+h.i18n("nowLoading")+'"></div>').append('<span class="elfinder-button-icon elfinder-button-icon-spinner"></span>').appendTo(s),h.request({cmd:"tree",target:g.hash}).done(function(){h.one("treedone",function(){a.replaceWith(t()),r.elfinderdialog("tabstopsInit")})}).fail(function(){a.remove()}))),h.dragUpload?Ce('<div class="ui-corner-all elfinder-upload-dropbox elfinder-tabstop" contenteditable="true" data-ph="'+h.i18n("dropPasteFiles")+'"></div>').on("paste",function(e){i(e)}).on("mousedown click",function(){Ce(this).focus()}).on("focus",function(){this.innerHTML=""}).on("mouseover",function(){Ce(this).addClass(y)}).on("mouseout",function(){Ce(this).removeClass(y)}).on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),Ce(this).addClass(y)}).on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),Ce(this).removeClass(y)}).on("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy",Ce(this).addClass(y)}).on("drop",function(e){s.elfinderdialog("close"),f&&(e.originalEvent._target=f[0]),b(e.originalEvent)}).prependTo(s).after('<div class="elfinder-upload-dialog-or">'+h.i18n("or")+"</div>")[0]:Ce('<div class="ui-corner-all elfinder-upload-dropbox" contenteditable="true">'+h.i18n("dropFilesBrowser")+"</div>").on("paste drop",function(e){i(e)}).on("mousedown click",function(){Ce(this).focus()}).on("focus",function(){this.innerHTML=""}).on("dragenter mouseover",function(){Ce(this).addClass(y)}).on("dragleave mouseout",function(){Ce(this).removeClass(y)}).prependTo(s).after('<div class="elfinder-upload-dialog-or">'+h.i18n("or")+"</div>")[0],r=h.dialog(s,{title:this.title+'<span class="elfinder-upload-target">'+(g?" - "+h.escape(g.i18||g.name):"")+"</span>",modal:!0,resizable:!1,destroyOnClose:!0})),v}},ye.prototype.commands.view=function(){var n=this.fm;this.value=n.viewType,this.alwaysEnabled=!0,this.updateOnSelect=!1,this.options={ui:"viewbutton"},this.getstate=function(){return 0},this.exec=function(){var e=this,t=n.storage("view","list"==this.value?"icons":"list");return n.lazy(function(){n.viewchange(),e.update(void 0,t),this.resolve()})}},ye});

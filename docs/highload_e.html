<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/favicon.png" />
    <title>High-Load Tomcat EFW Environment Setup</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --primary-light: #4a6491;
            --accent: #3498db;
            --accent-light: #5dade2;
            --warning: #e74c3c;
            --success: #2ecc71;
            --text: #333;
            --text-light: #7f8c8d;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --border-radius: 10px;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            padding: 0;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(120deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            border-radius: 0 0 20px 20px;
            box-shadow: var(--box-shadow);
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            transform: rotate(30deg);
        }
        
        .logo {
            font-size: 36px;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .logo span {
            background: linear-gradient(45deg, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            font-weight: 300;
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.9;
        }
        
        .meta-info {
            margin-top: 20px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .section {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .section-title {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            color: var(--accent);
        }
        
        .note-box {
            background: #fff9e6;
            border-left: 5px solid #ffcc00;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 25px;
        }
        
        .note-title {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .note-title i {
            margin-right: 10px;
            color: #ffcc00;
        }
        
        .system-diagram {
            width: 100%;
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 25px 0;
            box-shadow: var(--box-shadow);
            overflow-x: auto;
        }
        
        .diagram-container {
            min-width: 800px;
            position: relative;
        }
        
        .server-node {
            background: var(--light);
            border: 2px solid var(--accent);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
            text-align: center;
            font-weight: 500;
        }
        
        .server-node::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -15px;
            width: 15px;
            height: 2px;
            background: var(--accent);
        }
        
        .server-node::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -15px;
            width: 15px;
            height: 2px;
            background: var(--accent);
        }
        
        .connection-line {
            height: 40px;
            border-left: 2px solid var(--accent);
            margin: 0 auto;
            width: 2px;
            position: relative;
        }
        
        .connection-line::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -4px;
            width: 10px;
            height: 10px;
            border-right: 2px solid var(--accent);
            border-bottom: 2px solid var(--accent);
            transform: translateY(-50%) rotate(45deg);
        }
        
        .queue-box {
            background: rgba(52, 152, 219, 0.1);
            border: 1px dashed var(--accent);
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
        }
        
        .queue-title {
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 5px;
        }
        
        .config-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .config-table th, .config-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .config-table th {
            background-color: var(--accent);
            color: white;
        }
        
        .config-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .config-table tr:hover {
            background-color: #e9f7fe;
        }
        
        .explanation-box {
            background: #e8f4fc;
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid var(--accent);
        }
        
        .scenario-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .scenario-box {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        .scenario-box:hover {
            transform: translateY(-5px);
        }
        
        .scenario-title {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent);
        }
        
        .scenario-warning {
            border-left: 5px solid var(--warning);
        }
        
        .scenario-success {
            border-left: 5px solid var(--success);
        }
        
        .scenario-content {
            margin-top: 15px;
        }
        
        .countdown {
            display: inline-block;
            background: var(--warning);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 700;
            margin-top: 10px;
        }
        
        footer {
            background: var(--primary);
            color: white;
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            border-radius: 20px 20px 0 0;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .section {
                padding: 20px;
            }
            
            .system-diagram {
                padding: 10px;
            }
            
            .diagram-container {
                min-width: 600px;
            }
        }
        
        .animated {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }
        
        .visible {
            opacity: 1;
            transform: translateY(0);
        }

        .image-container {
            flex: 1;
            min-width: 300px;
            text-align: center;
        }
        
        .image-placeholder {
            width: 100%;
            height: 300px;
            background: linear-gradient(45deg, #3498db, #2c3e50);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .image-placeholder:hover {
            transform: scale(1.03);
        }
        
        .image-container p {
            color: #7f8c8d;
            font-style: italic;
        }
                
        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.5);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .lang-btn {
            background: #238636;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .lang-btn:hover {
            background: #2ea043;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <button class="lang-btn" onclick="switchLanguage('en')">
             English
        </button>
        <button class="lang-btn" onclick="switchLanguage('jp')">
             日本語
        </button>
        <button class="lang-btn" onclick="switchLanguage('cn')">
             中文
        </button>
    </div>

    <header>
        <div class="container">
            <div class="logo">
                <i class="fas fa-server"></i>
                <span>EFW</span> Environment Setup Guide
            </div>
            <h1>High-Load Tomcat EFW Environment Setup</h1>
            <p class="subtitle">For Java Experienced Developers - Escco Japan Co., Ltd.</p>
        </div>
    </header>

    <div class="container">
        <section class="section animated">
            <h2 class="section-title"><i class="fas fa-question-circle"></i> What is "Concurrent Connections" in Web Systems?</h2>
            
            <div class="explanation-box">
                <p>"Concurrent connections" is a term often used in web system development, but it is frequently misused without a clear definition. Here, we will create a strict definition including several related terms.</p>
                
                <ul>
                    <li><strong>Maximum Login Users</strong>: After login, session information is created and occupies certain memory. Depending on the system method, if session memory is large, pay attention to the number of users logging in within the session timeout period.</li>
                    <li><strong>Maximum Concurrent Connections</strong>: TCP connections are considered "connected" from "Established" to "Closed". The number of open connections at any given time is the concurrent connection count. One screen operation generates two connections (JSP and various static content). After output completion, the connection is maintained for 15 seconds.</li>
                    <li><strong>Maximum Concurrent Executions</strong>: The number of requests the server can process simultaneously.</li>
                </ul>
            </div>

            <div class="note-box">
                <div class="note-title">
                    <i class="fas fa-exclamation-circle"></i>
                    Note
                </div>
                <p>If Proxy, FireWall, etc. have caching capabilities, connections to static content may not reach the WEB server. And to be more precise, it's not 2 but 1.X.</p>
            </div>
            
        </section>

        <section class="section animated">
            <h2 class="section-title"><i class="fas fa-project-diagram"></i> System Concept Diagram</h2>
            
            <!-- Placeholder for system concept diagram -->
            <div class="image-placeholder" style="height:400px;">
            	<img src="./img/efw_env.png" style="height:95%">
            </div>
            
            <div class="config-table">
                <table>
                    <tr>
                        <th>Configuration Item</th>
                        <th>Value</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td>ListenBacklog</td>
                        <td>3000</td>
                        <td>Maximum connection wait queue number for queuing requests of established TCP connections</td>
                    </tr>
                    <tr>
                        <td>maxConnections</td>
                        <td>1000</td>
                        <td>Maximum number of concurrent connections the server accepts and processes</td>
                    </tr>
                    <tr>
                        <td>acceptCount</td>
                        <td>100</td>
                        <td>Maximum queue length for incoming connection requests when all possible request processing threads are in use</td>
                    </tr>
                    <tr>
                        <td>MaxClients</td>
                        <td>100</td>
                        <td>Number of concurrent requests that can be responded to</td>
                    </tr>
                    <tr>
                        <td>maxthreads</td>
                        <td>200 (default)</td>
                        <td>Maximum number created for request processing (maximum concurrent executions)</极>
                    </tr>
                    <tr>
                        <td>ServerLimit</td>
                        <td>1000</td>
                        <td>Maximum configurable value for MaxClients (maximum during Apache process execution, limited to 20000 or less)</td>
                    </tr>
                </table>
            </div>
        </section>

        <section class="section animated">
            <h2 class="section-title"><i class="fas fa-cogs"></i> System Concept Diagram Explanation</h2>
            
            <div class="explanation-box">
                <p>When there are many connections from clients:</p>
                <ul>
                    <li>First stored in Apache's ListenBacklog queue,其中1000 connections are passed to Tomcat.</li>
                    <li>Tomcat receives connection requests and stores them in the Connection queue.</li>
                    <li>100 connections are moved from the Connection queue to the Accept queue for processing.</li>
                    <li>Subsequent connection requests fill the vacancies in the Connection queue.</li>
                    <li>To ensure the Connection queue does not exceed its maximum value, match the values of MaxClients and maxConnections.</li>
                </ul>
                
                <p>When processing connection requests in the Connection queue with the EFW framework:</p>
                <ul>
                    <li>For heavy processing, set a concurrently processable queue for each event. When the queue maximum is reached, return an error.</li>
                    <li>For light processing, do not set a concurrently processable queue.</li>
                </ul>
                
                <p>There are two types of errors when the event queue maximum is reached:</p>
                <ul>
                    <li>If retry is allowed, display an error message and count down for 30 seconds.</li>
                    <li>If set to no retry, only display an error message.</li>
                </ul>
            </div>
        </section>

        <section class="section animated">
            <h2 class="section-title"><i class="fas fa-exclamation-triangle"></i> Error Scenarios</h2>
            
            <div class="scenario-container">
                <div class="scenario-box scenario-warning">
                    <h3 class="scenario-title">ListenBacklog Queue Overflow</h3>
                    <div class="scenario-content">
                        <p>When the server connections are full, new operations will display the following error message:</p>
                        <div class="note-box">
                            <p>Connection error: The server is busy. Please try again after a while.</p>
                        </div>
                    </div>
                </div>
                
                <div class="scenario-box scenario-success">
                    <h3 class="scenario-title">Event Queue Overflow (Retry Allowed)</h3>
                    <div class="scenario-content">
                        <p>When heavy operations are restricted, the following countdown message will be displayed (30-second count). Retry allowed.</p>
                        <div class极"note-box">
                            <p>The system is busy. Please wait until the operation becomes available.</p>
                            <div class="countdown">30 seconds</div>
                        </div>
                    </div>
                </div>
                
                <div class="scenario-box scenario-warning">
                    <h3 class="scenario-title">Event Queue Overflow (No Retry)</h3>
                    <div class="scenario-content">
                        <p>When operations are restricted, the following busy message will be displayed. No retry.</p>
                        <div class="note-box">
                            <p>This function is busy. Please wait for a while.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section animated">
            <h2 class="section-title"><i class="fas fa-wrench"></i> Configuration Locations</h2>
            
            <div class="explanation-box">
                <p>Various parameters can be adjusted in the following configuration files:</p>
                
                <ul>
                    <li><strong>Apache Configuration (httpd.conf)</strong>: ListenBacklog, MaxClients, ServerLimit</li>
                    <li><strong>Tomcat Configuration (server.xml)</strong>: maxConnections, acceptCount, maxthreads</li>
                    <li><strong>EFW Configuration (efw.properties)</strong>: Event queue size, retry settings</li>
                    <li><strong>PostgreSQL Configuration (postgresql.conf)</strong>: max_connections</li>
                </ul>
                
                <p>To handle high-load environments, these values need to be appropriately adjusted according to system requirements.</p>
            </div>
        </section>
    </div>

    <footer>
        <div class="container">
            <p>High-Load Tomcat EFW Environment Setup - Escco Japan Co., Ltd.</p>
            <p>© 2025 EFW Group | Technical Documentation for Java Experienced Developers</p>
        </div>
    </footer>

    <script>
        // Language switching function
        function switchLanguage(lang) {
            const pages = {
                'cn': 'highload_c.html',
                'jp': 'highload_j.html',
                'en': 'highload_e.html'
            };
            window.location.href = pages[lang];
        }
        // Animation on scroll
        document.addEventListener('DOMContentLoaded', function() {
            const animatedElements = document.querySelectorAll('.animated');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1
            });
            
            animatedElements.forEach(element => {
                observer.observe(element);
            });
        });
    </script>
</body>
</html>
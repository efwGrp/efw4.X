# efw 大容量ファイル処理技術サンプル

## 概要

本サンプルは、efwフレームワークが大規模なテキストおよびCSVファイルを処理するための様々な最適化手法を示しています。特に大規模データシナリオにおけるメモリ管理、I/O効率、並行処理に対して完全なソリューションを提供します。

## コアファイル

1. **メインページ**: `helloTextCSV.jsp`
2. **固定長テキスト処理**: `helloTextCSV_submit.js`
3. **CSVフォーマット処理**: `helloTextCSV_submit2.js`

## 機能特性

### 1. 多様な処理モード

#### モード1：シンプル処理
- **特徴**: すべてのデータをメモリに一度に読み込み
- **適用シナリオ**: 小規模ファイル処理、メモリが十分な場合
- **リスク**: 大規模ファイルはメモリオーバーフローの原因となる可能性

#### モード2：行単位処理
- **特徴**: ストリーム読み取り、行単位処理
- **利点**: メモリ使用量が安定
- **欠点**: I/O操作が頻繁、パフォーマンスが低い

#### モード3：バッチ処理
- **特徴**: データをバッチ単位で読み取り・処理
- **優勢**: メモリ使用とI/O効率のバランス
- **設定**: バッチサイズ調整によるパフォーマンス最適化

#### モード4：Writer再利用
- **特徴**: CSV Writerの再利用によるファイル操作削減
- **優勢**: ファイルオープン/クローズ操作の大幅削減
- **注意**: Writerのライフサイクル管理が必要

#### モード5：IDグループ化
- **特徴**: データIDによるグループ化処理
- **優勢**: カテゴリ別処理が必要なシナリオに適応
- **応用**: データ配信、分類保存など

### 2. ファイルフォーマットサポート

#### 固定長テキストフォーマット
```javascript
new BinaryReader(
    "filename.txt", 
    [10, 10],        // フィールド長
    ["MS932", "MS932"], // エンコーディングフォーマット
    20               // レコード総長
)
```

#### CSVフォーマット
```javascript
new CSVReader(
    "filename.csv",
    ",", "\"",       // 区切り文字と引用符
    "MS932"          // エンコーディングフォーマット
)
```

### 3. パフォーマンス最適化特性

#### メモリ管理
- ストリーム処理による大規模メモリ使用の回避
- バッチ処理によるメモリ使用ピークの制御
- 自動クリーンアップとリソース解放

#### I/O最適化
- 不要なファイル操作の削減
- バッチ書き込みによるI/O効率向上
- インテリジェントバッファ管理

## 使用説明

### 1. ファイル準備

#### 入力ファイル構造
- **固定長テキスト**: フィールドが固定長で配置
- **CSVファイル**: 標準カンマ区切りフォーマット
- **文字エンコーディング**: MS932等多种エンコーディングをサポート

#### 出力ディレクトリ
処理前に自動的に出力ディレクトリをクリーンアップおよび作成：
```javascript
file.remove("text&csv/seperated");
file.makeDir("text&csv/seperated");
```

### 2. パフォーマンスチューニング推奨事項

#### バッチサイズ調整
データ特性に応じて処理バッチを調整：
```javascript
// 実際の状況に応じてバッチサイズを調整
if (index % batchSize == 0) {
    processBatch();
}
```

#### メモリ監視
大規模ファイル処理時はメモリ使用を監視し、オーバーフローを回避。

#### 例外処理
適切な例外処理メカニズムを追加し、プログラムの堅牢性を確保。

## 応用シナリオ

### 1. 大規模データ処理
- 大規模ログファイル分析
- データウェアハウスETL処理
- バッチデータ変換

### 2. データ配信
- ビジネスルールに基づくデータ配信
- 多目的出力処理
- リアルタイムデータストリーム処理

### 3. システム統合
- 従来システムとのデータ交換
- 多形式データ変換
- 異種システム統合

## まとめ

efwフレームワークは強力で柔軟な大規模ファイル処理能力を提供し、多様な処理モードの組み合わせにより、様々な複雑なデータ処理シナリオに対応できます。シンプルなメモリ処理から複雑なストリームバッチ処理まで、適切なソリューションを見つけることができます。

### コア優位性
1. **柔軟性**: 多様な処理モードとファイルフォーマットをサポート
2. **パフォーマンス**: 最適化されたメモリとI/O管理
3. **信頼性**: 完全な例外処理とリソース管理
4. **使いやすさ**: 簡潔なAPIと豊富なサンプル

### 選択推奨
- **小規模ファイル**: シンプルモードを使用して開発効率を向上
- **大規模ファイル**: ストリームまたはバッチモードを使用して安定性を確保
- **高パフォーマンス要求**: Writer再利用とバッチ処理を組み合わせて最適化

適切な処理モードとパラメータ設定を選択することで、KBからTBレベルまでの様々なデータファイルを効率的かつ安定的に処理できます。